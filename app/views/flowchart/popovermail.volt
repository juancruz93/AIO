<script>
  //var objMail = {"layout":{"id":1,"name":"layout-simple","description":"Layout Standard","icon":"/aio/images/editor/n1.png","zones":[{"name":"preheader","width":"full-width","widthval":600},{"name":"header","width":"full-width","widthval":600},{"name":"body","width":"full-width","widthval":600},{"name":"footer","width":"full-width","widthval":600}]},"dz":{"preheader":{"name":"preheader","width":"full-width","widthval":600,"parent":"#edit-area","background_color":"#FFFFFF","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"content":[]},"header":{"name":"header","width":"full-width","widthval":600,"parent":"#edit-area","background_color":"#FFFFFF","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"height":143,"width":276,"align":"center","vertalign":"middle","imgsrc":"/asset/show/193","imgalt":"33.png","type":"Image"}],"amount":1},{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"type":"Separator"}],"amount":1}]},"body":{"name":"body","width":"full-width","widthval":600,"parent":"#edit-area","background_color":"#FFFFFF","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"height":161,"width":318,"align":"center","vertalign":"middle","imgsrc":"/asset/show/191","imgalt":"Img-20160519-wa0001.jpg","type":"Image"}],"amount":1}]},"footer":{"name":"footer","width":"full-width","widthval":600,"parent":"#edit-area","background_color":"#FFFFFF","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"type":"Separator"}],"amount":1},{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"height":113,"width":182,"align":"center","vertalign":"middle","imgsrc":"/aio/asset/show/71","imgalt":"1836757_837971202883836_6966135472265559953_o.jpg","type":"Image"},{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":"<p><span data-redactor=\"verified\" data-redactor-inlinemethods=\"\" style=\"font-size: 11px;\"><span style=\"font-size: 11px;\">Este correo electronico ha sido enviado a %%EMAIL%%</span></span></p><p style=\"text-align: right;\"><span data-redactor=\"verified\" data-redactor-inlinemethods=\"\" style=\"font-size: 11px;\"><a href=\"%%WEBVERSION%%\">Version web</a><span>  | </span></span><span data-redactor=\"verified\" data-redactor-inlinemethods=\"\" style=\"font-size: 11px;\"><a href=\"%%UNSUBSCRIBE%%\">Eliminar suscripcion</a></span></p>","type":"Text"},{"contentData":[{"socialname":"Facebook","selected":true},{"socialname":"Twitter","selected":true},{"socialname":"LinkedIn","selected":false},{"socialname":"Google Plus","selected":false}],"align":"center","size":"xs","theme":2,"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"type":"Social-Share"}],"amount":3},{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"type":"Separator"}],"amount":1}]}},"content":{},"editorColor":"#fff"};
  var dataObjSelectMailTemplate;
  function iframeResize() {
    var iFrame = document.getElementById('iframeEditor');
    //iFrame.height = iFrame.contentWindow.document.body.scrollHeight + "px";
    iFrame.height = "650px";
  }
  function formatRepo(repo) {

    var markup = '<div class="clearfix">' +
      '<div clas="col-sm-10">' +
      '<div class="clearfix">' +
      '<div class="col-sm-6">' + repo.name + '</div>' +
      '</div>';


    markup += '</div></div>';

    return markup;
  }

  function formatRepoSelection(repo) {
    return repo.name;
  }
  $.fn.select2.defaults.set('language', 'es');
  $(function () {

    $("#mailTemplate").select2({
      theme: "classic",
      ajax: {
        url: fullUrlBase + "/api/mailtemplate/gettemplateautocomplete",
        //url: "https://api.github.com/search/repositories",
        dataType: 'json',
        delay: 250,
        data: function (params) {
          return {
            q: params.term, // search term
            page: params.page
          };
        },
        processResults: function (data, page) {
          // parse the results into the format expected by Select2.
          // since we are using custom formatting functions we do not need to
          // alter the remote JSON data
          dataObjSelectMailTemplate = data;
          return {
            results: data.items
          };
        },
        cache: true
      },
      escapeMarkup: function (markup) {
        return markup;
      }, // let our custom formatter work
      minimumInputLength: 1,
      templateResult: formatRepo, // omitted for brevity, see the source of this page
      templateSelection: formatRepoSelection // omitted for brevity, see the source of this page  

    });

    $("#mailCategory").select2({
      theme: "classic",
      ajax: {
        url: fullUrlBase + "/api/mailcategory/getautocompletecategory",
        //url: "https://api.github.com/search/repositories",
        dataType: 'json',
        delay: 250,
        data: function (params) {
          return {
            q: params.term, // search term
            page: params.page
          };
        },
        processResults: function (data, page) {
          // parse the results into the format expected by Select2.
          // since we are using custom formatting functions we do not need to
          // alter the remote JSON data
          dataObjSelectMailTemplate = data;
          return {
            results: data.items
          };
        },
        cache: true
      },
      escapeMarkup: function (markup) {
        return markup;
      }, // let our custom formatter work
      minimumInputLength: 1,
      templateResult: formatRepo, // omitted for brevity, see the source of this page
      templateSelection: formatRepoSelection // omitted for brevity, see the source of this page  

    });

  });
</script>
<div class='col-xs-12 col-sm-12 col-md-12 col-lg-12 wrap' ng-init="getSender()">
  <div class="form-group" >
    <label for="mailtemplate">*Plantilla de correo</label><a class="extra-small-text" ng-href="{{'{{selected.hrefCreateMail}}'}}" target="_blank"> Crear nueva plantilla</a>
    {#    <select name="mailtemplate" id="mailTemplate" ng-change="changeSelectedMailTemplate(selected.mailtemplate)" ng-model="selected.mailtemplate" style="width: 200px"></select>  #}

    <ui-select name="senderName" ng-model="selected.mailtemplate" ng-change="changeSelectedMailTemplate(selected.mailtemplate)" theme="select2" sortable="false"
               close-on-select="true" style="width: 100%" reset-search-input="false">
      <ui-select-match
        placeholder="Seleccione uno">{{ "{{$select.selected.name}}" }}</ui-select-match>
      <ui-select-choices
        repeat="key in listSMailTemplate track by $index | propsFilter: {name: $select.search}"
        refresh="refreshAddresses($select.search)"
        refresh-delay="0"
        >
        <div ng-bind-html="key.name | highlight: $select.search"></div>
      </ui-select-choices>
    </ui-select>

  </div>

  <div class="form-group" ng-show="idService == '6' && statusService == '1'">
    <label for="mailCategory">*Adjuntar Archivo</label>
    <button type="button" class="btn btn-primary" ng-click="showModalAdj()" >Adjuntar archivos </button>
    <div class="col-sm-12 col-xs-12 col-md-12 col-lg-12" style="padding: 0!important;">
      <h5>Tamaño max permitido: <strong>1.40 MB</strong></h5>
      <h5>Tamaño de archivos: <strong>{{ " {{ sizeFiles/1000000|number:3 }} " }} MB</strong></h5>
    </div>
  </div>

  <div class="form-group">
    <div class="col-xs-10 col-sm-10 col-md-10 col-lg-10 none-padding" >
      <md-progress-linear md-mode="query" ng-show="queryProgressAtachment" class="md-warn"></md-progress-linear>
      <ul ng-hide="!hidefile" style='margin: 1em;'>
        <li ng-repeat="key in fileadjunt">
          {{"{{key.name}}"}} <span class="fa fa-times danger-no-hover" ng-click="deleteAsset(key.id)"></span>
        </li>
      </ul>
    </div>
  </div>

  <div class="form-group" >
    <label for="mailCategory">*Categoria de correo</label>
    {#    <select name="mailCategory" id="mailCategory"  ng-model="selected.mailcategory" style="width: 200px"></select>  #}
    <ui-select name="senderName" ng-model="selected.mailcategory" theme="select2" sortable="false"
               close-on-select="true" style="width: 100%">
      <ui-select-match
        placeholder="Seleccione uno">{{ "{{$select.selected.name}}" }}</ui-select-match>
      <ui-select-choices
        repeat="key in listSMailCategory | propsFilter: {name: $select.search}">
        <div ng-bind-html="key.name | highlight: $select.search"></div>
      </ui-select-choices>
    </ui-select>
  </div>
  <div class="form-group">
    <label for="senderName">*Nombre del remitente</label>
    <ui-select name="senderName" ng-model="selected.senderName" theme="select2" sortable="false"
               close-on-select="true" style="width: 100%">
      <ui-select-match
        placeholder="Seleccione uno">{{ "{{$select.selected.name}}" }}</ui-select-match>
      <ui-select-choices
        repeat="key as key in emailname | propsFilter: {name: $select.search}">
        <div ng-bind-html="key.name | highlight: $select.search"></div>
      </ui-select-choices>
    </ui-select>
  </div>
  <div class="form-group">
    <label for="senderEmail">*Correo del remitente</label>
    <ui-select name="senderEmail" ng-model="selected.senderEmail" theme="select2"
               sortable="false" close-on-select="true" style="width: 100%">
      <ui-select-match
        placeholder="Seleccione uno">{{ "{{$select.selected.email}}" }}</ui-select-match>
      <ui-select-choices
        repeat="key as key in emailsend | propsFilter: {email: $select.search}">
        <div ng-bind-html="key.email | highlight: $select.search"></div>
      </ui-select-choices>
    </ui-select> 
  </div>

  <div class="form-group" >
    <label for="subject">*Asunto</label>
    <input name="subject" type="text" placeholder="Asunto"  class="undeline-input" ng-model="selected.subject"/>
  </div>

  <div class="form-group" >
    <label for="replyto">Responder a</label>
    <input name="replyto" type="text" placeholder="Responder a"  class="undeline-input" ng-model="selected.replyto"/>
  </div>
  <div class="form-group" >
    <a ng-href="{{'{{selected.hrefSelectedMail}}'}}" target="_blank" ng-show="selected.flagSelected">Editar plantilla</a>
  </div>
  <div class="form-group" >
    <p class="text-danger" ng-show="selected.error">Todos los campos son obligarotios.</p>
  </div>
  <div class="clearfix"></div>

  <div class="footer" align="right">                                                
    <a  ng-click="closePopover()" class="danger-no-hover" style="cursor:pointer;" data-toggle="tooltip" data-placement="top" title="Cancelar">
      <i class="fa fa-times "></i>
    </a>
    <a  ng-click="refreshData()" class="primary-no-hover" style="cursor:pointer;" data-toggle="tooltip" data-placement="top" title="Actualizar">
      <i ng-class="classRefreshrotate ? 'fa fa-refresh fa-spin fa-fw': 'fa fa-refresh fa-fw'"></i>
    </a>
    <a ng-click="applyListSelectedMail()" class="success-no-hover" style="cursor:pointer;" data-toggle="tooltip" data-placement="top" title="Guardar">
      <i class="fa fa-check"></i>
    </a>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="adjun" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="myModalLabel">Adjuntar archivos</h4>
      </div>
      <div class="modal-body">
        <div role="tabpanel">
          <!-- Tab panes -->
          <div class="tab-content">
            <div role="tabpanel" id="adjun2">
              <div>
                <input type="file" nv-file-select="" uploader="uploader" multiple  /><br/>
              </div>
              <div  style="margin-bottom: 40px">
                <p>Cantidad de archivos seleccionados: {{'{{ uploader.queue.length }}'}}</p>
                <table class="table table-bordered"  >
                  <thead>
                    <tr>
                      <th width="50%">Nombre</th>
                      <th ng-show="uploader.isHTML5">Tamaño</th>
                      <th ng-show="uploader.isHTML5">Progreso</th>
                      <th>Estado</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="item in uploader.queue">
                      <td><strong>{{"{{ item.file.name }}"}}</strong></td>
                      <td ng-show="uploader.isHTML5" nowrap>{{"{{ item.file.size/1000000|number:3 }}"}} MB</td>
                      <td ng-show="uploader.isHTML5">
                        <div class="progress" style="margin-bottom: 0;">
                          <div class="progress-bar" role="progressbar" ng-style="{ 'width': item.progress + '%' }"></div>
                        </div>
                      </td>
                      <td class="text-center">
                        <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span>
                        <span ng-show="item.isCancel"><i class="glyphicon glyphicon-ban-circle"></i></span>
                        <span ng-show="item.isError"><i class="glyphicon glyphicon-remove"></i></span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

            </div>
            <div class=row>
              <div class="col-lg-12 text-right">
                <button type="button" class="btn btn-default" ng-click="closeModalAdj()">Cerrar</button>
                <button type="button" class="btn btn-primary" ng-click="saveAsset()">Adjuntar</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


