<script>
  //var objMail = {"layout":{"id":1,"name":"layout-simple","description":"Layout Standard","icon":"/aio/images/editor/n1.png","zones":[{"name":"preheader","width":"full-width","widthval":600},{"name":"header","width":"full-width","widthval":600},{"name":"body","width":"full-width","widthval":600},{"name":"footer","width":"full-width","widthval":600}]},"dz":{"preheader":{"name":"preheader","width":"full-width","widthval":600,"parent":"#edit-area","background_color":"#FFFFFF","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"content":[]},"header":{"name":"header","width":"full-width","widthval":600,"parent":"#edit-area","background_color":"#FFFFFF","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"height":143,"width":276,"align":"center","vertalign":"middle","imgsrc":"/asset/show/193","imgalt":"33.png","type":"Image"}],"amount":1},{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"type":"Separator"}],"amount":1}]},"body":{"name":"body","width":"full-width","widthval":600,"parent":"#edit-area","background_color":"#FFFFFF","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"height":161,"width":318,"align":"center","vertalign":"middle","imgsrc":"/asset/show/191","imgalt":"Img-20160519-wa0001.jpg","type":"Image"}],"amount":1}]},"footer":{"name":"footer","width":"full-width","widthval":600,"parent":"#edit-area","background_color":"#FFFFFF","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"type":"Separator"}],"amount":1},{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"height":113,"width":182,"align":"center","vertalign":"middle","imgsrc":"/aio/asset/show/71","imgalt":"1836757_837971202883836_6966135472265559953_o.jpg","type":"Image"},{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":"<p><span data-redactor=\"verified\" data-redactor-inlinemethods=\"\" style=\"font-size: 11px;\"><span style=\"font-size: 11px;\">Este correo electronico ha sido enviado a %%EMAIL%%</span></span></p><p style=\"text-align: right;\"><span data-redactor=\"verified\" data-redactor-inlinemethods=\"\" style=\"font-size: 11px;\"><a href=\"%%WEBVERSION%%\">Version web</a><span>  | </span></span><span data-redactor=\"verified\" data-redactor-inlinemethods=\"\" style=\"font-size: 11px;\"><a href=\"%%UNSUBSCRIBE%%\">Eliminar suscripcion</a></span></p>","type":"Text"},{"contentData":[{"socialname":"Facebook","selected":true},{"socialname":"Twitter","selected":true},{"socialname":"LinkedIn","selected":false},{"socialname":"Google Plus","selected":false}],"align":"center","size":"xs","theme":2,"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"type":"Social-Share"}],"amount":3},{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"content":[{"background_color":"transparent","border_width":0,"border_color":"#FFFFFF","border_style":"none","corner_top_left":0,"corner_top_right":0,"corner_bottom_left":0,"corner_bottom_right":0,"margin_top":0,"margin_bottom":0,"margin_left":0,"margin_right":0,"type":"Separator"}],"amount":1}]}},"content":{},"editorColor":"#fff"};
  var dataObjSelectSmsTemplate;
  function iframeResize() {
    var iFrame = document.getElementById('iframeEditor');
    //iFrame.height = iFrame.contentWindow.document.body.scrollHeight + "px";
    iFrame.height = "650px";
  }
  function formatRepo(repo) {

    var markup = '<div class="clearfix">' +
      '<div clas="col-sm-10">' +
      '<div class="clearfix">' +
      '<div class="col-sm-6">' + repo.name + '</div>' +
      '</div>';


    markup += '</div></div>';

    return markup;
  }

  function formatRepoSelection(repo) {
    return repo.name;
  }
  $.fn.select2.defaults.set('language', 'es');
  $(function () {

    $(".js-data-example-ajax").select2({
      theme: "classic",
      ajax: {
        url: fullUrlBase + "/api/smstemplate/getsmstemplateautocomplete",
        //url: "https://api.github.com/search/repositories",
        dataType: 'json',
        delay: 250,
        data: function (params) {
          return {
            q: params.term, // search term
            page: params.page
          };
        },
        processResults: function (data, page) {
          // parse the results into the format expected by Select2.
          // since we are using custom formatting functions we do not need to
          // alter the remote JSON data
          dataObjSelectSmsTemplate = data;
          return {
            results: data.items
          };
        },
        cache: true
      },
      escapeMarkup: function (markup) {
        return markup;
      }, // let our custom formatter work
      minimumInputLength: 1,
      templateResult: formatRepo, // omitted for brevity, see the source of this page
      templateSelection: formatRepoSelection // omitted for brevity, see the source of this page  

    });

  });
</script>
<div class='col-xs-12 col-sm-12 col-md-12 col-lg-12 wrap'>
  <div class="form-group" >
    <label for="smstemplate">*Plantilla de sms</label><a class="extra-small-text" ng-href="{{'{{selected.hrefCreateSms}}'}}" target="_blank"> Crear nueva plantilla</a>
    {#    <select name="smstemplate" class="js-data-example-ajax" ng-change="changeSelectedSmsTemplate(selected.smstemplate)" ng-model="selected.smstemplate" style="width: 200px"></select>  #}
    <ui-select name="senderName" ng-model="selected.smstemplate" ng-change="changeSelectedSmsTemplate(selected.smstemplate)" theme="select2" sortable="false"
               close-on-select="true" style="width: 100%">
      <ui-select-match
        placeholder="Seleccione uno">{{ "{{$select.selected.name}}" }}</ui-select-match>
      <ui-select-choices
        repeat="key in listSmsTemplate | propsFilter: {name: $select.search}">
        <div ng-bind-html="key.name | highlight: $select.search"></div>
      </ui-select-choices>
    </ui-select>
  </div>
      
  <div class="form-group" >
    <label for="smstemplate">*Categoria de sms</label>
    {#    <select name="smstemplate" class="js-data-example-ajax" ng-change="changeSelectedSmsTemplate(selected.smstemplate)" ng-model="selected.smstemplate" style="width: 200px"></select>  #}
    <ui-select name="senderName" ng-model="selected.smscategory" ng-change="changeSelectedSmsTemplate(selected.smstemplate)" theme="select2" sortable="false"
               close-on-select="true" style="width: 100%">
      <ui-select-match
        placeholder="Seleccione uno">{{ "{{$select.selected.name}}" }}</ui-select-match>
      <ui-select-choices
        repeat="key in listSmsCategory | propsFilter: {name: $select.search}">
        <div ng-bind-html="key.name | highlight: $select.search"></div>
      </ui-select-choices>
    </ui-select>
  </div>

  <div class="form-group" >
    <a ng-href="{{'{{selected.hrefSelectedSms}}'}}" target="_blank" ng-show="selected.flagSelected">Editar plantilla</a>
  </div>

  <div class="clearfix"></div>

  <div class="footer" align="right">                                                
    <a  ng-click="closePopover()" class="danger-no-hover" style="cursor:pointer;" data-toggle="tooltip" data-placement="top" title="Cancelar">
      <i class="fa fa-times "></i>
    </a>
    <a  ng-click="refreshData()" class="primary-no-hover" style="cursor:pointer;" data-toggle="tooltip" data-placement="top" title="Actualizar">
      <i ng-class="classRefreshrotate ? 'fa fa-refresh fa-spin fa-fw': 'fa fa-refresh fa-fw'"></i>
    </a>
    <a ng-click="applyListSelectedSms()" class="success-no-hover" style="cursor:pointer;" data-toggle="tooltip" data-placement="top" title="Guardar">
      <i class="fa fa-check"></i>
    </a>
  </div>

</div>
