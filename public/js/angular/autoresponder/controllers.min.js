(function(){angular.module('autoresponder.controllers',[]).filter('propsFilter',function(){return function(items,props){var out=[];if(angular.isArray(items)){var keys=Object.keys(props);items.forEach(function(item){var itemMatches=!1;for(var i=0;i<keys.length;i++){var prop=keys[i];var text=props[prop].toLowerCase();if(item[prop].toString().toLowerCase().indexOf(text)!==-1){itemMatches=!0;break}}
if(itemMatches){out.push(item)}})}else{out=items}
return out}}).controller('listController',['$scope','RestServices','notificationService',function($scope,RestServices,notificationService){$scope.initial=0;$scope.page=1;$scope.forward=function(){$scope.initial+=1;$scope.page+=1;$scope.listAutoresponse()};$scope.fastforward=function(){$scope.initial=($scope.list.total_pages-1);$scope.page=$scope.list.total_pages;$scope.listAutoresponse()};$scope.backward=function(){$scope.initial-=1;$scope.page-=1;$scope.listAutoresponse()};$scope.fastbackward=function(){$scope.initial=0;$scope.page=1;$scope.listAutoresponse()};$scope.listAutoresponse=function(){RestServices.getAllAutoresponder($scope.initial,$scope.filter).then(function(res){$scope.list=res})};$scope.listAutoresponse();$scope.filtername=function(){RestServices.getAllAutoresponder($scope.initial,$scope.filter).then(function(res){$scope.list=res})};$scope.confirmDelete=function(id){$scope.idAutoresponder=id;openModal()};$scope.deleteAutoresponder=function(){RestServices.delete($scope.idAutoresponder).then(function(res){notificationService.warning(res.message);$scope.listAutoresponse()});closeModal()};$scope.translationDays=function(day){switch(day){case 'Monday':day='Lunes';break;case 'Tuesday':day='Martes';break;case 'Wednesday':day='Miercoles';break;case 'Thursday':day='Jueves';break;case 'Friday':day='Viernes';break;case 'Saturday':day='Sabado';break;case 'Sunday':day='Domingo';break}
return day};$scope.previewAutoresponder=function(idAutoresponder){$('#modal-body-preview').empty();htmlPreviewAutores(idAutoresponder)}}]).controller('birthdayController',['$scope','RestServices','notificationService','$window','$stateParams',function($scope,RestServices,notificationService,$window,$stateParams){$scope.data={};$scope.data.status=!0;$scope.boolEditors=!0;$scope.addressees=[];$scope.addressees.count=0;if($stateParams.id){RestServices.getAutoresponder($stateParams.id).then(function(res){$scope.data=res.autoresponder;$("#valueDatepicker").val(res.autoresponder.time);$scope.data.senderNameSelect=res.autoresponder.idNameSender;$scope.data.senderMailSelect=res.autoresponder.idEmailsender;$scope.data.status=(res.autoresponder.status==1);if(res.autoresponder.target){$scope.addressees.showstep1=!1;var json=jQuery.parseJSON(res.autoresponder.target);$scope.addressees.count=res.autoresponder.quantitytarget;$scope.addressees.condition=json.condition;$scope.filters=json.filters;if(json.type=="contactlist"){$scope.addressees.showContactlist=!1;$scope.addressees.selectdContactlis=json.contactlists;$scope.getAllContactlist()}else if(json.type=="segment"){$scope.addressees.showSegment=!1;$scope.addressees.selectdSegment=json.segment;$scope.getAllSegment()}}
if(!res.autoresponder.autorespondercontent){$scope.boolEditors=!0}else{$scope.boolEditors=!1;htmlPreview($stateParams.id);$scope.getUrl=res.autoresponder.autorespondercontent.url}})}
$scope.addressees={selectdContactlis:[]};$scope.addressees={selectdSegment:[]};$scope.addressees.showSegment=!0;$scope.addressees.showstep1=!0;$scope.addressees.showContactlist=!0;$('#dateInitial').datetimepicker({format:'hh:mm',language:'es'}).on('changeDate',function(ev){$scope.$apply()});$scope.saveAutoresponder=function(){$scope.data.addressees=$scope.addressees;$scope.data.time=$("#valueDatepicker").val();$scope.data.filters=$scope.filters;$scope.data.condition=$scope.addressees.condition;var idAutoresponder=$stateParams.id?$stateParams.id:0;RestServices.createAutoresponder($scope.data,idAutoresponder).then(function(res){notificationService.success(res.message);$window.location.href=fullUrlBase+templateBase+"#/"})};$scope.clearSelect=function(){$scope.filters=[];$scope.addressees.count=0;$scope.disabledContactlist=!1;$scope.disabledSegment=!1;$scope.addressees.selectdContactlis="";$scope.addressees.selectdSegment=""};$scope.getContactlist=function(){$scope.addressees={selectdSegment:[]};$scope.segments=[];$scope.filters=[];$scope.contactlists=[];$scope.addressees.showstep1=!1;$scope.addressees.count=0;$scope.addressees.showSegment=!0;$scope.addressees.showContactlist=!1;$scope.prueba=undefined;$scope.getAllContactlist();$scope.getAllSegment()};$scope.getAllContactlist=function(){RestServices.getContactlist().then(function(data){$scope.contactlists=data})};$scope.getSegment=function(){$scope.addressees={selectdContactlis:[]};$scope.segments=[];$scope.contactlists=[];$scope.filters=[];$scope.addressees.showstep1=!1;$scope.addressees.count=0;$scope.prueba=undefined;$scope.prueba2=undefined;$scope.addressees.selectdContactlis=[];$scope.addressees.selectdSegment=[];$scope.addressees.showSegment=!1;$scope.addressees.showContactlist=!0;$scope.getAllSegment();$scope.getAllContactlist()};$scope.getAllSegment=function(){RestServices.getSegment().then(function(data){$scope.segments=data})};$scope.selectAction=function(){$scope.countContacts("contactlist")};$scope.selectActionSegment=function(){$scope.countContacts("segment")};$scope.allSegment=function(){$scope.disabledSegment=!0;$scope.addressees.selectdSegment=$scope.segments;$scope.countContacts("segment")};$scope.allContactlist=function(){$scope.disabledContactlist=!0;$scope.addressees.selectdContactlis=$scope.contactlists;$scope.countContacts("contactlist")};$scope.countContacts=function(type){$scope.addressees.count=0;var data={type:type,segment:$scope.addressees.selectdSegment,contactlist:$scope.addressees.selectdContactlis,filters:$scope.filters,condition:$scope.addressees.condition,idMail:$scope.idMail};RestServices.countContact(data).then(function(data){$scope.addressees.count=data})};function getemailname(){RestServices.getemailname().then(function(res){$scope.emailname=res})}
function getemailsend(){RestServices.getemailsend().then(function(res){$scope.emailsend=res})}
getemailname();getemailsend();$scope.showInputName=!1;$scope.showSelectName=!0;$scope.showIconsName=!0;$scope.showIconsSaveName=!1;$scope.changeStatusInputName=function(){if(!$scope.showInputName){$scope.showInputName=!0;$scope.showSelectName=!1;$scope.showIconsName=!1;$scope.showIconsSaveName=!0}else{$scope.showInputName=!1;$scope.showSelectName=!0;$scope.showIconsName=!0;$scope.showIconsSaveName=!1}};$scope.showInputEmail=!1;$scope.showSelectEmail=!0;$scope.showIconsEmail=!0;$scope.showIconsSaveEmail=!1;$scope.changeStatusInputEmail=function(){if(!$scope.showInputEmail){$scope.showInputEmail=!0;$scope.showSelectEmail=!1;$scope.showIconsEmail=!1;$scope.showIconsSaveEmail=!0}else{$scope.showInputEmail=!1;$scope.showSelectEmail=!0;$scope.showIconsEmail=!0;$scope.showIconsSaveEmail=!1}};$scope.saveName=function(){var data={name:$scope.senderName};RestServices.addEmailName(data).then(function(res){notificationService.success(res.msg);$scope.senderName="";getemailname();$scope.changeStatusInputName();$scope.data.senderNameSelect=res.idNameSender})};$scope.saveEmail=function(){var data={email:$scope.senderMail};RestServices.addEmailSender(data).then(function(res){notificationService.success(res.msg);$scope.senderMail="";getemailsend();$scope.changeStatusInputEmail();$scope.data.senderMailSelect=res.idEmailsender})};$scope.openMailTemplate=function(){$scope.data.addressees=$scope.addressees;$scope.data.filters=$scope.filters;$scope.data.condition=$scope.addressees.condition;$scope.data.time=$("#valueDatepicker").val();var idAutoresponder=$stateParams.id?$stateParams.id:0;RestServices.createAutoresponder($scope.data,idAutoresponder).then(function(res){$window.location.href=fullUrlBase+'mailtemplate#/selectautoresponder/'+res.autoresponder.idAutoresponder})};$scope.openContentEditor=function(){$scope.data.addressees=$scope.addressees;$scope.data.filters=$scope.filters;$scope.data.condition=$scope.addressees.condition;$scope.data.time=$("#valueDatepicker").val();var idAutoresponder=$stateParams.id?$stateParams.id:0;RestServices.createAutoresponder($scope.data,idAutoresponder).then(function(res){$window.location.href=fullUrlBase+templateBase+'/contenteditor/'+res.autoresponder.idAutoresponder})};$scope.openEditorHtml=function(){$scope.data.addressees=$scope.addressees;$scope.data.filters=$scope.filters;$scope.data.condition=$scope.addressees.condition;$scope.data.time=$("#valueDatepicker").val();var idAutoresponder=$stateParams.id?$stateParams.id:0;RestServices.createAutoresponder($scope.data,idAutoresponder).then(function(res){$window.location.href=fullUrlBase+templateBase+'/contenthtml/'+res.autoresponder.idAutoresponder})};$scope.editContentEditor=function(){$scope.data.addressees=$scope.addressees;$scope.data.time=$("#valueDatepicker").val();RestServices.createAutoresponder($scope.data,$stateParams.id).then(function(res){$window.location.href=fullUrlBase+$scope.data.autorespondercontent.url+res.autoresponder.idAutoresponder})};$scope.filters=[];$scope.tipeFilters=[{id:1,name:"Enviar a contactos que hayan recibido un correo"},{id:2,name:"Enviar a contactos que hayan abierto un correo"},{id:3,name:"Enviar a contactos que hayan hecho clic un enlace"}];$scope.selectMailFilter=function(key){if(key.typeFilters==3){RestServices.getLinksByMail(key.mailSelected).then(function(data){key.links=data})}else{if(!$scope.addressees.showContactlist){$scope.countContacts("contactlist")}else{$scope.countContacts("segment")}}};$scope.selectLinkFilter=function(){if(!$scope.addressees.showContactlist){$scope.countContacts("contactlist")}else{$scope.countContacts("segment")}};$scope.selectTypeFilter=function(key){key.mailSelected=[];key.linkSelected=[];key.mail=[];key.links=[];RestServices.getMailFilters(key.typeFilters).then(function(data){key.mail=data});switch(key.typeFilters){case 1:break;case 2:break;case 3:break}};$scope.addFilter=function(){$scope.addressees.condition="all";$scope.filters.push({})};$scope.removeFilters=function(index){$scope.filters.splice(index,1);if(!$scope.addressees.showContactlist){$scope.countContacts("contactlist")}else{$scope.countContacts("segment")}}}]).controller('contentEditorAutoresController',['$scope','RestServices','notificationService','$window','$stateParams',function($scope,RestServices,notificationService,$window,$stateParams){$scope.saveContentEditor=function(){var data={editor:document.getElementById('iframeEditor').contentWindow.catchEditorData()};RestServices.createContentEditorAutoresponder(data,idAutoresponder).then(function(res){if(res.operation=="create"){notificationService.success(res.message)}else if(res.operation=="edit"){notificationService.primary(res.message)}
$window.location.href=fullUrlBase+templateBase+'#/birthday/'+res.autoresponderContent.idAutoresponder})}}])})()