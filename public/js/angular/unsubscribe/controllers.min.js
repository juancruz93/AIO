(function(){angular.module('unsubscribeApp',['ngDragDrop','unsubscribe.service']).filter('propsFilter',function(){return function(a,b){var c=[];if(angular.isArray(a)){var d=Object.keys(b);a.forEach(function(f){for(var g=!1,h=0;h<d.length;h++){var j=d[h],k=b[j].toLowerCase();if(-1!==f[j].toString().toLowerCase().indexOf(k)){g=!0;break}}g&&c.push(f)})}else c=a;return c}}).directive('htmlSortable',['$parse','$timeout','$log','$window',function(a,b,c,d){return{restrict:'A',require:'?ngModel',scope:{htmlSortable:'=',ngModel:'=',ngExtraSortable:'='},link:function(f,g,h,j){var k={};k.is_handle=!1,k.in_use=!1,k.handleDragStart=function(l){return k.options&&angular.isDefined(k.options.disableDrag)&&!0===k.options.disableDrag(j.$modelValue,angular.element(this))?void l.preventDefault():(d.drag_source=null,d.drag_source_extra=null,k.options&&!k.is_handle&&k.options.handle?void l.preventDefault():void(k.is_handle=!1,l.dataTransfer.effectAllowed='move','IE'!=k.browser&&l.dataTransfer.setData('text/plain','anything'),d.drag_source=this,d.drag_source_extra=g.extra_data,this.classList.add('moving')))},k.handleDragOver=function(l){l.preventDefault&&l.preventDefault(),l.dataTransfer.dropEffect='move',this.classList.contains('over')||this.classList.add('over')},k.handleDragEnter=function(){this.classList.contains('over')||this.classList.add('over')},k.handleDragLeave=function(){this.classList.remove('over')},k.handleDrop=function(l){if(l.stopPropagation&&l.stopPropagation(),l.preventDefault(),this.classList.remove('over'),d.drag_source!=this){if(null==d.drag_source)return;var m=d.drag_source.model,n=this.index;if(-1!=j.$modelValue.indexOf(m)){var o=d.drag_source.index,p=angular.copy(j.$modelValue[o]);k.unbind(),j.$modelValue.splice(o,1),j.$modelValue.splice(n,0,p)}else if(k.options.allow_cross)j.$modelValue.splice(n,0,m);else return;f.$apply(),k.options&&angular.isDefined(k.options.stop)&&k.options.stop(j.$modelValue,n,g.extra_data,d.drag_source_extra)}return!1},k.handleDragEnd=function(){[].forEach.call(k.cols_,function(m){m.classList.remove('over'),m.classList.remove('moving')})},k.unbind=function(){[].forEach.call(k.cols_,function(l){l.removeAttribute('draggable'),l.removeEventListener('dragstart',k.handleDragStart,!1),l.removeEventListener('dragenter',k.handleDragEnter,!1),l.removeEventListener('dragover',k.handleDragOver,!1),l.removeEventListener('dragleave',k.handleDragLeave,!1),l.removeEventListener('drop',k.handleDrop,!1),l.removeEventListener('dragend',k.handleDragEnd,!1)}),k.in_use=!1},k.activehandle=function(){k.is_handle=!0},k.register_drop=function(l){l.addEventListener('drop',k.handleDrop,!1),l.addEventListener('dragstart',k.handleDragStart,!1),l.addEventListener('dragenter',k.handleDragEnter,!1),l.addEventListener('dragover',k.handleDragOver,!1),l.addEventListener('dragleave',k.handleDragLeave,!1),l.addEventListener('drop',k.handleDrop,!1),l.addEventListener('dragend',k.handleDragEnd,!1)},k.getBrowser=function(){var l=d.navigator.userAgent;return-1==l.indexOf('.NET')?-1==l.indexOf('Firefox')?'Chrome':'Firefox':'IE'},k.update=function(){d.drag_source=null;var l=0;return 0==j.$modelValue.length?void(0<g[0].children.length&&(g[0].children[0].index=0,k.register_drop(g[0].children[0]))):void(this.browser=this.getBrowser(),this.cols_=g[0].children,[].forEach.call(this.cols_,function(m){if(k.options&&k.options.handle){var n=m.querySelectorAll(k.options.handle)[0];n.addEventListener('mousedown',k.activehandle,!1)}m.index=l,m.model=j.$modelValue[l],l++,m.setAttribute('draggable','true'),k.register_drop(m)}),k.in_use=!0)},j&&(j.$render=function(){b(function(){k.first_load=!1,f.$watch('ngExtraSortable',function(l){g.extra_data=l}),f.$watch('htmlSortable',function(l){return k.options=angular.copy(l),'destroy'==l?void(k.in_use&&(k.unbind(),k.in_use=!1)):void(!angular.isDefined(k.options)&&(k.options={}),!angular.isDefined(k.options.allow_cross)&&(k.options.allow_cross=!1),angular.isDefined(k.options.construct)&&k.options.construct(j.$modelValue),g[0].classList.add('html5-sortable'),k.update(),b(function(){k.first_load=!0}))},!0),f.$watch('ngModel',function(){k.first_load&&'destroy'!=k.options&&b(function(){k.update()})},!0)})})}}}]).controller('contactController',['$scope','RestService','notificationService','$window',function(a,b,c){a.idMail=idMail,a.idContact=idContact,a.sendSelected=[],a.prueba={},a.items=[],a.arrServices=[],a.arrConfigDashboard=[],a.arrSubs=[],a.arrUnsubs=[],a.optionDroppable={opacity:0.4},a.draggableOptions={remove:function(){}},a.actionDroppableSubs={onOver:function(){element=angular.element(document.getElementById('subs')),$(element[0]).removeClass('boder-droppable').addClass('hover-droppable')},onDrop:function(){element=angular.element(document.getElementById('subs')),$(element[0]).removeClass('hover-droppable').addClass('boder-droppable').find('p').html('')},remove:function(f){for(i in objList=a.arrConfigDashboard[f],a.arrDefaultDashboard.items)objList.title==a.arrDefaultDashboard.items[i].title&&(a.arrConfigDashboard.splice(f,1),a.arrServices.splice(objList.jqyoui_pos,1,a.arrDefaultDashboard.items[i]))}},a.actionDroppableUnSubs={onOver:function(){element=angular.element(document.getElementById('unsubs')),$(element[0]).removeClass('boder-droppable').addClass('hover-droppable')},onDrop:function(){element=angular.element(document.getElementById('unsubs')),$(element[0]).removeClass('hover-droppable').addClass('boder-droppable').find('p').html('')},remove:function(f){for(i in objList=a.arrConfigDashboard[f],a.arrDefaultDashboard.items)objList.title==a.arrDefaultDashboard.items[i].title&&(a.arrConfigDashboard.splice(f,1),a.arrServices.splice(objList.jqyoui_pos,1,a.arrDefaultDashboard.items[i]))}},b.getContact(a.idContact).then(function(f){a.contact=f,a.name=angular.isDefined(a.contact.contact.name)?angular.isDefined(a.contact.contact.lastname)?a.contact.contact.name+' '+a.contact.contact.lastname:a.contact.contact.name:a.contact.contact.email;for(var g=0;g<a.contact.arrUnsubscribedCategories.length;g++)a.contact.arrUnsubscribedCategories[g].jqyoui_pos=g,a.contact.arrUnsubscribedCategories[g].drag=!0;for(var g=0;g<a.contact.arrSubscribedCategories.length;g++)a.contact.arrSubscribedCategories[g].jqyoui_pos=g,a.contact.arrSubscribedCategories[g].drag=!0;a.arrSubsConcat=angular.copy(a.contact.arrSubscribedCategories),a.arrUnsubs=angular.copy(a.contact.arrUnsubscribedCategories);var h=a.arrSubsConcat.concat(a.arrUnsubs);a.arrUnsubs=h}),a.not=!1,a.sendUnsubscribe=function(){document.getElementById('sendUnsub').disabled=!0;var f={idMail:a.idMail,arrSubs:a.arrSubs,arrUnsubs:a.arrUnsubs};b.sendUnsubscribe(f,a.idContact).then(function(g){c.success(g.message)})},a.subscribe=function(f){for(var g=0;g<a.arrUnsubs.length;g++)a.arrUnsubs[g].idContactlistCategory==f.idContactlistCategory&&a.arrUnsubs.splice(g,1);a.arrSubs.push(f)},a.unsubscribe=function(f){for(var g=0;g<a.arrSubs.length;g++)a.arrSubs[g].idContactlistCategory==f.idContactlistCategory&&a.arrSubs.splice(g,1);a.arrUnsubs.push(f)}}]).controller('contactautomaticController',['$scope','RestService','notificationService','$window',function(a,b,c){a.idMail=idMail,a.idContact=idContact,a.sendSelected=[],a.prueba={},a.items=[],a.arrServices=[],a.arrConfigDashboard=[],a.arrSubs=[],a.arrUnsubs=[],a.optionDroppable={opacity:0.4},a.draggableOptions={remove:function(){}},a.actionDroppableSubs={onOver:function(){element=angular.element(document.getElementById('subs')),$(element[0]).removeClass('boder-droppable').addClass('hover-droppable')},onDrop:function(){element=angular.element(document.getElementById('subs')),$(element[0]).removeClass('hover-droppable').addClass('boder-droppable').find('p').html('')},remove:function(f){for(i in objList=a.arrConfigDashboard[f],a.arrDefaultDashboard.items)objList.title==a.arrDefaultDashboard.items[i].title&&(a.arrConfigDashboard.splice(f,1),a.arrServices.splice(objList.jqyoui_pos,1,a.arrDefaultDashboard.items[i]))}},a.actionDroppableUnSubs={onOver:function(){element=angular.element(document.getElementById('unsubs')),$(element[0]).removeClass('boder-droppable').addClass('hover-droppable')},onDrop:function(){element=angular.element(document.getElementById('unsubs')),$(element[0]).removeClass('hover-droppable').addClass('boder-droppable').find('p').html('')},remove:function(f){for(i in objList=a.arrConfigDashboard[f],console.log(objList),a.arrDefaultDashboard.items)objList.title==a.arrDefaultDashboard.items[i].title&&(a.arrConfigDashboard.splice(f,1),a.arrServices.splice(objList.jqyoui_pos,1,a.arrDefaultDashboard.items[i]))}},b.getContact(a.idContact).then(function(f){a.contact=f,a.name=angular.isDefined(a.contact.contact.name)?angular.isDefined(a.contact.contact.lastname)?a.contact.contact.name+' '+a.contact.contact.lastname:a.contact.contact.name:a.contact.contact.email;for(var g=0;g<a.contact.arrUnsubscribedCategories.length;g++)a.contact.arrUnsubscribedCategories[g].jqyoui_pos=g,a.contact.arrUnsubscribedCategories[g].drag=!0;for(var g=0;g<a.contact.arrSubscribedCategories.length;g++)a.contact.arrSubscribedCategories[g].jqyoui_pos=g,a.contact.arrSubscribedCategories[g].drag=!0;a.arrSubs=angular.copy(a.contact.arrSubscribedCategories),a.arrUnsubs=angular.copy(a.contact.arrUnsubscribedCategories)}),a.sendUnsubscribe=function(){var f={idMail:a.idMail,arrSubs:a.arrSubs,arrUnsubs:a.arrUnsubs};b.sendUnsubscribeAutomatic(f,a.idContact).then(function(g){c.success(g.message)})},a.subscribe=function(f){for(var g=0;g<a.arrUnsubs.length;g++)a.arrUnsubs[g].idContactlistCategory==f.idContactlistCategory&&a.arrUnsubs.splice(g,1);a.arrSubs.push(f)},a.unsubscribe=function(f){for(var g=0;g<a.arrSubs.length;g++)a.arrSubs[g].idContactlistCategory==f.idContactlistCategory&&a.arrSubs.splice(g,1);a.arrUnsubs.push(f)}}]),angular.element().ready(function(){angular.bootstrap(document,['unsubscribeApp'])})})();