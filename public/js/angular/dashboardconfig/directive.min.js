angular.module("dashboardconfigDirective",[]).directive("htmlSortable",["$parse","$timeout","$log","$window",function(e,n,r,t){return{restrict:"A",require:"?ngModel",scope:{htmlSortable:"=",ngModel:"=",ngExtraSortable:"="},link:function(e,r,a,o){var i={};i.is_handle=!1,i.in_use=!1,i.handleDragStart=function(e){i.options&&angular.isDefined(i.options.disableDrag)&&!0===i.options.disableDrag(o.$modelValue,angular.element(this))?e.preventDefault():(t.drag_source=null,t.drag_source_extra=null,i.options&&!i.is_handle&&i.options.handle?e.preventDefault():(i.is_handle=!1,e.dataTransfer.effectAllowed="move","IE"!=i.browser&&e.dataTransfer.setData("text/plain","anything"),t.drag_source=this,t.drag_source_extra=r.extra_data,this.classList.add("moving")))},i.handleDragOver=function(e){e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",this.classList.contains("over")||this.classList.add("over")},i.handleDragEnter=function(e){this.classList.contains("over")||this.classList.add("over")},i.handleDragLeave=function(e){this.classList.remove("over")},i.handleDrop=function(n){if(n.stopPropagation&&n.stopPropagation(),n.preventDefault(),this.classList.remove("over"),t.drag_source!=this){if(null==t.drag_source)return;var a=t.drag_source.model,s=this.index;if(-1!=o.$modelValue.indexOf(a)){var d=t.drag_source.index,l=angular.copy(o.$modelValue[d]);i.unbind(),o.$modelValue.splice(d,1),o.$modelValue.splice(s,0,l)}else{if(!i.options.allow_cross)return;o.$modelValue.splice(s,0,a)}e.$apply(),i.options&&angular.isDefined(i.options.stop)&&i.options.stop(o.$modelValue,s,r.extra_data,t.drag_source_extra)}return!1},i.handleDragEnd=function(e){[].forEach.call(i.cols_,function(e){e.classList.remove("over"),e.classList.remove("moving")})},i.unbind=function(){[].forEach.call(i.cols_,function(e){e.removeAttribute("draggable"),e.removeEventListener("dragstart",i.handleDragStart,!1),e.removeEventListener("dragenter",i.handleDragEnter,!1),e.removeEventListener("dragover",i.handleDragOver,!1),e.removeEventListener("dragleave",i.handleDragLeave,!1),e.removeEventListener("drop",i.handleDrop,!1),e.removeEventListener("dragend",i.handleDragEnd,!1)}),i.in_use=!1},i.activehandle=function(){i.is_handle=!0},i.register_drop=function(e){e.addEventListener("drop",i.handleDrop,!1),e.addEventListener("dragstart",i.handleDragStart,!1),e.addEventListener("dragenter",i.handleDragEnter,!1),e.addEventListener("dragover",i.handleDragOver,!1),e.addEventListener("dragleave",i.handleDragLeave,!1),e.addEventListener("drop",i.handleDrop,!1),e.addEventListener("dragend",i.handleDragEnd,!1)},i.getBrowser=function(){var e=t.navigator.userAgent;return-1!=e.indexOf(".NET")?"IE":-1!=e.indexOf("Firefox")?"Firefox":"Chrome"},i.update=function(){t.drag_source=null;var e=0;0!=o.$modelValue.length?(this.browser=this.getBrowser(),this.cols_=r[0].children,[].forEach.call(this.cols_,function(n){i.options&&i.options.handle&&n.querySelectorAll(i.options.handle)[0].addEventListener("mousedown",i.activehandle,!1),n.index=e,n.model=o.$modelValue[e],e++,n.setAttribute("draggable","true"),i.register_drop(n)}),i.in_use=!0):r[0].children.length>0&&(r[0].children[0].index=0,i.register_drop(r[0].children[0]))},o&&(o.$render=function(){n(function(){i.first_load=!1,e.$watch("ngExtraSortable",function(e){r.extra_data=e}),e.$watch("htmlSortable",function(e){i.options=angular.copy(e),"destroy"!=e?(angular.isDefined(i.options)||(i.options={}),angular.isDefined(i.options.allow_cross)||(i.options.allow_cross=!1),angular.isDefined(i.options.construct)&&i.options.construct(o.$modelValue),r[0].classList.add("html5-sortable"),i.update(),n(function(){i.first_load=!0})):i.in_use&&(i.unbind(),i.in_use=!1)},!0),e.$watch("ngModel",function(e){i.first_load&&"destroy"!=i.options&&n(function(){i.update()})},!0)})})}}}]);