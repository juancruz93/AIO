angular.module("dashboardconfigController",[]).controller("index",["$scope","$mdSidenav","$log","constantDashboardConfig","$mdDialog","FileUploader","$stateParams","restService","notificationService",function(e,a,o,t,r,n,c,l,s){function d(e,a,o,t){$parent=e.$parent,e.imageAccount=$parent.imageAccount,e.idAccount=$parent.idAccount,e.page=0,e.UrlImageBase=o.urlBaseFolderImage+e.idAccount+"/",e.funcUniversal={selectedImage:function(a){if("top"==t)$parent.topImage=e.UrlImageBase+e.imageAccount.items[a].name;else if("bottom"==t)$parent.bottomImage=e.UrlImageBase+e.imageAccount.items[a].name;else{var o=e.imageAccount.items[a];$parent.arrConfigDashboard[t].imageDashboard=e.UrlImageBase+o.name,$parent.objItemSelected.changeIcon=e.UrlImageBase+o.name}}},e.closeDialog=function(){a.hide(),t||$parent.universalAction.getImagen()}}function g(e,a){e.dashboarPreview={},e.dashboarPreview.items=angular.copy(e.$parent.arrConfigDashboard),e.dashboarPreview.topImage=angular.copy(e.$parent.topImage),e.dashboarPreview.bottomImage=angular.copy(e.$parent.bottomImage),e.closeDialog=function(){a.hide()}}void 0!==c.id&&""!=c.id||(window.location.href=t.urlPeticion.account),e.arrConfigDashboardDefault=t.configDashboardDefault,e.arrConfigDashboardDefault={},e.arrServices=[],e.idAccount=c.id,e.urlAccountList=t.urlPeticion.account,e.arrConfigDashboard=[],e.sideNavOptions={open:function(o){e.objItemSelected={},e.objItemSelected.config=angular.copy(e.arrConfigDashboard[o]),e.objItemSelected.index=o,e.objItemSelected.changeIcon=!1,a("right").toggle()},close:function(){e.arrConfigDashboard[e.objItemSelected.index]=angular.copy(e.objItemSelected.config),delete e.objItemSelected,a("right").close()},forDefault:function(){for(var o in e.arrDefaultDashboard.items)e.objItemSelected.config.title==e.arrDefaultDashboard.items[o].title&&(e.arrConfigDashboard[e.objItemSelected.index]=e.arrDefaultDashboard.items[o]);delete e.objItemSelected,a("right").close()},saveConfig:function(){e.objItemSelected.changeIcon?(e.objItemSelected.config.imageDashboard=e.objItemSelected.changeIcon,e.arrConfigDashboard[e.objItemSelected.index]=angular.copy(e.objItemSelected.config)):e.arrConfigDashboard[e.objItemSelected.index]=angular.copy(e.objItemSelected.config),e.sideNavOptions.close(),delete e.objItemSelected}},e.draggableOptions={remove:function(e){console.log(e)}},e.universalAction={openModalAdj:function(a){document.body.scrollTop=0;var o=angular.element(document.body);r.show({scope:e.$new(),parent:o,targetEvent:a,template:t.templates.templateUpload,controller:d,locals:{items:!1}})},openModalImage:function(a,o){document.body.scrollTop=0;var n=angular.element(document.body);r.show({scope:e.$new(),parent:n,targetEvent:o,template:t.templates.templateSelectedImage,controller:d,locals:{items:a}})},openModalPreview:function(a){document.body.scrollTop=0;var o=angular.element(document.body);r.show({scope:e.$new(),parent:o,targetEvent:a,template:t.templates.templatePreview,controller:g})},getImagen:function(){try{l.getImageAccountDashboard(e.idAccount).then(function(a){e.imageAccount=a,e.loadignComplete=!0}).catch(function(e){s.error(e)})}catch(e){console.Error("getImageCatch",e)}},getConfigDashboard:function(){try{l.getConfigDashboard(e.idAccount).then(function(a){a?e.universalAction.setScope(a.content):e.universalAction.setScope(!1)}).catch(function(e){s.error(e)})}catch(e){console.Error("getImageCatch",e)}},getConfigDefaultDashboard:function(){try{l.getConfigDefaultDashboard().then(function(a){e.arrConfigDashboardDefault=JSON.parse(a.content)}).catch(function(e){s.error(e.message)}).finally(function(){e.universalAction.getConfigDashboard()})}catch(e){console.Error("getImageCatch",e)}},setScope:function(a){e.arrDefaultDashboard=a?JSON.parse(a):angular.copy(e.arrConfigDashboardDefault),e.arrConfigDashboard=angular.copy(e.arrDefaultDashboard.items),e.topImage=angular.copy(e.arrDefaultDashboard.topImage),e.bottomImage=angular.copy(e.arrDefaultDashboard.bottomImage)},saveConfig:function(){try{data={items:e.arrConfigDashboard,topImage:e.topImage,bottomImage:e.bottomImage},l.saveConfig(e.idAccount,data).then(function(e){s.info(e.message)}).catch(function(e){s.error(e.message)})}catch(e){console.log("CatchSaveConfig",e)}}},(e.uploader=new n({url:t.urlPeticion.uploadImage+e.idAccount})).onAfterAddingFile=function(a){e.uploader.queue[e.uploader.queue.length-1].upload()},e.optionDroppable={opacity:.4},e.actionDroppable={onOver:function(e,a){element=angular.element(document.getElementById("droppable")),$(element[0]).removeClass("boder-droppable").addClass("hover-droppable")},onDrop:function(e,a){element=angular.element(document.getElementById("droppable")),$(element[0]).removeClass("hover-droppable").addClass("boder-droppable").find("p").html("")},remove:function(a){objList=e.arrConfigDashboard[a];for(i in e.arrDefaultDashboard.items)objList.title==e.arrDefaultDashboard.items[i].title&&(e.arrConfigDashboard.splice(a,1),e.arrServices.splice(objList.jqyoui_pos,1,e.arrDefaultDashboard.items[i]))}},e.$watch("arrConfigDashboardDefault",function(){console.log(e.arrConfigDashboardDefault)},!0)}]).controller("dashboard",["$scope","constantDashboardConfig","restService","$q",function(e,a,o,t){e.arrConfigDashboard=[],e.go=function(e){window.location.href=void 0!==e?e:"#"},e.setUrlItem=function(e){t.defer().promise},e.getConfigAccount=function(t){var r=this;try{o.getservices().then(function(n){r.dataService=n,o.getConfigDashboardClient(t).then(function(o){var t=JSON.parse(o.content);if(r.dataService.length>0)for(var n=0;n<t.items.length;n++){var c=angular.copy(t.items[n]);if(void 0===c.ref||void 0!==c.idService)if(void 0!==c.idService){for(j in r.dataService)if(r.dataService[j].idService==c.idService)switch(c.idService){case 1:c.hrefEnlace=a.urlServices.sms;break;case 2:c.hrefEnlace=a.urlServices.email;break;case 4:c.hrefEnlace=a.urlServices.automatic_campaign;break;case 5:c.hrefEnlace=a.urlServices.survey;break;case 7:c.hrefEnlace=a.urlServices.smstwoway;break;}t.items.splice(n,1,c)}else c.hrefEnlace=void 0!==c.hrefEnlaceNewServices?c.hrefEnlaceNewServices:"#",t.items.splice(n,1,c);else{var i=c.ref;c.hrefEnlace=a.urlServices[i],t.items.splice(n,1,c)}}e.arrConfigDashboard=t})})}catch(e){console.log("Error",e)}}}]);