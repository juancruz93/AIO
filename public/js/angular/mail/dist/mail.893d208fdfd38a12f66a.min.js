/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

eval("__webpack_require__(1);\r\n__webpack_require__(2);\r\n__webpack_require__(3);\r\n__webpack_require__(4);\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9qcy9hbmd1bGFyL21haWwvbWFpbi5qcz9kZDdhIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLG1CQUFPLENBQUMsQ0FBVTtBQUNsQixtQkFBTyxDQUFDLENBQWtCO0FBQzFCLG1CQUFPLENBQUMsQ0FBaUI7QUFDekIsbUJBQU8sQ0FBQyxDQUFlIiwiZmlsZSI6IjAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCcuL2FwcC5qcycpO1xyXG5yZXF1aXJlKCcuL2NvbnRyb2xsZXJzLmpzJyk7XHJcbnJlcXVpcmUoJy4vZGlyZWN0aXZlcy5qcycpO1xyXG5yZXF1aXJlKCcuL3NlcnZpY2VzLmpzJyk7XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vanMvYW5ndWxhci9tYWlsL21haW4uanNcbi8vIG1vZHVsZSBpZCA9IDBcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///0\n");

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n(function () {\r\n  angular.module('mail', ['ui.router', 'mail.controllers', 'mail.directives', 'mail.services', 'ngMaterial', 'ui.select', 'ngSanitize', 'moment-picker', 'angularMoment', 'angularFileUpload'])\r\n//    .config(function($mdAriaProvider) {\r\n//      // Globally disables all ARIA warnings.\r\n//      $mdAriaProvider.disableWarnings();\r\n//    })\r\n          .constant('constantMail', {\r\n            permissionFBAdmin:\"ADMINISTER\",\r\n            permissionFBBasicAdmin:\"CREATE_CONTENT\",\r\n            permissionFBCreateContent:\"BASIC_ADMIN\",\r\n            \r\n            errorApiFacebook:\"Ha ocurrido un problema. Por favor intente de nuevo\",\r\n            errorLengthFanPage:\"No tiene fan page asociadas. Por favor intente de nuevo.\",\r\n            \r\n            templateModalPageFacebook:'<md-dialog aria-label=\"\">' +\r\n              //Toolbar  \r\n              \"<md-toolbar>\" +\r\n              \"<div class=\\\"md-toolbar-tools\\\">\" +\r\n              \"<h4 class=\\\"modal-title\\\" id=\\\"exampleModalLabel\\\">Seleccionar fan page</h4>\" +\r\n              \"<span flex></span>\" +\r\n              \"<md-button class=\\\"md-icon-button\\\" ng-click=\\\"cancel()\\\">\" +\r\n              \"<md-icon  aria-label=\\\"Close dialog\\\"></md-icon>\" +\r\n              \"</md-button>\" +\r\n              \"</div>\" +\r\n              \"</md-toolbar>\" +\r\n              //Dialog Content\r\n              \"<md-dialog-content >\" +\r\n              '<div class=\"container-fluid\">'+\r\n              '<div class=\"row row-flex row-flex-wrap\">'+\r\n              '<div class=\"col-xs-12 col-sm-12 col-md-12 col-lg-12\" ng-if=\"pages>0\">'+\r\n                '<h1>No tiene actualmente Fan Page para seleccionar.</h1>'+\r\n              '</div>'+\r\n              '<div class=\"col-xs-12 col-sm-12 col-md-4 col-lg-4 cursor-pointer\"  ng-repeat=\"page in pages\" ng-click=\"selectedPage(page)\"> '+\r\n              '<div class=\"card facebook-list\">'+\r\n                '<div class=\"text-center\">'+\r\n                    '<a ><img src=\"{{page.picture}}\" class=\"img-circle\"/></a>'+\r\n                    '<h3 class=\"text-center\">{{page.name}}</h3>'+\r\n                '</div>'+\r\n              '</div>'+\r\n              '</div>'+\r\n              '</div>'+\r\n              '</div>'+\r\n              '<br>'+\r\n              '<div class=row>' +\r\n              '<md-dialog-actions class=\"col-lg-12 text-right\">' +\r\n              \"<button type=\\\"button\\\" class=\\\"btn btn-default\\\"  ng-click=\\\"closeDialog()\\\">Cerrar</button>\" +\r\n              '</md-dialog-actions>' +\r\n              '</div>' +\r\n              '</md-dialog-content>' +\r\n              '</md-dialog>'\r\n          })\r\n          .config(['$stateProvider', '$urlRouterProvider', function ($stateProvider, $urlRouterProvider) {\r\n              $stateProvider\r\n                      .state('describe', {\r\n                        url: \"/basicinformation/:id\",\r\n                        templateUrl: fullUrlBase + templateBase + '/basicinformation',\r\n                        controller: 'basicinformationController'\r\n                      })\r\n                      .state('addressees', {\r\n                        url: \"/addressees/:id\",\r\n                        templateUrl: fullUrlBase + templateBase + '/addressees',\r\n                        controller: 'addAddresseesController'\r\n                      })\r\n                      .state('content', {\r\n                        url: \"/content/:id\",\r\n                        templateUrl: fullUrlBase + templateBase + '/content',\r\n                        controller: 'contentController'\r\n                      })\r\n                      .state('advanceoptions', {\r\n                        url: \"/advanceoptions/:id\",\r\n                        templateUrl: fullUrlBase + templateBase + '/advanceoptions/',\r\n                        controller: 'advanceoptionsController'\r\n                      })\r\n                      .state('shippingdate', {\r\n                        url: \"/shippingdate/:id\",\r\n                        templateUrl: fullUrlBase + templateBase + '/shippingdate',\r\n                        controller: 'shippingdateController'\r\n                      })\r\n//        $urlRouterProvider.otherwise(function ($injector, $location) {\r\n//          var $state = $injector.get('$state');\r\n//          $state.go('index');\r\n//        });\r\n            }]);\r\n})();\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9qcy9hbmd1bGFyL21haWwvYXBwLmpzP2MwOWYiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLGNBQWM7QUFDbkQsK0NBQStDLFdBQVc7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWCxhQUFhO0FBQ2IsQ0FBQyIsImZpbGUiOiIxLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gIGFuZ3VsYXIubW9kdWxlKCdtYWlsJywgWyd1aS5yb3V0ZXInLCAnbWFpbC5jb250cm9sbGVycycsICdtYWlsLmRpcmVjdGl2ZXMnLCAnbWFpbC5zZXJ2aWNlcycsICduZ01hdGVyaWFsJywgJ3VpLnNlbGVjdCcsICduZ1Nhbml0aXplJywgJ21vbWVudC1waWNrZXInLCAnYW5ndWxhck1vbWVudCcsICdhbmd1bGFyRmlsZVVwbG9hZCddKVxyXG4vLyAgICAuY29uZmlnKGZ1bmN0aW9uKCRtZEFyaWFQcm92aWRlcikge1xyXG4vLyAgICAgIC8vIEdsb2JhbGx5IGRpc2FibGVzIGFsbCBBUklBIHdhcm5pbmdzLlxyXG4vLyAgICAgICRtZEFyaWFQcm92aWRlci5kaXNhYmxlV2FybmluZ3MoKTtcclxuLy8gICAgfSlcclxuICAgICAgICAgIC5jb25zdGFudCgnY29uc3RhbnRNYWlsJywge1xyXG4gICAgICAgICAgICBwZXJtaXNzaW9uRkJBZG1pbjpcIkFETUlOSVNURVJcIixcclxuICAgICAgICAgICAgcGVybWlzc2lvbkZCQmFzaWNBZG1pbjpcIkNSRUFURV9DT05URU5UXCIsXHJcbiAgICAgICAgICAgIHBlcm1pc3Npb25GQkNyZWF0ZUNvbnRlbnQ6XCJCQVNJQ19BRE1JTlwiLFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXJyb3JBcGlGYWNlYm9vazpcIkhhIG9jdXJyaWRvIHVuIHByb2JsZW1hLiBQb3IgZmF2b3IgaW50ZW50ZSBkZSBudWV2b1wiLFxyXG4gICAgICAgICAgICBlcnJvckxlbmd0aEZhblBhZ2U6XCJObyB0aWVuZSBmYW4gcGFnZSBhc29jaWFkYXMuIFBvciBmYXZvciBpbnRlbnRlIGRlIG51ZXZvLlwiLFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGVtcGxhdGVNb2RhbFBhZ2VGYWNlYm9vazonPG1kLWRpYWxvZyBhcmlhLWxhYmVsPVwiXCI+JyArXHJcbiAgICAgICAgICAgICAgLy9Ub29sYmFyICBcclxuICAgICAgICAgICAgICBcIjxtZC10b29sYmFyPlwiICtcclxuICAgICAgICAgICAgICBcIjxkaXYgY2xhc3M9XFxcIm1kLXRvb2xiYXItdG9vbHNcXFwiPlwiICtcclxuICAgICAgICAgICAgICBcIjxoNCBjbGFzcz1cXFwibW9kYWwtdGl0bGVcXFwiIGlkPVxcXCJleGFtcGxlTW9kYWxMYWJlbFxcXCI+U2VsZWNjaW9uYXIgZmFuIHBhZ2U8L2g0PlwiICtcclxuICAgICAgICAgICAgICBcIjxzcGFuIGZsZXg+PC9zcGFuPlwiICtcclxuICAgICAgICAgICAgICBcIjxtZC1idXR0b24gY2xhc3M9XFxcIm1kLWljb24tYnV0dG9uXFxcIiBuZy1jbGljaz1cXFwiY2FuY2VsKClcXFwiPlwiICtcclxuICAgICAgICAgICAgICBcIjxtZC1pY29uICBhcmlhLWxhYmVsPVxcXCJDbG9zZSBkaWFsb2dcXFwiPjwvbWQtaWNvbj5cIiArXHJcbiAgICAgICAgICAgICAgXCI8L21kLWJ1dHRvbj5cIiArXHJcbiAgICAgICAgICAgICAgXCI8L2Rpdj5cIiArXHJcbiAgICAgICAgICAgICAgXCI8L21kLXRvb2xiYXI+XCIgK1xyXG4gICAgICAgICAgICAgIC8vRGlhbG9nIENvbnRlbnRcclxuICAgICAgICAgICAgICBcIjxtZC1kaWFsb2ctY29udGVudCA+XCIgK1xyXG4gICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiY29udGFpbmVyLWZsdWlkXCI+JytcclxuICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInJvdyByb3ctZmxleCByb3ctZmxleC13cmFwXCI+JytcclxuICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImNvbC14cy0xMiBjb2wtc20tMTIgY29sLW1kLTEyIGNvbC1sZy0xMlwiIG5nLWlmPVwicGFnZXM+MFwiPicrXHJcbiAgICAgICAgICAgICAgICAnPGgxPk5vIHRpZW5lIGFjdHVhbG1lbnRlIEZhbiBQYWdlIHBhcmEgc2VsZWNjaW9uYXIuPC9oMT4nK1xyXG4gICAgICAgICAgICAgICc8L2Rpdj4nK1xyXG4gICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiY29sLXhzLTEyIGNvbC1zbS0xMiBjb2wtbWQtNCBjb2wtbGctNCBjdXJzb3ItcG9pbnRlclwiICBuZy1yZXBlYXQ9XCJwYWdlIGluIHBhZ2VzXCIgbmctY2xpY2s9XCJzZWxlY3RlZFBhZ2UocGFnZSlcIj4gJytcclxuICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImNhcmQgZmFjZWJvb2stbGlzdFwiPicrXHJcbiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInRleHQtY2VudGVyXCI+JytcclxuICAgICAgICAgICAgICAgICAgICAnPGEgPjxpbWcgc3JjPVwie3twYWdlLnBpY3R1cmV9fVwiIGNsYXNzPVwiaW1nLWNpcmNsZVwiLz48L2E+JytcclxuICAgICAgICAgICAgICAgICAgICAnPGgzIGNsYXNzPVwidGV4dC1jZW50ZXJcIj57e3BhZ2UubmFtZX19PC9oMz4nK1xyXG4gICAgICAgICAgICAgICAgJzwvZGl2PicrXHJcbiAgICAgICAgICAgICAgJzwvZGl2PicrXHJcbiAgICAgICAgICAgICAgJzwvZGl2PicrXHJcbiAgICAgICAgICAgICAgJzwvZGl2PicrXHJcbiAgICAgICAgICAgICAgJzwvZGl2PicrXHJcbiAgICAgICAgICAgICAgJzxicj4nK1xyXG4gICAgICAgICAgICAgICc8ZGl2IGNsYXNzPXJvdz4nICtcclxuICAgICAgICAgICAgICAnPG1kLWRpYWxvZy1hY3Rpb25zIGNsYXNzPVwiY29sLWxnLTEyIHRleHQtcmlnaHRcIj4nICtcclxuICAgICAgICAgICAgICBcIjxidXR0b24gdHlwZT1cXFwiYnV0dG9uXFxcIiBjbGFzcz1cXFwiYnRuIGJ0bi1kZWZhdWx0XFxcIiAgbmctY2xpY2s9XFxcImNsb3NlRGlhbG9nKClcXFwiPkNlcnJhcjwvYnV0dG9uPlwiICtcclxuICAgICAgICAgICAgICAnPC9tZC1kaWFsb2ctYWN0aW9ucz4nICtcclxuICAgICAgICAgICAgICAnPC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgJzwvbWQtZGlhbG9nLWNvbnRlbnQ+JyArXHJcbiAgICAgICAgICAgICAgJzwvbWQtZGlhbG9nPidcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJywgZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuICAgICAgICAgICAgICAkc3RhdGVQcm92aWRlclxyXG4gICAgICAgICAgICAgICAgICAgICAgLnN0YXRlKCdkZXNjcmliZScsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9iYXNpY2luZm9ybWF0aW9uLzppZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVsbFVybEJhc2UgKyB0ZW1wbGF0ZUJhc2UgKyAnL2Jhc2ljaW5mb3JtYXRpb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnYmFzaWNpbmZvcm1hdGlvbkNvbnRyb2xsZXInXHJcbiAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgLnN0YXRlKCdhZGRyZXNzZWVzJywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL2FkZHJlc3NlZXMvOmlkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdWxsVXJsQmFzZSArIHRlbXBsYXRlQmFzZSArICcvYWRkcmVzc2VlcycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhZGRBZGRyZXNzZWVzQ29udHJvbGxlcidcclxuICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAuc3RhdGUoJ2NvbnRlbnQnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogXCIvY29udGVudC86aWRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bGxVcmxCYXNlICsgdGVtcGxhdGVCYXNlICsgJy9jb250ZW50JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2NvbnRlbnRDb250cm9sbGVyJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgIC5zdGF0ZSgnYWR2YW5jZW9wdGlvbnMnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogXCIvYWR2YW5jZW9wdGlvbnMvOmlkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdWxsVXJsQmFzZSArIHRlbXBsYXRlQmFzZSArICcvYWR2YW5jZW9wdGlvbnMvJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2FkdmFuY2VvcHRpb25zQ29udHJvbGxlcidcclxuICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAuc3RhdGUoJ3NoaXBwaW5nZGF0ZScsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9zaGlwcGluZ2RhdGUvOmlkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdWxsVXJsQmFzZSArIHRlbXBsYXRlQmFzZSArICcvc2hpcHBpbmdkYXRlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3NoaXBwaW5nZGF0ZUNvbnRyb2xsZXInXHJcbiAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4vLyAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShmdW5jdGlvbiAoJGluamVjdG9yLCAkbG9jYXRpb24pIHtcclxuLy8gICAgICAgICAgdmFyICRzdGF0ZSA9ICRpbmplY3Rvci5nZXQoJyRzdGF0ZScpO1xyXG4vLyAgICAgICAgICAkc3RhdGUuZ28oJ2luZGV4Jyk7XHJcbi8vICAgICAgICB9KTtcclxuICAgICAgICAgICAgfV0pO1xyXG59KSgpO1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2pzL2FuZ3VsYXIvbWFpbC9hcHAuanNcbi8vIG1vZHVsZSBpZCA9IDFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///1\n");

/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n(function () {\r\n  angular.module('mail.controllers', [])\r\n          .filter('propsFilter', function () {\r\n            return function (items, props) {\r\n              var out = [];\r\n              if (angular.isArray(items)) {\r\n                var keys = Object.keys(props);\r\n                items.forEach(function (item) {\r\n                  var itemMatches = false;\r\n                  for (var i = 0; i < keys.length; i++) {\r\n                    var prop = keys[i];\r\n                    var text = props[prop].toLowerCase();\r\n                    if (item[prop].toString().toLowerCase().indexOf(text) !== -1) {\r\n                      itemMatches = true;\r\n                      break;\r\n                    }\r\n                  }\r\n\r\n                  if (itemMatches) {\r\n                    out.push(item);\r\n                  }\r\n                });\r\n              } else {\r\n                // Let the output be the input untouched\r\n                out = items;\r\n              }\r\n\r\n              return out;\r\n            };\r\n          })\r\n          .filter('getById', function () {\r\n            return function (input, id) {\r\n              var i = 0, len = input.length;\r\n              for (; i < len; i++) {\r\n                if (input[i].gmt == id) {\r\n                  return input[i];\r\n                }\r\n              }\r\n              return null;\r\n            }\r\n          })\r\n          .controller('main', ['$scope', 'incomplete', '$rootScope', 'wizard', 'restService', function ($scope, incomplete, $rootScope, wizard, restService) {\r\n              $rootScope.incomplete = incomplete.getincomplete();\r\n              wizard.setdescribe(true);\r\n              wizard.setaddressees(false);\r\n              wizard.setcontent(false);\r\n              wizard.setadvanceoptions(false);\r\n              wizard.setshippingdate(false);\r\n              $rootScope.addressees = wizard.getaddressees();\r\n              $rootScope.describe = wizard.getdescribe();\r\n              $rootScope.content = wizard.getcontent();\r\n              $rootScope.advanceoptions = wizard.getadvanceoptions();\r\n              $rootScope.shippingdate = wizard.getshippingdate();\r\n            }])\r\n          .controller('basicinformationController', ['$scope', '$rootScope', 'restService', '$window', 'notificationService', '$stateParams', 'wizard', function ($scope, $rootScope, restService, $window, notificationService, $stateParams, wizard) {\r\n\r\n              wizard.setdescribe(true);\r\n              wizard.setaddressees(false);\r\n              wizard.setcontent(false);\r\n              wizard.setadvanceoptions(false);\r\n              wizard.setshippingdate(false);\r\n              $rootScope.addressees = wizard.getaddressees();\r\n              $rootScope.describe = wizard.getdescribe();\r\n              $rootScope.content = wizard.getcontent();\r\n              $rootScope.advanceoptions = wizard.getadvanceoptions();\r\n              $rootScope.shippingdate = wizard.getshippingdate();\r\n              $scope.data = {};\r\n              $scope.data.category = [];\r\n              function getemailname() {\r\n                restService.getemailname().then(function (res) {\r\n                  $scope.emailname = res;\r\n                });\r\n              }\r\n\r\n              function getemailsend() {\r\n                restService.getemailsend().then(function (res) {\r\n                  $scope.emailsend = res;\r\n                });\r\n              }\r\n\r\n              function getMailCategory() {\r\n                restService.getMailCategory().then(function (res) {\r\n                  $scope.availibleCategory = res;\r\n                });\r\n              }\r\n\r\n              function getReplyTo() {\r\n                restService.getReplyTo().then(function (res) {\r\n                  $scope.replyToArray = res;\r\n                });\r\n              }\r\n\r\n              getemailname();\r\n              getemailsend();\r\n              getReplyTo();\r\n              getMailCategory();\r\n              $scope.showInputName = false;\r\n              $scope.showInputCategory = false;\r\n              $scope.showSelectName = true;\r\n              $scope.showCategoryName = true;\r\n              $scope.showIconsName = true;\r\n              $scope.showIconsCategory = true;\r\n              $scope.showIconsSaveName = false;\r\n              $scope.showIconsSaveCategory = false;\r\n              $scope.changeStatusNameCategory = function () {\r\n                if (!$scope.showInputCategory) {\r\n                  $scope.showInputCategory = true;\r\n                  $scope.showCategoryName = false;\r\n                  $scope.showIconsCategory = false;\r\n                  $scope.showIconsSaveCategory = true;\r\n                } else {\r\n                  $scope.showInputCategory = false;\r\n                  $scope.showCategoryName = true;\r\n                  $scope.showIconsCategory = true;\r\n                  $scope.showIconsSaveCategory = false;\r\n                }\r\n              };\r\n              $scope.changeStatusInputName = function () {\r\n                if (!$scope.showInputName) {\r\n                  $scope.showInputName = true;\r\n                  $scope.showSelectName = false;\r\n                  $scope.showIconsName = false;\r\n                  $scope.showIconsSaveName = true;\r\n                } else {\r\n                  $scope.showInputName = false;\r\n                  $scope.showSelectName = true;\r\n                  $scope.showIconsName = true;\r\n                  $scope.showIconsSaveName = false;\r\n                }\r\n              }\r\n\r\n              $scope.showInputEmail = false;\r\n              $scope.showSelectEmail = true;\r\n              $scope.showIconsEmail = true;\r\n              $scope.showIconsSaveEmail = false;\r\n              $scope.changeStatusInputEmail = function () {\r\n                if (!$scope.showInputEmail) {\r\n                  $scope.showInputEmail = true;\r\n                  $scope.showSelectEmail = false;\r\n                  $scope.showIconsEmail = false;\r\n                  $scope.showIconsSaveEmail = true;\r\n                } else {\r\n                  $scope.showInputEmail = false;\r\n                  $scope.showSelectEmail = true;\r\n                  $scope.showIconsEmail = true;\r\n                  $scope.showIconsSaveEmail = false;\r\n                }\r\n              }\r\n\r\n\r\n              $scope.showInputReplyto = false;\r\n              $scope.showSelectReplyto = true;\r\n              $scope.showIconsReplyto = true;\r\n              $scope.showIconsSaveReplyto = false;\r\n              $scope.changeStatusInputReplyto = function () {\r\n                if (!$scope.showInputReplyto) {\r\n                  $scope.showInputReplyto = true;\r\n                  $scope.showSelectReplyto = false;\r\n                  $scope.showIconsReplyto = false;\r\n                  $scope.showIconsSaveReplyto = true;\r\n                } else {\r\n                  $scope.showInputReplyto = false;\r\n                  $scope.showSelectReplyto = true;\r\n                  $scope.showIconsReplyto = true;\r\n                  $scope.showIconsSaveReplyto = false;\r\n                }\r\n              }\r\n\r\n\r\n\r\n              $scope.basicInformationRegister = function () {\r\n                if (typeof ($rootScope.idMailGet) != \"undefined\") {\r\n                  //console.log($scope.data);\r\n                  if (typeof ($scope.data.senderNameSelect) == 'undefined') {\r\n                    notificationService.error(\"El Nombre del remitente es obigatorio\");\r\n                  } else if (typeof ($scope.data.senderMailSelect) == 'undefined') {\r\n                    notificationService.error(\"El Correo del remitente es obigatorio\");\r\n                  } else {\r\n                    restService.editBasicInformation($rootScope.idMailGet, $scope.data).then(function (res) {\r\n                      notificationService.success(res['msg']);\r\n                      $rootScope.idMailGet = res['idMail'];\r\n                      $window.location.href = fullUrlBase + templateBase + '/create#/addressees/' + res['idMail'];\r\n                    });\r\n                  }\r\n                } else {\r\n                  if (typeof ($scope.data.senderNameSelect) == 'undefined') {\r\n                    notificationService.error(\"El Nombre del remitente es obigatorio\");\r\n                  } else if (typeof ($scope.data.senderMailSelect) == 'undefined') {\r\n                    notificationService.error(\"El Correo del remitente es obigatorio\");\r\n                  } else {\r\n                    restService.addBasicInformation($scope.data).then(function (res) {\r\n                      notificationService.success(res['msg']);\r\n                      $rootScope.idMailGet = res['idMail'];\r\n                      $window.location.href = fullUrlBase + templateBase + '/create#/addressees/' + res['idMail'];\r\n                    });\r\n                  }\r\n                }\r\n              };\r\n              $scope.basicInformationSave = function () {\r\n                if (typeof ($scope.data.senderNameSelect) == 'undefined') {\r\n                  notificationService.error(\"El Nombre del remitente es obigatorio\");\r\n                } else if (typeof ($scope.data.senderMailSelect) == 'undefined') {\r\n                  notificationService.error(\"El Correo del remitente es obigatorio\");\r\n                } else {\r\n                  restService.editBasicInformation($rootScope.idMailGet, $scope.data).then(function (res) {\r\n                    //console.log(res);\r\n                    notificationService.success(res['msg']);\r\n                    $rootScope.idMailGet = res['idMail'];\r\n                    $window.location.href = fullUrlBase + templateBase;\r\n                  });\r\n                }\r\n              };\r\n              $scope.saveCategory = function () {\r\n                var data = {name: $scope.categoryName};\r\n                $scope.changeStatusNameCategory();\r\n                restService.saveCategory(data).then(function (res) {\r\n                  notificationService.primary(res['msg']);\r\n                  $scope.categoryName = \"\";\r\n                  getMailCategory();\r\n                  $scope.data.category.push(res['category'].idMailCategory);\r\n                });\r\n              };\r\n              $scope.saveName = function () {\r\n                var data = {name: $scope.senderName};\r\n                restService.addEmailName(data).then(function (res) {\r\n                  notificationService.success(res['msg']);\r\n                  $scope.senderName = \"\";\r\n                  getemailname();\r\n                  $scope.changeStatusInputName();\r\n                  $scope.data.senderNameSelect = res['idNameSender'];\r\n                });\r\n              }\r\n\r\n              $scope.saveEmail = function () {\r\n                var data = {email: $scope.senderMail};\r\n                restService.addEmailSender(data).then(function (res) {\r\n                  if (res == \"\" || res == null) {\r\n                    notificationService.warning('No se pudo guardar el remitente, posiblemente el correo ese demasiado largo, intentelo nuevamente o comuniquese con soporte');\r\n                  } else {\r\n                    notificationService.success(res['msg']);\r\n                    $scope.senderMail = \"\";\r\n                    getemailsend();\r\n                    $scope.changeStatusInputEmail();\r\n                    $scope.data.senderMailSelect = res['idEmailsender'];\r\n                  }\r\n                });\r\n              }\r\n\r\n              $scope.saveReplyto = function () {\r\n                var data = {email: $scope.replyTo};\r\n                restService.addReplyTo(data).then(function (res) {\r\n                  notificationService.success(res['msg']);\r\n                  $scope.replyTo = \"\";\r\n                  getReplyTo();\r\n                  $scope.changeStatusInputReplyto();\r\n                  $scope.data.replyToSelect = res['idReplyTo'];\r\n                });\r\n              }\r\n\r\n\r\n              if ($stateParams.id) {\r\n                if (!IsNumeric($stateParams.id)) {\r\n                  notificationService.warning(\"El correo no se ha encontrado\");\r\n                  location.href = '#/basicinformation/';\r\n                } else {\r\n                  $rootScope.idMailGet = $stateParams.id;\r\n                }\r\n              }\r\n              function IsNumeric(val) {\r\n                return Number(parseFloat(val)) == val;\r\n              }\r\n\r\n              if ($rootScope.idMailGet && IsNumeric($rootScope.idMailGet)) {\r\n                //        if (typeof ($rootScope.idMailGet) != \"undefined\" ) {\r\n                restService.findMail($rootScope.idMailGet).then(function (res) {\r\n                  $scope.data.name = res.name;\r\n                  $scope.data.senderNameSelect = res.idNameSender;\r\n                  $scope.data.senderMailSelect = res.idEmailsender;\r\n                  $scope.data.replyToSelect = res.idReplyTo;\r\n                  $scope.data.replyto = res.replyto;\r\n                  $scope.data.subject = res.subject;\r\n                  $scope.data.test = (res.test == 1);\r\n                });\r\n                restService.getMailCategoryByIdMail($rootScope.idMailGet).then(function (res) {\r\n                  var idMailCategory = [];\r\n                  res.forEach(function (item, index) {\r\n                    idMailCategory.push(item.idMailCategory);\r\n                  });\r\n                  $scope.data.category = idMailCategory;\r\n                });\r\n              }\r\n            }])\r\n          .controller('shippingdateController', ['$scope', '$rootScope', '$interval', '$filter', 'restService', '$stateParams', '$q', 'notificationService', 'moment', 'wizard', '$FB', '$timeout', function ($scope, $rootScope, $interval, $filter, restService, $stateParams, $q, notificationService, moment, wizard, $FB, $timeout) {\r\n              if (!IsNumeric($stateParams.id)) {\r\n                notificationService.warning(\"El correo no se ha encontrado\");\r\n                location.href = '#/basicinformation/';\r\n                return true;\r\n              }\r\n\r\n              function IsNumeric(val) {\r\n                return Number(parseFloat(val)) == val;\r\n              }\r\n              wizard.setdescribe(false);\r\n              wizard.setaddressees(false);\r\n              wizard.setcontent(false);\r\n              wizard.setadvanceoptions(false);\r\n              wizard.setshippingdate(true);\r\n              $rootScope.addressees = wizard.getaddressees();\r\n              $rootScope.describe = wizard.getdescribe();\r\n              $rootScope.content = wizard.getcontent();\r\n              $rootScope.advanceoptions = wizard.getadvanceoptions();\r\n              $rootScope.shippingdate = wizard.getshippingdate();\r\n              $scope.show = false;\r\n              $scope.data = {};\r\n              $scope.zonahoraria = {};\r\n              $rootScope.idMailGet = $stateParams.id;\r\n              $scope.idMail = $rootScope.idMailGet;\r\n              $scope.imagenDate = new Date();\r\n              $scope.imagenTime = $scope.imagenDate.getTime();\r\n              $scope.tester = {\r\n                mailTester: false,\r\n                emailsSendTester: null,\r\n                messageSendTester: null,\r\n                sendTesterMail: function () {\r\n                  if (this.mailTester) {\r\n                    if (this.emailsSendTester == null || this.emailsSendTester == \"\") {\r\n                      notificationService.error(\"El campo de correos de envio de tester no puede estar vacio.\");\r\n                      return false;\r\n                    }\r\n                    data = {mailsSend: this.emailsSendTester.split(\",\"), messageSend: this.messageSendTester, idTester: $scope.idMail};\r\n                    restService.sendTesterMails(data, $scope.idMail)\r\n                            .then(function (data) {\r\n                              console.log(data);\r\n                            });\r\n                  }\r\n\r\n                }\r\n              };\r\n\r\n\r\n              $('#datetimepicker').datetimepicker({\r\n                format: 'yyyy-MM-dd hh:mm',\r\n                language: 'es'\r\n              }).on('changeDate', function (ev) {\r\n                $scope.tick();\r\n                $scope.$apply();\r\n              });\r\n              $scope.showTextarea = function () {\r\n                if ($scope.show == false) {\r\n                  $scope.show = true;\r\n                } else {\r\n                  $scope.show = false;\r\n                }\r\n              }\r\n              $scope.loginFB = function (idPage) {\r\n                $FB.getLoginStatus(function (response) {\r\n                  if (response.status === 'connected') {\r\n                    $FB.api('/' + idPage + \"?fields=access_token,name\", function (response) {\r\n                      $scope.setFacebook(response);\r\n                    });\r\n                  } else {\r\n                    $FB.login(function () {\r\n                      $FB.api('/' + idPage + \"?fields=access_token,name\", function (response) {\r\n                        $scope.setFacebook(response);\r\n                      });\r\n                    }, {\r\n                      scope: 'publish_actions,publish_pages,manage_pages'\r\n                    });\r\n                  }\r\n                });\r\n              }\r\n              $scope.setFacebook = function (data) {\r\n\r\n                $FB.api('/' + data.id + '/picture?redirect=false', function (response) {\r\n                  $scope.$apply(function () {\r\n                    $scope.data.facebook.name = data.name;\r\n                    $scope.data.facebook.picture = response.data.url;\r\n                    $scope.data.facebook.access_token = data.access_token;\r\n\r\n                  });\r\n                });\r\n              }\r\n\r\n              $scope.publishSocialFacebook = function (data) {\r\n                var post = {};\r\n\r\n//                post.url = fullUrlBase + 'asset/thumbnailmail/' + $scope.idMail; //SERVIDOR\r\n                post.url = \"https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcQ1dmzDhsPc5yHJ5S6j90DUcoUEayldxlaiFDnhAyzR5YFcozADUxk1dBw\";//LOCALHOST\r\n                post.access_token = $scope.data.facebook.access_token;\r\n                post.message = ($scope.data.facebook.description != null) ? $scope.data.facebook.description : \"\";\r\n                //                if(!angular.equals(null,$scope.data.facebook.description)){\r\n                //                  post.caption = $scope.data.facebook.description; \r\n                //                }\r\n                console.log(\"Check -> Caption, me imagino que el comentario en el post\");\r\n                console.log(post);\r\n                if (data.socialSend != \"now\") {\r\n                  post.scheduled_publish_time = data.socialSend;\r\n                  post.published = false;\r\n                }\r\n                post.link = \"https://aio.sigmamovil.com/webversion/show/\" + \"1-\" + $scope.data.idMail + \"-public-\" + $scope.data.codigo + \"/\";\r\n                $FB.api(\"/\" + $scope.data.facebook.idPage + \"/feed\",\r\n                        \"POST\", post,\r\n                        function (response) {\r\n                          if (response && !response.error) {\r\n                            var photoId = response.id;\r\n                            var postId = response.post_id;\r\n                            if (typeof postId == \"undefined\") {\r\n                              postId = $scope.data.facebook.idPage + \"_\" + photoId;\r\n                            }\r\n                            restService.sendDataComfirmationEmail(data).then(function (data) {\r\n                              notificationService.primary(data.message);\r\n                              openModalConfirm();\r\n                            }).catch(function (data) {\r\n                              $FB.api(\"/\" + photoId,\r\n                                      \"DELETE\",\r\n                                      {access_token: $scope.data.facebook.access_token},\r\n                                      function (response) {\r\n                                        if (response && !response.error) {\r\n                                        }\r\n                                      });\r\n\r\n                              $FB.api(\"/\" + postId,\r\n                                      \"DELETE\",\r\n                                      {access_token: $scope.data.facebook.access_token},\r\n                                      function (response) {\r\n                                        if (response && !response.error) {\r\n                                        }\r\n                                      });\r\n                            });\r\n                          } else {\r\n                            notificationService.error(\"ocurrÃ­o un error haciendo el posteo, por favor validar la sessiÃ³n de facebook.\")\r\n                          }\r\n                        });\r\n              }\r\n\r\n              if ($stateParams.id) {\r\n                $rootScope.idMailGet = $stateParams.id;\r\n                $scope.idMail = $rootScope.idMailGet;\r\n              }\r\n\r\n              restService.getSaxs().then(function (res) {\r\n                for (var i = 0; i < res.length; i++) {\r\n                  if (res[i].service == \"email marketing\") {\r\n                    $scope.ammoutEmail = {ammount: res[i].amount, accountingMode: res[i].accountingMode};\r\n                  }\r\n                }\r\n              });\r\n              restService.findMail($rootScope.idMailGet).then(function (res) {\r\n\r\n                $scope.data = res;\r\n                $scope.data.test = (res.test == \"1\");\r\n                if (res.scheduleDate != null && res.scheduleDate != \"\") {\r\n                  $(\"#valueDatepicker\").val(res.scheduleDate);\r\n                  $scope.gmtDataBase = res.gmt;\r\n                  $scope.date = res.scheduleDate;\r\n                  $scope.oldHour = true;\r\n                  restService.getlisttimezone().then(function (res) {\r\n                    $scope.timezone = res;\r\n                    $scope.zonahoraria.zone = $filter('getById')($scope.timezone, res.gmt);\r\n                  });\r\n                } else {\r\n                  restService.getlisttimezone().then(function (res) {\r\n                    $scope.timezone = res;\r\n                    $scope.zonahoraria.zone = $filter('getById')($scope.timezone, \"-0500\");\r\n                  });\r\n                  $scope.oldHour = false;\r\n                }\r\n\r\n                if (res.target != null && res.target != \"\") {\r\n                  var json = jQuery.parseJSON(res.target);\r\n                  if (json.type == \"contactlist\") {\r\n                    $scope.data.titleList = 'Lista(s) de contacto(s): ';\r\n                    $scope.data.contacts = json.contactlists;\r\n                  } else if (json.type == \"segment\") {\r\n                    $scope.data.titleList = 'Segmento(s): ';\r\n                    $scope.data.contacts = json.segment;\r\n                  }\r\n                  //console.log(json);\r\n                }\r\n\r\n                restService.getContentMail($rootScope.idMailGet).then(function (resStatics) {\r\n                  if (resStatics.statisticsEmails != \"\") {\r\n                    $scope.data.statisticsEmails = {statisticsEmails: resStatics.statisticsEmails, quantity: resStatics.quantity, typeTime: resStatics.typeTime};\r\n                  } else {\r\n                    $scope.data.statisticsEmails = false;\r\n                  }\r\n\r\n                  if (resStatics.notificationEmails != \"\") {\r\n                    $scope.data.notificationEmails = resStatics.notificationEmails;\r\n                  } else {\r\n                    $scope.data.notificationEmails = false;\r\n                  }\r\n\r\n                  if (resStatics.facebook) {\r\n                    $scope.data.facebook = resStatics.facebook;\r\n                    if ($FB.loaded) {\r\n                      $scope.loginFB($scope.data.facebook.idPage);\r\n                    } else {\r\n                      $timeout(function () {\r\n                        $scope.loginFB($scope.data.facebook.idPage);\r\n                      }, 2000);\r\n                    }\r\n                  } else {\r\n                    $scope.data.facebook = false;\r\n                  }\r\n                })\r\n                restService.findEmailSender(res.idEmailsender).then(function (resEmailSender) {\r\n                  //console.log(resEmailSender);\r\n                  $scope.data.emailSender = resEmailSender.email;\r\n                });\r\n                restService.findEmailName(res.idNameSender).then(function (resEmailname) {\r\n                  //            console.log(resEmailname);\r\n                  $scope.data.nameSender = resEmailname.name;\r\n                });\r\n\r\n                if (res.idReplyTo != null && angular.isDefined(res.idReplyTo)) {\r\n                  restService.findReplyto(res.idReplyTo).then(function (resReplyto) {\r\n                    //          console.log(resReplyto.email);\r\n                    $scope.data.replyto = resReplyto.email;\r\n                  });\r\n                } else {\r\n                  $scope.data.replyto = null;\r\n                }\r\n\r\n\r\n                restService.findMailCategory($rootScope.idMailGet).then(function (res) {\r\n                  $scope.data.category = res;\r\n                });\r\n                restService.findMailAttachment($rootScope.idMailGet).then(function (res) {\r\n                  $scope.data.attachment = res;\r\n                  $scope.data.sizeAttachment = 0;\r\n                  if ($scope.data.attachment.length > 0) {\r\n                    for (var i in $scope.data.attachment) {\r\n                      $scope.data.sizeAttachment = $scope.data.sizeAttachment + parseInt($scope.data.attachment[i].size);\r\n                    }\r\n                  }\r\n                  //console.log(res);\r\n                });\r\n              });\r\n              var dateUnix = moment().utc().valueOf();\r\n              var gmt;\r\n              $scope.changeTestMail = function (test) {\r\n                var data = {};\r\n                if (test) {\r\n                  data.test = 1;\r\n                } else {\r\n                  data.test = 0;\r\n                }\r\n\r\n                restService.changeTestMail($rootScope.idMailGet, data).then(function (res) {\r\n                  notificationService.primary(\"Se actualizo correctamente el correo.\");\r\n                })\r\n              }\r\n              $scope.tick = function () {\r\n                var selecteDate = $(\"#valueDatepicker\").val();\r\n                if (!selecteDate.length == 0) {\r\n                  $scope.dateSelectedUnix = moment(selecteDate).utc().valueOf();\r\n                  dateUnix = $scope.dateSelectedUnix;\r\n                }\r\n\r\n                if (typeof ($scope.zonahoraria.zone) == \"undefined\") {\r\n                  gmt = \"-0500\";\r\n                } else {\r\n                  gmt = $scope.zonahoraria.zone.gmt;\r\n                }\r\n\r\n                if (!$scope.oldHour) {\r\n                  $scope.date = moment(dateUnix).utcOffset(gmt).format('YYYY-MM-DD HH:mm');\r\n                  $scope.dateCompare = moment(dateUnix).utcOffset(gmt).add(10, 'minutes').format('YYYY-MM-DD HH:mm');\r\n                }\r\n\r\n              }\r\n\r\n              $scope.program = function () {\r\n                var gmt;\r\n                var selecteDate = $(\"#valueDatepicker\").val();\r\n                if (selecteDate.length == 0) {\r\n                  notificationService.error(\"No se puede programar el envio, falta la fecha de envio\");\r\n                  return false;\r\n                }\r\n\r\n                var timenow = moment().utc('-0500').format('YYYY-MM-DD HH:mm');\r\n                if ($scope.dateCompare <= timenow) {\r\n                  notificationService.error(\"No se puede programar el envio, la fecha de envio ya expiro\");\r\n                  return false;\r\n                }\r\n                var enviar = {dateSelected: selecteDate, gmt: $scope.zonahoraria.zone.gmt, idMail: $scope.idMail};\r\n                restService.sendScheduleDateEmail(enviar).then(function (data) {\r\n                  notificationService.primary(data.message);\r\n                  $scope.oldHour = true;\r\n                  $scope.data.gmt = $scope.gmtDataBase = data.mail.gmt;\r\n                  $scope.data.scheduleDate = $scope.date = data.mail.scheduleDate;\r\n                });\r\n              }\r\n\r\n              $scope.reprogram = function () {\r\n                $scope.oldHour = false;\r\n                $(\"#valueDatepicker\").val(moment(new Date()).format('YYYY-MM-DD HH:mm'));\r\n                $scope.zonahoraria.zone = $filter('getById')($scope.timezone, \"-0500\");\r\n                $scope.date = moment(new Date()).format('YYYY-MM-DD HH:mm');\r\n              }\r\n\r\n              $scope.sendNow = function () {\r\n                var gmt = '-0500';\r\n                var enviar = {dateSelected: moment().utcOffset(gmt).format('YYYY-MM-DD HH:mm'), gmt: $scope.zonahoraria.zone.gmt, idMail: $scope.idMail};\r\n                restService.sendScheduleDateEmail(enviar).then(function (data) {\r\n                  notificationService.primary(data.message);\r\n                  $scope.oldHour = true;\r\n                  $scope.data.gmt = $scope.gmtDataBase = data.mail.gmt;\r\n                  $scope.data.scheduleDate = $scope.date = data.mail.scheduleDate;\r\n                });\r\n              };\r\n              $scope.closeModalConfirm = function () {\r\n                location.href = fullUrlBase + templateBase;\r\n              };\r\n              $scope.sendConfirmation = function () {\r\n                $scope.dateConfirmation = moment(new Date()).format('YYYY-MM-DD HH:mm');\r\n                $scope.getMd5($scope.data);\r\n              };\r\n              $scope.sendDataConfirmationEmail = function (data) {\r\n                restService.sendDataComfirmationEmail(data).then(function (data) {\r\n                  notificationService.primary(data.message);\r\n                  openModalConfirm();\r\n                });\r\n              }\r\n              $scope.validateData = function () {\r\n                var data = $scope.data;\r\n                var objSendDataConfirmation = {};\r\n                var defer = $q.defer();\r\n                var message = \"No se puede enviar el mensaje porque falta el campo \";\r\n                if (data.name == 0 || !angular.isDefined(data.name)) {\r\n                  defer.reject(false);\r\n                  notificationService.error(message + \"nombre correo\");\r\n                }\r\n                if (data.emailSender == 0 || !angular.isDefined(data.emailSender)) {\r\n                  defer.reject(false);\r\n                  notificationService.error(message + \"remitente\");\r\n                }\r\n                if (data.category == 0 || !angular.isDefined(data.category)) {\r\n                  defer.reject(false);\r\n                  notificationService.error(message + \"categoria de correos\");\r\n                }\r\n                if (data.subject == 0 || !angular.isDefined(data.subject)) {\r\n                  defer.reject(false);\r\n                  notificationService.error(message + \"asunto de correo\");\r\n                }\r\n                if (data.target == null || !angular.isDefined(data.target)) {\r\n                  defer.reject(false);\r\n                  notificationService.error(message + \"destinatarios\");\r\n                }\r\n                if (data.scheduleDate == null || !angular.isDefined(data.scheduleDate)) {\r\n                  defer.reject(false);\r\n                  notificationService.error(message + \"fecha y hora de envio\");\r\n                }\r\n\r\n                if (data.sizeAttachment > 2000000) {\r\n                  defer.reject(false);\r\n                  notificationService.error(\"El tamaÃ±o de todos los adjuntos es mayor a lo permitido\");\r\n                }\r\n\r\n                if (angular.isDefined($scope.ammoutEmail)) {\r\n                  //console.log($scope.ammoutEmail.ammount,data.quantitytarget,parseInt($scope.ammoutEmail.ammount) < parseInt(data.quantitytarget));\r\n                  if ($scope.ammoutEmail.accountingMode == \"sending\") {\r\n\r\n                    if (parseInt($scope.ammoutEmail.ammount) < parseInt(data.quantitytarget)) {\r\n                      defer.reject(false);\r\n                      notificationService.error(\"No tiene saldo suficiente para realizar esta campaÃ±a, le invitamos a recargar el servicio.\");\r\n                    }\r\n                  }\r\n                } else {\r\n                  defer.reject(false);\r\n                  notificationService.error(\"No tiene los servicios para realizar la campaÃ±a, por favor comunicarse con soporte\");\r\n                }\r\n\r\n                var scheduleDate = moment(data.scheduleDate).utc(data.gmt).add(10, 'minutes').format('YYYY-MM-DD HH:mm');\r\n                var nowhour = moment().utc('-0500').format('YYYY-MM-DD HH:mm');\r\n\r\n                var dateProgram = moment(scheduleDate);\r\n                var hournow = moment();\r\n                var programeSocial = 'now';\r\n\r\n                if (scheduleDate <= nowhour) {\r\n                  defer.reject(false);\r\n                  notificationService.error(\"la fecha de programación ya expiro, por favor validar.\");\r\n                } else {\r\n                  var postDate = moment(data.scheduleDate).utc(data.gmt);\r\n                  var nowMoment = moment().utc('-0500');\r\n                  if (postDate.diff(nowMoment, 'minutes') <= 20) {\r\n                    programeSocial = \"now\";\r\n                  } else {\r\n                    programeSocial = moment(dateProgram).unix();\r\n                  }\r\n\r\n                }\r\n                objSendDataConfirmation = {dateConfirmation: $scope.dateConfirmation, idMail: $scope.idMail, socialSend: programeSocial};\r\n                defer.resolve(objSendDataConfirmation);\r\n                return defer.promise;\r\n              }\r\n\r\n              //$interval(tick, 1000);\r\n\r\n              $scope.test = {};\r\n              $scope.loaderTestMail = false;\r\n\r\n              $scope.sendTestMail = function () {\r\n                $scope.test.idMail = $stateParams.id;\r\n                $scope.loaderTestMail = true;\r\n                restService.sendTestMail($scope.test).then(function (data) {\r\n                  notificationService.success(data.message);\r\n                  $scope.test.target = '';\r\n                  $scope.test.message = '';\r\n                  $scope.loaderTestMail = false;\r\n                }).catch(function (data) {\r\n                  $scope.loaderTestMail = false;\r\n                });\r\n              };\r\n\r\n              $scope.sendTesterMail = function () {\r\n                $scope.test.idMail = $stateParams.id;\r\n                $scope.loaderTestMail = true;\r\n                restService.sendTestMail($scope.test).then(function (data) {\r\n                  notificationService.success(data.message);\r\n                  $scope.test.target = '';\r\n                  $scope.test.message = '';\r\n                  $scope.loaderTestMail = false;\r\n                }).catch(function (data) {\r\n                  $scope.loaderTestMail = false;\r\n                });\r\n              };\r\n\r\n              restService.getThumbnailMail($stateParams.id).then(function (data) {\r\n                console.log(data.thumb);\r\n                $scope.urlThumbnail = data.thumb;\r\n              });\r\n\r\n              $scope.downloadMailPreview = function () {\r\n                restService.downloadMailPreview($stateParams.id).then(function (data) {\r\n                  if (!data.thumb) {\r\n                    notificationService.error(\"Ocurrio un error generando el archivo, por favor comunicarse con el administrador.\");\r\n                  } else {\r\n                    var url = fullUrlBase + data.thumb;\r\n                    location.href = url;\r\n                  }\r\n                });\r\n              };\r\n\r\n//     $scope.restService.getMd5publish($scope.data).then(function(data){\r\n//        \r\n//      })\r\n\r\n              $scope.getMd5 = function (data) {\r\n                restService.getMd5publish(data).then(function (data) {\r\n                  $scope.data.codigo = angular.copy(data.data);\r\n                  $scope.validateData().then(function (success) {\r\n                    if ($scope.data.facebook) {\r\n                      $scope.publishSocialFacebook(success);\r\n                    } else {\r\n                      $scope.sendDataConfirmationEmail(success);\r\n                    }\r\n                  })\r\n                }).catch(function (data) {\r\n                });\r\n              }\r\n\r\n            }\r\n          ])\r\n          .controller('addAddresseesController', ['$scope', 'restService', '$window', 'incomplete', '$rootScope', '$stateParams', 'notificationService', 'wizard', function ($scope, restService, $window, incomplete, $rootScope, $stateParams, notificationService, wizard) {\r\n              $rootScope.idMailGet = $stateParams.id;\r\n              $scope.enabled = false;\r\n              $scope.enableddb = false;\r\n              $scope.enabledcat = false;\r\n              if (!IsNumeric($stateParams.id)) {\r\n                notificationService.warning(\"El correo no se ha encontrado\");\r\n                location.href = '#/basicinformation/';\r\n              }\r\n\r\n              $scope.data = {\r\n                singleMail: true,\r\n                alldb: false,\r\n                typeUnsuscribed: false,\r\n                typeAccount: null\r\n              };\r\n              function IsNumeric(val) {\r\n                return Number(parseFloat(val)) == val;\r\n              }\r\n              wizard.setdescribe(false);\r\n              wizard.setaddressees(true);\r\n              wizard.setcontent(false);\r\n              wizard.setadvanceoptions(false);\r\n              wizard.setshippingdate(false);\r\n              $rootScope.addressees = wizard.getaddressees();\r\n              $rootScope.describe = wizard.getdescribe();\r\n              $rootScope.content = wizard.getcontent();\r\n              $rootScope.advanceoptions = wizard.getadvanceoptions();\r\n              $rootScope.shippingdate = wizard.getshippingdate();\r\n              $scope.idMail = $rootScope.idMailGet;\r\n              $scope.disabledContactlist = false;\r\n              $scope.disabledSegment = false;\r\n              $scope.addressees = [];\r\n              $scope.addressees = {selectdContactlis: []};\r\n              $scope.addressees = {selectdSegment: []};\r\n              $scope.addressees.showSegment = true;\r\n              $scope.addressees.showstep1 = true;\r\n              $scope.addressees.showContactlist = true;\r\n              $scope.addressees.count = 0;\r\n              $scope.addressees.filerMail = [];\r\n              $scope.categories = \"\";\r\n              $scope.statusandtype = \"\";\r\n\r\n              restService.findMail($scope.idMail).then(function (data) {\r\n\r\n                $scope.addressees.count = data.quantitytarget;\r\n\r\n                if (data.singleMail == 1 && data.alldb == 1 ) {\r\n                    var type = false;                    \r\n                    if(data.typeUnsuscribed == 0 || data.typeUnsuscribed == null){\r\n                        type = false;\r\n                    }else{\r\n                        type = true;\r\n                    }\r\n                    $scope.data = {\r\n                    singleMail: true,\r\n                    alldb: true,\r\n                    idAccount: data.idAccount,\r\n                    typeUnsuscribed: type,\r\n                    typeAccount: data.typeAccount\r\n                  };\r\n                } else if (data.singleMail == 1 && data.alldb == 0) {\r\n                   var type = false;                    \r\n                   if(data.typeUnsuscribed == 0 || data.typeUnsuscribed == null){\r\n                       type = false;\r\n                   }else{\r\n                       type = true;\r\n                   }\r\n                  $scope.data = {\r\n                    singleMail: true,\r\n                    alldb: false,\r\n                    idAccount: data.idAccount,\r\n                    typeUnsuscribed: type,\r\n                    typeAccount: data.typeAccount\r\n                  };\r\n                } else if (data.singleMail == 0 && data.alldb == 0 && data.target == null) {\r\n                   var type = false;                    \r\n                   if(data.typeUnsuscribed == 0 || data.typeUnsuscribed == null){\r\n                       type = false;\r\n                   }else{\r\n                       type = true;\r\n                   }\r\n                  $scope.data = {\r\n                    singleMail: true,\r\n                    alldb: false,\r\n                    idAccount: data.idAccount,\r\n                    typeUnsuscribed: type,\r\n                    typeAccount: data.typeAccount\r\n                  };\r\n                } else if (data.singleMail == 0 && data.alldb == 0) {\r\n                   var type = false;                    \r\n                   if(data.typeUnsuscribed == 0 || data.typeUnsuscribed == null){\r\n                       type = false;\r\n                   }else{\r\n                       type = true;\r\n                   }\r\n                  $scope.data = {\r\n                    singleMail: false,\r\n                    alldb: false,\r\n                    idAccount: data.idAccount,\r\n                    typeUnsuscribed: type,\r\n                    typeAccount: data.typeAccount\r\n                  };\r\n                }\r\n\r\n                if (data.target) {\r\n                  $scope.addressees.showstep1 = false;\r\n                  var json = jQuery.parseJSON(data.target);\r\n                  if (json.type == \"contactlist\") {\r\n                    $scope.statusandtype = json.type;\r\n                    $scope.addressees.showContactlist = false;\r\n                    $scope.addressees.selectdContactlis = json.contactlists;\r\n                    $scope.getAllContactlist();\r\n                  } else if (json.type == \"segment\") {\r\n                    $scope.statusandtype = json.type;\r\n                    $scope.addressees.showSegment = false;\r\n                    $scope.addressees.selectdSegment = json.segment;\r\n                    $scope.getAllSegment();\r\n                  }\r\n                  if (json.filters) {\r\n                    $scope.filters = json.filters;\r\n                    $scope.addressees.condition = json.condition;\r\n                    restService.getMailFilters().then(function (data) {\r\n                      $scope.addressees.filerMail = data;\r\n                    });\r\n                  }\r\n                }\r\n                if(json.filters[0].typeFilters!='' ){\r\n                    $scope.filterContact = 1;\r\n                }\r\n\r\n              });\r\n              $scope.clearSelect = function () {\r\n                $scope.filters = [];\r\n                $scope.addressees.count = 0;\r\n                $scope.disabledContactlist = false;\r\n                $scope.disabledSegment = false;\r\n                $scope.addressees.selectdContactlis = \"\";\r\n                $scope.addressees.selectdSegment = \"\";\r\n                $scope.categories = \"\";\r\n              };\r\n              $scope.getContactlist = function () {\r\n                $scope.filters = [];\r\n                $scope.addressees = {selectdSegment: []};\r\n                $scope.segments = [];\r\n                $scope.contactlists = [];\r\n                $scope.addressees.showstep1 = false;\r\n                $scope.addressees.count = 0;\r\n                $scope.addressees.showSegment = true;\r\n                $scope.addressees.showContactlist = false;\r\n                $scope.prueba = undefined;\r\n                $scope.getAllContactlist();\r\n                $scope.getAllSegment();\r\n              };\r\n              $scope.getAllContactlist = function () {\r\n                restService.getContactlist().then(function (data) {\r\n                  $scope.contactlists = data;\r\n                  $scope.only();\r\n                });\r\n              };\r\n              $scope.getSegment = function () {\r\n                $scope.filters = [];\r\n                $scope.addressees = {selectdContactlis: []};\r\n                $scope.segments = [];\r\n                $scope.contactlists = [];\r\n                $scope.addressees.showstep1 = false;\r\n                $scope.addressees.count = 0;\r\n                $scope.prueba = undefined;\r\n                $scope.prueba2 = undefined;\r\n                $scope.addressees.selectdContactlis = [];\r\n                $scope.addressees.selectdSegment = [];\r\n                $scope.addressees.showSegment = false;\r\n                $scope.addressees.showContactlist = true;\r\n                $scope.getAllSegment();\r\n                $scope.getAllContactlist();\r\n              };\r\n              $scope.getAllSegment = function () {\r\n                restService.getSegment().then(function (data) {\r\n                  $scope.segments = data;\r\n                });\r\n              };\r\n              $scope.selectAction = function () {\r\n                $scope.countContacts(\"contactlist\");\r\n              };\r\n              $scope.selectActionSegment = function () {\r\n                $scope.countContacts(\"segment\");\r\n              };\r\n              $scope.countContacts = function (type) {\r\n                $scope.addressees.count = 0;\r\n                var data = {\r\n                  type: type,\r\n                  segment: $scope.addressees.selectdSegment,\r\n                  contactlist: $scope.addressees.selectdContactlis,\r\n                  filters: $scope.filters,\r\n                  condition: $scope.addressees.condition,\r\n                  idMail: $scope.idMail\r\n                };\r\n                restService.countContact(data).then(function (data) {\r\n                  $scope.addressees.count = data.count;\r\n                  $scope.only();\r\n                });\r\n              };\r\n\r\n              $scope.addAddressees = function () {\r\n                var data = {\r\n                  selectdContactlis: $scope.addressees.selectdContactlis,\r\n                  selectdSegment: $scope.addressees.selectdSegment,\r\n                  showSegment: $scope.addressees.showSegment,\r\n                  showContactlist: $scope.addressees.showContactlist,\r\n                  idMail: $scope.idMail,\r\n                  quantitytarget: $scope.addressees.count,\r\n                  filters: $scope.filters,\r\n                  condition: $scope.addressees.condition,\r\n                  singleMail: $scope.data.singleMail,\r\n                  alldb: $scope.data.alldb,\r\n                  typeUnsuscribed : $scope.data.typeUnsuscribed\r\n                };\r\n                if ($scope.addressees.selectdContactlis && $scope.addressees.selectdContactlis.length > 0) {\r\n                  incomplete.setincomplete(false);\r\n                  $rootScope.incomplete = incomplete.getincomplete();\r\n                  $scope.add(data);\r\n                } else if ($scope.addressees.selectdSegment && $scope.addressees.selectdSegment.length > 0) {\r\n                  incomplete.setincomplete(false);\r\n                  $rootScope.incomplete = incomplete.getincomplete();\r\n                  $scope.add(data);\r\n                } else {\r\n                  incomplete.setincomplete(true);\r\n                  $rootScope.incomplete = incomplete.getincomplete();\r\n                  $scope.add(data);\r\n                }\r\n              };\r\n              $scope.allSegment = function () {\r\n                $scope.disabledSegment = true;\r\n                $scope.addressees.selectdSegment = $scope.segments;\r\n                $scope.selectActionSegment();\r\n              };\r\n              $scope.allContactlist = function () {\r\n                $scope.disabledContactlist = true;\r\n                $scope.addressees.selectdContactlis = $scope.contactlists;\r\n                $scope.selectAction();\r\n              };\r\n              $scope.filters = [];\r\n              $scope.tipeFilters = [\r\n                {id: 1, name: \"Enviar a contactos que hayan recibido un correo\"},\r\n                {id: 2, name: \"Enviar a contactos que hayan abierto un correo\"},\r\n                {id: 3, name: \"Enviar a contactos que hayan hecho clic un enlace\"}\r\n              ];\r\n              $scope.selectMailFilter = function (key) {\r\n                restService.getMailFilters().then(function (data) {\r\n                  $scope.addressees.filerMail = data;\r\n                });\r\n                if (key.typeFilters == 3) {\r\n                  restService.getLinksByMail(key.mailSelected).then(function (data) {\r\n                    key.links = data;\r\n                  });\r\n                } else {\r\n                  if (!$scope.addressees.showContactlist) {\r\n                    $scope.countContacts(\"contactlist\");\r\n                  } else {\r\n                    $scope.countContacts(\"segment\");\r\n                  }\r\n                }\r\n              };\r\n              function IsNumeric(val) {\r\n                return Number(parseFloat(val)) == val;\r\n              }\r\n              $scope.selectinverted = function (key) {\r\n                if (key.typeFilters == 3) {\r\n                  if (IsNumeric(key.mailSelected) && IsNumeric(key.mailSelected) && IsNumeric(key.linkSelected)) {\r\n                    if (!$scope.addressees.showContactlist) {\r\n                      $scope.countContacts(\"contactlist\");\r\n                    } else {\r\n                      $scope.countContacts(\"segment\");\r\n                    }\r\n                  }\r\n                } else {\r\n                  if (IsNumeric(key.mailSelected) && key.typeFilters) {\r\n                    if (!$scope.addressees.showContactlist) {\r\n                      $scope.countContacts(\"contactlist\");\r\n                    } else {\r\n                      $scope.countContacts(\"segment\");\r\n                    }\r\n                  }\r\n                }\r\n              };\r\n              $scope.selectLinkFilter = function () {\r\n                if (!$scope.addressees.showContactlist) {\r\n                  $scope.countContacts(\"contactlist\");\r\n                } else {\r\n                  $scope.countContacts(\"segment\");\r\n                }\r\n              };\r\n              $scope.selectTypeFilter = function (key) {\r\n                key.mailSelected = [];\r\n                key.linkSelected = [];\r\n                key.mail = [];\r\n                key.links = [];\r\n                key.inverted = \"\";\r\n                restService.getMailFilters().then(function (data) {\r\n                  $scope.addressees.filerMail = data;\r\n\r\n                });\r\n                switch (key.typeFilters) {\r\n                  case 1:\r\n\r\n                    break;\r\n                  case 2:\r\n\r\n                    break;\r\n                  case 3:\r\n\r\n                    break;\r\n                }\r\n              };\r\n              \r\n              $scope.filterContact = 0;\r\n              \r\n              $scope.addFilter = function () {\r\n                $scope.addressees.condition = \"all\";\r\n                $scope.filters.push({});\r\n                $scope.filterContact = 1;\r\n                 $('#filterContact').addClass('disabled');\r\n              };\r\n              $scope.removeFilters = function (index) {\r\n                $scope.filters.splice(index, 1);\r\n                $scope.filterContact = 0;\r\n                $('#filterContact').removeClass('disabled');\r\n                if (!$scope.addressees.showContactlist) {\r\n                  $scope.countContacts(\"contactlist\");\r\n                } else {\r\n                  $scope.countContacts(\"segment\");\r\n                }\r\n              };\r\n              $scope.add = function (data) {\r\n                restService.addAddressees(data).then(function () {\r\n                  notificationService.success(\"Se ha guardado la selección de destinatarios correctamente\");\r\n                  location.href = '#/content/' + $scope.idMail;\r\n                });\r\n              };\r\n              $scope.only = function () {\r\n                if ($scope.addressees.showContactlist == false) {\r\n                  var data = {\r\n                    selectdContactlis: $scope.addressees.selectdContactlis,\r\n                    filters: $scope.filters,\r\n                    singleMail: $scope.data.singleMail\r\n                  };\r\n\r\n                  if (typeof data.selectdContactlis !== 'undefined') {\r\n                    //\r\n\r\n                    restService.only(data).then(function (data) {\r\n                      $scope.addressees.count = data.count;\r\n                      $scope.categories = data.categories;\r\n                    });\r\n                  }\r\n                }\r\n\r\n\r\n              };\r\n              $scope.only();\r\n            }])\r\n          .controller('index', ['$scope', 'incomplete', '$rootScope', 'restService', 'notificationService', '$interval', function ($scope, incomplete, $rootScope, restService, notificationService, $interval) {\r\n              $scope.viewlist = true;\r\n              $scope.viewnolist = true;\r\n              $scope.prueba = [{name: 'Eliminar'}];\r\n              $scope.initial = 0;\r\n              $scope.page = 1;\r\n              $scope.mail = [{}];\r\n              $scope.mailToTemplate = [];\r\n              $scope.selected = [];\r\n              $scope.filter = \"\";\r\n              $scope.showTest = false;\r\n              $scope.confirmDelete = function (idMail) {\r\n                $scope.idMail = idMail;\r\n                openModal();\r\n              };\r\n              $scope.confirmCancel = function (idMail) {\r\n                $scope.idMail = idMail;\r\n                openModalCancel(idMail);\r\n              };\r\n              $scope.previewmailtempcont = function (id) {\r\n                restService.previewMailTemplateContent(id).then(function (data) {\r\n\r\n                  var e = data.template;\r\n                  $('#content-preview').empty();\r\n                  $('<iframe frameborder=\"0\" width=\"100%\" height=\"100%\"/>').appendTo('#content-preview').contents().find('body').append(e);\r\n                  $('#myModal').modal('show');\r\n                });\r\n              };\r\n              $scope.pauseMailAn = function (idMail) {\r\n                //console.log(idMail);\r\n                pauseMail(idMail);\r\n              };\r\n              $scope.cancelMailAn = function (idMail) {\r\n                cancelMail(idMail);\r\n              };\r\n              $scope.resumeMailAn = function (idMail) {\r\n                //console.log(idMail);\r\n                resumeMail(idMail);\r\n              };\r\n              $scope.cancelMail = function (idMail) {\r\n                restService.cancelMail(idMail).then(function (data) {\r\n                  notificationService.warning(data.message);\r\n                  closeModalCancel();\r\n                  $scope.getAll();\r\n                });\r\n              };\r\n              $scope.deleteMail = function () {\r\n                restService.deleteMail($scope.idMail).then(function (data) {\r\n                  notificationService.warning(data.message);\r\n                  closeModal();\r\n                  $scope.getAll();\r\n                });\r\n              };\r\n              $scope.openModalCancel = function (idMail) {\r\n                console.log(idMail);\r\n                $scope.idMail = idMail;\r\n                $('#dialogCancel').addClass('dialog--open');\r\n              };\r\n              //        $scope.filter.category = [];\r\n              $scope.filter = {category: []};\r\n              $scope.$watch('showTest', function () {\r\n                if ($scope.showTest) {\r\n                  $scope.filter.showTest = 0;\r\n                } else {\r\n                  $scope.filter.showTest = 1;\r\n                }\r\n                $scope.getAll();\r\n              }, true);\r\n              $scope.forward = function () {\r\n                $scope.initial += 1;\r\n                $scope.page += 1;\r\n                $scope.getAll();\r\n              };\r\n              $scope.fastforward = function () {\r\n                $scope.initial = ($scope.mail.total_pages - 1);\r\n                $scope.page = $scope.mail.total_pages;\r\n                $scope.getAll();\r\n              };\r\n              $scope.backward = function () {\r\n                $scope.initial -= 1;\r\n                $scope.page -= 1;\r\n                $scope.getAll();\r\n              };\r\n              $scope.fastbackward = function () {\r\n                $scope.initial = 0;\r\n                $scope.page = 1;\r\n                $scope.getAll();\r\n              };\r\n              $scope.search = function () {\r\n               $scope.initial = 0;\r\n               $scope.page = 1;\r\n                $scope.getAll();\r\n              };\r\n              $scope.searchcategory = function () {\r\n                if ($scope.filter.category.length >= 1) {\r\n                  $scope.initial = 0;\r\n                  $scope.page = 1;\r\n                  $scope.getAll();\r\n                } else {\r\n                  $scope.getAll();\r\n                }\r\n              };\r\n              $scope.$watch('[filter.dateinitial,filter.dateend]', function () {\r\n                //          if(angular.isDefined($scope.filter.dateinitial)){\r\n                //            if($scope.filter.dateinitial != \"\"){\r\n                //              if(angular.isDefined($scope.filter.dateend)){\r\n                //                if($scope.filter.dateend != \"\"){\r\n                //                  $scope.getAll();\r\n                //                }\r\n                //              }\r\n                //            }\r\n                //          }\r\n                $scope.initial = 0;\r\n                $scope.page = 1;\r\n                $scope.getAll();\r\n              });\r\n              $scope.getAll = function () {\r\n                if (angular.isDefined($scope.mail[0])) {\r\n                  $scope.mail[0].items = [];\r\n                }\r\n                restService.getAllMail($scope.initial, $scope.filter).then(function (data) {\r\n                  $scope.mail = data;\r\n                });\r\n              };\r\n              var statusVerify = function () {\r\n                restService.getAllMail($scope.initial, $scope.filter).then(function (data) {\r\n                  data[0].items.forEach(function (item, index) {\r\n                    if ($scope.mail[0].items[index].status != item.status) {\r\n                      $scope.mail[0].items[index].status = item.status;\r\n                      //console.log(item.status);\r\n                    }\r\n                  });\r\n                  //$scope.mail = data;\r\n                });\r\n              };\r\n              $interval(statusVerify, 1000);\r\n              restService.getMailCategory($scope.initial, $scope.filter).then(function (data) {\r\n                $scope.mailCategory = data;\r\n              });\r\n              //$scope.getAll();\r\n              //              $scope.to = function () {\r\n              $scope.toggle = function (item, list) {\r\n                var idx = list.indexOf(item);\r\n                if (idx > -1) {\r\n                  list.splice(idx, 1);\r\n                } else {\r\n                  list.push(item);\r\n                }\r\n              };\r\n              $scope.exists = function (item, list) {\r\n                return list.indexOf(item) > -1;\r\n              };\r\n              $scope.isChecked = function () {\r\n                return $scope.mail[0].items && $scope.selected.length === $scope.mail[0].items.length;\r\n              };\r\n              $scope.isIndeterminate = function () {\r\n                $scope.initial = 0;\r\n                $scope.page = 1;\r\n                return ($scope.selected.length !== $scope.mail[0].items.length);\r\n              };\r\n              $scope.toggleAll = function () {\r\n                if ($scope.selected.length === $scope.mail[0].items.length) {\r\n                  $scope.selected = [];\r\n                } else if ($scope.selected.length === 0 || $scope.selected.length > 0) {\r\n                  $scope.selected = $scope.mail[0].items.slice(0);\r\n                }\r\n              };             \r\n              $scope.getAll();\r\n              //              }\r\n              $scope.targetString = function (target) {\r\n                var string = \"\";\r\n                //                for (var i = 0; i > target.contactlists.length; i++) {\r\n                ////                  console.log(target.contactlists[i]);\r\n                //                  string += target.contactlists[i].name;\r\n                //                }\r\n                return string;\r\n              }\r\n\r\n              //Todo sobre pasar mail a template\r\n              $scope.empty = false;\r\n              $scope.length = false;\r\n              $scope.categ = false;\r\n              $scope.restart = function (idMail) {\r\n                for (var i = 0; i < $scope.mail[0].items.length; i++) {\r\n                  if ($scope.mail[0].items[i].idMail == idMail) {\r\n                    $scope.mailToTemplate = $scope.mail[0].items[i];\r\n                    break;\r\n                  }\r\n                }\r\n                $scope.empty = false;\r\n                $scope.length = false;\r\n                $scope.categ = false;\r\n                $scope.namemailtempcat = '';\r\n              };\r\n\r\n              restService.getMailTemplateCategory().then(function (data) {\r\n                $scope.mailtempcats = data;\r\n              });\r\n\r\n              $scope.saveMailAsMailTemplate = function () {\r\n                restService.getMailContentJSON($scope.mailToTemplate.idMail).then(function (data) {\r\n                  $scope.editor = data.content;\r\n\r\n                  if (angular.isUndefined($scope.namemailtempcat) || $scope.namemailtempcat === '') {\r\n                    $scope.empty = true;\r\n                    $scope.length = false;\r\n                    //notificationService.error(\"El campo de nombre de la plantilla no puede estar vacÃƒÆ’Ã‚Â­o\");\r\n                    //alert(\"El campo de nombre de la plantilla no puede estar vacÃƒÆ’Ã‚Â­o\");\r\n                    return false;\r\n                  }\r\n                  if ($scope.namemailtempcat.length < 2 || $scope.namemailtempcat.length > 80) {\r\n                    $scope.empty = false;\r\n                    $scope.length = true;\r\n                    //notificationService.error(\"El campo de nombre de la plantilla debe tener mÃƒÆ’Ã‚Â­nimo 2 caracteres y mÃƒÆ’Ã‚Â¡ximo 80\");\r\n                    //alert(\"El campo de nombre de la plantilla debe tener mÃƒÆ’Ã‚Â­nimo 2 caracteres y mÃƒÆ’Ã‚Â¡ximo 80\");\r\n                    return false;\r\n                  }\r\n                  if (angular.isUndefined($scope.mailtempcat)) {\r\n                    $scope.categ = true;\r\n                    //notificationService.error(\"Debe seleccionar un ÃƒÆ’Ã‚Â­tem del listado de categorÃƒÆ’Ã‚Â­as\");\r\n                    //alert(\"Debe seleccionar un ÃƒÆ’Ã‚Â­tem del listado de categorÃƒÆ’Ã‚Â­as\");\r\n                    return false;\r\n                  }\r\n\r\n                  var data = {\r\n                    nameMailTemplate: $scope.namemailtempcat,\r\n                    mailTemplateCateg: $scope.mailtempcat,\r\n                    editor: $scope.editor\r\n                  };\r\n                  console.log(data);\r\n\r\n                  //                document.getElementById('iframeEditor').contentWindow.RecreateEditor();\r\n\r\n                  restService.saveMailAsMailTemplate(data, null).then(function (data) {\r\n                    $(\"#saveMailAsMailTemplate\").modal(\"hide\");\r\n                    $scope.namemailtempcat = '';\r\n                    $scope.mailtempcat = '';\r\n                    $scope.empty = false;\r\n                    $scope.length = false;\r\n                    $scope.cat = false;\r\n\r\n                    notificationService.success(data.message);\r\n                  });\r\n                });\r\n\r\n\r\n              };\r\n              // Fin de todo sobre pasar mail a template\r\n              \r\n              $scope.statusFunc = function () {\r\n                  console.log('Afuera');\r\n                  console.log($scope.filter.mailStatus);\r\n                if ($scope.filter.mailStatus.length > 0) {\r\n                  console.log('Adentro');\r\n                  console.log($scope.filter.mailStatus);\r\n                  $scope.initial = 0;\r\n                  $scope.page = 1;\r\n                  $scope.getAll();\r\n                }\r\n              };\r\n\r\n            }])\r\n          .controller('contentController', ['$scope', 'restService', '$stateParams', '$rootScope', 'notificationService', '$filter', 'wizard', function ($scope, restService, $stateParams, $rootScope, notificationService, $filter, wizard) {\r\n              wizard.setdescribe(false);\r\n              wizard.setaddressees(false);\r\n              wizard.setcontent(true);\r\n              wizard.setadvanceoptions(false);\r\n              wizard.setshippingdate(false);\r\n              $rootScope.addressees = wizard.getaddressees();\r\n              $rootScope.describe = wizard.getdescribe();\r\n              $rootScope.content = wizard.getcontent();\r\n              $rootScope.advanceoptions = wizard.getadvanceoptions();\r\n              $rootScope.shippingdate = wizard.getshippingdate();\r\n              $rootScope.idMailGet = $stateParams.id;\r\n              $scope.idMail = $rootScope.idMailGet;\r\n              $scope.imagenDate = new Date();\r\n              $scope.imagenTime = $scope.imagenDate.getTime();\r\n              if (!IsNumeric($stateParams.id)) {\r\n                notificationService.warning(\"El correo no se ha encontrado\");\r\n                location.href = '#/basicinformation/';\r\n              }\r\n\r\n              function IsNumeric(val) {\r\n                return Number(parseFloat(val)) == val;\r\n              }\r\n              $scope.getContent = {};\r\n              $scope.setPlane = {};\r\n              $scope.boolEditors = true;\r\n              $scope.PlaneError = {};\r\n              htmlPreview($scope.idMail);\r\n              restService.getContentMail($scope.idMail).then(function (data) {\r\n\r\n                if (!data.content) {\r\n                  //            console.log(data);\r\n                  $scope.boolEditors = true;\r\n                } else {\r\n                  //            console.log(data);\r\n                  restService.getThumbnailMail($stateParams.id).then(function (data) {\r\n                    $scope.urlThumbnail = data.thumb;\r\n                  });\r\n                  $scope.boolEditors = false;\r\n                  $scope.getContent = data.content;\r\n                  $scope.setPlane.content = data.content.plaintext;\r\n                }\r\n              });\r\n              $scope.addplaintext = function () {\r\n                var data = {\r\n                  idMail: $scope.idMail,\r\n                  plaintext: $scope.setPlane.content\r\n                };\r\n                restService.addPlaintext(data).then(function () {\r\n                  notificationService.primary(\"Se ha modificado el texto plano del correo\");\r\n                  $scope.closeModal();\r\n                });\r\n              };\r\n              $scope.openModal = function () {\r\n                $('.dialog').addClass('dialog--open');\r\n              }\r\n\r\n              $scope.closeModal = function () {\r\n                $('.dialog').removeClass('dialog--open');\r\n              }\r\n            }])\r\n          .controller('contentEditorController', ['$scope', 'restService', 'notificationService', function ($scope, restService, notificationService) {\r\n\r\n              $scope.registerContent = function (idMail) {\r\n                var data = {\r\n                  editor: document.getElementById('iframeEditor').contentWindow.catchEditorData()\r\n                };\r\n                restService.addContentEditor(idMail, data).then(function (res) {\r\n                  location.href = fullUrlBase + templateBase + '/create#/content/' + res['idMail'];\r\n                });\r\n              };\r\n              $scope.saveContent = function (idMail) {\r\n                var data = {\r\n                  editor: document.getElementById('iframeEditor').contentWindow.catchEditorData()\r\n                };\r\n                restService.addContentEditor(idMail, data).then(function (res) {\r\n                  document.getElementById('iframeEditor').contentWindow.RecreateEditor();\r\n                  notificationService.success(res['msg']);\r\n                });\r\n              };\r\n              $scope.empty = false;\r\n              $scope.length = false;\r\n              $scope.categ = false;\r\n\r\n\r\n\r\n              $scope.saveMailAsMailTemplate = function () {\r\n                if (angular.isUndefined($scope.namemailtempcat) || $scope.namemailtempcat === '') {\r\n                  $scope.empty = true;\r\n                  $scope.length = false;\r\n                  //notificationService.error(\"El campo de nombre de la plantilla no puede estar vacÃƒÆ’Ã‚Â­o\");\r\n                  //alert(\"El campo de nombre de la plantilla no puede estar vacÃƒÆ’Ã‚Â­o\");\r\n                  return false;\r\n                }\r\n                if ($scope.namemailtempcat.length < 2 || $scope.namemailtempcat.length > 80) {\r\n                  $scope.empty = false;\r\n                  $scope.length = true;\r\n                  //notificationService.error(\"El campo de nombre de la plantilla debe tener mÃƒÆ’Ã‚Â­nimo 2 caracteres y mÃƒÆ’Ã‚Â¡ximo 80\");\r\n                  //alert(\"El campo de nombre de la plantilla debe tener mÃƒÆ’Ã‚Â­nimo 2 caracteres y mÃƒÆ’Ã‚Â¡ximo 80\");\r\n                  return false;\r\n                }\r\n                if (angular.isUndefined($scope.mailtempcat)) {\r\n                  $scope.categ = true;\r\n                  //notificationService.error(\"Debe seleccionar un ÃƒÆ’Ã‚Â­tem del listado de categorÃƒÆ’Ã‚Â­as\");\r\n                  //alert(\"Debe seleccionar un ÃƒÆ’Ã‚Â­tem del listado de categorÃƒÆ’Ã‚Â­as\");\r\n                  return false;\r\n                }\r\n\r\n                var data = {\r\n                  nameMailTemplate: $scope.namemailtempcat,\r\n                  mailTemplateCateg: $scope.mailtempcat,\r\n                  editor: document.getElementById('iframeEditor').contentWindow.catchEditorData()\r\n                };\r\n                document.getElementById('iframeEditor').contentWindow.RecreateEditor();\r\n                restService.saveMailAsMailTemplate(data, null).then(function (data) {\r\n                  $(\"#saveMailAsMailTemplate\").modal(\"hide\");\r\n                  $scope.namemailtempcat = '';\r\n                  $scope.mailtempcat = '';\r\n                  $scope.empty = false;\r\n                  $scope.length = false;\r\n                  $scope.cat = false;\r\n                  notificationService.success(data.message);\r\n                });\r\n              };\r\n              $scope.restart = function () {\r\n                $scope.empty = false;\r\n                $scope.length = false;\r\n                $scope.categ = false;\r\n                $scope.namemailtempcat = '';\r\n              };\r\n\r\n\r\n            }])\r\n          .controller('contentUrlController', ['$scope', 'restService', 'notificationService', function ($scope, restService, notificationService) {\r\n              $scope.trimContent = function () {\r\n                $('#url').val($('#url').val().trim());\r\n              }\r\n\r\n              $scope.registerContentUrl = function () {\r\n                //          if ($scope.checkboximage) {\r\n                //            var image = $scope.checkboximage;\r\n                //          } else {\r\n                //            image = false;\r\n                //          }\r\n                sendData(\"no load\");\r\n                //          sendData(image);\r\n              };\r\n              //        $scope.saveContent = function (idMail) {\r\n              //          var data = {\r\n              //            editor: document.getElementById('iframeEditor').contentWindow.catchEditorData()\r\n              //          };\r\n              //          restService.addContentEditor(idMail, data).then(function (res) {\r\n              //            document.getElementById('iframeEditor').contentWindow.RecreateEditor();\r\n              //            notificationService.success(res['msg']);\r\n              //          });\r\n              //        };\r\n            }])\r\n          .controller('advanceoptionsController', ['$scope', 'restService', 'notificationService', '$rootScope', '$stateParams', '$mdDialog', 'FileUploader', 'wizard', '$FB', '$q', 'constantMail', '$timeout', '$window', function ($scope, restService, notificationService, $rootScope, $stateParams, $mdDialog, FileUploader, wizard, $FB, $q, constantMail, $timeout, $window) {\r\n          \r\n              //              $scope.notifications = false;\r\n              //              $scope.notificationEmails = \"\";\r\n              //              $scope.dataadv = [];\r\n              $scope.dataadv = {};\r\n              $scope.sizeFiles = 0;\r\n\r\n              $scope.result = [];\r\n\r\n              var num = 1;\r\n              var numbers = [];\r\n              while (num <= 30) {\r\n                numbers[num] = num;\r\n                num++;\r\n              }\r\n              $scope.numbers = numbers;\r\n              //              $scope.typesTimes = typesTimes;\r\n              $scope.typesTimes = {hour: \"horas\", day: \"días\", week: \"semanas\"};\r\n              //              console.log($scope.numbers);\r\n              //              console.log($scope.typesTimes);\r\n              $scope.dataadv.notifications = false;\r\n              $scope.dataadv.notificationEmails = \"\";\r\n              $scope.dataadv.statistics = false;\r\n              $scope.dataadv.statisticsEmails = \"\";\r\n              wizard.setdescribe(false);\r\n              wizard.setaddressees(false);\r\n              wizard.setcontent(false);\r\n              wizard.setadvanceoptions(true);\r\n              wizard.setshippingdate(false);\r\n              $rootScope.addressees = wizard.getaddressees();\r\n              $rootScope.describe = wizard.getdescribe();\r\n              $rootScope.content = wizard.getcontent();\r\n              $rootScope.advanceoptions = wizard.getadvanceoptions();\r\n              $rootScope.shippingdate = wizard.getshippingdate();\r\n              $rootScope.idMailGet = $stateParams.id;\r\n              $scope.isModal = \"\";\r\n              if (!IsNumeric($stateParams.id)) {\r\n                notificationService.warning(\"El correo no se ha encontrado\");\r\n                location.href = '#/basicinformation/';\r\n              }\r\n\r\n              function IsNumeric(val) {\r\n                return Number(parseFloat(val)) == val;\r\n              }\r\n              $scope.idMail = $rootScope.idMailGet;\r\n              $scope.status = '  ';\r\n              $scope.customFullscreen = false;\r\n              $scope.deleteAttached = function (id, index) {\r\n                restService.deleteAttached(id).then(function () {\r\n                  $scope.attach();\r\n                });\r\n              };\r\n              function DialogController($scope, $mdDialog) {\r\n                $scope.hide = function () {\r\n                  $mdDialog.hide();\r\n                };\r\n                $scope.cancel = function () {\r\n                  $mdDialog.cancel();\r\n                };\r\n                $scope.answer = function () {\r\n                  $('#adjun').modal('hide');\r\n                  $scope.selectFile();\r\n                };\r\n              }\r\n              \r\n              \r\n              var uploadUrl = fullUrlBase + \"gallery/uploadfileadjunt/\" + $scope.idMail;\r\n              var uploader = $scope.uploader = new FileUploader({\r\n                url: uploadUrl\r\n              });\r\n              // FILTERS\r\n              //\r\n              //        uploader.filters.push({\r\n              //          name: 'customFilter',\r\n              //          fn: function (item /*{File|FileLikeObject}*/, options) {\r\n              //            return this.queue.length < 10;\r\n              //          }\r\n              //        });\r\n\r\n\r\n              uploader.onWhenAddingFileFailed = function (item /*{File|FileLikeObject}*/, filter, options) {\r\n                //console.info('onWhenAddingFileFailed', item, filter, options);\r\n              };\r\n              uploader.onAfterAddingFile = function (fileItem) {\r\n                //console.info('onAfterAddingFile', fileItem);\r\n                //          $scope.arrFilePending = true;\r\n                $scope.uploader.queue[$scope.uploader.queue.length - 1].upload();\r\n              };\r\n              uploader.onAfterAddingAll = function (addedFileItems) {\r\n                //console.info('onAfterAddingAll', addedFileItems);\r\n              };\r\n              uploader.onBeforeUploadItem = function (item) {\r\n                //console.info('onBeforeUploadItem', item);\r\n              };\r\n              uploader.onProgressItem = function (fileItem, progress) {\r\n                //console.info('onProgressItem', fileItem, progress);\r\n              };\r\n              uploader.onProgressAll = function (progress) {\r\n                //console.info('onProgressAll', progress);\r\n              };\r\n              uploader.onSuccessItem = function (fileItem, response, status, headers) {\r\n                //console.info('onSuccessItem', fileItem, response, status, headers);\r\n              };\r\n              uploader.onErrorItem = function (fileItem, response, status, headers) {\r\n                //console.info('onErrorItem', fileItem, response, status, headers);\r\n              };\r\n              uploader.onCancelItem = function (fileItem, response, status, headers) {\r\n                //console.info('onCancelItem', fileItem, response, status, headers);\r\n              };\r\n              uploader.onCompleteItem = function (fileItem, response, status, headers) {\r\n\r\n                //console.info('onCompleteItem', fileItem, response, status, headers);\r\n              };\r\n              uploader.onCompleteAll = function () {\r\n\r\n                $scope.attach();\r\n                //          $scope.arrFilePending = false;\r\n                //console.info('onCompleteAll');\r\n              };\r\n              console.log($scope.idMail);\r\n              $scope.showTabDialog = function (ev) {\r\n                document.body.scrollTop = 0;\r\n                $mdDialog.show({\r\n                  scope: $scope.$new(),\r\n                  //            mdDialog: $mdDialog,\r\n                  controller: DialogController,\r\n                  templateUrl: 'tabDialog.tmpl.html',\r\n                  parent: angular.element(document.body),\r\n                  targetEvent: ev,\r\n                  clickOutsideToClose: true\r\n                }).then(function (answer) {\r\n                  $scope.status = 'You said the information was \"' + answer + '\".';\r\n                }, function () {\r\n                  $scope.status = 'You cancelled the dialog.';\r\n                });\r\n              };\r\n              \r\n        \r\n        $scope.uploaderTwo = function() {\r\n\r\n      //==============================================\r\n\r\n      /*var hashLocal  = location.hash;\r\n                  var arrayTemp = hashLocal.split(\"/\");\r\n                  var idMail = arrayTemp['2'];*/\r\n\r\n                  var uploader = new plupload.Uploader({\r\n        browse_button : 'pickfiles', // you can pass in id...\r\n        container: document.getElementById('container'), \r\n        //url: \"{{url('mail/loadpdf')}}/\"+idMail,\r\n        url: \"../../mail/loadpdf/\"+$scope.idMail,\r\n        file_data_name: \"file\",\r\n        filters : {\r\n            max_file_size : '500mb',\r\n            mime_types: [\r\n      {title : \"Zip files\", extensions : \"zip\"}\r\n                          ]\r\n        },\r\n        // Flash settings\r\n        flash_swf_url : '/plupload/js/Moxie.swf',\r\n        // Silverlight settings\r\n        silverlight_xap_url : '/plupload/js/Moxie.xap',\r\n        multi_selection: false,\r\n        rename: true,\r\n        sortable: true,\r\n        dragdrop: true,\r\n\r\n        views: {\r\n            list: false,\r\n            thumbs: false\r\n        },        \r\n\r\n        init: {\r\n            PostInit: function() {\r\n          document.getElementById('filelist').innerHTML = '';\r\n\r\n          document.getElementById('uploadfiles').onclick = function() {\r\n              uploader.start()\r\n              return false;\r\n          };\r\n            },\r\n\r\n            FilesAdded: function(up, files) {\r\n          plupload.each(files, function(file) {\r\n            document.getElementById('filelist').innerHTML += '<div id=\"' + file.id + '\">' + file.name + ' (' + plupload.formatSize(file.size) + ') <b></b></div>';\r\n              });\r\n            },\r\n\r\n            UploadProgress: function(up, file) {\r\n          document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = '<span>' + file.percent + \"%</span>\";\r\n            },\r\n                          \r\n            FileUploaded: function(up, err) {\r\n\r\n          restService.getTableResults($scope.idMail)\r\n           .then(function (data) { \r\n             $scope.fileadjuntpdf = data;\r\n             $scope.result = data; \r\n             if(data.uploadstatus == \"error\"){\r\n                 notificationService.error(\"Ah ocurrido un error validando el archivo que estas intentando cargar,\");\r\n                 //debo de hacer los movimientos a la inversa para que pueda cargar un archivo nuevamente en la vista.\r\n                 $('#next').hide('slow');\r\n                 $('#gogo').hide('slow');\r\n                 $('#resume').hide('slow');\r\n                 $('#buttons').show('slow');\r\n                 $('#htab3').show('slow');\r\n                 $('#filelist').show('slow');\r\n                 $('#container').show('slow');\r\n                 \r\n                 document.getElementById('filelist').innerHTML = '';\r\n                 \r\n             }\r\n           })\r\n           .catch(function (data) { notificationService.error(data); });\r\n          \r\n          $('#next').show('slow');\r\n          $('#gogo').show('slow');\r\n          $('#resume').show('slow');\r\n          $('#buttons').hide('slow');\r\n          $('#htab3').hide('slow');\r\n          $('#filelist').hide('slow');\r\n          $('#container').hide('slow');\r\n\r\n            },\r\n\r\n            Error: function(up, err) {\r\n          document.getElementById('console').innerHTML += \"\\nError #\" + err.code + \": \" + err.message;\r\n            }\r\n        }\r\n          });\r\n\r\n                  uploader.init();\r\n      \r\n      //==============================================\r\n\r\n        }\r\n        $scope.uploaderTwo(); //inicializando el modulo puesto...\r\n\r\n              $scope.answer = function () {\r\n                $('#adjun').modal('hide');\r\n              };\r\n              //        prueba($scope.idMail);\r\n              $scope.fileadjunt = [];\r\n              $scope.fileadjuntpdf = [];\r\n              $scope.fileSelecteds = [];\r\n              $scope.divfile = true;\r\n              //        $scope.tabload = function () {\r\n              //          $scope.divfile = false;\r\n              //        }\r\n              //        $scope.tabgallery = function () {\r\n              //          $scope.divfile = true;\r\n              //        }\r\n              $scope.count = 0;\r\n              $scope.initial = 0;\r\n              $scope.page = 1;\r\n              $scope.hidefile = false;\r\n              $scope.search = function () {\r\n                $scope.getAll();\r\n              };\r\n              $scope.forward = function () {\r\n                $scope.initial += 1;\r\n                $scope.page += 1;\r\n                $scope.getAll();\r\n              };\r\n              $scope.fastforward = function () {\r\n                $scope.initial = ($scope.gallery.total_pages - 1);\r\n                $scope.page = $scope.gallery.total_pages;\r\n                $scope.getAll();\r\n              };\r\n              $scope.backward = function () {\r\n                $scope.initial -= 1;\r\n                $scope.page -= 1;\r\n                $scope.getAll();\r\n              };\r\n              $scope.fastbackward = function () {\r\n                $scope.initial = 0;\r\n                $scope.page = 1;\r\n                //          $scope.addFile();\r\n                $scope.getAll();\r\n              };\r\n              $scope.getAll = function () {\r\n                restService.getAllGallery($scope.initial).then(function (data) {\r\n                  $scope.gallery = data;\r\n                  $scope.attach();\r\n                  $scope.attachpdf();\r\n                });\r\n              };\r\n              $scope.attach = function () {\r\n                restService.getAllAttachment($scope.idMail).then(function (data) {\r\n                  $scope.fileadjunt = data;\r\n                  $scope.sizeFiles = 0;\r\n                  $scope.fileSelecteds = angular.copy($scope.fileadjunt);\r\n                  if ($scope.fileadjunt.length > 0) {\r\n                    $scope.hidefile = true;\r\n                    $scope.selectFile();\r\n                    $scope.setSizeFile();\r\n                  }\r\n                });\r\n              };\r\n              $scope.attachpdf = function () {\r\n                restService.getAllAttachmentpdf($scope.idMail).then(function (data) {\r\n                  $scope.fileadjuntpdf = data;\r\n                  $scope.result = data;\r\n                  $scope.sizeFiles = 0;\r\n                  //$scope.fileSelecteds = angular.copy($scope.fileadjuntpdf);\r\n                  if ($scope.fileadjuntpdf.files.length > 0) {\r\n                    $('#next').show('slow');\r\n                    $('#gogo').show('slow');\r\n                    $('#resume').show('slow');\r\n                    $('#buttons').hide('slow');\r\n                    $('#htab3').hide('slow');\r\n                    $('#filelist').hide('slow');\r\n                    $('#container').hide('slow');\r\n                  }\r\n                });\r\n              };\r\n              $scope.setSizeFile = function () {\r\n                for (var i in $scope.fileadjunt) {\r\n                  $scope.sizeFiles = $scope.sizeFiles + parseInt($scope.fileadjunt[i].size);\r\n                }\r\n              }\r\n\r\n              $scope.selectFile = function () {\r\n                for (var i = 0; i < $scope.gallery[0].items.length; i++) {\r\n                  $scope.gallery[0].items[i].class = {}\r\n                  for (var j in $scope.fileadjunt) {\r\n                    if ($scope.fileadjunt[j].idAsset == $scope.gallery[0].items[i].idAsset) {\r\n                      $scope.gallery[0].items[i].class.border = \"1px solid red\";\r\n                      $scope.gallery[0].items[i].class.opacity = 0.5;\r\n                    }\r\n                  }\r\n                }\r\n              };\r\n              $scope.selectedAsset = function (data, $index) {\r\n                var x = $scope.gallery[0].items[$index];\r\n                if (angular.isDefined(x.class) && !angular.equals(x.class, {})) {\r\n                  for (var i in $scope.fileSelecteds) {\r\n                    if ($scope.fileSelecteds[i].idAsset == data.idAsset) {\r\n                      $scope.fileSelecteds.splice(i, 1);\r\n                    }\r\n                  }\r\n                  $scope.gallery[0].items[$index].class = {};\r\n                } else {\r\n                  $scope.fileSelecteds.push(data);\r\n                  $scope.gallery[0].items[$index].class = {};\r\n                  $scope.gallery[0].items[$index].class.border = \"1px solid red\";\r\n                  $scope.gallery[0].items[$index].class.opacity = 0.5;\r\n                }\r\n              };\r\n              $scope.addFile = function () {\r\n                //          if($scope.arrFilePending){\r\n                //            $scope.uploader.uploadAll();\r\n                //          }\r\n                //          console.log($scope.fileSelecteds);\r\n                //          return;\r\n                if ($scope.fileSelecteds.length > 0) {\r\n                  $scope.hidefile = true;\r\n                  var data = {\r\n                    file: $scope.fileSelecteds,\r\n                    idMail: $scope.idMail\r\n                  };\r\n                  restService.addAdjunt(data).then(function () {\r\n                    $scope.attach();\r\n                  });\r\n                }\r\n                //$scope.answer('not useful');\r\n                $('#adjun').modal('hide');\r\n              };\r\n              $scope.addFileLoad = function () {\r\n                //console.log(123);\r\n                //          $(\"#myModal\").modal(\"hide\");\r\n                //          $scope.getAll();\r\n              };\r\n              $scope.getAll();\r\n              $scope.googleAnalyticsLink = [];\r\n              $scope.showLinksGoogleAnalytics = false;\r\n              $scope.googleAnalytics = {links: [], campaignName: \"\", idMail: $stateParams.id};\r\n              $scope.disabledSendDataGoogleAnalytics = false;\r\n\r\n              $scope.sendDataGoogleAnalytics = function () {\r\n                if ($scope.googleAnalytics.campaignName.length < 2 || $scope.googleAnalytics.links.length == 0) {\r\n                  notificationService.error(\"Los campos nombre de campaña y seguimiento de Google Analytics no pueden estar vacios.\");\r\n                } else {\r\n                  restService.sendDataGoogleAnalitics($scope.googleAnalytics).then(function (data) {\r\n                    if (data.action == \"create\") {\r\n                      notificationService.success(data.message);\r\n                    } else {\r\n                      notificationService.primary(data.message);\r\n                    }\r\n                  });\r\n                }\r\n              };\r\n              $scope.clearDataGoogleAnalytics = function () {\r\n                $scope.googleAnalytics.campaignName = \"\";\r\n                $scope.googleAnalytics.links = [];\r\n                //$scope.dataGoogleAnalytics = {};\r\n              };\r\n              $scope.discardChangesGoogleAnalytics = function () {\r\n                $scope.showLinksGoogleAnalytics = false;\r\n                $scope.googleAnalytics.campaignName = \"\";\r\n                $scope.googleAnalytics.links = [];\r\n                //$scope.dataGoogleAnalytics = {};\r\n              };\r\n              $scope.changeNotifications = function () {\r\n                $(\"#notificationArea\").removeClass(\"error-focus\");\r\n                if (!$scope.notifications) {\r\n                  $scope.dataadv.notificationEmails = \"\";\r\n                  $(\"#advert-error\").removeClass('color-danger');\r\n                }\r\n                //                console.log($scope.dataadv.notifications);\r\n                //                console.log($scope.dataadv.notificationEmails);\r\n\r\n              }\r\n              $scope.changeStatistics = function () {\r\n                $(\"#statisticsArea\").removeClass(\"error-focus\");\r\n                if (!$scope.statistics) {\r\n                  $scope.dataadv.statisticsEmails = \"\";\r\n                  $scope.dataadv.quantity = null;\r\n                  $scope.dataadv.typeTime = null;\r\n                  $(\"#advert-error-statistics\").removeClass('color-danger');\r\n                }\r\n                //                console.log($scope.dataadv.statistics);\r\n                //                console.log($scope.dataadv.statistics);\r\n\r\n              }\r\n\r\n              $scope.validateEmail = function () {\r\n                $(\"#notificationArea\").removeClass(\"error-focus\");\r\n                var notEmails = $scope.dataadv.notificationEmails.split(',');\r\n                var cont = 0;\r\n                var re = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                for (i = 0; i < notEmails.length; i++) {\r\n                  if (!re.test(notEmails[i])) {\r\n                    cont++;\r\n                  }\r\n                }\r\n                //                .log.log(\"El array tiene \" + notEmails.length + \" posiciones y su contenido es '\" + notEmails[0] + \"' en su posicion 0\");\r\n                if (cont > 0) {\r\n                  $(\"#notificationArea\").addClass('error-focus');\r\n                }\r\n\r\n                if (notEmails.length == 1 && notEmails[0] == '') {\r\n                  $(\"#notificationArea\").removeClass(\"error-focus\");\r\n                  $(\"#advert-error\").removeClass('color-danger');\r\n                }\r\n                //                console.log(\"Posiciones: \" + notEmails.length);\r\n\r\n                if (notEmails.length > 8) {\r\n                  $(\"#notificationArea\").addClass('error-focus');\r\n                  $(\"#advert-error\").addClass('color-danger');\r\n                } else {\r\n                  $(\"#advert-error\").removeClass('color-danger');\r\n                }\r\n\r\n              }\r\n              $scope.validateEmailStatistics = function () {\r\n                $(\"#statisticsArea\").removeClass(\"error-focus\");\r\n                var notEmails = $scope.dataadv.statisticsEmails.split(',');\r\n                var cont = 0;\r\n                var re = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                for (i = 0; i < notEmails.length; i++) {\r\n                  if (!re.test(notEmails[i])) {\r\n                    cont++;\r\n                  }\r\n                }\r\n                //                console.log(\"El array tiene \" + notEmails.length + \" posiciones y su contenido es '\" + notEmails[0] + \"' en su posicion 0\");\r\n                if (cont > 0) {\r\n                  $(\"#statisticsArea\").addClass('error-focus');\r\n                }\r\n\r\n                if (notEmails.length == 1 && notEmails[0] == '') {\r\n                  $(\"#statisticsArea\").removeClass(\"error-focus\");\r\n                  $(\"#advert-error-statistics\").removeClass('color-danger');\r\n                }\r\n                //                console.log(\"Posiciones: \" + notEmails.length);\r\n\r\n                if (notEmails.length > 8) {\r\n                  $(\"#statisticsArea\").addClass('error-focus');\r\n                  $(\"#advert-error-statistics\").addClass('color-danger');\r\n                } else {\r\n                  $(\"#advert-error-statistics\").removeClass('color-danger');\r\n                }\r\n\r\n              }\r\n\r\n              $scope.sendDataForTable = function(){\r\n                  //console.log(\"esta entrando al metodo xD\");  \r\n                  restService.getTableResults($scope.idMail)\r\n                        .then(function (data) { $scope.result = data; })\r\n                        .catch(function (data) { notificationService.error(data); });\r\n              }\r\n              //APP FACEBOOK\r\n              function ModalPageFacebookCtrl($scope, $mdDialog, pages) {\r\n                $scope.pages = pages\r\n                $scope.hide = function () {\r\n                  $mdDialog.hide();\r\n                };\r\n                $scope.closeDialog = function () {\r\n                  $mdDialog.cancel();\r\n                };\r\n                $scope.selectedPage = function (page) {\r\n                  $mdDialog.hide(page);\r\n                }\r\n              }\r\n\r\n              $scope.appFacebook = {\r\n                fanPageSelected: false,\r\n                checkPermissionFacebookPage: function (page) {\r\n                  var defer = $q.defer();\r\n                  var promise = defer.promise;\r\n                  var arrPageReturn = {data: []};\r\n                  for (var i in page) {\r\n                    if (typeof page[i].perms.indexOf(constantMail.permissionFBAdmin) != \"number\" ||\r\n                            typeof page[i].perms.indexOf(constantMail.permissionFBBasicAdmin) != \"number\" ||\r\n                            typeof page[i].perms.indexOf(constantMail.permissionFBCreateContent) != \"number\") {\r\n                      continue;\r\n                    }\r\n                    arrPageReturn.data.push(page[i]);\r\n                  }\r\n                  if (arrPageReturn.data.length <= 0) {\r\n                    defer.reject(constantMail.errorLengthFanPage);\r\n                  }\r\n                  defer.resolve(arrPageReturn);\r\n                  return promise;\r\n                },\r\n                changeSwitch: function () {\r\n                  if ($scope.appFacebook.facebook) {\r\n                    if (!this.fanPageSelected) {\r\n                      $scope.appFacebook.login(false);\r\n                    }\r\n                  } else {\r\n\r\n                  }\r\n                },\r\n                login: function (objPage) {\r\n                  $FB.getLoginStatus(function (response) {\r\n                    console.log(response);\r\n                    if (response.status === 'connected') {\r\n                      $FB.api('/me/accounts', function (response) {\r\n//                      $FB.api('/' + $FB.getUserID() + '/accounts', function (response) {\r\n                        if (response.error) {\r\n                         //notificationService.error(constantMail.errorApiFacebook);\r\n                          return;\r\n                        }\r\n                        $scope.appFacebook.checkPermissionFacebookPage(response.data).then(function (response) {\r\n                        if (!objPage) {\r\n                          $scope.appFacebook.showModalSelectedPage(response);\r\n                        } else {\r\n                          $scope.appFacebook.setFacebook(response, objPage);\r\n                        }\r\n                        }).catch(function (data) {\r\n                          notificationService.error(data);\r\n                        });\r\n                      });\r\n                    } else {\r\n                      $FB.login(function () {\r\n                        $FB.api('/me/accounts', function (response) {\r\n//                        $FB.api('/' + $FB.getUserID() + '/accounts', function (response) {\r\n                          if (response.error) {\r\n                            //notificationService.error(constantMail.errorApiFacebook);\r\n                            return;\r\n                          }\r\n                          $scope.appFacebook.checkPermissionFacebookPage(response.data).then(function (response) {\r\n                          if (!objPage) {\r\n                            $scope.appFacebook.showModalSelectedPage(response);\r\n                          } /*else {\r\n                            $scope.appFacebook.setFacebook(response, objPage);\r\n                          }*/\r\n                          }).catch(function (data) {\r\n                            notificationService.error(data);\r\n                          });\r\n                        });\r\n                      }, {\r\n                        scope: 'publish_actions,publish_pages,manage_pages'\r\n                      });\r\n                    }\r\n                  });\r\n                },\r\n                getPicturesPage: function (id) {\r\n                  var defer = $q.defer();\r\n                  var promise = defer.promise;\r\n                  FB.api('/' + id + '/picture?redirect=false', function (response) {\r\n                    defer.resolve(response);\r\n                  });\r\n                  return promise;\r\n                },\r\n                getFanPageArr: function (data) {\r\n                  var defer = $q.defer();\r\n                  var promises = [];\r\n                  var response = data;\r\n                  angular.forEach(response, function (value) {\r\n                    promises.push($scope.appFacebook.getPicturesPage(value.id));\r\n                  });\r\n                  function setResolve(data) {\r\n                    for (var i = 0; i < data.length; i++) {\r\n                      response[i].picture = data[i].data.url;\r\n                    }\r\n                    defer.resolve(response);\r\n                  }\r\n                  $q.all(promises).then(function (data) {\r\n                    setResolve(data)\r\n                  });\r\n                  return defer.promise;\r\n                },\r\n                showModalSelectedPage: function (data) {\r\n                  var pages = data.data\r\n\r\n                  $scope.appFacebook.getFanPageArr(pages).then(function (data) {\r\n                    document.body.scrollTop = 0;\r\n                    $mdDialog.show({\r\n                      scope: $scope.$new(),\r\n                      controller: ModalPageFacebookCtrl,\r\n                      template: constantMail.templateModalPageFacebook,\r\n                      parent: angular.element(document.body),\r\n                      clickOutsideToClose: true,\r\n                      disableParentScroll: false,\r\n                      locals: {\r\n                        pages: data\r\n                      },\r\n                    }).then(function (response) {\r\n                      $scope.appFacebook.fanPageSelected = response;\r\n                    }, function () {\r\n                      if (!$scope.appFacebook.fanPageSelected) {\r\n                        $scope.appFacebook.facebook = false;\r\n                      }\r\n                    });\r\n                  });\r\n                },\r\n                setFacebook: function (response, objPage) {\r\n                  $scope.appFacebook.getPicturesPage(objPage.idPage).then(function (data) {\r\n                    for (var i = 0; i < response.data.length; i++) {\r\n                      let value = response.data[i];\r\n                      console.log(parseInt(value.id) == parseInt(objPage.idPage));\r\n                      if (parseInt(value.id) == parseInt(objPage.idPage)) {\r\n                        $scope.appFacebook.facebook = true;\r\n                        $scope.appFacebook.fanPageSelected = value;\r\n                        $scope.appFacebook.fanPageSelected.picture = data.data.url;\r\n                        $scope.appFacebook.descriptionPublish = objPage.description;\r\n                        console.log($scope.appFacebook);\r\n                        break;\r\n                      }\r\n                    }\r\n                  });\r\n\r\n                }\r\n              };\r\n              restService.getContentMail($scope.idMail).then(function (data) {\r\n                $scope.showLinksGoogleAnalytics = (data.googleAnalytics == 1 ? true : false);\r\n                $scope.googleAnalyticsLinks = data.content.links;\r\n                if (typeof data.googleAnalyticsData !== 'undefined') {\r\n                  $scope.googleAnalytics = data.googleAnalyticsData;\r\n                }\r\n\r\n                if (data.notificationEmails) {\r\n                  $scope.dataadv.notifications = true;\r\n                  $scope.dataadv.notificationEmails = data.notificationEmails;\r\n                }\r\n\r\n                if (data.statisticsEmails) {\r\n                  $scope.dataadv.statistics = true;\r\n                  $scope.dataadv.statisticsEmails = data.statisticsEmails;\r\n                  $scope.dataadv.quantity = data.quantity;\r\n                  $scope.dataadv.typeTime = data.typeTime;\r\n                }\r\n\r\n                if (data.facebook) {\r\n                  var data = {idPage: data.facebook.idPage, description: data.facebook.description};\r\n                  console.log(\"Valida si existe faceboog loko\");\r\n                  console.log(data);\r\n                  if ($FB.loaded) {\r\n                    $scope.appFacebook.login(data);\r\n                  } else {\r\n                    $timeout(function () {\r\n                      $scope.appFacebook.login(data);\r\n                    }, 100);\r\n                  }\r\n\r\n                }\r\n\r\n                $scope.saveAdvanceOptions = function () {\r\n                  if ($scope.appFacebook.facebook && $scope.appFacebook.fanPageSelected) {\r\n                    $scope.dataadv.facebook = angular.copy($scope.appFacebook);\r\n                  } else {\r\n                    $scope.dataadv.facebook = false;\r\n                  }\r\n\r\n                  $scope.dataadv.googleAnalytics = $scope.showLinksGoogleAnalytics;\r\n                  restService.saveAdvanceOptions($scope.idMail, $scope.dataadv).then(function (data) {\r\n                    notificationService.primary(\"La informaciÃ³n del mail ha sido actualizada correctamente.\");\r\n                    window.location.href = fullUrlBase + templateBase + '/create#/shippingdate/' + $scope.idMail;\r\n                  });\r\n                }\r\n                \r\n                $scope.statusAttached = function (type) {\r\n                  if(type == 'attachment'){\r\n                    if($scope.fileadjuntpdf.files.length > 0){\r\n                      $('#cancelDialog').addClass('dialog--open');\r\n                      $scope.isModal = 'customizedpdf';\r\n                    }\r\n                  }\r\n                  if (type == 'customizedpdf'){\r\n                    if ($scope.fileadjunt.length > 0) {\r\n                      $('#cancelDialog').addClass('dialog--open');\r\n                      $scope.isModal = 'attachment';\r\n                    }\r\n                  }\r\n                }\r\n                \r\n                $scope.closeModal = function (){\r\n                  if($scope.isModal == 'attachment'){\r\n                    $('.nav-tabs a[href=\"/#htab1\"]').tab('show');\r\n                  }\r\n                  if($scope.isModal == 'customizedpdf'){\r\n                    $('.nav-tabs a[href=\"/#htab2\"]').tab('show');\r\n                  }\r\n                  $('.dialog').removeClass('dialog--open');\r\n                }\r\n                \r\n                $scope.saveAdjunt = function (){\r\n                  if($scope.isModal == 'attachment'){\r\n                    //$scope.fileadjunt = [];\r\n                    for(var i = 0; i<$scope.fileadjunt.length; i++){\r\n                      restService.deleteAttached($scope.fileadjunt[i].idMailattachment).then(function () {\r\n                        $scope.attach();\r\n                      });\r\n                    }\r\n                    $('.nav-tabs a[href=\"/#htab2\"]').tab('show');\r\n                    $('.dialog').removeClass('dialog--open');\r\n                  }\r\n                  if($scope.isModal == 'customizedpdf'){\r\n                    document.getElementById('filelist').innerHTML = '';\r\n                    $scope.uploader = [];\r\n                    if($scope.result.files.length){\r\n                      restService.deleteCustomizedpdf($scope.idMail).then(function () {\r\n                        $scope.attachpdf();\r\n                      });\r\n                    }\r\n                    $('#next').hide('slow');\r\n                    $('#gogo').hide('slow');\r\n                    $('#resume').hide('slow');\r\n                    $('#buttons').hide('slow');\r\n                    $('#htab3').show('slow');\r\n                    $('#filelist').show('slow');\r\n                    $('#container').show('slow');\r\n\r\n                    $('.nav-tabs a[href=\"/#htab1\"]').tab('show');\r\n                    $('.dialog').removeClass('dialog--open');\r\n                  }\r\n                }\r\n                \r\n                $scope.deleteAll = function (idMail) {\r\n                  restService.deleteCustomizedpdf(idMail).then(function () {\r\n                    //$scope.attachpdf();\r\n                    $scope.fileadjuntpdf = {'files':[]};\r\n                    $('#next').hide('slow');\r\n                    $('#gogo').hide('slow');\r\n                    $('#resume').hide('slow');\r\n                    $('#buttons').show('slow');\r\n                    $('#htab3').show('slow');\r\n                    $('#filelist').show('slow');\r\n                    $('#container').show('slow');\r\n\r\n                    document.getElementById('filelist').innerHTML = '';\r\n                  });\r\n                }\r\n              });\r\n            }\r\n          ])\r\n          .controller('mailStructureEditorController', ['$scope', 'restService', 'notificationService', '$rootScope', '$stateParams', function ($scope, restService, notificationService, $rootScope, $stateParams) {\r\n              $scope.initial = 0;\r\n              $scope.page = 1;\r\n              $scope.filter = \"\";\r\n              $scope.search = function () {\r\n                $scope.getAll();\r\n              };\r\n              $scope.forward = function () {\r\n                $scope.initial += 1;\r\n                $scope.page += 1;\r\n                $scope.getAll();\r\n              };\r\n              $scope.fastforward = function () {\r\n                $scope.initial = ($scope.mailstructure.total_pages - 1);\r\n                $scope.page = $scope.mailstructure.total_pages;\r\n                $scope.getAll();\r\n              };\r\n              $scope.backward = function () {\r\n                $scope.initial -= 1;\r\n                $scope.page -= 1;\r\n                $scope.getAll();\r\n              };\r\n              $scope.fastbackward = function () {\r\n                $scope.initial = 0;\r\n                $scope.page = 1;\r\n                $scope.getAll();\r\n              };\r\n              $scope.getAll = function () {\r\n                restService.getAllMailStructure($scope.initial, $scope.filter).then(function (data) {\r\n                  $scope.mailstructure = data;\r\n                });\r\n              };\r\n              $scope.getAll();\r\n            }]);\r\n})();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9qcy9hbmd1bGFyL21haWwvY29udHJvbGxlcnMuanM/N2U4MyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxpQkFBaUI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGVBQWU7QUFDZjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsU0FBUztBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtB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aUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsQ0FBQyIsImZpbGUiOiIyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gIGFuZ3VsYXIubW9kdWxlKCdtYWlsLmNvbnRyb2xsZXJzJywgW10pXHJcbiAgICAgICAgICAuZmlsdGVyKCdwcm9wc0ZpbHRlcicsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtcywgcHJvcHMpIHtcclxuICAgICAgICAgICAgICB2YXIgb3V0ID0gW107XHJcbiAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShpdGVtcykpIHtcclxuICAgICAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMocHJvcHMpO1xyXG4gICAgICAgICAgICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgaXRlbU1hdGNoZXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByb3AgPSBrZXlzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gcHJvcHNbcHJvcF0udG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVtwcm9wXS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0ZXh0KSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGl0ZW1NYXRjaGVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1NYXRjaGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBMZXQgdGhlIG91dHB1dCBiZSB0aGUgaW5wdXQgdW50b3VjaGVkXHJcbiAgICAgICAgICAgICAgICBvdXQgPSBpdGVtcztcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIHJldHVybiBvdXQ7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmZpbHRlcignZ2V0QnlJZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCwgaWQpIHtcclxuICAgICAgICAgICAgICB2YXIgaSA9IDAsIGxlbiA9IGlucHV0Lmxlbmd0aDtcclxuICAgICAgICAgICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXRbaV0uZ210ID09IGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBpbnB1dFtpXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuY29udHJvbGxlcignbWFpbicsIFsnJHNjb3BlJywgJ2luY29tcGxldGUnLCAnJHJvb3RTY29wZScsICd3aXphcmQnLCAncmVzdFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCBpbmNvbXBsZXRlLCAkcm9vdFNjb3BlLCB3aXphcmQsIHJlc3RTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5pbmNvbXBsZXRlID0gaW5jb21wbGV0ZS5nZXRpbmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgd2l6YXJkLnNldGRlc2NyaWJlKHRydWUpO1xyXG4gICAgICAgICAgICAgIHdpemFyZC5zZXRhZGRyZXNzZWVzKGZhbHNlKTtcclxuICAgICAgICAgICAgICB3aXphcmQuc2V0Y29udGVudChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgd2l6YXJkLnNldGFkdmFuY2VvcHRpb25zKGZhbHNlKTtcclxuICAgICAgICAgICAgICB3aXphcmQuc2V0c2hpcHBpbmdkYXRlKGZhbHNlKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmFkZHJlc3NlZXMgPSB3aXphcmQuZ2V0YWRkcmVzc2VlcygpO1xyXG4gICAgICAgICAgICAgICRyb290U2NvcGUuZGVzY3JpYmUgPSB3aXphcmQuZ2V0ZGVzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmNvbnRlbnQgPSB3aXphcmQuZ2V0Y29udGVudCgpO1xyXG4gICAgICAgICAgICAgICRyb290U2NvcGUuYWR2YW5jZW9wdGlvbnMgPSB3aXphcmQuZ2V0YWR2YW5jZW9wdGlvbnMoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLnNoaXBwaW5nZGF0ZSA9IHdpemFyZC5nZXRzaGlwcGluZ2RhdGUoKTtcclxuICAgICAgICAgICAgfV0pXHJcbiAgICAgICAgICAuY29udHJvbGxlcignYmFzaWNpbmZvcm1hdGlvbkNvbnRyb2xsZXInLCBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJ3Jlc3RTZXJ2aWNlJywgJyR3aW5kb3cnLCAnbm90aWZpY2F0aW9uU2VydmljZScsICckc3RhdGVQYXJhbXMnLCAnd2l6YXJkJywgZnVuY3Rpb24gKCRzY29wZSwgJHJvb3RTY29wZSwgcmVzdFNlcnZpY2UsICR3aW5kb3csIG5vdGlmaWNhdGlvblNlcnZpY2UsICRzdGF0ZVBhcmFtcywgd2l6YXJkKSB7XHJcblxyXG4gICAgICAgICAgICAgIHdpemFyZC5zZXRkZXNjcmliZSh0cnVlKTtcclxuICAgICAgICAgICAgICB3aXphcmQuc2V0YWRkcmVzc2VlcyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgd2l6YXJkLnNldGNvbnRlbnQoZmFsc2UpO1xyXG4gICAgICAgICAgICAgIHdpemFyZC5zZXRhZHZhbmNlb3B0aW9ucyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgd2l6YXJkLnNldHNoaXBwaW5nZGF0ZShmYWxzZSk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5hZGRyZXNzZWVzID0gd2l6YXJkLmdldGFkZHJlc3NlZXMoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmRlc2NyaWJlID0gd2l6YXJkLmdldGRlc2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5jb250ZW50ID0gd2l6YXJkLmdldGNvbnRlbnQoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmFkdmFuY2VvcHRpb25zID0gd2l6YXJkLmdldGFkdmFuY2VvcHRpb25zKCk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5zaGlwcGluZ2RhdGUgPSB3aXphcmQuZ2V0c2hpcHBpbmdkYXRlKCk7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmRhdGEgPSB7fTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5jYXRlZ29yeSA9IFtdO1xyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGdldGVtYWlsbmFtZSgpIHtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldGVtYWlsbmFtZSgpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZW1haWxuYW1lID0gcmVzO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRlbWFpbHNlbmQoKSB7XHJcbiAgICAgICAgICAgICAgICByZXN0U2VydmljZS5nZXRlbWFpbHNlbmQoKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmVtYWlsc2VuZCA9IHJlcztcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0TWFpbENhdGVnb3J5KCkge1xyXG4gICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZ2V0TWFpbENhdGVnb3J5KCkudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5hdmFpbGlibGVDYXRlZ29yeSA9IHJlcztcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0UmVwbHlUbygpIHtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldFJlcGx5VG8oKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlcGx5VG9BcnJheSA9IHJlcztcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZ2V0ZW1haWxuYW1lKCk7XHJcbiAgICAgICAgICAgICAgZ2V0ZW1haWxzZW5kKCk7XHJcbiAgICAgICAgICAgICAgZ2V0UmVwbHlUbygpO1xyXG4gICAgICAgICAgICAgIGdldE1haWxDYXRlZ29yeSgpO1xyXG4gICAgICAgICAgICAgICRzY29wZS5zaG93SW5wdXROYW1lID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNob3dJbnB1dENhdGVnb3J5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNob3dTZWxlY3ROYW1lID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAkc2NvcGUuc2hvd0NhdGVnb3J5TmFtZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNob3dJY29uc05hbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5zaG93SWNvbnNDYXRlZ29yeSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNob3dJY29uc1NhdmVOYW1lID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNob3dJY29uc1NhdmVDYXRlZ29yeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5jaGFuZ2VTdGF0dXNOYW1lQ2F0ZWdvcnkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5zaG93SW5wdXRDYXRlZ29yeSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0lucHV0Q2F0ZWdvcnkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0NhdGVnb3J5TmFtZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0ljb25zQ2F0ZWdvcnkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dJY29uc1NhdmVDYXRlZ29yeSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0lucHV0Q2F0ZWdvcnkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dDYXRlZ29yeU5hbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0ljb25zQ2F0ZWdvcnkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0ljb25zU2F2ZUNhdGVnb3J5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuY2hhbmdlU3RhdHVzSW5wdXROYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuc2hvd0lucHV0TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0lucHV0TmFtZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93U2VsZWN0TmFtZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0ljb25zTmFtZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0ljb25zU2F2ZU5hbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dJbnB1dE5hbWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dTZWxlY3ROYW1lID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dJY29uc05hbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0ljb25zU2F2ZU5hbWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICRzY29wZS5zaG93SW5wdXRFbWFpbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5zaG93U2VsZWN0RW1haWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5zaG93SWNvbnNFbWFpbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNob3dJY29uc1NhdmVFbWFpbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5jaGFuZ2VTdGF0dXNJbnB1dEVtYWlsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuc2hvd0lucHV0RW1haWwpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dJbnB1dEVtYWlsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dTZWxlY3RFbWFpbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0ljb25zRW1haWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dJY29uc1NhdmVFbWFpbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0lucHV0RW1haWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dTZWxlY3RFbWFpbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93SWNvbnNFbWFpbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93SWNvbnNTYXZlRW1haWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUuc2hvd0lucHV0UmVwbHl0byA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5zaG93U2VsZWN0UmVwbHl0byA9IHRydWU7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNob3dJY29uc1JlcGx5dG8gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5zaG93SWNvbnNTYXZlUmVwbHl0byA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5jaGFuZ2VTdGF0dXNJbnB1dFJlcGx5dG8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5zaG93SW5wdXRSZXBseXRvKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93SW5wdXRSZXBseXRvID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dTZWxlY3RSZXBseXRvID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93SWNvbnNSZXBseXRvID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93SWNvbnNTYXZlUmVwbHl0byA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0lucHV0UmVwbHl0byA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd1NlbGVjdFJlcGx5dG8gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0ljb25zUmVwbHl0byA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93SWNvbnNTYXZlUmVwbHl0byA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUuYmFzaWNJbmZvcm1hdGlvblJlZ2lzdGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAoJHJvb3RTY29wZS5pZE1haWxHZXQpICE9IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygkc2NvcGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKCRzY29wZS5kYXRhLnNlbmRlck5hbWVTZWxlY3QpID09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihcIkVsIE5vbWJyZSBkZWwgcmVtaXRlbnRlIGVzIG9iaWdhdG9yaW9cIik7XHJcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mICgkc2NvcGUuZGF0YS5zZW5kZXJNYWlsU2VsZWN0KSA9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoXCJFbCBDb3JyZW8gZGVsIHJlbWl0ZW50ZSBlcyBvYmlnYXRvcmlvXCIpO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmVkaXRCYXNpY0luZm9ybWF0aW9uKCRyb290U2NvcGUuaWRNYWlsR2V0LCAkc2NvcGUuZGF0YSkudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLnN1Y2Nlc3MocmVzWydtc2cnXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmlkTWFpbEdldCA9IHJlc1snaWRNYWlsJ107XHJcbiAgICAgICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSBmdWxsVXJsQmFzZSArIHRlbXBsYXRlQmFzZSArICcvY3JlYXRlIy9hZGRyZXNzZWVzLycgKyByZXNbJ2lkTWFpbCddO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBpZiAodHlwZW9mICgkc2NvcGUuZGF0YS5zZW5kZXJOYW1lU2VsZWN0KSA9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoXCJFbCBOb21icmUgZGVsIHJlbWl0ZW50ZSBlcyBvYmlnYXRvcmlvXCIpO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiAoJHNjb3BlLmRhdGEuc2VuZGVyTWFpbFNlbGVjdCkgPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKFwiRWwgQ29ycmVvIGRlbCByZW1pdGVudGUgZXMgb2JpZ2F0b3Jpb1wiKTtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN0U2VydmljZS5hZGRCYXNpY0luZm9ybWF0aW9uKCRzY29wZS5kYXRhKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2Uuc3VjY2VzcyhyZXNbJ21zZyddKTtcclxuICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuaWRNYWlsR2V0ID0gcmVzWydpZE1haWwnXTtcclxuICAgICAgICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9IGZ1bGxVcmxCYXNlICsgdGVtcGxhdGVCYXNlICsgJy9jcmVhdGUjL2FkZHJlc3NlZXMvJyArIHJlc1snaWRNYWlsJ107XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5iYXNpY0luZm9ybWF0aW9uU2F2ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKCRzY29wZS5kYXRhLnNlbmRlck5hbWVTZWxlY3QpID09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoXCJFbCBOb21icmUgZGVsIHJlbWl0ZW50ZSBlcyBvYmlnYXRvcmlvXCIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgKCRzY29wZS5kYXRhLnNlbmRlck1haWxTZWxlY3QpID09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoXCJFbCBDb3JyZW8gZGVsIHJlbWl0ZW50ZSBlcyBvYmlnYXRvcmlvXCIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZWRpdEJhc2ljSW5mb3JtYXRpb24oJHJvb3RTY29wZS5pZE1haWxHZXQsICRzY29wZS5kYXRhKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5zdWNjZXNzKHJlc1snbXNnJ10pO1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuaWRNYWlsR2V0ID0gcmVzWydpZE1haWwnXTtcclxuICAgICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSBmdWxsVXJsQmFzZSArIHRlbXBsYXRlQmFzZTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuc2F2ZUNhdGVnb3J5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7bmFtZTogJHNjb3BlLmNhdGVnb3J5TmFtZX07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2hhbmdlU3RhdHVzTmFtZUNhdGVnb3J5KCk7XHJcbiAgICAgICAgICAgICAgICByZXN0U2VydmljZS5zYXZlQ2F0ZWdvcnkoZGF0YSkudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UucHJpbWFyeShyZXNbJ21zZyddKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhdGVnb3J5TmFtZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgIGdldE1haWxDYXRlZ29yeSgpO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5jYXRlZ29yeS5wdXNoKHJlc1snY2F0ZWdvcnknXS5pZE1haWxDYXRlZ29yeSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5zYXZlTmFtZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge25hbWU6ICRzY29wZS5zZW5kZXJOYW1lfTtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmFkZEVtYWlsTmFtZShkYXRhKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5zdWNjZXNzKHJlc1snbXNnJ10pO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2VuZGVyTmFtZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgIGdldGVtYWlsbmFtZSgpO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuY2hhbmdlU3RhdHVzSW5wdXROYW1lKCk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnNlbmRlck5hbWVTZWxlY3QgPSByZXNbJ2lkTmFtZVNlbmRlciddO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUuc2F2ZUVtYWlsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7ZW1haWw6ICRzY29wZS5zZW5kZXJNYWlsfTtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmFkZEVtYWlsU2VuZGVyKGRhdGEpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICBpZiAocmVzID09IFwiXCIgfHwgcmVzID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLndhcm5pbmcoJ05vIHNlIHB1ZG8gZ3VhcmRhciBlbCByZW1pdGVudGUsIHBvc2libGVtZW50ZSBlbCBjb3JyZW8gZXNlIGRlbWFzaWFkbyBsYXJnbywgaW50ZW50ZWxvIG51ZXZhbWVudGUgbyBjb211bmlxdWVzZSBjb24gc29wb3J0ZScpO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2Uuc3VjY2VzcyhyZXNbJ21zZyddKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2VuZGVyTWFpbCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0ZW1haWxzZW5kKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNoYW5nZVN0YXR1c0lucHV0RW1haWwoKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5zZW5kZXJNYWlsU2VsZWN0ID0gcmVzWydpZEVtYWlsc2VuZGVyJ107XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNhdmVSZXBseXRvID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7ZW1haWw6ICRzY29wZS5yZXBseVRvfTtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmFkZFJlcGx5VG8oZGF0YSkudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2Uuc3VjY2VzcyhyZXNbJ21zZyddKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlcGx5VG8gPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICBnZXRSZXBseVRvKCk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5jaGFuZ2VTdGF0dXNJbnB1dFJlcGx5dG8oKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEucmVwbHlUb1NlbGVjdCA9IHJlc1snaWRSZXBseVRvJ107XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLmlkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIUlzTnVtZXJpYygkc3RhdGVQYXJhbXMuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2Uud2FybmluZyhcIkVsIGNvcnJlbyBubyBzZSBoYSBlbmNvbnRyYWRvXCIpO1xyXG4gICAgICAgICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gJyMvYmFzaWNpbmZvcm1hdGlvbi8nO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5pZE1haWxHZXQgPSAkc3RhdGVQYXJhbXMuaWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIElzTnVtZXJpYyh2YWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXIocGFyc2VGbG9hdCh2YWwpKSA9PSB2YWw7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBpZiAoJHJvb3RTY29wZS5pZE1haWxHZXQgJiYgSXNOdW1lcmljKCRyb290U2NvcGUuaWRNYWlsR2V0KSkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIGlmICh0eXBlb2YgKCRyb290U2NvcGUuaWRNYWlsR2V0KSAhPSBcInVuZGVmaW5lZFwiICkge1xyXG4gICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZmluZE1haWwoJHJvb3RTY29wZS5pZE1haWxHZXQpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5uYW1lID0gcmVzLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnNlbmRlck5hbWVTZWxlY3QgPSByZXMuaWROYW1lU2VuZGVyO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5zZW5kZXJNYWlsU2VsZWN0ID0gcmVzLmlkRW1haWxzZW5kZXI7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnJlcGx5VG9TZWxlY3QgPSByZXMuaWRSZXBseVRvO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5yZXBseXRvID0gcmVzLnJlcGx5dG87XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnN1YmplY3QgPSByZXMuc3ViamVjdDtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEudGVzdCA9IChyZXMudGVzdCA9PSAxKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZ2V0TWFpbENhdGVnb3J5QnlJZE1haWwoJHJvb3RTY29wZS5pZE1haWxHZXQpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgaWRNYWlsQ2F0ZWdvcnkgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgcmVzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWRNYWlsQ2F0ZWdvcnkucHVzaChpdGVtLmlkTWFpbENhdGVnb3J5KTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLmNhdGVnb3J5ID0gaWRNYWlsQ2F0ZWdvcnk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1dKVxyXG4gICAgICAgICAgLmNvbnRyb2xsZXIoJ3NoaXBwaW5nZGF0ZUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRpbnRlcnZhbCcsICckZmlsdGVyJywgJ3Jlc3RTZXJ2aWNlJywgJyRzdGF0ZVBhcmFtcycsICckcScsICdub3RpZmljYXRpb25TZXJ2aWNlJywgJ21vbWVudCcsICd3aXphcmQnLCAnJEZCJywgJyR0aW1lb3V0JywgZnVuY3Rpb24gKCRzY29wZSwgJHJvb3RTY29wZSwgJGludGVydmFsLCAkZmlsdGVyLCByZXN0U2VydmljZSwgJHN0YXRlUGFyYW1zLCAkcSwgbm90aWZpY2F0aW9uU2VydmljZSwgbW9tZW50LCB3aXphcmQsICRGQiwgJHRpbWVvdXQpIHtcclxuICAgICAgICAgICAgICBpZiAoIUlzTnVtZXJpYygkc3RhdGVQYXJhbXMuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLndhcm5pbmcoXCJFbCBjb3JyZW8gbm8gc2UgaGEgZW5jb250cmFkb1wiKTtcclxuICAgICAgICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSAnIy9iYXNpY2luZm9ybWF0aW9uLyc7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIElzTnVtZXJpYyh2YWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXIocGFyc2VGbG9hdCh2YWwpKSA9PSB2YWw7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHdpemFyZC5zZXRkZXNjcmliZShmYWxzZSk7XHJcbiAgICAgICAgICAgICAgd2l6YXJkLnNldGFkZHJlc3NlZXMoZmFsc2UpO1xyXG4gICAgICAgICAgICAgIHdpemFyZC5zZXRjb250ZW50KGZhbHNlKTtcclxuICAgICAgICAgICAgICB3aXphcmQuc2V0YWR2YW5jZW9wdGlvbnMoZmFsc2UpO1xyXG4gICAgICAgICAgICAgIHdpemFyZC5zZXRzaGlwcGluZ2RhdGUodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5hZGRyZXNzZWVzID0gd2l6YXJkLmdldGFkZHJlc3NlZXMoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmRlc2NyaWJlID0gd2l6YXJkLmdldGRlc2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5jb250ZW50ID0gd2l6YXJkLmdldGNvbnRlbnQoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmFkdmFuY2VvcHRpb25zID0gd2l6YXJkLmdldGFkdmFuY2VvcHRpb25zKCk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5zaGlwcGluZ2RhdGUgPSB3aXphcmQuZ2V0c2hpcHBpbmdkYXRlKCk7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZGF0YSA9IHt9O1xyXG4gICAgICAgICAgICAgICRzY29wZS56b25haG9yYXJpYSA9IHt9O1xyXG4gICAgICAgICAgICAgICRyb290U2NvcGUuaWRNYWlsR2V0ID0gJHN0YXRlUGFyYW1zLmlkO1xyXG4gICAgICAgICAgICAgICRzY29wZS5pZE1haWwgPSAkcm9vdFNjb3BlLmlkTWFpbEdldDtcclxuICAgICAgICAgICAgICAkc2NvcGUuaW1hZ2VuRGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmltYWdlblRpbWUgPSAkc2NvcGUuaW1hZ2VuRGF0ZS5nZXRUaW1lKCk7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnRlc3RlciA9IHtcclxuICAgICAgICAgICAgICAgIG1haWxUZXN0ZXI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgZW1haWxzU2VuZFRlc3RlcjogbnVsbCxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2VTZW5kVGVzdGVyOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgc2VuZFRlc3Rlck1haWw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubWFpbFRlc3Rlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmVtYWlsc1NlbmRUZXN0ZXIgPT0gbnVsbCB8fCB0aGlzLmVtYWlsc1NlbmRUZXN0ZXIgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihcIkVsIGNhbXBvIGRlIGNvcnJlb3MgZGUgZW52aW8gZGUgdGVzdGVyIG5vIHB1ZWRlIGVzdGFyIHZhY2lvLlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHttYWlsc1NlbmQ6IHRoaXMuZW1haWxzU2VuZFRlc3Rlci5zcGxpdChcIixcIiksIG1lc3NhZ2VTZW5kOiB0aGlzLm1lc3NhZ2VTZW5kVGVzdGVyLCBpZFRlc3RlcjogJHNjb3BlLmlkTWFpbH07XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdFNlcnZpY2Uuc2VuZFRlc3Rlck1haWxzKGRhdGEsICRzY29wZS5pZE1haWwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAgICAgICAkKCcjZGF0ZXRpbWVwaWNrZXInKS5kYXRldGltZXBpY2tlcih7XHJcbiAgICAgICAgICAgICAgICBmb3JtYXQ6ICd5eXl5LU1NLWRkIGhoOm1tJyxcclxuICAgICAgICAgICAgICAgIGxhbmd1YWdlOiAnZXMnXHJcbiAgICAgICAgICAgICAgfSkub24oJ2NoYW5nZURhdGUnLCBmdW5jdGlvbiAoZXYpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS50aWNrKCk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNob3dUZXh0YXJlYSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2hvdyA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAkc2NvcGUubG9naW5GQiA9IGZ1bmN0aW9uIChpZFBhZ2UpIHtcclxuICAgICAgICAgICAgICAgICRGQi5nZXRMb2dpblN0YXR1cyhmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ2Nvbm5lY3RlZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAkRkIuYXBpKCcvJyArIGlkUGFnZSArIFwiP2ZpZWxkcz1hY2Nlc3NfdG9rZW4sbmFtZVwiLCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZXRGYWNlYm9vayhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJEZCLmxvZ2luKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICRGQi5hcGkoJy8nICsgaWRQYWdlICsgXCI/ZmllbGRzPWFjY2Vzc190b2tlbixuYW1lXCIsIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0RmFjZWJvb2socmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICdwdWJsaXNoX2FjdGlvbnMscHVibGlzaF9wYWdlcyxtYW5hZ2VfcGFnZXMnXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAkc2NvcGUuc2V0RmFjZWJvb2sgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG5cclxuICAgICAgICAgICAgICAgICRGQi5hcGkoJy8nICsgZGF0YS5pZCArICcvcGljdHVyZT9yZWRpcmVjdD1mYWxzZScsIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5mYWNlYm9vay5uYW1lID0gZGF0YS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLmZhY2Vib29rLnBpY3R1cmUgPSByZXNwb25zZS5kYXRhLnVybDtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5mYWNlYm9vay5hY2Nlc3NfdG9rZW4gPSBkYXRhLmFjY2Vzc190b2tlbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUucHVibGlzaFNvY2lhbEZhY2Vib29rID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwb3N0ID0ge307XHJcblxyXG4vLyAgICAgICAgICAgICAgICBwb3N0LnVybCA9IGZ1bGxVcmxCYXNlICsgJ2Fzc2V0L3RodW1ibmFpbG1haWwvJyArICRzY29wZS5pZE1haWw7IC8vU0VSVklET1JcclxuICAgICAgICAgICAgICAgIHBvc3QudXJsID0gXCJodHRwczovL2VuY3J5cHRlZC10Ym4zLmdzdGF0aWMuY29tL2ltYWdlcz9xPXRibjpBTmQ5R2NRMWRtekRoc1BjNXlISjVTNmo5MERVY29VRWF5bGR4bGFpRkRuaEF5elI1WUZjb3pBRFV4azFkQndcIjsvL0xPQ0FMSE9TVFxyXG4gICAgICAgICAgICAgICAgcG9zdC5hY2Nlc3NfdG9rZW4gPSAkc2NvcGUuZGF0YS5mYWNlYm9vay5hY2Nlc3NfdG9rZW47XHJcbiAgICAgICAgICAgICAgICBwb3N0Lm1lc3NhZ2UgPSAoJHNjb3BlLmRhdGEuZmFjZWJvb2suZGVzY3JpcHRpb24gIT0gbnVsbCkgPyAkc2NvcGUuZGF0YS5mYWNlYm9vay5kZXNjcmlwdGlvbiA6IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICBpZighYW5ndWxhci5lcXVhbHMobnVsbCwkc2NvcGUuZGF0YS5mYWNlYm9vay5kZXNjcmlwdGlvbikpe1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICBwb3N0LmNhcHRpb24gPSAkc2NvcGUuZGF0YS5mYWNlYm9vay5kZXNjcmlwdGlvbjsgXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNoZWNrIC0+IENhcHRpb24sIG1lIGltYWdpbm8gcXVlIGVsIGNvbWVudGFyaW8gZW4gZWwgcG9zdFwiKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHBvc3QpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuc29jaWFsU2VuZCAhPSBcIm5vd1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgIHBvc3Quc2NoZWR1bGVkX3B1Ymxpc2hfdGltZSA9IGRhdGEuc29jaWFsU2VuZDtcclxuICAgICAgICAgICAgICAgICAgcG9zdC5wdWJsaXNoZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHBvc3QubGluayA9IFwiaHR0cHM6Ly9haW8uc2lnbWFtb3ZpbC5jb20vd2VidmVyc2lvbi9zaG93L1wiICsgXCIxLVwiICsgJHNjb3BlLmRhdGEuaWRNYWlsICsgXCItcHVibGljLVwiICsgJHNjb3BlLmRhdGEuY29kaWdvICsgXCIvXCI7XHJcbiAgICAgICAgICAgICAgICAkRkIuYXBpKFwiL1wiICsgJHNjb3BlLmRhdGEuZmFjZWJvb2suaWRQYWdlICsgXCIvZmVlZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIlBPU1RcIiwgcG9zdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmICFyZXNwb25zZS5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBob3RvSWQgPSByZXNwb25zZS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3N0SWQgPSByZXNwb25zZS5wb3N0X2lkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwb3N0SWQgPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0SWQgPSAkc2NvcGUuZGF0YS5mYWNlYm9vay5pZFBhZ2UgKyBcIl9cIiArIHBob3RvSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN0U2VydmljZS5zZW5kRGF0YUNvbWZpcm1hdGlvbkVtYWlsKGRhdGEpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5wcmltYXJ5KGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5Nb2RhbENvbmZpcm0oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGQi5hcGkoXCIvXCIgKyBwaG90b0lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiREVMRVRFXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2FjY2Vzc190b2tlbjogJHNjb3BlLmRhdGEuZmFjZWJvb2suYWNjZXNzX3Rva2VufSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiAhcmVzcG9uc2UuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGQi5hcGkoXCIvXCIgKyBwb3N0SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJERUxFVEVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YWNjZXNzX3Rva2VuOiAkc2NvcGUuZGF0YS5mYWNlYm9vay5hY2Nlc3NfdG9rZW59LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmICFyZXNwb25zZS5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoXCJvY3VycsODwq1vIHVuIGVycm9yIGhhY2llbmRvIGVsIHBvc3RlbywgcG9yIGZhdm9yIHZhbGlkYXIgbGEgc2Vzc2nDg8KzbiBkZSBmYWNlYm9vay5cIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5pZCkge1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5pZE1haWxHZXQgPSAkc3RhdGVQYXJhbXMuaWQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaWRNYWlsID0gJHJvb3RTY29wZS5pZE1haWxHZXQ7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICByZXN0U2VydmljZS5nZXRTYXhzKCkudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICBpZiAocmVzW2ldLnNlcnZpY2UgPT0gXCJlbWFpbCBtYXJrZXRpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hbW1vdXRFbWFpbCA9IHthbW1vdW50OiByZXNbaV0uYW1vdW50LCBhY2NvdW50aW5nTW9kZTogcmVzW2ldLmFjY291bnRpbmdNb2RlfTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmZpbmRNYWlsKCRyb290U2NvcGUuaWRNYWlsR2V0KS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YSA9IHJlcztcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnRlc3QgPSAocmVzLnRlc3QgPT0gXCIxXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcy5zY2hlZHVsZURhdGUgIT0gbnVsbCAmJiByZXMuc2NoZWR1bGVEYXRlICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgJChcIiN2YWx1ZURhdGVwaWNrZXJcIikudmFsKHJlcy5zY2hlZHVsZURhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZ210RGF0YUJhc2UgPSByZXMuZ210O1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0ZSA9IHJlcy5zY2hlZHVsZURhdGU7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5vbGRIb3VyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZ2V0bGlzdHRpbWV6b25lKCkudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRpbWV6b25lID0gcmVzO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS56b25haG9yYXJpYS56b25lID0gJGZpbHRlcignZ2V0QnlJZCcpKCRzY29wZS50aW1lem9uZSwgcmVzLmdtdCk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZ2V0bGlzdHRpbWV6b25lKCkudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRpbWV6b25lID0gcmVzO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS56b25haG9yYXJpYS56b25lID0gJGZpbHRlcignZ2V0QnlJZCcpKCRzY29wZS50aW1lem9uZSwgXCItMDUwMFwiKTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5vbGRIb3VyID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlcy50YXJnZXQgIT0gbnVsbCAmJiByZXMudGFyZ2V0ICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGpzb24gPSBqUXVlcnkucGFyc2VKU09OKHJlcy50YXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgICBpZiAoanNvbi50eXBlID09IFwiY29udGFjdGxpc3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnRpdGxlTGlzdCA9ICdMaXN0YShzKSBkZSBjb250YWN0byhzKTogJztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5jb250YWN0cyA9IGpzb24uY29udGFjdGxpc3RzO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGpzb24udHlwZSA9PSBcInNlZ21lbnRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnRpdGxlTGlzdCA9ICdTZWdtZW50byhzKTogJztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5jb250YWN0cyA9IGpzb24uc2VnbWVudDtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGpzb24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldENvbnRlbnRNYWlsKCRyb290U2NvcGUuaWRNYWlsR2V0KS50aGVuKGZ1bmN0aW9uIChyZXNTdGF0aWNzKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChyZXNTdGF0aWNzLnN0YXRpc3RpY3NFbWFpbHMgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnN0YXRpc3RpY3NFbWFpbHMgPSB7c3RhdGlzdGljc0VtYWlsczogcmVzU3RhdGljcy5zdGF0aXN0aWNzRW1haWxzLCBxdWFudGl0eTogcmVzU3RhdGljcy5xdWFudGl0eSwgdHlwZVRpbWU6IHJlc1N0YXRpY3MudHlwZVRpbWV9O1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnN0YXRpc3RpY3NFbWFpbHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgaWYgKHJlc1N0YXRpY3Mubm90aWZpY2F0aW9uRW1haWxzICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5ub3RpZmljYXRpb25FbWFpbHMgPSByZXNTdGF0aWNzLm5vdGlmaWNhdGlvbkVtYWlscztcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5ub3RpZmljYXRpb25FbWFpbHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgaWYgKHJlc1N0YXRpY3MuZmFjZWJvb2spIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5mYWNlYm9vayA9IHJlc1N0YXRpY3MuZmFjZWJvb2s7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRGQi5sb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2dpbkZCKCRzY29wZS5kYXRhLmZhY2Vib29rLmlkUGFnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvZ2luRkIoJHNjb3BlLmRhdGEuZmFjZWJvb2suaWRQYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgIH0sIDIwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5mYWNlYm9vayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZmluZEVtYWlsU2VuZGVyKHJlcy5pZEVtYWlsc2VuZGVyKS50aGVuKGZ1bmN0aW9uIChyZXNFbWFpbFNlbmRlcikge1xyXG4gICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlc0VtYWlsU2VuZGVyKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEuZW1haWxTZW5kZXIgPSByZXNFbWFpbFNlbmRlci5lbWFpbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZmluZEVtYWlsTmFtZShyZXMuaWROYW1lU2VuZGVyKS50aGVuKGZ1bmN0aW9uIChyZXNFbWFpbG5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNFbWFpbG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5uYW1lU2VuZGVyID0gcmVzRW1haWxuYW1lLm5hbWU7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzLmlkUmVwbHlUbyAhPSBudWxsICYmIGFuZ3VsYXIuaXNEZWZpbmVkKHJlcy5pZFJlcGx5VG8pKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmZpbmRSZXBseXRvKHJlcy5pZFJlcGx5VG8pLnRoZW4oZnVuY3Rpb24gKHJlc1JlcGx5dG8pIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICBjb25zb2xlLmxvZyhyZXNSZXBseXRvLmVtYWlsKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5yZXBseXRvID0gcmVzUmVwbHl0by5lbWFpbDtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5yZXBseXRvID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZmluZE1haWxDYXRlZ29yeSgkcm9vdFNjb3BlLmlkTWFpbEdldCkudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLmNhdGVnb3J5ID0gcmVzO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXN0U2VydmljZS5maW5kTWFpbEF0dGFjaG1lbnQoJHJvb3RTY29wZS5pZE1haWxHZXQpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5hdHRhY2htZW50ID0gcmVzO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5zaXplQXR0YWNobWVudCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZGF0YS5hdHRhY2htZW50Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluICRzY29wZS5kYXRhLmF0dGFjaG1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnNpemVBdHRhY2htZW50ID0gJHNjb3BlLmRhdGEuc2l6ZUF0dGFjaG1lbnQgKyBwYXJzZUludCgkc2NvcGUuZGF0YS5hdHRhY2htZW50W2ldLnNpemUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlcyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB2YXIgZGF0ZVVuaXggPSBtb21lbnQoKS51dGMoKS52YWx1ZU9mKCk7XHJcbiAgICAgICAgICAgICAgdmFyIGdtdDtcclxuICAgICAgICAgICAgICAkc2NvcGUuY2hhbmdlVGVzdE1haWwgPSBmdW5jdGlvbiAodGVzdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcclxuICAgICAgICAgICAgICAgIGlmICh0ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgIGRhdGEudGVzdCA9IDE7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBkYXRhLnRlc3QgPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmNoYW5nZVRlc3RNYWlsKCRyb290U2NvcGUuaWRNYWlsR2V0LCBkYXRhKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5wcmltYXJ5KFwiU2UgYWN0dWFsaXpvIGNvcnJlY3RhbWVudGUgZWwgY29ycmVvLlwiKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICRzY29wZS50aWNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVEYXRlID0gJChcIiN2YWx1ZURhdGVwaWNrZXJcIikudmFsKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXNlbGVjdGVEYXRlLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRlU2VsZWN0ZWRVbml4ID0gbW9tZW50KHNlbGVjdGVEYXRlKS51dGMoKS52YWx1ZU9mKCk7XHJcbiAgICAgICAgICAgICAgICAgIGRhdGVVbml4ID0gJHNjb3BlLmRhdGVTZWxlY3RlZFVuaXg7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAoJHNjb3BlLnpvbmFob3JhcmlhLnpvbmUpID09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgZ210ID0gXCItMDUwMFwiO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgZ210ID0gJHNjb3BlLnpvbmFob3JhcmlhLnpvbmUuZ210O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLm9sZEhvdXIpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGUgPSBtb21lbnQoZGF0ZVVuaXgpLnV0Y09mZnNldChnbXQpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbScpO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0ZUNvbXBhcmUgPSBtb21lbnQoZGF0ZVVuaXgpLnV0Y09mZnNldChnbXQpLmFkZCgxMCwgJ21pbnV0ZXMnKS5mb3JtYXQoJ1lZWVktTU0tREQgSEg6bW0nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUucHJvZ3JhbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBnbXQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZURhdGUgPSAkKFwiI3ZhbHVlRGF0ZXBpY2tlclwiKS52YWwoKTtcclxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlRGF0ZS5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKFwiTm8gc2UgcHVlZGUgcHJvZ3JhbWFyIGVsIGVudmlvLCBmYWx0YSBsYSBmZWNoYSBkZSBlbnZpb1wiKTtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciB0aW1lbm93ID0gbW9tZW50KCkudXRjKCctMDUwMCcpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbScpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5kYXRlQ29tcGFyZSA8PSB0aW1lbm93KSB7XHJcbiAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoXCJObyBzZSBwdWVkZSBwcm9ncmFtYXIgZWwgZW52aW8sIGxhIGZlY2hhIGRlIGVudmlvIHlhIGV4cGlyb1wiKTtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIGVudmlhciA9IHtkYXRlU2VsZWN0ZWQ6IHNlbGVjdGVEYXRlLCBnbXQ6ICRzY29wZS56b25haG9yYXJpYS56b25lLmdtdCwgaWRNYWlsOiAkc2NvcGUuaWRNYWlsfTtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLnNlbmRTY2hlZHVsZURhdGVFbWFpbChlbnZpYXIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5wcmltYXJ5KGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5vbGRIb3VyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEuZ210ID0gJHNjb3BlLmdtdERhdGFCYXNlID0gZGF0YS5tYWlsLmdtdDtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEuc2NoZWR1bGVEYXRlID0gJHNjb3BlLmRhdGUgPSBkYXRhLm1haWwuc2NoZWR1bGVEYXRlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUucmVwcm9ncmFtID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm9sZEhvdXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICQoXCIjdmFsdWVEYXRlcGlja2VyXCIpLnZhbChtb21lbnQobmV3IERhdGUoKSkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tJykpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnpvbmFob3JhcmlhLnpvbmUgPSAkZmlsdGVyKCdnZXRCeUlkJykoJHNjb3BlLnRpbWV6b25lLCBcIi0wNTAwXCIpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRhdGUgPSBtb21lbnQobmV3IERhdGUoKSkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tJyk7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUuc2VuZE5vdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBnbXQgPSAnLTA1MDAnO1xyXG4gICAgICAgICAgICAgICAgdmFyIGVudmlhciA9IHtkYXRlU2VsZWN0ZWQ6IG1vbWVudCgpLnV0Y09mZnNldChnbXQpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbScpLCBnbXQ6ICRzY29wZS56b25haG9yYXJpYS56b25lLmdtdCwgaWRNYWlsOiAkc2NvcGUuaWRNYWlsfTtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLnNlbmRTY2hlZHVsZURhdGVFbWFpbChlbnZpYXIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5wcmltYXJ5KGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5vbGRIb3VyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEuZ210ID0gJHNjb3BlLmdtdERhdGFCYXNlID0gZGF0YS5tYWlsLmdtdDtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEuc2NoZWR1bGVEYXRlID0gJHNjb3BlLmRhdGUgPSBkYXRhLm1haWwuc2NoZWR1bGVEYXRlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuY2xvc2VNb2RhbENvbmZpcm0gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gZnVsbFVybEJhc2UgKyB0ZW1wbGF0ZUJhc2U7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuc2VuZENvbmZpcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRlQ29uZmlybWF0aW9uID0gbW9tZW50KG5ldyBEYXRlKCkpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbScpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldE1kNSgkc2NvcGUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuc2VuZERhdGFDb25maXJtYXRpb25FbWFpbCA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXN0U2VydmljZS5zZW5kRGF0YUNvbWZpcm1hdGlvbkVtYWlsKGRhdGEpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5wcmltYXJ5KGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIG9wZW5Nb2RhbENvbmZpcm0oKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAkc2NvcGUudmFsaWRhdGVEYXRhID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAkc2NvcGUuZGF0YTtcclxuICAgICAgICAgICAgICAgIHZhciBvYmpTZW5kRGF0YUNvbmZpcm1hdGlvbiA9IHt9O1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gXCJObyBzZSBwdWVkZSBlbnZpYXIgZWwgbWVuc2FqZSBwb3JxdWUgZmFsdGEgZWwgY2FtcG8gXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5uYW1lID09IDAgfHwgIWFuZ3VsYXIuaXNEZWZpbmVkKGRhdGEubmFtZSkpIHtcclxuICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihtZXNzYWdlICsgXCJub21icmUgY29ycmVvXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuZW1haWxTZW5kZXIgPT0gMCB8fCAhYW5ndWxhci5pc0RlZmluZWQoZGF0YS5lbWFpbFNlbmRlcikpIHtcclxuICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihtZXNzYWdlICsgXCJyZW1pdGVudGVcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5jYXRlZ29yeSA9PSAwIHx8ICFhbmd1bGFyLmlzRGVmaW5lZChkYXRhLmNhdGVnb3J5KSkge1xyXG4gICAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKG1lc3NhZ2UgKyBcImNhdGVnb3JpYSBkZSBjb3JyZW9zXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuc3ViamVjdCA9PSAwIHx8ICFhbmd1bGFyLmlzRGVmaW5lZChkYXRhLnN1YmplY3QpKSB7XHJcbiAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IobWVzc2FnZSArIFwiYXN1bnRvIGRlIGNvcnJlb1wiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChkYXRhLnRhcmdldCA9PSBudWxsIHx8ICFhbmd1bGFyLmlzRGVmaW5lZChkYXRhLnRhcmdldCkpIHtcclxuICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihtZXNzYWdlICsgXCJkZXN0aW5hdGFyaW9zXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuc2NoZWR1bGVEYXRlID09IG51bGwgfHwgIWFuZ3VsYXIuaXNEZWZpbmVkKGRhdGEuc2NoZWR1bGVEYXRlKSkge1xyXG4gICAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKG1lc3NhZ2UgKyBcImZlY2hhIHkgaG9yYSBkZSBlbnZpb1wiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zaXplQXR0YWNobWVudCA+IDIwMDAwMDApIHtcclxuICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihcIkVsIHRhbWHDg8KxbyBkZSB0b2RvcyBsb3MgYWRqdW50b3MgZXMgbWF5b3IgYSBsbyBwZXJtaXRpZG9cIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKCRzY29wZS5hbW1vdXRFbWFpbCkpIHtcclxuICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygkc2NvcGUuYW1tb3V0RW1haWwuYW1tb3VudCxkYXRhLnF1YW50aXR5dGFyZ2V0LHBhcnNlSW50KCRzY29wZS5hbW1vdXRFbWFpbC5hbW1vdW50KSA8IHBhcnNlSW50KGRhdGEucXVhbnRpdHl0YXJnZXQpKTtcclxuICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hbW1vdXRFbWFpbC5hY2NvdW50aW5nTW9kZSA9PSBcInNlbmRpbmdcIikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQoJHNjb3BlLmFtbW91dEVtYWlsLmFtbW91bnQpIDwgcGFyc2VJbnQoZGF0YS5xdWFudGl0eXRhcmdldCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKFwiTm8gdGllbmUgc2FsZG8gc3VmaWNpZW50ZSBwYXJhIHJlYWxpemFyIGVzdGEgY2FtcGHDg8KxYSwgbGUgaW52aXRhbW9zIGEgcmVjYXJnYXIgZWwgc2VydmljaW8uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihcIk5vIHRpZW5lIGxvcyBzZXJ2aWNpb3MgcGFyYSByZWFsaXphciBsYSBjYW1wYcODwrFhLCBwb3IgZmF2b3IgY29tdW5pY2Fyc2UgY29uIHNvcG9ydGVcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHNjaGVkdWxlRGF0ZSA9IG1vbWVudChkYXRhLnNjaGVkdWxlRGF0ZSkudXRjKGRhdGEuZ210KS5hZGQoMTAsICdtaW51dGVzJykuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbm93aG91ciA9IG1vbWVudCgpLnV0YygnLTA1MDAnKS5mb3JtYXQoJ1lZWVktTU0tREQgSEg6bW0nKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0ZVByb2dyYW0gPSBtb21lbnQoc2NoZWR1bGVEYXRlKTtcclxuICAgICAgICAgICAgICAgIHZhciBob3Vybm93ID0gbW9tZW50KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcHJvZ3JhbWVTb2NpYWwgPSAnbm93JztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NoZWR1bGVEYXRlIDw9IG5vd2hvdXIpIHtcclxuICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihcImxhIGZlY2hhIGRlIHByb2dyYW1hY2nDs24geWEgZXhwaXJvLCBwb3IgZmF2b3IgdmFsaWRhci5cIik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgcG9zdERhdGUgPSBtb21lbnQoZGF0YS5zY2hlZHVsZURhdGUpLnV0YyhkYXRhLmdtdCk7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBub3dNb21lbnQgPSBtb21lbnQoKS51dGMoJy0wNTAwJyk7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChwb3N0RGF0ZS5kaWZmKG5vd01vbWVudCwgJ21pbnV0ZXMnKSA8PSAyMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb2dyYW1lU29jaWFsID0gXCJub3dcIjtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBwcm9ncmFtZVNvY2lhbCA9IG1vbWVudChkYXRlUHJvZ3JhbSkudW5peCgpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb2JqU2VuZERhdGFDb25maXJtYXRpb24gPSB7ZGF0ZUNvbmZpcm1hdGlvbjogJHNjb3BlLmRhdGVDb25maXJtYXRpb24sIGlkTWFpbDogJHNjb3BlLmlkTWFpbCwgc29jaWFsU2VuZDogcHJvZ3JhbWVTb2NpYWx9O1xyXG4gICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShvYmpTZW5kRGF0YUNvbmZpcm1hdGlvbik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIC8vJGludGVydmFsKHRpY2ssIDEwMDApO1xyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUudGVzdCA9IHt9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5sb2FkZXJUZXN0TWFpbCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUuc2VuZFRlc3RNYWlsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRlc3QuaWRNYWlsID0gJHN0YXRlUGFyYW1zLmlkO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRlclRlc3RNYWlsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLnNlbmRUZXN0TWFpbCgkc2NvcGUudGVzdCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLnN1Y2Nlc3MoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnRlc3QudGFyZ2V0ID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS50ZXN0Lm1lc3NhZ2UgPSAnJztcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRlclRlc3RNYWlsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGVyVGVzdE1haWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICRzY29wZS5zZW5kVGVzdGVyTWFpbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS50ZXN0LmlkTWFpbCA9ICRzdGF0ZVBhcmFtcy5pZDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkZXJUZXN0TWFpbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICByZXN0U2VydmljZS5zZW5kVGVzdE1haWwoJHNjb3BlLnRlc3QpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5zdWNjZXNzKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS50ZXN0LnRhcmdldCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUudGVzdC5tZXNzYWdlID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5sb2FkZXJUZXN0TWFpbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRlclRlc3RNYWlsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICByZXN0U2VydmljZS5nZXRUaHVtYm5haWxNYWlsKCRzdGF0ZVBhcmFtcy5pZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YS50aHVtYik7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudXJsVGh1bWJuYWlsID0gZGF0YS50aHVtYjtcclxuICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgJHNjb3BlLmRvd25sb2FkTWFpbFByZXZpZXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXN0U2VydmljZS5kb3dubG9hZE1haWxQcmV2aWV3KCRzdGF0ZVBhcmFtcy5pZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICBpZiAoIWRhdGEudGh1bWIpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKFwiT2N1cnJpbyB1biBlcnJvciBnZW5lcmFuZG8gZWwgYXJjaGl2bywgcG9yIGZhdm9yIGNvbXVuaWNhcnNlIGNvbiBlbCBhZG1pbmlzdHJhZG9yLlwiKTtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyBkYXRhLnRodW1iO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSB1cmw7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH07XHJcblxyXG4vLyAgICAgJHNjb3BlLnJlc3RTZXJ2aWNlLmdldE1kNXB1Ymxpc2goJHNjb3BlLmRhdGEpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XHJcbi8vICAgICAgICBcclxuLy8gICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUuZ2V0TWQ1ID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldE1kNXB1Ymxpc2goZGF0YSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5jb2RpZ28gPSBhbmd1bGFyLmNvcHkoZGF0YS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnZhbGlkYXRlRGF0YSgpLnRoZW4oZnVuY3Rpb24gKHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmRhdGEuZmFjZWJvb2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wdWJsaXNoU29jaWFsRmFjZWJvb2soc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZW5kRGF0YUNvbmZpcm1hdGlvbkVtYWlsKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICBdKVxyXG4gICAgICAgICAgLmNvbnRyb2xsZXIoJ2FkZEFkZHJlc3NlZXNDb250cm9sbGVyJywgWyckc2NvcGUnLCAncmVzdFNlcnZpY2UnLCAnJHdpbmRvdycsICdpbmNvbXBsZXRlJywgJyRyb290U2NvcGUnLCAnJHN0YXRlUGFyYW1zJywgJ25vdGlmaWNhdGlvblNlcnZpY2UnLCAnd2l6YXJkJywgZnVuY3Rpb24gKCRzY29wZSwgcmVzdFNlcnZpY2UsICR3aW5kb3csIGluY29tcGxldGUsICRyb290U2NvcGUsICRzdGF0ZVBhcmFtcywgbm90aWZpY2F0aW9uU2VydmljZSwgd2l6YXJkKSB7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5pZE1haWxHZXQgPSAkc3RhdGVQYXJhbXMuaWQ7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZW5hYmxlZGRiID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmVuYWJsZWRjYXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICBpZiAoIUlzTnVtZXJpYygkc3RhdGVQYXJhbXMuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLndhcm5pbmcoXCJFbCBjb3JyZW8gbm8gc2UgaGEgZW5jb250cmFkb1wiKTtcclxuICAgICAgICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSAnIy9iYXNpY2luZm9ybWF0aW9uLyc7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUuZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIHNpbmdsZU1haWw6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBhbGxkYjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICB0eXBlVW5zdXNjcmliZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgdHlwZUFjY291bnQ6IG51bGxcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIElzTnVtZXJpYyh2YWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXIocGFyc2VGbG9hdCh2YWwpKSA9PSB2YWw7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHdpemFyZC5zZXRkZXNjcmliZShmYWxzZSk7XHJcbiAgICAgICAgICAgICAgd2l6YXJkLnNldGFkZHJlc3NlZXModHJ1ZSk7XHJcbiAgICAgICAgICAgICAgd2l6YXJkLnNldGNvbnRlbnQoZmFsc2UpO1xyXG4gICAgICAgICAgICAgIHdpemFyZC5zZXRhZHZhbmNlb3B0aW9ucyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgd2l6YXJkLnNldHNoaXBwaW5nZGF0ZShmYWxzZSk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5hZGRyZXNzZWVzID0gd2l6YXJkLmdldGFkZHJlc3NlZXMoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmRlc2NyaWJlID0gd2l6YXJkLmdldGRlc2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5jb250ZW50ID0gd2l6YXJkLmdldGNvbnRlbnQoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmFkdmFuY2VvcHRpb25zID0gd2l6YXJkLmdldGFkdmFuY2VvcHRpb25zKCk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5zaGlwcGluZ2RhdGUgPSB3aXphcmQuZ2V0c2hpcHBpbmdkYXRlKCk7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmlkTWFpbCA9ICRyb290U2NvcGUuaWRNYWlsR2V0O1xyXG4gICAgICAgICAgICAgICRzY29wZS5kaXNhYmxlZENvbnRhY3RsaXN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmRpc2FibGVkU2VnbWVudCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzID0gW107XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3NlZXMgPSB7c2VsZWN0ZENvbnRhY3RsaXM6IFtdfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2VlcyA9IHtzZWxlY3RkU2VnbWVudDogW119O1xyXG4gICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLnNob3dTZWdtZW50ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2Vlcy5zaG93c3RlcDEgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLnNob3dDb250YWN0bGlzdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3NlZXMuY291bnQgPSAwO1xyXG4gICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLmZpbGVyTWFpbCA9IFtdO1xyXG4gICAgICAgICAgICAgICRzY29wZS5jYXRlZ29yaWVzID0gXCJcIjtcclxuICAgICAgICAgICAgICAkc2NvcGUuc3RhdHVzYW5kdHlwZSA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmZpbmRNYWlsKCRzY29wZS5pZE1haWwpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2Vlcy5jb3VudCA9IGRhdGEucXVhbnRpdHl0YXJnZXQ7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuc2luZ2xlTWFpbCA9PSAxICYmIGRhdGEuYWxsZGIgPT0gMSApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IGZhbHNlOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS50eXBlVW5zdXNjcmliZWQgPT0gMCB8fCBkYXRhLnR5cGVVbnN1c2NyaWJlZCA9PSBudWxsKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2luZ2xlTWFpbDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBhbGxkYjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBpZEFjY291bnQ6IGRhdGEuaWRBY2NvdW50LFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGVVbnN1c2NyaWJlZDogdHlwZSxcclxuICAgICAgICAgICAgICAgICAgICB0eXBlQWNjb3VudDogZGF0YS50eXBlQWNjb3VudFxyXG4gICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnNpbmdsZU1haWwgPT0gMSAmJiBkYXRhLmFsbGRiID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgIHZhciB0eXBlID0gZmFsc2U7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgIGlmKGRhdGEudHlwZVVuc3VzY3JpYmVkID09IDAgfHwgZGF0YS50eXBlVW5zdXNjcmliZWQgPT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNpbmdsZU1haWw6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgYWxsZGI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGlkQWNjb3VudDogZGF0YS5pZEFjY291bnQsXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZVVuc3VzY3JpYmVkOiB0eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGVBY2NvdW50OiBkYXRhLnR5cGVBY2NvdW50XHJcbiAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuc2luZ2xlTWFpbCA9PSAwICYmIGRhdGEuYWxsZGIgPT0gMCAmJiBkYXRhLnRhcmdldCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IGZhbHNlOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICBpZihkYXRhLnR5cGVVbnN1c2NyaWJlZCA9PSAwIHx8IGRhdGEudHlwZVVuc3VzY3JpYmVkID09IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGVNYWlsOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGFsbGRiOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBpZEFjY291bnQ6IGRhdGEuaWRBY2NvdW50LFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGVVbnN1c2NyaWJlZDogdHlwZSxcclxuICAgICAgICAgICAgICAgICAgICB0eXBlQWNjb3VudDogZGF0YS50eXBlQWNjb3VudFxyXG4gICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnNpbmdsZU1haWwgPT0gMCAmJiBkYXRhLmFsbGRiID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgIHZhciB0eXBlID0gZmFsc2U7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgIGlmKGRhdGEudHlwZVVuc3VzY3JpYmVkID09IDAgfHwgZGF0YS50eXBlVW5zdXNjcmliZWQgPT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNpbmdsZU1haWw6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGFsbGRiOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBpZEFjY291bnQ6IGRhdGEuaWRBY2NvdW50LFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGVVbnN1c2NyaWJlZDogdHlwZSxcclxuICAgICAgICAgICAgICAgICAgICB0eXBlQWNjb3VudDogZGF0YS50eXBlQWNjb3VudFxyXG4gICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChkYXRhLnRhcmdldCkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2Vlcy5zaG93c3RlcDEgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgdmFyIGpzb24gPSBqUXVlcnkucGFyc2VKU09OKGRhdGEudGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgICAgaWYgKGpzb24udHlwZSA9PSBcImNvbnRhY3RsaXN0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdHVzYW5kdHlwZSA9IGpzb24udHlwZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2Vlcy5zaG93Q29udGFjdGxpc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2Vlcy5zZWxlY3RkQ29udGFjdGxpcyA9IGpzb24uY29udGFjdGxpc3RzO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGxDb250YWN0bGlzdCgpO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGpzb24udHlwZSA9PSBcInNlZ21lbnRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdGF0dXNhbmR0eXBlID0ganNvbi50eXBlO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLnNob3dTZWdtZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3NlZXMuc2VsZWN0ZFNlZ21lbnQgPSBqc29uLnNlZ21lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbFNlZ21lbnQoKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBpZiAoanNvbi5maWx0ZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlcnMgPSBqc29uLmZpbHRlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3NlZXMuY29uZGl0aW9uID0ganNvbi5jb25kaXRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZ2V0TWFpbEZpbHRlcnMoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2Vlcy5maWxlck1haWwgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihqc29uLmZpbHRlcnNbMF0udHlwZUZpbHRlcnMhPScnICl7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlckNvbnRhY3QgPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAkc2NvcGUuY2xlYXJTZWxlY3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVycyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3NlZXMuY291bnQgPSAwO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRpc2FibGVkQ29udGFjdGxpc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kaXNhYmxlZFNlZ21lbnQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLnNlbGVjdGRDb250YWN0bGlzID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLnNlbGVjdGRTZWdtZW50ID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jYXRlZ29yaWVzID0gXCJcIjtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5nZXRDb250YWN0bGlzdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJzID0gW107XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2VlcyA9IHtzZWxlY3RkU2VnbWVudDogW119O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlZ21lbnRzID0gW107XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29udGFjdGxpc3RzID0gW107XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2Vlcy5zaG93c3RlcDEgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLmNvdW50ID0gMDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLnNob3dTZWdtZW50ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLnNob3dDb250YWN0bGlzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBydWViYSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGxDb250YWN0bGlzdCgpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbFNlZ21lbnQoKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5nZXRBbGxDb250YWN0bGlzdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldENvbnRhY3RsaXN0KCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuY29udGFjdGxpc3RzID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm9ubHkoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmdldFNlZ21lbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVycyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3NlZXMgPSB7c2VsZWN0ZENvbnRhY3RsaXM6IFtdfTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zZWdtZW50cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbnRhY3RsaXN0cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3NlZXMuc2hvd3N0ZXAxID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2Vlcy5jb3VudCA9IDA7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJ1ZWJhID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBydWViYTIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2Vlcy5zZWxlY3RkQ29udGFjdGxpcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3NlZXMuc2VsZWN0ZFNlZ21lbnQgPSBbXTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLnNob3dTZWdtZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2Vlcy5zaG93Q29udGFjdGxpc3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbFNlZ21lbnQoKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGxDb250YWN0bGlzdCgpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbFNlZ21lbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXN0U2VydmljZS5nZXRTZWdtZW50KCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2VnbWVudHMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0QWN0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50Q29udGFjdHMoXCJjb250YWN0bGlzdFwiKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5zZWxlY3RBY3Rpb25TZWdtZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50Q29udGFjdHMoXCJzZWdtZW50XCIpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmNvdW50Q29udGFjdHMgPSBmdW5jdGlvbiAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3NlZXMuY291bnQgPSAwO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsXHJcbiAgICAgICAgICAgICAgICAgIHNlZ21lbnQ6ICRzY29wZS5hZGRyZXNzZWVzLnNlbGVjdGRTZWdtZW50LFxyXG4gICAgICAgICAgICAgICAgICBjb250YWN0bGlzdDogJHNjb3BlLmFkZHJlc3NlZXMuc2VsZWN0ZENvbnRhY3RsaXMsXHJcbiAgICAgICAgICAgICAgICAgIGZpbHRlcnM6ICRzY29wZS5maWx0ZXJzLFxyXG4gICAgICAgICAgICAgICAgICBjb25kaXRpb246ICRzY29wZS5hZGRyZXNzZWVzLmNvbmRpdGlvbixcclxuICAgICAgICAgICAgICAgICAgaWRNYWlsOiAkc2NvcGUuaWRNYWlsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuY291bnRDb250YWN0KGRhdGEpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3NlZXMuY291bnQgPSBkYXRhLmNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUub25seSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgJHNjb3BlLmFkZEFkZHJlc3NlZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgc2VsZWN0ZENvbnRhY3RsaXM6ICRzY29wZS5hZGRyZXNzZWVzLnNlbGVjdGRDb250YWN0bGlzLFxyXG4gICAgICAgICAgICAgICAgICBzZWxlY3RkU2VnbWVudDogJHNjb3BlLmFkZHJlc3NlZXMuc2VsZWN0ZFNlZ21lbnQsXHJcbiAgICAgICAgICAgICAgICAgIHNob3dTZWdtZW50OiAkc2NvcGUuYWRkcmVzc2Vlcy5zaG93U2VnbWVudCxcclxuICAgICAgICAgICAgICAgICAgc2hvd0NvbnRhY3RsaXN0OiAkc2NvcGUuYWRkcmVzc2Vlcy5zaG93Q29udGFjdGxpc3QsXHJcbiAgICAgICAgICAgICAgICAgIGlkTWFpbDogJHNjb3BlLmlkTWFpbCxcclxuICAgICAgICAgICAgICAgICAgcXVhbnRpdHl0YXJnZXQ6ICRzY29wZS5hZGRyZXNzZWVzLmNvdW50LFxyXG4gICAgICAgICAgICAgICAgICBmaWx0ZXJzOiAkc2NvcGUuZmlsdGVycyxcclxuICAgICAgICAgICAgICAgICAgY29uZGl0aW9uOiAkc2NvcGUuYWRkcmVzc2Vlcy5jb25kaXRpb24sXHJcbiAgICAgICAgICAgICAgICAgIHNpbmdsZU1haWw6ICRzY29wZS5kYXRhLnNpbmdsZU1haWwsXHJcbiAgICAgICAgICAgICAgICAgIGFsbGRiOiAkc2NvcGUuZGF0YS5hbGxkYixcclxuICAgICAgICAgICAgICAgICAgdHlwZVVuc3VzY3JpYmVkIDogJHNjb3BlLmRhdGEudHlwZVVuc3VzY3JpYmVkXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hZGRyZXNzZWVzLnNlbGVjdGRDb250YWN0bGlzICYmICRzY29wZS5hZGRyZXNzZWVzLnNlbGVjdGRDb250YWN0bGlzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgaW5jb21wbGV0ZS5zZXRpbmNvbXBsZXRlKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5pbmNvbXBsZXRlID0gaW5jb21wbGV0ZS5nZXRpbmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5hZGQoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRzY29wZS5hZGRyZXNzZWVzLnNlbGVjdGRTZWdtZW50ICYmICRzY29wZS5hZGRyZXNzZWVzLnNlbGVjdGRTZWdtZW50Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgaW5jb21wbGV0ZS5zZXRpbmNvbXBsZXRlKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5pbmNvbXBsZXRlID0gaW5jb21wbGV0ZS5nZXRpbmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5hZGQoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBpbmNvbXBsZXRlLnNldGluY29tcGxldGUodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuaW5jb21wbGV0ZSA9IGluY29tcGxldGUuZ2V0aW5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuYWRkKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmFsbFNlZ21lbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGlzYWJsZWRTZWdtZW50ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLnNlbGVjdGRTZWdtZW50ID0gJHNjb3BlLnNlZ21lbnRzO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdEFjdGlvblNlZ21lbnQoKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5hbGxDb250YWN0bGlzdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kaXNhYmxlZENvbnRhY3RsaXN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLnNlbGVjdGRDb250YWN0bGlzID0gJHNjb3BlLmNvbnRhY3RsaXN0cztcclxuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RBY3Rpb24oKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5maWx0ZXJzID0gW107XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnRpcGVGaWx0ZXJzID0gW1xyXG4gICAgICAgICAgICAgICAge2lkOiAxLCBuYW1lOiBcIkVudmlhciBhIGNvbnRhY3RvcyBxdWUgaGF5YW4gcmVjaWJpZG8gdW4gY29ycmVvXCJ9LFxyXG4gICAgICAgICAgICAgICAge2lkOiAyLCBuYW1lOiBcIkVudmlhciBhIGNvbnRhY3RvcyBxdWUgaGF5YW4gYWJpZXJ0byB1biBjb3JyZW9cIn0sXHJcbiAgICAgICAgICAgICAgICB7aWQ6IDMsIG5hbWU6IFwiRW52aWFyIGEgY29udGFjdG9zIHF1ZSBoYXlhbiBoZWNobyBjbGljIHVuIGVubGFjZVwifVxyXG4gICAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdE1haWxGaWx0ZXIgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgICAgICAgICByZXN0U2VydmljZS5nZXRNYWlsRmlsdGVycygpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3NlZXMuZmlsZXJNYWlsID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGtleS50eXBlRmlsdGVycyA9PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldExpbmtzQnlNYWlsKGtleS5tYWlsU2VsZWN0ZWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBrZXkubGlua3MgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLmFkZHJlc3NlZXMuc2hvd0NvbnRhY3RsaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50Q29udGFjdHMoXCJjb250YWN0bGlzdFwiKTtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRDb250YWN0cyhcInNlZ21lbnRcIik7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIElzTnVtZXJpYyh2YWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXIocGFyc2VGbG9hdCh2YWwpKSA9PSB2YWw7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICRzY29wZS5zZWxlY3RpbnZlcnRlZCA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChrZXkudHlwZUZpbHRlcnMgPT0gMykge1xyXG4gICAgICAgICAgICAgICAgICBpZiAoSXNOdW1lcmljKGtleS5tYWlsU2VsZWN0ZWQpICYmIElzTnVtZXJpYyhrZXkubWFpbFNlbGVjdGVkKSAmJiBJc051bWVyaWMoa2V5LmxpbmtTZWxlY3RlZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5hZGRyZXNzZWVzLnNob3dDb250YWN0bGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50Q29udGFjdHMoXCJjb250YWN0bGlzdFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50Q29udGFjdHMoXCJzZWdtZW50XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKElzTnVtZXJpYyhrZXkubWFpbFNlbGVjdGVkKSAmJiBrZXkudHlwZUZpbHRlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5hZGRyZXNzZWVzLnNob3dDb250YWN0bGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50Q29udGFjdHMoXCJjb250YWN0bGlzdFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50Q29udGFjdHMoXCJzZWdtZW50XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdExpbmtGaWx0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5hZGRyZXNzZWVzLnNob3dDb250YWN0bGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRDb250YWN0cyhcImNvbnRhY3RsaXN0XCIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50Q29udGFjdHMoXCJzZWdtZW50XCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdFR5cGVGaWx0ZXIgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgICAgICAgICBrZXkubWFpbFNlbGVjdGVkID0gW107XHJcbiAgICAgICAgICAgICAgICBrZXkubGlua1NlbGVjdGVkID0gW107XHJcbiAgICAgICAgICAgICAgICBrZXkubWFpbCA9IFtdO1xyXG4gICAgICAgICAgICAgICAga2V5LmxpbmtzID0gW107XHJcbiAgICAgICAgICAgICAgICBrZXkuaW52ZXJ0ZWQgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZ2V0TWFpbEZpbHRlcnMoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzZWVzLmZpbGVyTWFpbCA9IGRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGtleS50eXBlRmlsdGVycykge1xyXG4gICAgICAgICAgICAgICAgICBjYXNlIDE6XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICBjYXNlIDI6XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICBjYXNlIDM6XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlckNvbnRhY3QgPSAwO1xyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICRzY29wZS5hZGRGaWx0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2Vlcy5jb25kaXRpb24gPSBcImFsbFwiO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlcnMucHVzaCh7fSk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyQ29udGFjdCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgJCgnI2ZpbHRlckNvbnRhY3QnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5yZW1vdmVGaWx0ZXJzID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVycy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlckNvbnRhY3QgPSAwO1xyXG4gICAgICAgICAgICAgICAgJCgnI2ZpbHRlckNvbnRhY3QnKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLmFkZHJlc3NlZXMuc2hvd0NvbnRhY3RsaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5jb3VudENvbnRhY3RzKFwiY29udGFjdGxpc3RcIik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRDb250YWN0cyhcInNlZ21lbnRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuYWRkID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmFkZEFkZHJlc3NlZXMoZGF0YSkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2Uuc3VjY2VzcyhcIlNlIGhhIGd1YXJkYWRvIGxhIHNlbGVjY2nDs24gZGUgZGVzdGluYXRhcmlvcyBjb3JyZWN0YW1lbnRlXCIpO1xyXG4gICAgICAgICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gJyMvY29udGVudC8nICsgJHNjb3BlLmlkTWFpbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLm9ubHkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFkZHJlc3NlZXMuc2hvd0NvbnRhY3RsaXN0ID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGRDb250YWN0bGlzOiAkc2NvcGUuYWRkcmVzc2Vlcy5zZWxlY3RkQ29udGFjdGxpcyxcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzOiAkc2NvcGUuZmlsdGVycyxcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGVNYWlsOiAkc2NvcGUuZGF0YS5zaW5nbGVNYWlsXHJcbiAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEuc2VsZWN0ZENvbnRhY3RsaXMgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdFNlcnZpY2Uub25seShkYXRhKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc2Vlcy5jb3VudCA9IGRhdGEuY291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2F0ZWdvcmllcyA9IGRhdGEuY2F0ZWdvcmllcztcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUub25seSgpO1xyXG4gICAgICAgICAgICB9XSlcclxuICAgICAgICAgIC5jb250cm9sbGVyKCdpbmRleCcsIFsnJHNjb3BlJywgJ2luY29tcGxldGUnLCAnJHJvb3RTY29wZScsICdyZXN0U2VydmljZScsICdub3RpZmljYXRpb25TZXJ2aWNlJywgJyRpbnRlcnZhbCcsIGZ1bmN0aW9uICgkc2NvcGUsIGluY29tcGxldGUsICRyb290U2NvcGUsIHJlc3RTZXJ2aWNlLCBub3RpZmljYXRpb25TZXJ2aWNlLCAkaW50ZXJ2YWwpIHtcclxuICAgICAgICAgICAgICAkc2NvcGUudmlld2xpc3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICRzY29wZS52aWV3bm9saXN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAkc2NvcGUucHJ1ZWJhID0gW3tuYW1lOiAnRWxpbWluYXInfV07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmluaXRpYWwgPSAwO1xyXG4gICAgICAgICAgICAgICRzY29wZS5wYWdlID0gMTtcclxuICAgICAgICAgICAgICAkc2NvcGUubWFpbCA9IFt7fV07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLm1haWxUb1RlbXBsYXRlID0gW107XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkID0gW107XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlciA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNob3dUZXN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmNvbmZpcm1EZWxldGUgPSBmdW5jdGlvbiAoaWRNYWlsKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaWRNYWlsID0gaWRNYWlsO1xyXG4gICAgICAgICAgICAgICAgb3Blbk1vZGFsKCk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuY29uZmlybUNhbmNlbCA9IGZ1bmN0aW9uIChpZE1haWwpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pZE1haWwgPSBpZE1haWw7XHJcbiAgICAgICAgICAgICAgICBvcGVuTW9kYWxDYW5jZWwoaWRNYWlsKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5wcmV2aWV3bWFpbHRlbXBjb250ID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXN0U2VydmljZS5wcmV2aWV3TWFpbFRlbXBsYXRlQ29udGVudChpZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgdmFyIGUgPSBkYXRhLnRlbXBsYXRlO1xyXG4gICAgICAgICAgICAgICAgICAkKCcjY29udGVudC1wcmV2aWV3JykuZW1wdHkoKTtcclxuICAgICAgICAgICAgICAgICAgJCgnPGlmcmFtZSBmcmFtZWJvcmRlcj1cIjBcIiB3aWR0aD1cIjEwMCVcIiBoZWlnaHQ9XCIxMDAlXCIvPicpLmFwcGVuZFRvKCcjY29udGVudC1wcmV2aWV3JykuY29udGVudHMoKS5maW5kKCdib2R5JykuYXBwZW5kKGUpO1xyXG4gICAgICAgICAgICAgICAgICAkKCcjbXlNb2RhbCcpLm1vZGFsKCdzaG93Jyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5wYXVzZU1haWxBbiA9IGZ1bmN0aW9uIChpZE1haWwpIHtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coaWRNYWlsKTtcclxuICAgICAgICAgICAgICAgIHBhdXNlTWFpbChpZE1haWwpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmNhbmNlbE1haWxBbiA9IGZ1bmN0aW9uIChpZE1haWwpIHtcclxuICAgICAgICAgICAgICAgIGNhbmNlbE1haWwoaWRNYWlsKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5yZXN1bWVNYWlsQW4gPSBmdW5jdGlvbiAoaWRNYWlsKSB7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGlkTWFpbCk7XHJcbiAgICAgICAgICAgICAgICByZXN1bWVNYWlsKGlkTWFpbCk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuY2FuY2VsTWFpbCA9IGZ1bmN0aW9uIChpZE1haWwpIHtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmNhbmNlbE1haWwoaWRNYWlsKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2Uud2FybmluZyhkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICBjbG9zZU1vZGFsQ2FuY2VsKCk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmRlbGV0ZU1haWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXN0U2VydmljZS5kZWxldGVNYWlsKCRzY29wZS5pZE1haWwpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS53YXJuaW5nKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIGNsb3NlTW9kYWwoKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUub3Blbk1vZGFsQ2FuY2VsID0gZnVuY3Rpb24gKGlkTWFpbCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coaWRNYWlsKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pZE1haWwgPSBpZE1haWw7XHJcbiAgICAgICAgICAgICAgICAkKCcjZGlhbG9nQ2FuY2VsJykuYWRkQ2xhc3MoJ2RpYWxvZy0tb3BlbicpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgICRzY29wZS5maWx0ZXIuY2F0ZWdvcnkgPSBbXTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyID0ge2NhdGVnb3J5OiBbXX07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnc2hvd1Rlc3QnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNob3dUZXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXIuc2hvd1Rlc3QgPSAwO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlci5zaG93VGVzdCA9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmZvcndhcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbCArPSAxO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgKz0gMTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5mYXN0Zm9yd2FyZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsID0gKCRzY29wZS5tYWlsLnRvdGFsX3BhZ2VzIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucGFnZSA9ICRzY29wZS5tYWlsLnRvdGFsX3BhZ2VzO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmJhY2t3YXJkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmluaXRpYWwgLT0gMTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYWdlIC09IDE7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZmFzdGJhY2t3YXJkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmluaXRpYWwgPSAwO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgPSAxO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNlYXJjaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgJHNjb3BlLmluaXRpYWwgPSAwO1xyXG4gICAgICAgICAgICAgICAkc2NvcGUucGFnZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuc2VhcmNoY2F0ZWdvcnkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmZpbHRlci5jYXRlZ29yeS5sZW5ndGggPj0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5wYWdlID0gMTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnW2ZpbHRlci5kYXRlaW5pdGlhbCxmaWx0ZXIuZGF0ZWVuZF0nLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCgkc2NvcGUuZmlsdGVyLmRhdGVpbml0aWFsKSl7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIGlmKCRzY29wZS5maWx0ZXIuZGF0ZWluaXRpYWwgIT0gXCJcIil7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQoJHNjb3BlLmZpbHRlci5kYXRlZW5kKSl7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICBpZigkc2NvcGUuZmlsdGVyLmRhdGVlbmQgIT0gXCJcIil7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsID0gMDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYWdlID0gMTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKCRzY29wZS5tYWlsWzBdKSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubWFpbFswXS5pdGVtcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZ2V0QWxsTWFpbCgkc2NvcGUuaW5pdGlhbCwgJHNjb3BlLmZpbHRlcikudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubWFpbCA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIHZhciBzdGF0dXNWZXJpZnkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXN0U2VydmljZS5nZXRBbGxNYWlsKCRzY29wZS5pbml0aWFsLCAkc2NvcGUuZmlsdGVyKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgIGRhdGFbMF0uaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm1haWxbMF0uaXRlbXNbaW5kZXhdLnN0YXR1cyAhPSBpdGVtLnN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1haWxbMF0uaXRlbXNbaW5kZXhdLnN0YXR1cyA9IGl0ZW0uc3RhdHVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhpdGVtLnN0YXR1cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgLy8kc2NvcGUubWFpbCA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRpbnRlcnZhbChzdGF0dXNWZXJpZnksIDEwMDApO1xyXG4gICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldE1haWxDYXRlZ29yeSgkc2NvcGUuaW5pdGlhbCwgJHNjb3BlLmZpbHRlcikudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1haWxDYXRlZ29yeSA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgLy8kc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICRzY29wZS50byA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAkc2NvcGUudG9nZ2xlID0gZnVuY3Rpb24gKGl0ZW0sIGxpc3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpZHggPSBsaXN0LmluZGV4T2YoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaWR4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgbGlzdC5zcGxpY2UoaWR4LCAxKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIGxpc3QucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5leGlzdHMgPSBmdW5jdGlvbiAoaXRlbSwgbGlzdCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxpc3QuaW5kZXhPZihpdGVtKSA+IC0xO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmlzQ2hlY2tlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUubWFpbFswXS5pdGVtcyAmJiAkc2NvcGUuc2VsZWN0ZWQubGVuZ3RoID09PSAkc2NvcGUubWFpbFswXS5pdGVtcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuaXNJbmRldGVybWluYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmluaXRpYWwgPSAwO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgPSAxO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICgkc2NvcGUuc2VsZWN0ZWQubGVuZ3RoICE9PSAkc2NvcGUubWFpbFswXS5pdGVtcy5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZUFsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWQubGVuZ3RoID09PSAkc2NvcGUubWFpbFswXS5pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkID0gW107XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRzY29wZS5zZWxlY3RlZC5sZW5ndGggPT09IDAgfHwgJHNjb3BlLnNlbGVjdGVkLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkID0gJHNjb3BlLm1haWxbMF0uaXRlbXMuc2xpY2UoMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTsgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICAgIC8vICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnRhcmdldFN0cmluZyA9IGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJpbmcgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPiB0YXJnZXQuY29udGFjdGxpc3RzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAvLy8vICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codGFyZ2V0LmNvbnRhY3RsaXN0c1tpXSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgIHN0cmluZyArPSB0YXJnZXQuY29udGFjdGxpc3RzW2ldLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgLy9Ub2RvIHNvYnJlIHBhc2FyIG1haWwgYSB0ZW1wbGF0ZVxyXG4gICAgICAgICAgICAgICRzY29wZS5lbXB0eSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5sZW5ndGggPSBmYWxzZTtcclxuICAgICAgICAgICAgICAkc2NvcGUuY2F0ZWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAkc2NvcGUucmVzdGFydCA9IGZ1bmN0aW9uIChpZE1haWwpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLm1haWxbMF0uaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5tYWlsWzBdLml0ZW1zW2ldLmlkTWFpbCA9PSBpZE1haWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWFpbFRvVGVtcGxhdGUgPSAkc2NvcGUubWFpbFswXS5pdGVtc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVtcHR5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubGVuZ3RoID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2F0ZWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5uYW1lbWFpbHRlbXBjYXQgPSAnJztcclxuICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICByZXN0U2VydmljZS5nZXRNYWlsVGVtcGxhdGVDYXRlZ29yeSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tYWlsdGVtcGNhdHMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUuc2F2ZU1haWxBc01haWxUZW1wbGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldE1haWxDb250ZW50SlNPTigkc2NvcGUubWFpbFRvVGVtcGxhdGUuaWRNYWlsKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5lZGl0b3IgPSBkYXRhLmNvbnRlbnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCgkc2NvcGUubmFtZW1haWx0ZW1wY2F0KSB8fCAkc2NvcGUubmFtZW1haWx0ZW1wY2F0ID09PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lbXB0eSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxlbmd0aCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihcIkVsIGNhbXBvIGRlIG5vbWJyZSBkZSBsYSBwbGFudGlsbGEgbm8gcHVlZGUgZXN0YXIgdmFjw4PGksOG4oCZw4PigJrDgsKtb1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAvL2FsZXJ0KFwiRWwgY2FtcG8gZGUgbm9tYnJlIGRlIGxhIHBsYW50aWxsYSBubyBwdWVkZSBlc3RhciB2YWPDg8aSw4bigJnDg+KAmsOCwq1vXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm5hbWVtYWlsdGVtcGNhdC5sZW5ndGggPCAyIHx8ICRzY29wZS5uYW1lbWFpbHRlbXBjYXQubGVuZ3RoID4gODApIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZW1wdHkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubGVuZ3RoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAvL25vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoXCJFbCBjYW1wbyBkZSBub21icmUgZGUgbGEgcGxhbnRpbGxhIGRlYmUgdGVuZXIgbcODxpLDhuKAmcOD4oCaw4LCrW5pbW8gMiBjYXJhY3RlcmVzIHkgbcODxpLDhuKAmcOD4oCaw4LCoXhpbW8gODBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9hbGVydChcIkVsIGNhbXBvIGRlIG5vbWJyZSBkZSBsYSBwbGFudGlsbGEgZGViZSB0ZW5lciBtw4PGksOG4oCZw4PigJrDgsKtbmltbyAyIGNhcmFjdGVyZXMgeSBtw4PGksOG4oCZw4PigJrDgsKheGltbyA4MFwiKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQoJHNjb3BlLm1haWx0ZW1wY2F0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jYXRlZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9ub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKFwiRGViZSBzZWxlY2Npb25hciB1biDDg8aSw4bigJnDg+KAmsOCwq10ZW0gZGVsIGxpc3RhZG8gZGUgY2F0ZWdvcsODxpLDhuKAmcOD4oCaw4LCrWFzXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vYWxlcnQoXCJEZWJlIHNlbGVjY2lvbmFyIHVuIMODxpLDhuKAmcOD4oCaw4LCrXRlbSBkZWwgbGlzdGFkbyBkZSBjYXRlZ29yw4PGksOG4oCZw4PigJrDgsKtYXNcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lTWFpbFRlbXBsYXRlOiAkc2NvcGUubmFtZW1haWx0ZW1wY2F0LFxyXG4gICAgICAgICAgICAgICAgICAgIG1haWxUZW1wbGF0ZUNhdGVnOiAkc2NvcGUubWFpbHRlbXBjYXQsXHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yOiAkc2NvcGUuZWRpdG9yXHJcbiAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lmcmFtZUVkaXRvcicpLmNvbnRlbnRXaW5kb3cuUmVjcmVhdGVFZGl0b3IoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLnNhdmVNYWlsQXNNYWlsVGVtcGxhdGUoZGF0YSwgbnVsbCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoXCIjc2F2ZU1haWxBc01haWxUZW1wbGF0ZVwiKS5tb2RhbChcImhpZGVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5hbWVtYWlsdGVtcGNhdCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tYWlsdGVtcGNhdCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lbXB0eSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5sZW5ndGggPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2F0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2Uuc3VjY2VzcyhkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAvLyBGaW4gZGUgdG9kbyBzb2JyZSBwYXNhciBtYWlsIGEgdGVtcGxhdGVcclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAkc2NvcGUuc3RhdHVzRnVuYyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FmdWVyYScpO1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuZmlsdGVyLm1haWxTdGF0dXMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5maWx0ZXIubWFpbFN0YXR1cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBZGVudHJvJyk7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5maWx0ZXIubWFpbFN0YXR1cyk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsID0gMDtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIH1dKVxyXG4gICAgICAgICAgLmNvbnRyb2xsZXIoJ2NvbnRlbnRDb250cm9sbGVyJywgWyckc2NvcGUnLCAncmVzdFNlcnZpY2UnLCAnJHN0YXRlUGFyYW1zJywgJyRyb290U2NvcGUnLCAnbm90aWZpY2F0aW9uU2VydmljZScsICckZmlsdGVyJywgJ3dpemFyZCcsIGZ1bmN0aW9uICgkc2NvcGUsIHJlc3RTZXJ2aWNlLCAkc3RhdGVQYXJhbXMsICRyb290U2NvcGUsIG5vdGlmaWNhdGlvblNlcnZpY2UsICRmaWx0ZXIsIHdpemFyZCkge1xyXG4gICAgICAgICAgICAgIHdpemFyZC5zZXRkZXNjcmliZShmYWxzZSk7XHJcbiAgICAgICAgICAgICAgd2l6YXJkLnNldGFkZHJlc3NlZXMoZmFsc2UpO1xyXG4gICAgICAgICAgICAgIHdpemFyZC5zZXRjb250ZW50KHRydWUpO1xyXG4gICAgICAgICAgICAgIHdpemFyZC5zZXRhZHZhbmNlb3B0aW9ucyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgd2l6YXJkLnNldHNoaXBwaW5nZGF0ZShmYWxzZSk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5hZGRyZXNzZWVzID0gd2l6YXJkLmdldGFkZHJlc3NlZXMoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmRlc2NyaWJlID0gd2l6YXJkLmdldGRlc2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5jb250ZW50ID0gd2l6YXJkLmdldGNvbnRlbnQoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmFkdmFuY2VvcHRpb25zID0gd2l6YXJkLmdldGFkdmFuY2VvcHRpb25zKCk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5zaGlwcGluZ2RhdGUgPSB3aXphcmQuZ2V0c2hpcHBpbmdkYXRlKCk7XHJcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5pZE1haWxHZXQgPSAkc3RhdGVQYXJhbXMuaWQ7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmlkTWFpbCA9ICRyb290U2NvcGUuaWRNYWlsR2V0O1xyXG4gICAgICAgICAgICAgICRzY29wZS5pbWFnZW5EYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgICAkc2NvcGUuaW1hZ2VuVGltZSA9ICRzY29wZS5pbWFnZW5EYXRlLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICBpZiAoIUlzTnVtZXJpYygkc3RhdGVQYXJhbXMuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLndhcm5pbmcoXCJFbCBjb3JyZW8gbm8gc2UgaGEgZW5jb250cmFkb1wiKTtcclxuICAgICAgICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSAnIy9iYXNpY2luZm9ybWF0aW9uLyc7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBJc051bWVyaWModmFsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVyKHBhcnNlRmxvYXQodmFsKSkgPT0gdmFsO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAkc2NvcGUuZ2V0Q29udGVudCA9IHt9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5zZXRQbGFuZSA9IHt9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5ib29sRWRpdG9ycyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLlBsYW5lRXJyb3IgPSB7fTtcclxuICAgICAgICAgICAgICBodG1sUHJldmlldygkc2NvcGUuaWRNYWlsKTtcclxuICAgICAgICAgICAgICByZXN0U2VydmljZS5nZXRDb250ZW50TWFpbCgkc2NvcGUuaWRNYWlsKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFkYXRhLmNvbnRlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmJvb2xFZGl0b3JzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldFRodW1ibmFpbE1haWwoJHN0YXRlUGFyYW1zLmlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVybFRodW1ibmFpbCA9IGRhdGEudGh1bWI7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuYm9vbEVkaXRvcnMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmdldENvbnRlbnQgPSBkYXRhLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zZXRQbGFuZS5jb250ZW50ID0gZGF0YS5jb250ZW50LnBsYWludGV4dDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAkc2NvcGUuYWRkcGxhaW50ZXh0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgIGlkTWFpbDogJHNjb3BlLmlkTWFpbCxcclxuICAgICAgICAgICAgICAgICAgcGxhaW50ZXh0OiAkc2NvcGUuc2V0UGxhbmUuY29udGVudFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmFkZFBsYWludGV4dChkYXRhKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5wcmltYXJ5KFwiU2UgaGEgbW9kaWZpY2FkbyBlbCB0ZXh0byBwbGFubyBkZWwgY29ycmVvXCIpO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2VNb2RhbCgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUub3Blbk1vZGFsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJCgnLmRpYWxvZycpLmFkZENsYXNzKCdkaWFsb2ctLW9wZW4nKTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJCgnLmRpYWxvZycpLnJlbW92ZUNsYXNzKCdkaWFsb2ctLW9wZW4nKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1dKVxyXG4gICAgICAgICAgLmNvbnRyb2xsZXIoJ2NvbnRlbnRFZGl0b3JDb250cm9sbGVyJywgWyckc2NvcGUnLCAncmVzdFNlcnZpY2UnLCAnbm90aWZpY2F0aW9uU2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsIHJlc3RTZXJ2aWNlLCBub3RpZmljYXRpb25TZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICRzY29wZS5yZWdpc3RlckNvbnRlbnQgPSBmdW5jdGlvbiAoaWRNYWlsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgZWRpdG9yOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWZyYW1lRWRpdG9yJykuY29udGVudFdpbmRvdy5jYXRjaEVkaXRvckRhdGEoKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmFkZENvbnRlbnRFZGl0b3IoaWRNYWlsLCBkYXRhKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgbG9jYXRpb24uaHJlZiA9IGZ1bGxVcmxCYXNlICsgdGVtcGxhdGVCYXNlICsgJy9jcmVhdGUjL2NvbnRlbnQvJyArIHJlc1snaWRNYWlsJ107XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5zYXZlQ29udGVudCA9IGZ1bmN0aW9uIChpZE1haWwpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICBlZGl0b3I6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZnJhbWVFZGl0b3InKS5jb250ZW50V2luZG93LmNhdGNoRWRpdG9yRGF0YSgpXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuYWRkQ29udGVudEVkaXRvcihpZE1haWwsIGRhdGEpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWZyYW1lRWRpdG9yJykuY29udGVudFdpbmRvdy5SZWNyZWF0ZUVkaXRvcigpO1xyXG4gICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLnN1Y2Nlc3MocmVzWydtc2cnXSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5lbXB0eSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5sZW5ndGggPSBmYWxzZTtcclxuICAgICAgICAgICAgICAkc2NvcGUuY2F0ZWcgPSBmYWxzZTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUuc2F2ZU1haWxBc01haWxUZW1wbGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKCRzY29wZS5uYW1lbWFpbHRlbXBjYXQpIHx8ICRzY29wZS5uYW1lbWFpbHRlbXBjYXQgPT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5lbXB0eSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5sZW5ndGggPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgLy9ub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKFwiRWwgY2FtcG8gZGUgbm9tYnJlIGRlIGxhIHBsYW50aWxsYSBubyBwdWVkZSBlc3RhciB2YWPDg8aSw4bigJnDg+KAmsOCwq1vXCIpO1xyXG4gICAgICAgICAgICAgICAgICAvL2FsZXJ0KFwiRWwgY2FtcG8gZGUgbm9tYnJlIGRlIGxhIHBsYW50aWxsYSBubyBwdWVkZSBlc3RhciB2YWPDg8aSw4bigJnDg+KAmsOCwq1vXCIpO1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm5hbWVtYWlsdGVtcGNhdC5sZW5ndGggPCAyIHx8ICRzY29wZS5uYW1lbWFpbHRlbXBjYXQubGVuZ3RoID4gODApIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmVtcHR5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5sZW5ndGggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAvL25vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoXCJFbCBjYW1wbyBkZSBub21icmUgZGUgbGEgcGxhbnRpbGxhIGRlYmUgdGVuZXIgbcODxpLDhuKAmcOD4oCaw4LCrW5pbW8gMiBjYXJhY3RlcmVzIHkgbcODxpLDhuKAmcOD4oCaw4LCoXhpbW8gODBcIik7XHJcbiAgICAgICAgICAgICAgICAgIC8vYWxlcnQoXCJFbCBjYW1wbyBkZSBub21icmUgZGUgbGEgcGxhbnRpbGxhIGRlYmUgdGVuZXIgbcODxpLDhuKAmcOD4oCaw4LCrW5pbW8gMiBjYXJhY3RlcmVzIHkgbcODxpLDhuKAmcOD4oCaw4LCoXhpbW8gODBcIik7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKCRzY29wZS5tYWlsdGVtcGNhdCkpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhdGVnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgLy9ub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKFwiRGViZSBzZWxlY2Npb25hciB1biDDg8aSw4bigJnDg+KAmsOCwq10ZW0gZGVsIGxpc3RhZG8gZGUgY2F0ZWdvcsODxpLDhuKAmcOD4oCaw4LCrWFzXCIpO1xyXG4gICAgICAgICAgICAgICAgICAvL2FsZXJ0KFwiRGViZSBzZWxlY2Npb25hciB1biDDg8aSw4bigJnDg+KAmsOCwq10ZW0gZGVsIGxpc3RhZG8gZGUgY2F0ZWdvcsODxpLDhuKAmcOD4oCaw4LCrWFzXCIpO1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgIG5hbWVNYWlsVGVtcGxhdGU6ICRzY29wZS5uYW1lbWFpbHRlbXBjYXQsXHJcbiAgICAgICAgICAgICAgICAgIG1haWxUZW1wbGF0ZUNhdGVnOiAkc2NvcGUubWFpbHRlbXBjYXQsXHJcbiAgICAgICAgICAgICAgICAgIGVkaXRvcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lmcmFtZUVkaXRvcicpLmNvbnRlbnRXaW5kb3cuY2F0Y2hFZGl0b3JEYXRhKClcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWZyYW1lRWRpdG9yJykuY29udGVudFdpbmRvdy5SZWNyZWF0ZUVkaXRvcigpO1xyXG4gICAgICAgICAgICAgICAgcmVzdFNlcnZpY2Uuc2F2ZU1haWxBc01haWxUZW1wbGF0ZShkYXRhLCBudWxsKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICQoXCIjc2F2ZU1haWxBc01haWxUZW1wbGF0ZVwiKS5tb2RhbChcImhpZGVcIik7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5uYW1lbWFpbHRlbXBjYXQgPSAnJztcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm1haWx0ZW1wY2F0ID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5lbXB0eSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubGVuZ3RoID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5jYXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5zdWNjZXNzKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5yZXN0YXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVtcHR5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubGVuZ3RoID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2F0ZWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5uYW1lbWFpbHRlbXBjYXQgPSAnJztcclxuICAgICAgICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgICAgIH1dKVxyXG4gICAgICAgICAgLmNvbnRyb2xsZXIoJ2NvbnRlbnRVcmxDb250cm9sbGVyJywgWyckc2NvcGUnLCAncmVzdFNlcnZpY2UnLCAnbm90aWZpY2F0aW9uU2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsIHJlc3RTZXJ2aWNlLCBub3RpZmljYXRpb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnRyaW1Db250ZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJCgnI3VybCcpLnZhbCgkKCcjdXJsJykudmFsKCkudHJpbSgpKTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICRzY29wZS5yZWdpc3RlckNvbnRlbnRVcmwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICBpZiAoJHNjb3BlLmNoZWNrYm94aW1hZ2UpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgdmFyIGltYWdlID0gJHNjb3BlLmNoZWNrYm94aW1hZ2U7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICBpbWFnZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2VuZERhdGEoXCJubyBsb2FkXCIpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgc2VuZERhdGEoaW1hZ2UpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgICRzY29wZS5zYXZlQ29udGVudCA9IGZ1bmN0aW9uIChpZE1haWwpIHtcclxuICAgICAgICAgICAgICAvLyAgICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAvLyAgICAgICAgICAgIGVkaXRvcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lmcmFtZUVkaXRvcicpLmNvbnRlbnRXaW5kb3cuY2F0Y2hFZGl0b3JEYXRhKClcclxuICAgICAgICAgICAgICAvLyAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIC8vICAgICAgICAgIHJlc3RTZXJ2aWNlLmFkZENvbnRlbnRFZGl0b3IoaWRNYWlsLCBkYXRhKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAvLyAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZnJhbWVFZGl0b3InKS5jb250ZW50V2luZG93LlJlY3JlYXRlRWRpdG9yKCk7XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLnN1Y2Nlc3MocmVzWydtc2cnXSk7XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgIH07XHJcbiAgICAgICAgICAgIH1dKVxyXG4gICAgICAgICAgLmNvbnRyb2xsZXIoJ2FkdmFuY2VvcHRpb25zQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJ3Jlc3RTZXJ2aWNlJywgJ25vdGlmaWNhdGlvblNlcnZpY2UnLCAnJHJvb3RTY29wZScsICckc3RhdGVQYXJhbXMnLCAnJG1kRGlhbG9nJywgJ0ZpbGVVcGxvYWRlcicsICd3aXphcmQnLCAnJEZCJywgJyRxJywgJ2NvbnN0YW50TWFpbCcsICckdGltZW91dCcsICckd2luZG93JywgZnVuY3Rpb24gKCRzY29wZSwgcmVzdFNlcnZpY2UsIG5vdGlmaWNhdGlvblNlcnZpY2UsICRyb290U2NvcGUsICRzdGF0ZVBhcmFtcywgJG1kRGlhbG9nLCBGaWxlVXBsb2FkZXIsIHdpemFyZCwgJEZCLCAkcSwgY29uc3RhbnRNYWlsLCAkdGltZW91dCwgJHdpbmRvdykge1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICRzY29wZS5ub3RpZmljYXRpb25zID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICRzY29wZS5ub3RpZmljYXRpb25FbWFpbHMgPSBcIlwiO1xyXG4gICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAkc2NvcGUuZGF0YWFkdiA9IFtdO1xyXG4gICAgICAgICAgICAgICRzY29wZS5kYXRhYWR2ID0ge307XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNpemVGaWxlcyA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICRzY29wZS5yZXN1bHQgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgdmFyIG51bSA9IDE7XHJcbiAgICAgICAgICAgICAgdmFyIG51bWJlcnMgPSBbXTtcclxuICAgICAgICAgICAgICB3aGlsZSAobnVtIDw9IDMwKSB7XHJcbiAgICAgICAgICAgICAgICBudW1iZXJzW251bV0gPSBudW07XHJcbiAgICAgICAgICAgICAgICBudW0rKztcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgJHNjb3BlLm51bWJlcnMgPSBudW1iZXJzO1xyXG4gICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAkc2NvcGUudHlwZXNUaW1lcyA9IHR5cGVzVGltZXM7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnR5cGVzVGltZXMgPSB7aG91cjogXCJob3Jhc1wiLCBkYXk6IFwiZMOtYXNcIiwgd2VlazogXCJzZW1hbmFzXCJ9O1xyXG4gICAgICAgICAgICAgIC8vICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUubnVtYmVycyk7XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS50eXBlc1RpbWVzKTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZGF0YWFkdi5ub3RpZmljYXRpb25zID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmRhdGFhZHYubm90aWZpY2F0aW9uRW1haWxzID0gXCJcIjtcclxuICAgICAgICAgICAgICAkc2NvcGUuZGF0YWFkdi5zdGF0aXN0aWNzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmRhdGFhZHYuc3RhdGlzdGljc0VtYWlscyA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgd2l6YXJkLnNldGRlc2NyaWJlKGZhbHNlKTtcclxuICAgICAgICAgICAgICB3aXphcmQuc2V0YWRkcmVzc2VlcyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgd2l6YXJkLnNldGNvbnRlbnQoZmFsc2UpO1xyXG4gICAgICAgICAgICAgIHdpemFyZC5zZXRhZHZhbmNlb3B0aW9ucyh0cnVlKTtcclxuICAgICAgICAgICAgICB3aXphcmQuc2V0c2hpcHBpbmdkYXRlKGZhbHNlKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmFkZHJlc3NlZXMgPSB3aXphcmQuZ2V0YWRkcmVzc2VlcygpO1xyXG4gICAgICAgICAgICAgICRyb290U2NvcGUuZGVzY3JpYmUgPSB3aXphcmQuZ2V0ZGVzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmNvbnRlbnQgPSB3aXphcmQuZ2V0Y29udGVudCgpO1xyXG4gICAgICAgICAgICAgICRyb290U2NvcGUuYWR2YW5jZW9wdGlvbnMgPSB3aXphcmQuZ2V0YWR2YW5jZW9wdGlvbnMoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLnNoaXBwaW5nZGF0ZSA9IHdpemFyZC5nZXRzaGlwcGluZ2RhdGUoKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLmlkTWFpbEdldCA9ICRzdGF0ZVBhcmFtcy5pZDtcclxuICAgICAgICAgICAgICAkc2NvcGUuaXNNb2RhbCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgaWYgKCFJc051bWVyaWMoJHN0YXRlUGFyYW1zLmlkKSkge1xyXG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS53YXJuaW5nKFwiRWwgY29ycmVvIG5vIHNlIGhhIGVuY29udHJhZG9cIik7XHJcbiAgICAgICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gJyMvYmFzaWNpbmZvcm1hdGlvbi8nO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gSXNOdW1lcmljKHZhbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcihwYXJzZUZsb2F0KHZhbCkpID09IHZhbDtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmlkTWFpbCA9ICRyb290U2NvcGUuaWRNYWlsR2V0O1xyXG4gICAgICAgICAgICAgICRzY29wZS5zdGF0dXMgPSAnICAnO1xyXG4gICAgICAgICAgICAgICRzY29wZS5jdXN0b21GdWxsc2NyZWVuID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmRlbGV0ZUF0dGFjaGVkID0gZnVuY3Rpb24gKGlkLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZGVsZXRlQXR0YWNoZWQoaWQpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuYXR0YWNoKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIERpYWxvZ0NvbnRyb2xsZXIoJHNjb3BlLCAkbWREaWFsb2cpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5oaWRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICRtZERpYWxvZy5jYW5jZWwoKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAkKCcjYWRqdW4nKS5tb2RhbCgnaGlkZScpO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0RmlsZSgpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgdmFyIHVwbG9hZFVybCA9IGZ1bGxVcmxCYXNlICsgXCJnYWxsZXJ5L3VwbG9hZGZpbGVhZGp1bnQvXCIgKyAkc2NvcGUuaWRNYWlsO1xyXG4gICAgICAgICAgICAgIHZhciB1cGxvYWRlciA9ICRzY29wZS51cGxvYWRlciA9IG5ldyBGaWxlVXBsb2FkZXIoe1xyXG4gICAgICAgICAgICAgICAgdXJsOiB1cGxvYWRVcmxcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAvLyBGSUxURVJTXHJcbiAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAvLyAgICAgICAgdXBsb2FkZXIuZmlsdGVycy5wdXNoKHtcclxuICAgICAgICAgICAgICAvLyAgICAgICAgICBuYW1lOiAnY3VzdG9tRmlsdGVyJyxcclxuICAgICAgICAgICAgICAvLyAgICAgICAgICBmbjogZnVuY3Rpb24gKGl0ZW0gLyp7RmlsZXxGaWxlTGlrZU9iamVjdH0qLywgb3B0aW9ucykge1xyXG4gICAgICAgICAgICAgIC8vICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVldWUubGVuZ3RoIDwgMTA7XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIC8vICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgIHVwbG9hZGVyLm9uV2hlbkFkZGluZ0ZpbGVGYWlsZWQgPSBmdW5jdGlvbiAoaXRlbSAvKntGaWxlfEZpbGVMaWtlT2JqZWN0fSovLCBmaWx0ZXIsIG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5pbmZvKCdvbldoZW5BZGRpbmdGaWxlRmFpbGVkJywgaXRlbSwgZmlsdGVyLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIHVwbG9hZGVyLm9uQWZ0ZXJBZGRpbmdGaWxlID0gZnVuY3Rpb24gKGZpbGVJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUuaW5mbygnb25BZnRlckFkZGluZ0ZpbGUnLCBmaWxlSXRlbSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAkc2NvcGUuYXJyRmlsZVBlbmRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnVwbG9hZGVyLnF1ZXVlWyRzY29wZS51cGxvYWRlci5xdWV1ZS5sZW5ndGggLSAxXS51cGxvYWQoKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIHVwbG9hZGVyLm9uQWZ0ZXJBZGRpbmdBbGwgPSBmdW5jdGlvbiAoYWRkZWRGaWxlSXRlbXMpIHtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5pbmZvKCdvbkFmdGVyQWRkaW5nQWxsJywgYWRkZWRGaWxlSXRlbXMpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgdXBsb2FkZXIub25CZWZvcmVVcGxvYWRJdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5pbmZvKCdvbkJlZm9yZVVwbG9hZEl0ZW0nLCBpdGVtKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIHVwbG9hZGVyLm9uUHJvZ3Jlc3NJdGVtID0gZnVuY3Rpb24gKGZpbGVJdGVtLCBwcm9ncmVzcykge1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmluZm8oJ29uUHJvZ3Jlc3NJdGVtJywgZmlsZUl0ZW0sIHByb2dyZXNzKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIHVwbG9hZGVyLm9uUHJvZ3Jlc3NBbGwgPSBmdW5jdGlvbiAocHJvZ3Jlc3MpIHtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5pbmZvKCdvblByb2dyZXNzQWxsJywgcHJvZ3Jlc3MpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgdXBsb2FkZXIub25TdWNjZXNzSXRlbSA9IGZ1bmN0aW9uIChmaWxlSXRlbSwgcmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycykge1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmluZm8oJ29uU3VjY2Vzc0l0ZW0nLCBmaWxlSXRlbSwgcmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycyk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICB1cGxvYWRlci5vbkVycm9ySXRlbSA9IGZ1bmN0aW9uIChmaWxlSXRlbSwgcmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycykge1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmluZm8oJ29uRXJyb3JJdGVtJywgZmlsZUl0ZW0sIHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgdXBsb2FkZXIub25DYW5jZWxJdGVtID0gZnVuY3Rpb24gKGZpbGVJdGVtLCByZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUuaW5mbygnb25DYW5jZWxJdGVtJywgZmlsZUl0ZW0sIHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgdXBsb2FkZXIub25Db21wbGV0ZUl0ZW0gPSBmdW5jdGlvbiAoZmlsZUl0ZW0sIHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUuaW5mbygnb25Db21wbGV0ZUl0ZW0nLCBmaWxlSXRlbSwgcmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycyk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICB1cGxvYWRlci5vbkNvbXBsZXRlQWxsID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5hdHRhY2goKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICRzY29wZS5hcnJGaWxlUGVuZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmluZm8oJ29uQ29tcGxldGVBbGwnKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5pZE1haWwpO1xyXG4gICAgICAgICAgICAgICRzY29wZS5zaG93VGFiRGlhbG9nID0gZnVuY3Rpb24gKGV2KSB7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA9IDA7XHJcbiAgICAgICAgICAgICAgICAkbWREaWFsb2cuc2hvdyh7XHJcbiAgICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUuJG5ldygpLFxyXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIG1kRGlhbG9nOiAkbWREaWFsb2csXHJcbiAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IERpYWxvZ0NvbnRyb2xsZXIsXHJcbiAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndGFiRGlhbG9nLnRtcGwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgIHBhcmVudDogYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmJvZHkpLFxyXG4gICAgICAgICAgICAgICAgICB0YXJnZXRFdmVudDogZXYsXHJcbiAgICAgICAgICAgICAgICAgIGNsaWNrT3V0c2lkZVRvQ2xvc2U6IHRydWVcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGFuc3dlcikge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdHVzID0gJ1lvdSBzYWlkIHRoZSBpbmZvcm1hdGlvbiB3YXMgXCInICsgYW5zd2VyICsgJ1wiLic7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zdGF0dXMgPSAnWW91IGNhbmNlbGxlZCB0aGUgZGlhbG9nLic7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgICRzY29wZS51cGxvYWRlclR3byA9IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gICAgICAvKnZhciBoYXNoTG9jYWwgID0gbG9jYXRpb24uaGFzaDtcclxuICAgICAgICAgICAgICAgICAgdmFyIGFycmF5VGVtcCA9IGhhc2hMb2NhbC5zcGxpdChcIi9cIik7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBpZE1haWwgPSBhcnJheVRlbXBbJzInXTsqL1xyXG5cclxuICAgICAgICAgICAgICAgICAgdmFyIHVwbG9hZGVyID0gbmV3IHBsdXBsb2FkLlVwbG9hZGVyKHtcclxuICAgICAgICBicm93c2VfYnV0dG9uIDogJ3BpY2tmaWxlcycsIC8vIHlvdSBjYW4gcGFzcyBpbiBpZC4uLlxyXG4gICAgICAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhaW5lcicpLCBcclxuICAgICAgICAvL3VybDogXCJ7e3VybCgnbWFpbC9sb2FkcGRmJyl9fS9cIitpZE1haWwsXHJcbiAgICAgICAgdXJsOiBcIi4uLy4uL21haWwvbG9hZHBkZi9cIiskc2NvcGUuaWRNYWlsLFxyXG4gICAgICAgIGZpbGVfZGF0YV9uYW1lOiBcImZpbGVcIixcclxuICAgICAgICBmaWx0ZXJzIDoge1xyXG4gICAgICAgICAgICBtYXhfZmlsZV9zaXplIDogJzUwMG1iJyxcclxuICAgICAgICAgICAgbWltZV90eXBlczogW1xyXG4gICAgICB7dGl0bGUgOiBcIlppcCBmaWxlc1wiLCBleHRlbnNpb25zIDogXCJ6aXBcIn1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgfSxcclxuICAgICAgICAvLyBGbGFzaCBzZXR0aW5nc1xyXG4gICAgICAgIGZsYXNoX3N3Zl91cmwgOiAnL3BsdXBsb2FkL2pzL01veGllLnN3ZicsXHJcbiAgICAgICAgLy8gU2lsdmVybGlnaHQgc2V0dGluZ3NcclxuICAgICAgICBzaWx2ZXJsaWdodF94YXBfdXJsIDogJy9wbHVwbG9hZC9qcy9Nb3hpZS54YXAnLFxyXG4gICAgICAgIG11bHRpX3NlbGVjdGlvbjogZmFsc2UsXHJcbiAgICAgICAgcmVuYW1lOiB0cnVlLFxyXG4gICAgICAgIHNvcnRhYmxlOiB0cnVlLFxyXG4gICAgICAgIGRyYWdkcm9wOiB0cnVlLFxyXG5cclxuICAgICAgICB2aWV3czoge1xyXG4gICAgICAgICAgICBsaXN0OiBmYWxzZSxcclxuICAgICAgICAgICAgdGh1bWJzOiBmYWxzZVxyXG4gICAgICAgIH0sICAgICAgICBcclxuXHJcbiAgICAgICAgaW5pdDoge1xyXG4gICAgICAgICAgICBQb3N0SW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZWxpc3QnKS5pbm5lckhUTUwgPSAnJztcclxuXHJcbiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXBsb2FkZmlsZXMnKS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgdXBsb2FkZXIuc3RhcnQoKVxyXG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICBGaWxlc0FkZGVkOiBmdW5jdGlvbih1cCwgZmlsZXMpIHtcclxuICAgICAgICAgIHBsdXBsb2FkLmVhY2goZmlsZXMsIGZ1bmN0aW9uKGZpbGUpIHtcclxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVsaXN0JykuaW5uZXJIVE1MICs9ICc8ZGl2IGlkPVwiJyArIGZpbGUuaWQgKyAnXCI+JyArIGZpbGUubmFtZSArICcgKCcgKyBwbHVwbG9hZC5mb3JtYXRTaXplKGZpbGUuc2l6ZSkgKyAnKSA8Yj48L2I+PC9kaXY+JztcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIFVwbG9hZFByb2dyZXNzOiBmdW5jdGlvbih1cCwgZmlsZSkge1xyXG4gICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZmlsZS5pZCkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2InKVswXS5pbm5lckhUTUwgPSAnPHNwYW4+JyArIGZpbGUucGVyY2VudCArIFwiJTwvc3Bhbj5cIjtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgRmlsZVVwbG9hZGVkOiBmdW5jdGlvbih1cCwgZXJyKSB7XHJcblxyXG4gICAgICAgICAgcmVzdFNlcnZpY2UuZ2V0VGFibGVSZXN1bHRzKCRzY29wZS5pZE1haWwpXHJcbiAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsgXHJcbiAgICAgICAgICAgICAkc2NvcGUuZmlsZWFkanVudHBkZiA9IGRhdGE7XHJcbiAgICAgICAgICAgICAkc2NvcGUucmVzdWx0ID0gZGF0YTsgXHJcbiAgICAgICAgICAgICBpZihkYXRhLnVwbG9hZHN0YXR1cyA9PSBcImVycm9yXCIpe1xyXG4gICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoXCJBaCBvY3VycmlkbyB1biBlcnJvciB2YWxpZGFuZG8gZWwgYXJjaGl2byBxdWUgZXN0YXMgaW50ZW50YW5kbyBjYXJnYXIsXCIpO1xyXG4gICAgICAgICAgICAgICAgIC8vZGVibyBkZSBoYWNlciBsb3MgbW92aW1pZW50b3MgYSBsYSBpbnZlcnNhIHBhcmEgcXVlIHB1ZWRhIGNhcmdhciB1biBhcmNoaXZvIG51ZXZhbWVudGUgZW4gbGEgdmlzdGEuXHJcbiAgICAgICAgICAgICAgICAgJCgnI25leHQnKS5oaWRlKCdzbG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgJCgnI2dvZ28nKS5oaWRlKCdzbG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgJCgnI3Jlc3VtZScpLmhpZGUoJ3Nsb3cnKTtcclxuICAgICAgICAgICAgICAgICAkKCcjYnV0dG9ucycpLnNob3coJ3Nsb3cnKTtcclxuICAgICAgICAgICAgICAgICAkKCcjaHRhYjMnKS5zaG93KCdzbG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgJCgnI2ZpbGVsaXN0Jykuc2hvdygnc2xvdycpO1xyXG4gICAgICAgICAgICAgICAgICQoJyNjb250YWluZXInKS5zaG93KCdzbG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVsaXN0JykuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgfSlcclxuICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGRhdGEpIHsgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhKTsgfSk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgICQoJyNuZXh0Jykuc2hvdygnc2xvdycpO1xyXG4gICAgICAgICAgJCgnI2dvZ28nKS5zaG93KCdzbG93Jyk7XHJcbiAgICAgICAgICAkKCcjcmVzdW1lJykuc2hvdygnc2xvdycpO1xyXG4gICAgICAgICAgJCgnI2J1dHRvbnMnKS5oaWRlKCdzbG93Jyk7XHJcbiAgICAgICAgICAkKCcjaHRhYjMnKS5oaWRlKCdzbG93Jyk7XHJcbiAgICAgICAgICAkKCcjZmlsZWxpc3QnKS5oaWRlKCdzbG93Jyk7XHJcbiAgICAgICAgICAkKCcjY29udGFpbmVyJykuaGlkZSgnc2xvdycpO1xyXG5cclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIEVycm9yOiBmdW5jdGlvbih1cCwgZXJyKSB7XHJcbiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uc29sZScpLmlubmVySFRNTCArPSBcIlxcbkVycm9yICNcIiArIGVyci5jb2RlICsgXCI6IFwiICsgZXJyLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgIHVwbG9hZGVyLmluaXQoKTtcclxuICAgICAgXHJcbiAgICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgJHNjb3BlLnVwbG9hZGVyVHdvKCk7IC8vaW5pY2lhbGl6YW5kbyBlbCBtb2R1bG8gcHVlc3RvLi4uXHJcblxyXG4gICAgICAgICAgICAgICRzY29wZS5hbnN3ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkKCcjYWRqdW4nKS5tb2RhbCgnaGlkZScpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgIHBydWViYSgkc2NvcGUuaWRNYWlsKTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZmlsZWFkanVudCA9IFtdO1xyXG4gICAgICAgICAgICAgICRzY29wZS5maWxlYWRqdW50cGRmID0gW107XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmZpbGVTZWxlY3RlZHMgPSBbXTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZGl2ZmlsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgICRzY29wZS50YWJsb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgIC8vICAgICAgICAgICRzY29wZS5kaXZmaWxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgIH1cclxuICAgICAgICAgICAgICAvLyAgICAgICAgJHNjb3BlLnRhYmdhbGxlcnkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgICAgJHNjb3BlLmRpdmZpbGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIC8vICAgICAgICB9XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmNvdW50ID0gMDtcclxuICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbCA9IDA7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgPSAxO1xyXG4gICAgICAgICAgICAgICRzY29wZS5oaWRlZmlsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5zZWFyY2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZm9yd2FyZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsICs9IDE7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucGFnZSArPSAxO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmZhc3Rmb3J3YXJkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmluaXRpYWwgPSAoJHNjb3BlLmdhbGxlcnkudG90YWxfcGFnZXMgLSAxKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYWdlID0gJHNjb3BlLmdhbGxlcnkudG90YWxfcGFnZXM7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuYmFja3dhcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbCAtPSAxO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgLT0gMTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5mYXN0YmFja3dhcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbCA9IDA7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucGFnZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAkc2NvcGUuYWRkRmlsZSgpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldEFsbEdhbGxlcnkoJHNjb3BlLmluaXRpYWwpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmdhbGxlcnkgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuYXR0YWNoKCk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5hdHRhY2hwZGYoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmF0dGFjaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldEFsbEF0dGFjaG1lbnQoJHNjb3BlLmlkTWFpbCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZmlsZWFkanVudCA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zaXplRmlsZXMgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZmlsZVNlbGVjdGVkcyA9IGFuZ3VsYXIuY29weSgkc2NvcGUuZmlsZWFkanVudCk7XHJcbiAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZmlsZWFkanVudC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmhpZGVmaWxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0RmlsZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zZXRTaXplRmlsZSgpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5hdHRhY2hwZGYgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXN0U2VydmljZS5nZXRBbGxBdHRhY2htZW50cGRmKCRzY29wZS5pZE1haWwpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpbGVhZGp1bnRwZGYgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUucmVzdWx0ID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNpemVGaWxlcyA9IDA7XHJcbiAgICAgICAgICAgICAgICAgIC8vJHNjb3BlLmZpbGVTZWxlY3RlZHMgPSBhbmd1bGFyLmNvcHkoJHNjb3BlLmZpbGVhZGp1bnRwZGYpO1xyXG4gICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmZpbGVhZGp1bnRwZGYuZmlsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNuZXh0Jykuc2hvdygnc2xvdycpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNnb2dvJykuc2hvdygnc2xvdycpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNyZXN1bWUnKS5zaG93KCdzbG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI2J1dHRvbnMnKS5oaWRlKCdzbG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI2h0YWIzJykuaGlkZSgnc2xvdycpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNmaWxlbGlzdCcpLmhpZGUoJ3Nsb3cnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjY29udGFpbmVyJykuaGlkZSgnc2xvdycpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5zZXRTaXplRmlsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gJHNjb3BlLmZpbGVhZGp1bnQpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNpemVGaWxlcyA9ICRzY29wZS5zaXplRmlsZXMgKyBwYXJzZUludCgkc2NvcGUuZmlsZWFkanVudFtpXS5zaXplKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICRzY29wZS5zZWxlY3RGaWxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZ2FsbGVyeVswXS5pdGVtcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZ2FsbGVyeVswXS5pdGVtc1tpXS5jbGFzcyA9IHt9XHJcbiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogaW4gJHNjb3BlLmZpbGVhZGp1bnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmZpbGVhZGp1bnRbal0uaWRBc3NldCA9PSAkc2NvcGUuZ2FsbGVyeVswXS5pdGVtc1tpXS5pZEFzc2V0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ2FsbGVyeVswXS5pdGVtc1tpXS5jbGFzcy5ib3JkZXIgPSBcIjFweCBzb2xpZCByZWRcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5nYWxsZXJ5WzBdLml0ZW1zW2ldLmNsYXNzLm9wYWNpdHkgPSAwLjU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRBc3NldCA9IGZ1bmN0aW9uIChkYXRhLCAkaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIHZhciB4ID0gJHNjb3BlLmdhbGxlcnlbMF0uaXRlbXNbJGluZGV4XTtcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZCh4LmNsYXNzKSAmJiAhYW5ndWxhci5lcXVhbHMoeC5jbGFzcywge30pKSB7XHJcbiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gJHNjb3BlLmZpbGVTZWxlY3RlZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmZpbGVTZWxlY3RlZHNbaV0uaWRBc3NldCA9PSBkYXRhLmlkQXNzZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5maWxlU2VsZWN0ZWRzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmdhbGxlcnlbMF0uaXRlbXNbJGluZGV4XS5jbGFzcyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpbGVTZWxlY3RlZHMucHVzaChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmdhbGxlcnlbMF0uaXRlbXNbJGluZGV4XS5jbGFzcyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZ2FsbGVyeVswXS5pdGVtc1skaW5kZXhdLmNsYXNzLmJvcmRlciA9IFwiMXB4IHNvbGlkIHJlZFwiO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZ2FsbGVyeVswXS5pdGVtc1skaW5kZXhdLmNsYXNzLm9wYWNpdHkgPSAwLjU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuYWRkRmlsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgIGlmKCRzY29wZS5hcnJGaWxlUGVuZGluZyl7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICRzY29wZS51cGxvYWRlci51cGxvYWRBbGwoKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5maWxlU2VsZWN0ZWRzKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZmlsZVNlbGVjdGVkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5oaWRlZmlsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGU6ICRzY29wZS5maWxlU2VsZWN0ZWRzLFxyXG4gICAgICAgICAgICAgICAgICAgIGlkTWFpbDogJHNjb3BlLmlkTWFpbFxyXG4gICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICByZXN0U2VydmljZS5hZGRBZGp1bnQoZGF0YSkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmF0dGFjaCgpO1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vJHNjb3BlLmFuc3dlcignbm90IHVzZWZ1bCcpO1xyXG4gICAgICAgICAgICAgICAgJCgnI2FkanVuJykubW9kYWwoJ2hpZGUnKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5hZGRGaWxlTG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coMTIzKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICQoXCIjbXlNb2RhbFwiKS5tb2RhbChcImhpZGVcIik7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmdvb2dsZUFuYWx5dGljc0xpbmsgPSBbXTtcclxuICAgICAgICAgICAgICAkc2NvcGUuc2hvd0xpbmtzR29vZ2xlQW5hbHl0aWNzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmdvb2dsZUFuYWx5dGljcyA9IHtsaW5rczogW10sIGNhbXBhaWduTmFtZTogXCJcIiwgaWRNYWlsOiAkc3RhdGVQYXJhbXMuaWR9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5kaXNhYmxlZFNlbmREYXRhR29vZ2xlQW5hbHl0aWNzID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICRzY29wZS5zZW5kRGF0YUdvb2dsZUFuYWx5dGljcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZ29vZ2xlQW5hbHl0aWNzLmNhbXBhaWduTmFtZS5sZW5ndGggPCAyIHx8ICRzY29wZS5nb29nbGVBbmFseXRpY3MubGlua3MubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihcIkxvcyBjYW1wb3Mgbm9tYnJlIGRlIGNhbXBhw7FhIHkgc2VndWltaWVudG8gZGUgR29vZ2xlIEFuYWx5dGljcyBubyBwdWVkZW4gZXN0YXIgdmFjaW9zLlwiKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLnNlbmREYXRhR29vZ2xlQW5hbGl0aWNzKCRzY29wZS5nb29nbGVBbmFseXRpY3MpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5hY3Rpb24gPT0gXCJjcmVhdGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5zdWNjZXNzKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UucHJpbWFyeShkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuY2xlYXJEYXRhR29vZ2xlQW5hbHl0aWNzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdvb2dsZUFuYWx5dGljcy5jYW1wYWlnbk5hbWUgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdvb2dsZUFuYWx5dGljcy5saW5rcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgLy8kc2NvcGUuZGF0YUdvb2dsZUFuYWx5dGljcyA9IHt9O1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmRpc2NhcmRDaGFuZ2VzR29vZ2xlQW5hbHl0aWNzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dMaW5rc0dvb2dsZUFuYWx5dGljcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdvb2dsZUFuYWx5dGljcy5jYW1wYWlnbk5hbWUgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdvb2dsZUFuYWx5dGljcy5saW5rcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgLy8kc2NvcGUuZGF0YUdvb2dsZUFuYWx5dGljcyA9IHt9O1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmNoYW5nZU5vdGlmaWNhdGlvbnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI25vdGlmaWNhdGlvbkFyZWFcIikucmVtb3ZlQ2xhc3MoXCJlcnJvci1mb2N1c1wiKTtcclxuICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLm5vdGlmaWNhdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGFhZHYubm90aWZpY2F0aW9uRW1haWxzID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgJChcIiNhZHZlcnQtZXJyb3JcIikucmVtb3ZlQ2xhc3MoJ2NvbG9yLWRhbmdlcicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLmRhdGFhZHYubm90aWZpY2F0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuZGF0YWFkdi5ub3RpZmljYXRpb25FbWFpbHMpO1xyXG5cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmNoYW5nZVN0YXRpc3RpY3MgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3N0YXRpc3RpY3NBcmVhXCIpLnJlbW92ZUNsYXNzKFwiZXJyb3ItZm9jdXNcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5zdGF0aXN0aWNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhYWR2LnN0YXRpc3RpY3NFbWFpbHMgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YWFkdi5xdWFudGl0eSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhYWR2LnR5cGVUaW1lID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgJChcIiNhZHZlcnQtZXJyb3Itc3RhdGlzdGljc1wiKS5yZW1vdmVDbGFzcygnY29sb3ItZGFuZ2VyJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuZGF0YWFkdi5zdGF0aXN0aWNzKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5kYXRhYWR2LnN0YXRpc3RpY3MpO1xyXG5cclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICRzY29wZS52YWxpZGF0ZUVtYWlsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJChcIiNub3RpZmljYXRpb25BcmVhXCIpLnJlbW92ZUNsYXNzKFwiZXJyb3ItZm9jdXNcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgbm90RW1haWxzID0gJHNjb3BlLmRhdGFhZHYubm90aWZpY2F0aW9uRW1haWxzLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29udCA9IDA7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmUgPSAvXigoW148PigpW1xcXVxcXFwuLDs6XFxzQFxcXCJdKyhcXC5bXjw+KClbXFxdXFxcXC4sOzpcXHNAXFxcIl0rKSopfChcXFwiLitcXFwiKSlAKChcXFtbMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XFxdKXwoKFthLXpBLVpcXC0wLTldK1xcLikrW2EtekEtWl17Mix9KSkkLztcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBub3RFbWFpbHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKCFyZS50ZXN0KG5vdEVtYWlsc1tpXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250Kys7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgIC5sb2cubG9nKFwiRWwgYXJyYXkgdGllbmUgXCIgKyBub3RFbWFpbHMubGVuZ3RoICsgXCIgcG9zaWNpb25lcyB5IHN1IGNvbnRlbmlkbyBlcyAnXCIgKyBub3RFbWFpbHNbMF0gKyBcIicgZW4gc3UgcG9zaWNpb24gMFwiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjb250ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAkKFwiI25vdGlmaWNhdGlvbkFyZWFcIikuYWRkQ2xhc3MoJ2Vycm9yLWZvY3VzJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG5vdEVtYWlscy5sZW5ndGggPT0gMSAmJiBub3RFbWFpbHNbMF0gPT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgJChcIiNub3RpZmljYXRpb25BcmVhXCIpLnJlbW92ZUNsYXNzKFwiZXJyb3ItZm9jdXNcIik7XHJcbiAgICAgICAgICAgICAgICAgICQoXCIjYWR2ZXJ0LWVycm9yXCIpLnJlbW92ZUNsYXNzKCdjb2xvci1kYW5nZXInKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUG9zaWNpb25lczogXCIgKyBub3RFbWFpbHMubGVuZ3RoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobm90RW1haWxzLmxlbmd0aCA+IDgpIHtcclxuICAgICAgICAgICAgICAgICAgJChcIiNub3RpZmljYXRpb25BcmVhXCIpLmFkZENsYXNzKCdlcnJvci1mb2N1cycpO1xyXG4gICAgICAgICAgICAgICAgICAkKFwiI2FkdmVydC1lcnJvclwiKS5hZGRDbGFzcygnY29sb3ItZGFuZ2VyJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAkKFwiI2FkdmVydC1lcnJvclwiKS5yZW1vdmVDbGFzcygnY29sb3ItZGFuZ2VyJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAkc2NvcGUudmFsaWRhdGVFbWFpbFN0YXRpc3RpY3MgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3N0YXRpc3RpY3NBcmVhXCIpLnJlbW92ZUNsYXNzKFwiZXJyb3ItZm9jdXNcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgbm90RW1haWxzID0gJHNjb3BlLmRhdGFhZHYuc3RhdGlzdGljc0VtYWlscy5zcGxpdCgnLCcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbnQgPSAwO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlID0gL14oKFtePD4oKVtcXF1cXFxcLiw7Olxcc0BcXFwiXSsoXFwuW148PigpW1xcXVxcXFwuLDs6XFxzQFxcXCJdKykqKXwoXFxcIi4rXFxcIikpQCgoXFxbWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcXSl8KChbYS16QS1aXFwtMC05XStcXC4pK1thLXpBLVpdezIsfSkpJC87XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbm90RW1haWxzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmICghcmUudGVzdChub3RFbWFpbHNbaV0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udCsrO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVsIGFycmF5IHRpZW5lIFwiICsgbm90RW1haWxzLmxlbmd0aCArIFwiIHBvc2ljaW9uZXMgeSBzdSBjb250ZW5pZG8gZXMgJ1wiICsgbm90RW1haWxzWzBdICsgXCInIGVuIHN1IHBvc2ljaW9uIDBcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgJChcIiNzdGF0aXN0aWNzQXJlYVwiKS5hZGRDbGFzcygnZXJyb3ItZm9jdXMnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobm90RW1haWxzLmxlbmd0aCA9PSAxICYmIG5vdEVtYWlsc1swXSA9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAkKFwiI3N0YXRpc3RpY3NBcmVhXCIpLnJlbW92ZUNsYXNzKFwiZXJyb3ItZm9jdXNcIik7XHJcbiAgICAgICAgICAgICAgICAgICQoXCIjYWR2ZXJ0LWVycm9yLXN0YXRpc3RpY3NcIikucmVtb3ZlQ2xhc3MoJ2NvbG9yLWRhbmdlcicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJQb3NpY2lvbmVzOiBcIiArIG5vdEVtYWlscy5sZW5ndGgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChub3RFbWFpbHMubGVuZ3RoID4gOCkge1xyXG4gICAgICAgICAgICAgICAgICAkKFwiI3N0YXRpc3RpY3NBcmVhXCIpLmFkZENsYXNzKCdlcnJvci1mb2N1cycpO1xyXG4gICAgICAgICAgICAgICAgICAkKFwiI2FkdmVydC1lcnJvci1zdGF0aXN0aWNzXCIpLmFkZENsYXNzKCdjb2xvci1kYW5nZXInKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICQoXCIjYWR2ZXJ0LWVycm9yLXN0YXRpc3RpY3NcIikucmVtb3ZlQ2xhc3MoJ2NvbG9yLWRhbmdlcicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICRzY29wZS5zZW5kRGF0YUZvclRhYmxlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcImVzdGEgZW50cmFuZG8gYWwgbWV0b2RvIHhEXCIpOyAgXHJcbiAgICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldFRhYmxlUmVzdWx0cygkc2NvcGUuaWRNYWlsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkgeyAkc2NvcGUucmVzdWx0ID0gZGF0YTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChkYXRhKSB7IG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YSk7IH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAvL0FQUCBGQUNFQk9PS1xyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIE1vZGFsUGFnZUZhY2Vib29rQ3RybCgkc2NvcGUsICRtZERpYWxvZywgcGFnZXMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYWdlcyA9IHBhZ2VzXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaGlkZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgJG1kRGlhbG9nLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2VEaWFsb2cgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICRtZERpYWxvZy5jYW5jZWwoKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRQYWdlID0gZnVuY3Rpb24gKHBhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgJG1kRGlhbG9nLmhpZGUocGFnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAkc2NvcGUuYXBwRmFjZWJvb2sgPSB7XHJcbiAgICAgICAgICAgICAgICBmYW5QYWdlU2VsZWN0ZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgY2hlY2tQZXJtaXNzaW9uRmFjZWJvb2tQYWdlOiBmdW5jdGlvbiAocGFnZSkge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IGRlZmVyLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBhcnJQYWdlUmV0dXJuID0ge2RhdGE6IFtdfTtcclxuICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBwYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYWdlW2ldLnBlcm1zLmluZGV4T2YoY29uc3RhbnRNYWlsLnBlcm1pc3Npb25GQkFkbWluKSAhPSBcIm51bWJlclwiIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgcGFnZVtpXS5wZXJtcy5pbmRleE9mKGNvbnN0YW50TWFpbC5wZXJtaXNzaW9uRkJCYXNpY0FkbWluKSAhPSBcIm51bWJlclwiIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgcGFnZVtpXS5wZXJtcy5pbmRleE9mKGNvbnN0YW50TWFpbC5wZXJtaXNzaW9uRkJDcmVhdGVDb250ZW50KSAhPSBcIm51bWJlclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYXJyUGFnZVJldHVybi5kYXRhLnB1c2gocGFnZVtpXSk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgaWYgKGFyclBhZ2VSZXR1cm4uZGF0YS5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChjb25zdGFudE1haWwuZXJyb3JMZW5ndGhGYW5QYWdlKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKGFyclBhZ2VSZXR1cm4pO1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjaGFuZ2VTd2l0Y2g6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hcHBGYWNlYm9vay5mYWNlYm9vaykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5mYW5QYWdlU2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGYWNlYm9vay5sb2dpbihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGxvZ2luOiBmdW5jdGlvbiAob2JqUGFnZSkge1xyXG4gICAgICAgICAgICAgICAgICAkRkIuZ2V0TG9naW5TdGF0dXMoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdjb25uZWN0ZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAkRkIuYXBpKCcvbWUvYWNjb3VudHMnLCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuLy8gICAgICAgICAgICAgICAgICAgICAgJEZCLmFwaSgnLycgKyAkRkIuZ2V0VXNlcklEKCkgKyAnL2FjY291bnRzJywgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgLy9ub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGNvbnN0YW50TWFpbC5lcnJvckFwaUZhY2Vib29rKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwcEZhY2Vib29rLmNoZWNrUGVybWlzc2lvbkZhY2Vib29rUGFnZShyZXNwb25zZS5kYXRhKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9ialBhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwRmFjZWJvb2suc2hvd01vZGFsU2VsZWN0ZWRQYWdlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwRmFjZWJvb2suc2V0RmFjZWJvb2socmVzcG9uc2UsIG9ialBhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgJEZCLmxvZ2luKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJEZCLmFwaSgnL21lL2FjY291bnRzJywgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbi8vICAgICAgICAgICAgICAgICAgICAgICAgJEZCLmFwaSgnLycgKyAkRkIuZ2V0VXNlcklEKCkgKyAnL2FjY291bnRzJywgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL25vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoY29uc3RhbnRNYWlsLmVycm9yQXBpRmFjZWJvb2spO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwRmFjZWJvb2suY2hlY2tQZXJtaXNzaW9uRmFjZWJvb2tQYWdlKHJlc3BvbnNlLmRhdGEpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvYmpQYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwRmFjZWJvb2suc2hvd01vZGFsU2VsZWN0ZWRQYWdlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9IC8qZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwRmFjZWJvb2suc2V0RmFjZWJvb2socmVzcG9uc2UsIG9ialBhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICdwdWJsaXNoX2FjdGlvbnMscHVibGlzaF9wYWdlcyxtYW5hZ2VfcGFnZXMnXHJcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGdldFBpY3R1cmVzUGFnZTogZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICAgICAgICAgICAgRkIuYXBpKCcvJyArIGlkICsgJy9waWN0dXJlP3JlZGlyZWN0PWZhbHNlJywgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBnZXRGYW5QYWdlQXJyOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJlc3BvbnNlLCBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKCRzY29wZS5hcHBGYWNlYm9vay5nZXRQaWN0dXJlc1BhZ2UodmFsdWUuaWQpKTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNldFJlc29sdmUoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VbaV0ucGljdHVyZSA9IGRhdGFbaV0uZGF0YS51cmw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICRxLmFsbChwcm9taXNlcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFJlc29sdmUoZGF0YSlcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNob3dNb2RhbFNlbGVjdGVkUGFnZTogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIHBhZ2VzID0gZGF0YS5kYXRhXHJcblxyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwRmFjZWJvb2suZ2V0RmFuUGFnZUFycihwYWdlcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAkbWREaWFsb2cuc2hvdyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLiRuZXcoKSxcclxuICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IE1vZGFsUGFnZUZhY2Vib29rQ3RybCxcclxuICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBjb25zdGFudE1haWwudGVtcGxhdGVNb2RhbFBhZ2VGYWNlYm9vayxcclxuICAgICAgICAgICAgICAgICAgICAgIHBhcmVudDogYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmJvZHkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgY2xpY2tPdXRzaWRlVG9DbG9zZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVQYXJlbnRTY3JvbGw6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgbG9jYWxzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VzOiBkYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBwRmFjZWJvb2suZmFuUGFnZVNlbGVjdGVkID0gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuYXBwRmFjZWJvb2suZmFuUGFnZVNlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGYWNlYm9vay5mYWNlYm9vayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzZXRGYWNlYm9vazogZnVuY3Rpb24gKHJlc3BvbnNlLCBvYmpQYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGYWNlYm9vay5nZXRQaWN0dXJlc1BhZ2Uob2JqUGFnZS5pZFBhZ2UpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLmRhdGEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IHJlc3BvbnNlLmRhdGFbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwYXJzZUludCh2YWx1ZS5pZCkgPT0gcGFyc2VJbnQob2JqUGFnZS5pZFBhZ2UpKTtcclxuICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludCh2YWx1ZS5pZCkgPT0gcGFyc2VJbnQob2JqUGFnZS5pZFBhZ2UpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGYWNlYm9vay5mYWNlYm9vayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGYWNlYm9vay5mYW5QYWdlU2VsZWN0ZWQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwcEZhY2Vib29rLmZhblBhZ2VTZWxlY3RlZC5waWN0dXJlID0gZGF0YS5kYXRhLnVybDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwcEZhY2Vib29rLmRlc2NyaXB0aW9uUHVibGlzaCA9IG9ialBhZ2UuZGVzY3JpcHRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5hcHBGYWNlYm9vayk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZ2V0Q29udGVudE1haWwoJHNjb3BlLmlkTWFpbCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dMaW5rc0dvb2dsZUFuYWx5dGljcyA9IChkYXRhLmdvb2dsZUFuYWx5dGljcyA9PSAxID8gdHJ1ZSA6IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5nb29nbGVBbmFseXRpY3NMaW5rcyA9IGRhdGEuY29udGVudC5saW5rcztcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YS5nb29nbGVBbmFseXRpY3NEYXRhICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZ29vZ2xlQW5hbHl0aWNzID0gZGF0YS5nb29nbGVBbmFseXRpY3NEYXRhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChkYXRhLm5vdGlmaWNhdGlvbkVtYWlscykge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YWFkdi5ub3RpZmljYXRpb25zID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGFhZHYubm90aWZpY2F0aW9uRW1haWxzID0gZGF0YS5ub3RpZmljYXRpb25FbWFpbHM7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdGlzdGljc0VtYWlscykge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YWFkdi5zdGF0aXN0aWNzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGFhZHYuc3RhdGlzdGljc0VtYWlscyA9IGRhdGEuc3RhdGlzdGljc0VtYWlscztcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGFhZHYucXVhbnRpdHkgPSBkYXRhLnF1YW50aXR5O1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YWFkdi50eXBlVGltZSA9IGRhdGEudHlwZVRpbWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuZmFjZWJvb2spIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7aWRQYWdlOiBkYXRhLmZhY2Vib29rLmlkUGFnZSwgZGVzY3JpcHRpb246IGRhdGEuZmFjZWJvb2suZGVzY3JpcHRpb259O1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlZhbGlkYSBzaSBleGlzdGUgZmFjZWJvb2cgbG9rb1wiKTtcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgIGlmICgkRkIubG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwcEZhY2Vib29rLmxvZ2luKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hcHBGYWNlYm9vay5sb2dpbihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5zYXZlQWR2YW5jZU9wdGlvbnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYXBwRmFjZWJvb2suZmFjZWJvb2sgJiYgJHNjb3BlLmFwcEZhY2Vib29rLmZhblBhZ2VTZWxlY3RlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhYWR2LmZhY2Vib29rID0gYW5ndWxhci5jb3B5KCRzY29wZS5hcHBGYWNlYm9vayk7XHJcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGFhZHYuZmFjZWJvb2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGFhZHYuZ29vZ2xlQW5hbHl0aWNzID0gJHNjb3BlLnNob3dMaW5rc0dvb2dsZUFuYWx5dGljcztcclxuICAgICAgICAgICAgICAgICAgcmVzdFNlcnZpY2Uuc2F2ZUFkdmFuY2VPcHRpb25zKCRzY29wZS5pZE1haWwsICRzY29wZS5kYXRhYWR2KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5wcmltYXJ5KFwiTGEgaW5mb3JtYWNpw4PCs24gZGVsIG1haWwgaGEgc2lkbyBhY3R1YWxpemFkYSBjb3JyZWN0YW1lbnRlLlwiKTtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGZ1bGxVcmxCYXNlICsgdGVtcGxhdGVCYXNlICsgJy9jcmVhdGUjL3NoaXBwaW5nZGF0ZS8nICsgJHNjb3BlLmlkTWFpbDtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICRzY29wZS5zdGF0dXNBdHRhY2hlZCA9IGZ1bmN0aW9uICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmKHR5cGUgPT0gJ2F0dGFjaG1lbnQnKXtcclxuICAgICAgICAgICAgICAgICAgICBpZigkc2NvcGUuZmlsZWFkanVudHBkZi5maWxlcy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICQoJyNjYW5jZWxEaWFsb2cnKS5hZGRDbGFzcygnZGlhbG9nLS1vcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNNb2RhbCA9ICdjdXN0b21pemVkcGRmJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gJ2N1c3RvbWl6ZWRwZGYnKXtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmZpbGVhZGp1bnQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgJCgnI2NhbmNlbERpYWxvZycpLmFkZENsYXNzKCdkaWFsb2ctLW9wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5pc01vZGFsID0gJ2F0dGFjaG1lbnQnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uICgpe1xyXG4gICAgICAgICAgICAgICAgICBpZigkc2NvcGUuaXNNb2RhbCA9PSAnYXR0YWNobWVudCcpe1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5uYXYtdGFicyBhW2hyZWY9XCIvI2h0YWIxXCJdJykudGFiKCdzaG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgaWYoJHNjb3BlLmlzTW9kYWwgPT0gJ2N1c3RvbWl6ZWRwZGYnKXtcclxuICAgICAgICAgICAgICAgICAgICAkKCcubmF2LXRhYnMgYVtocmVmPVwiLyNodGFiMlwiXScpLnRhYignc2hvdycpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICQoJy5kaWFsb2cnKS5yZW1vdmVDbGFzcygnZGlhbG9nLS1vcGVuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICRzY29wZS5zYXZlQWRqdW50ID0gZnVuY3Rpb24gKCl7XHJcbiAgICAgICAgICAgICAgICAgIGlmKCRzY29wZS5pc01vZGFsID09ICdhdHRhY2htZW50Jyl7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGUuZmlsZWFkanVudCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGk8JHNjb3BlLmZpbGVhZGp1bnQubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgICAgICAgcmVzdFNlcnZpY2UuZGVsZXRlQXR0YWNoZWQoJHNjb3BlLmZpbGVhZGp1bnRbaV0uaWRNYWlsYXR0YWNobWVudCkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hdHRhY2goKTtcclxuICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkKCcubmF2LXRhYnMgYVtocmVmPVwiLyNodGFiMlwiXScpLnRhYignc2hvdycpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5kaWFsb2cnKS5yZW1vdmVDbGFzcygnZGlhbG9nLS1vcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgaWYoJHNjb3BlLmlzTW9kYWwgPT0gJ2N1c3RvbWl6ZWRwZGYnKXtcclxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZWxpc3QnKS5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudXBsb2FkZXIgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBpZigkc2NvcGUucmVzdWx0LmZpbGVzLmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICByZXN0U2VydmljZS5kZWxldGVDdXN0b21pemVkcGRmKCRzY29wZS5pZE1haWwpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXR0YWNocGRmKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI25leHQnKS5oaWRlKCdzbG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI2dvZ28nKS5oaWRlKCdzbG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI3Jlc3VtZScpLmhpZGUoJ3Nsb3cnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjYnV0dG9ucycpLmhpZGUoJ3Nsb3cnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjaHRhYjMnKS5zaG93KCdzbG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI2ZpbGVsaXN0Jykuc2hvdygnc2xvdycpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNjb250YWluZXInKS5zaG93KCdzbG93Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQoJy5uYXYtdGFicyBhW2hyZWY9XCIvI2h0YWIxXCJdJykudGFiKCdzaG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLmRpYWxvZycpLnJlbW92ZUNsYXNzKCdkaWFsb2ctLW9wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGVsZXRlQWxsID0gZnVuY3Rpb24gKGlkTWFpbCkge1xyXG4gICAgICAgICAgICAgICAgICByZXN0U2VydmljZS5kZWxldGVDdXN0b21pemVkcGRmKGlkTWFpbCkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGUuYXR0YWNocGRmKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpbGVhZGp1bnRwZGYgPSB7J2ZpbGVzJzpbXX07XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI25leHQnKS5oaWRlKCdzbG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI2dvZ28nKS5oaWRlKCdzbG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI3Jlc3VtZScpLmhpZGUoJ3Nsb3cnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjYnV0dG9ucycpLnNob3coJ3Nsb3cnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjaHRhYjMnKS5zaG93KCdzbG93Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI2ZpbGVsaXN0Jykuc2hvdygnc2xvdycpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNjb250YWluZXInKS5zaG93KCdzbG93Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlbGlzdCcpLmlubmVySFRNTCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgXSlcclxuICAgICAgICAgIC5jb250cm9sbGVyKCdtYWlsU3RydWN0dXJlRWRpdG9yQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJ3Jlc3RTZXJ2aWNlJywgJ25vdGlmaWNhdGlvblNlcnZpY2UnLCAnJHJvb3RTY29wZScsICckc3RhdGVQYXJhbXMnLCBmdW5jdGlvbiAoJHNjb3BlLCByZXN0U2VydmljZSwgbm90aWZpY2F0aW9uU2VydmljZSwgJHJvb3RTY29wZSwgJHN0YXRlUGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmluaXRpYWwgPSAwO1xyXG4gICAgICAgICAgICAgICRzY29wZS5wYWdlID0gMTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyID0gXCJcIjtcclxuICAgICAgICAgICAgICAkc2NvcGUuc2VhcmNoID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmZvcndhcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbCArPSAxO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgKz0gMTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICRzY29wZS5mYXN0Zm9yd2FyZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsID0gKCRzY29wZS5tYWlsc3RydWN0dXJlLnRvdGFsX3BhZ2VzIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucGFnZSA9ICRzY29wZS5tYWlsc3RydWN0dXJlLnRvdGFsX3BhZ2VzO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmJhY2t3YXJkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmluaXRpYWwgLT0gMTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYWdlIC09IDE7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZmFzdGJhY2t3YXJkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmluaXRpYWwgPSAwO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgPSAxO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJlc3RTZXJ2aWNlLmdldEFsbE1haWxTdHJ1Y3R1cmUoJHNjb3BlLmluaXRpYWwsICRzY29wZS5maWx0ZXIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm1haWxzdHJ1Y3R1cmUgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgIH1dKTtcclxufSkoKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2pzL2FuZ3VsYXIvbWFpbC9jb250cm9sbGVycy5qc1xuLy8gbW9kdWxlIGlkID0gMlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///2\n");

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n(function () {\r\n  angular.module('mail.directives', [])\r\n          .directive('fileModel', [\"$parse\", function ($parse) {\r\n              return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attrs) {\r\n                  var model = $parse(attrs.fileModel);\r\n                  var modelSetter = model.assign;\r\n\r\n                  element.bind('change', function () {\r\n                    scope.$apply(function () {\r\n                      modelSetter(scope, element[0].files[0]);\r\n                    });\r\n                  });\r\n                }\r\n              };\r\n            }])\r\n          .filter('trustedhtml', function ($sce) {\r\n            return function (value, type) {\r\n              return $sce.trustAs(type || 'html', value);\r\n            }\r\n          }\r\n          )\r\n          .directive('fb', ['$FB', function ($FB) {\r\n              return {\r\n                restrict: \"E\",\r\n                replace: true,\r\n                template: \"<div id='fb-root'></div>\",\r\n                compile: function (tElem, tAttrs) {\r\n                  return {\r\n                    post: function (scope, iElem, iAttrs, controller) {\r\n                      var fbAppId = iAttrs.appId || '';\r\n\r\n                      var fb_params = {\r\n                        appId: iAttrs.appId || \"\",\r\n                        cookie: iAttrs.cookie || true,\r\n                        status: iAttrs.status || true,\r\n                        xfbml: iAttrs.xfbml || true\r\n                      };\r\n\r\n                      // Setup the post-load callback\r\n                      window.fbAsyncInit = function () {\r\n                        $FB._init(fb_params);\r\n\r\n                        if ('fbInit' in iAttrs) {\r\n                          iAttrs.fbInit();\r\n                        }\r\n                      };\r\n\r\n                      (function (d, s, id, fbAppId) {\r\n                        var js, fjs = d.getElementsByTagName(s)[0];\r\n                        if (d.getElementById(id))\r\n                          return;\r\n                        js = d.createElement(s);\r\n                        js.id = id;\r\n                        js.async = true;\r\n                        js.src = \"//connect.facebook.net/en_US/all.js\";\r\n                        fjs.parentNode.insertBefore(js, fjs);\r\n                      }(document, 'script', 'facebook-jssdk', fbAppId));\r\n                    }\r\n                  }\r\n                }\r\n              };\r\n            }]);\r\n})();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9qcy9hbmd1bGFyL21haWwvZGlyZWN0aXZlcy5qcz9jZjk1Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLENBQUMiLCJmaWxlIjoiMy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuKGZ1bmN0aW9uICgpIHtcclxuICBhbmd1bGFyLm1vZHVsZSgnbWFpbC5kaXJlY3RpdmVzJywgW10pXHJcbiAgICAgICAgICAuZGlyZWN0aXZlKCdmaWxlTW9kZWwnLCBbXCIkcGFyc2VcIiwgZnVuY3Rpb24gKCRwYXJzZSkge1xyXG4gICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSAkcGFyc2UoYXR0cnMuZmlsZU1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgdmFyIG1vZGVsU2V0dGVyID0gbW9kZWwuYXNzaWduO1xyXG5cclxuICAgICAgICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIG1vZGVsU2V0dGVyKHNjb3BlLCBlbGVtZW50WzBdLmZpbGVzWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfV0pXHJcbiAgICAgICAgICAuZmlsdGVyKCd0cnVzdGVkaHRtbCcsIGZ1bmN0aW9uICgkc2NlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWUsIHR5cGUpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzKHR5cGUgfHwgJ2h0bWwnLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIClcclxuICAgICAgICAgIC5kaXJlY3RpdmUoJ2ZiJywgWyckRkInLCBmdW5jdGlvbiAoJEZCKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHJlc3RyaWN0OiBcIkVcIixcclxuICAgICAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogXCI8ZGl2IGlkPSdmYi1yb290Jz48L2Rpdj5cIixcclxuICAgICAgICAgICAgICAgIGNvbXBpbGU6IGZ1bmN0aW9uICh0RWxlbSwgdEF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zdDogZnVuY3Rpb24gKHNjb3BlLCBpRWxlbSwgaUF0dHJzLCBjb250cm9sbGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgZmJBcHBJZCA9IGlBdHRycy5hcHBJZCB8fCAnJztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgZmJfcGFyYW1zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBJZDogaUF0dHJzLmFwcElkIHx8IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZTogaUF0dHJzLmNvb2tpZSB8fCB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IGlBdHRycy5zdGF0dXMgfHwgdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeGZibWw6IGlBdHRycy54ZmJtbCB8fCB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgIC8vIFNldHVwIHRoZSBwb3N0LWxvYWQgY2FsbGJhY2tcclxuICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mYkFzeW5jSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJEZCLl9pbml0KGZiX3BhcmFtcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJ2ZiSW5pdCcgaW4gaUF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaUF0dHJzLmZiSW5pdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoZCwgcywgaWQsIGZiQXBwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGpzLCBmanMgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKHMpWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC5nZXRFbGVtZW50QnlJZChpZCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqcyA9IGQuY3JlYXRlRWxlbWVudChzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAganMuaWQgPSBpZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAganMuYXN5bmMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqcy5zcmMgPSBcIi8vY29ubmVjdC5mYWNlYm9vay5uZXQvZW5fVVMvYWxsLmpzXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZqcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqcywgZmpzKTtcclxuICAgICAgICAgICAgICAgICAgICAgIH0oZG9jdW1lbnQsICdzY3JpcHQnLCAnZmFjZWJvb2stanNzZGsnLCBmYkFwcElkKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfV0pO1xyXG59KSgpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vanMvYW5ndWxhci9tYWlsL2RpcmVjdGl2ZXMuanNcbi8vIG1vZHVsZSBpZCA9IDNcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///3\n");

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n(function () {\r\n  angular.module('mail.services', [])\r\n          .factory('restService', ['$http', '$q', 'notificationService', function ($http, $q, notificationService) {\r\n\r\n              function getContactlist() {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/getcontactlist';\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getMailFilters() {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/getmailfilters';\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getSegment() {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/getsegment';\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function countContact(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/countcontact';\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function addAddressees(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/addaddressees';\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          if (data.type) {\r\n                            notificationService.warning(data.message);\r\n                          } else {\r\n                            notificationService.error(data.message);\r\n                          }\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n              \r\n              function only(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/only';\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          if (data.type) {\r\n                            notificationService.warning(data.message);\r\n                          } else {\r\n                            notificationService.error(data.message);\r\n                          }\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n              \r\n              function getlisttimezone() {\r\n                var deferred = $q.defer();\r\n                $http.get(fullUrlBase + 'mail/timezone/')\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getemailsend() {\r\n                var deferred = $q.defer();\r\n                $http.get(fullUrlBase + 'mail/emailsender/')\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n              \r\n              function getReplyTo() {\r\n                var deferred = $q.defer();\r\n                $http.get(fullUrlBase + 'mail/replyto/')\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function addBasicInformation(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'mail/basicinformation/';\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function editBasicInformation(idMail, data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'mail/editbasicinformation/' + idMail;\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function saveAdvanceOptions(idMail, data) {\r\n\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/saveadvanceoptions/' + idMail;\r\n                console.log(data);\r\n                $http.put(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getemailname() {\r\n                var deferred = $q.defer();\r\n                $http.get(fullUrlBase + 'mail/emailname/')\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function addEmailName(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'mail/addemailname/';\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function addEmailSender(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'mail/addemailsender/';\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n              \r\n              function addReplyTo(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'mail/addreplyto/';\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function findMail(idMail) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/findmail/' + idMail;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n//              console.log(data.message);\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function findEmailSender(idEmailsender) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/findemailsender/' + idEmailsender;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function findMailAttachment(idEmail) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/findmailattachment/' + idEmail;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function findEmailName(idEmailname) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/findemailname/' + idEmailname;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n              \r\n              function findReplyto(idReplyto) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/findreplyto/' + idReplyto;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getAllMail(page, filter) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/getallmail/' + page;\r\n                //console.log(filter);\r\n                $http.post(url, filter)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getContentMail(idMail) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/getcontentmail/' + idMail;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getMailCategory() {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/getmailcategory';\r\n                console.log(url);\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function addContentEditor(idMail, data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'mail/contenteditor/' + idMail;\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getMailCategoryByIdMail(idMail) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/getmailcategoryidmail/' + idMail;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function findMailCategory(idMailcategory) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/findmailcategory/' + idMailcategory;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function deleteMail(idMail) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/deletemail/' + idMail;\r\n                $http.delete(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function addPlaintext(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/updateplainttext';\r\n                $http.put(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getAllMailStructure(page, name) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/mailstructure/getall/' + page;\r\n                $http.post(url, name)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function sendDataGoogleAnalitics(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/addgoogleanalitics';\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getAllGallery(page) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/gallery/' + page;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function addAdjunt(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/addadjunt';\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getAllAttachment(idMail) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/getallattachment/' + idMail;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function sendDataComfirmationEmail(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/sendconfirmationmail';\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data.message);\r\n                          notificationService.error(data.message);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function sendScheduleDateEmail(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/sendscheduledateemail';\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function saveMailAsMailTemplate(data) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/mailtemplate/savemailtemp';\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              function sendTestMail(data) {\r\n                var defered = $q.defer();\r\n                var url = fullUrlBase + \"api/sendmail/testmail\";\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          defered.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          defered.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n\r\n                return defered.promise;\r\n              }\r\n\r\n              function previewMailTemplateContent(id) {\r\n                var deferred = $q.defer();\r\n                var url = 'api/mail/preview/' + id;\r\n                $http.post(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n              function getMailContentJSON(id) {\r\n                var deferred = $q.defer();\r\n                var url = 'api/mail/getmailcontentjson/' + id;\r\n                $http.post(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function deleteAttached(id) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/deleteattached/' + id;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getSaxs() {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/saxs/getall';\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getThumbnailMail(idMail) {\r\n                var defered = $q.defer();\r\n                var url = fullUrlBase + \"api/sendmail/getthumbnail/\" + idMail;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          defered.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          defered.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n\r\n                return defered.promise;\r\n              }\r\n\r\n              function saveCategory(data) {\r\n                var url = fullUrlBase + 'api/mailcategory/savemailcategoryinmail';\r\n                var deferred = $q.defer();\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function changeTestMail(idMail, data) {\r\n                var url = fullUrlBase + \"api/sendmail/changetest\";\r\n                var deferred = $q.defer();\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function cancelMail(idMail) {\r\n                var url = fullUrlBase + 'api/mail/cancelmail/' + idMail;\r\n                var deferred = $q.defer();\r\n                $http.delete(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getLinksByMail(idMail) {\r\n                var url = fullUrlBase + 'api/sendmail/getlinksbymail/' + idMail;\r\n                var deferred = $q.defer();\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n\r\n              function getMailTemplateCategory() {\r\n                var deferred = $q.defer();\r\n                $http.get(fullUrlBase + 'api/mailtemplate/getmailtemplatecategory')\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n\r\n                return deferred.promise;\r\n              }\r\n              function sendTesterMails(data, idMail) {\r\n                var url = fullUrlBase + 'api/sendmail/sendtester/' + idMail;\r\n                var defer = $q.defer();\r\n                var promise = defer.promise;\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          defer.resolve(data);\r\n                        })\r\n                        .error(function (err) {\r\n                          defer.reject(err.message);\r\n                          notificationService.error(err.message);\r\n                        });\r\n\r\n                return promise;\r\n              }\r\n\r\n              function getMd5publish(data) {\r\n                var url = fullUrlBase + 'api/mail/getmdgpublish/', data;\r\n                var defer = $q.defer();\r\n                var promise = defer.promise;\r\n                $http.post(url, data)\r\n                        .success(function (data) {\r\n                          defer.resolve(data);\r\n                        })\r\n                        .error(function (err) {\r\n                          defer.reject(err.message);\r\n                          notificationService.error(err.message);\r\n                        });\r\n\r\n                return promise;\r\n              }\r\n              \r\n              function downloadMailPreview(idMail) {\r\n                var defered = $q.defer();\r\n                var url = fullUrlBase + \"api/sendmail/downloadmailpreview/\" + idMail;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          defered.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          defered.reject(data);\r\n                          notificationService.error(data.message);\r\n                        });\r\n\r\n                return defered.promise;\r\n              }\r\n\r\n              function  getTableResults(id) {\r\n                //console.log(\"esta llegando aqui service\"); return;\r\n                var url = fullUrlBase + 'mail/structurename/'+id;\r\n                var defer = $q.defer();\r\n                var promise = defer.promise;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          defer.resolve(data);\r\n                        })\r\n                        .error(function (err) {\r\n                          defer.reject(err.message);\r\n                          notificationService.error(err.message);\r\n                        });\r\n                return promise;\r\n              }\r\n              \r\n              function deleteCustomizedpdf(id){\r\n                var url = fullUrlBase + 'mail/deletedall/'+id;\r\n                console.log(url);\r\n                var defer = $q.defer();\r\n                var promise = defer.promise;\r\n                $http.get(url)\r\n                  .success(function (data) {\r\n                    defer.resolve(data);\r\n                  })\r\n                  .error(function (err) {\r\n                    defer.reject(err.message);\r\n                    notificationService.error(err.message);\r\n                  });\r\n                return promise;\r\n              }\r\n              \r\n              function getAllAttachmentpdf(idMail) {\r\n                var deferred = $q.defer();\r\n                var url = fullUrlBase + 'api/sendmail/getallattachmentpdf/' + idMail;\r\n                $http.get(url)\r\n                        .success(function (data) {\r\n                          deferred.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          deferred.reject(data);\r\n                          notificationService.error(data);\r\n                        });\r\n                return deferred.promise;\r\n              }\r\n\r\n              return {\r\n                getContactlist: getContactlist,\r\n                getSegment: getSegment,\r\n                countContact: countContact,\r\n                addAddressees: addAddressees,\r\n                getlisttimezone: getlisttimezone,\r\n                getemailname: getemailname,\r\n                getemailsend: getemailsend,\r\n                addBasicInformation: addBasicInformation,\r\n                findMail: findMail,\r\n                getAllMail: getAllMail,\r\n                addEmailName: addEmailName,\r\n                addEmailSender: addEmailSender,\r\n                editBasicInformation: editBasicInformation,\r\n                getContentMail: getContentMail,\r\n                getMailCategory: getMailCategory,\r\n                addContentEditor: addContentEditor,\r\n                getMailCategoryByIdMail: getMailCategoryByIdMail,\r\n                deleteMail: deleteMail,\r\n                addPlaintext: addPlaintext,\r\n                getAllMailStructure: getAllMailStructure,\r\n                getAllGallery: getAllGallery,\r\n                addAdjunt: addAdjunt,\r\n                getAllAttachment: getAllAttachment,\r\n                sendDataGoogleAnalitics: sendDataGoogleAnalitics,\r\n                findEmailSender: findEmailSender,\r\n                findEmailName: findEmailName,\r\n                findMailCategory: findMailCategory,\r\n                sendDataComfirmationEmail: sendDataComfirmationEmail,\r\n                findMailAttachment: findMailAttachment,\r\n                sendScheduleDateEmail: sendScheduleDateEmail,\r\n                saveMailAsMailTemplate: saveMailAsMailTemplate,\r\n                sendTestMail: sendTestMail,\r\n                previewMailTemplateContent: previewMailTemplateContent,\r\n                getMailContentJSON: getMailContentJSON,\r\n                deleteAttached: deleteAttached,\r\n                getSaxs: getSaxs,\r\n                saveAdvanceOptions: saveAdvanceOptions,\r\n                getThumbnailMail: getThumbnailMail,\r\n                saveCategory: saveCategory,\r\n                cancelMail: cancelMail,\r\n                changeTestMail: changeTestMail,\r\n                getMailFilters: getMailFilters,\r\n                getLinksByMail: getLinksByMail,\r\n                getMailTemplateCategory: getMailTemplateCategory,\r\n                sendTesterMails: sendTesterMails,\r\n                getMd5publish : getMd5publish,\r\n                downloadMailPreview: downloadMailPreview,\r\n                getReplyTo: getReplyTo,\r\n                addReplyTo: addReplyTo,\r\n                findReplyto: findReplyto,\r\n                getTableResults: getTableResults,\r\n                only: only,\r\n                deleteCustomizedpdf: deleteCustomizedpdf,\r\n                getAllAttachmentpdf: getAllAttachmentpdf\r\n              };\r\n            }])\r\n          .service(\"incomplete\", function () {\r\n            var varincomplete = false;\r\n            this.setincomplete = function (incomple) {\r\n              varincomplete = incomple;\r\n            };\r\n            this.getincomplete = function () {\r\n              return varincomplete;\r\n            };\r\n          })\r\n          .service(\"wizard\", function () {\r\n            var describe = false;\r\n            var addressees = false;\r\n            var content = false;\r\n            var advanceoptions = false;\r\n            var shippingdate = false;\r\n\r\n            this.setdescribe = function (incomple) {\r\n              describe = incomple;\r\n            };\r\n            this.getdescribe = function () {\r\n              return describe;\r\n            };\r\n\r\n            this.setaddressees = function (incomple) {\r\n              addressees = incomple;\r\n            };\r\n            this.getaddressees = function () {\r\n              return addressees;\r\n            };\r\n\r\n            this.setcontent = function (incomple) {\r\n              content = incomple;\r\n            };\r\n            this.getcontent = function () {\r\n              return content;\r\n            };\r\n\r\n            this.setadvanceoptions = function (incomple) {\r\n              advanceoptions = incomple;\r\n            };\r\n            this.getadvanceoptions = function () {\r\n              return advanceoptions;\r\n            };\r\n\r\n            this.setshippingdate = function (incomple) {\r\n              shippingdate = incomple;\r\n            };\r\n            this.getshippingdate = function () {\r\n              return shippingdate;\r\n            };\r\n\r\n          })\r\n          .factory('notificationService', function () {\r\n            function error(message) {\r\n              slideOnTop(message, 4000, 'glyphicon glyphicon-remove-circle', 'danger');\r\n            }\r\n\r\n            function success(message) {\r\n              slideOnTop(message, 4000, 'glyphicon glyphicon-ok-circle', 'success');\r\n            }\r\n\r\n            function warning(message) {\r\n              slideOnTop(message, 4000, 'glyphicon glyphicon-exclamation-sign', 'warning');\r\n            }\r\n\r\n            function notice(message) {\r\n              slideOnTop(message, 4000, 'glyphicon glyphicon-exclamation-sign', 'notice');\r\n            }\r\n\r\n            function primary(message) {\r\n              slideOnTop(message, 4000, 'glyphicon glyphicon-exclamation-sign', 'primary');\r\n            }\r\n\r\n            return {\r\n              error: error,\r\n              success: success,\r\n              warning: warning,\r\n              notice: notice,\r\n              primary: primary\r\n            };\r\n          })\r\n          .factory('$FB', ['$rootScope', function ($rootScope) {\r\n              var fbLoaded = false;\r\n              // Our own customisations\r\n              var _fb = {\r\n                loaded: fbLoaded,\r\n                _init: function (params) {\r\n                  if (window.FB) {\r\n                    // FIXME: Ugly hack to maintain both window.FB\r\n                    // and our AngularJS-wrapped $FB with our customisations\r\n                    angular.extend(window.FB, _fb);\r\n                    angular.extend(_fb, window.FB);\r\n                    // Set the flag\r\n                    _fb.loaded = true;\r\n                    // Initialise FB SDK\r\n                    window.FB.init(params);\r\n                    if (!$rootScope.$$phase) {\r\n                      $rootScope.$apply();\r\n                    }\r\n                  }\r\n                }\r\n\r\n              }\r\n              return _fb;\r\n            }]);\r\n\r\n})();\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9qcy9hbmd1bGFyL21haWwvc2VydmljZXMuanM/OTBhOCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7O0FBRXpCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5Qjs7QUFFekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5Qjs7QUFFekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7O0FBRXpCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5Qjs7QUFFekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5Qjs7QUFFekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7O0FBRXpCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSx5QkFBeUI7O0FBRXpCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLHlCQUF5Qjs7QUFFekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLHlCQUF5Qjs7QUFFekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLHlCQUF5Qjs7QUFFekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7O0FBRXpCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5Qjs7QUFFekI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7O0FBRXpCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7O0FBRXpCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7O0FBRXpCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EseUJBQXlCOztBQUV6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7O0FBRXpCO0FBQ0E7O0FBRUE7QUFDQSw0REFBNEQ7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWIsQ0FBQyIsImZpbGUiOiI0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gIGFuZ3VsYXIubW9kdWxlKCdtYWlsLnNlcnZpY2VzJywgW10pXHJcbiAgICAgICAgICAuZmFjdG9yeSgncmVzdFNlcnZpY2UnLCBbJyRodHRwJywgJyRxJywgJ25vdGlmaWNhdGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxLCBub3RpZmljYXRpb25TZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGdldENvbnRhY3RsaXN0KCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvc2VuZG1haWwvZ2V0Y29udGFjdGxpc3QnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGdldE1haWxGaWx0ZXJzKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvc2VuZG1haWwvZ2V0bWFpbGZpbHRlcnMnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFNlZ21lbnQoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zZW5kbWFpbC9nZXRzZWdtZW50JztcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBjb3VudENvbnRhY3QoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvc2VuZG1haWwvY291bnRjb250YWN0JztcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QodXJsLCBkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gYWRkQWRkcmVzc2VlcyhkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zZW5kbWFpbC9hZGRhZGRyZXNzZWVzJztcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QodXJsLCBkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLndhcm5pbmcoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIG9ubHkoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvc2VuZG1haWwvb25seSc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybCwgZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEudHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS53YXJuaW5nKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRsaXN0dGltZXpvbmUoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KGZ1bGxVcmxCYXNlICsgJ21haWwvdGltZXpvbmUvJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRlbWFpbHNlbmQoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KGZ1bGxVcmxCYXNlICsgJ21haWwvZW1haWxzZW5kZXIvJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFJlcGx5VG8oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KGZ1bGxVcmxCYXNlICsgJ21haWwvcmVwbHl0by8nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGFkZEJhc2ljSW5mb3JtYXRpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdtYWlsL2Jhc2ljaW5mb3JtYXRpb24vJztcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QodXJsLCBkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBlZGl0QmFzaWNJbmZvcm1hdGlvbihpZE1haWwsIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnbWFpbC9lZGl0YmFzaWNpbmZvcm1hdGlvbi8nICsgaWRNYWlsO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCh1cmwsIGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIHNhdmVBZHZhbmNlT3B0aW9ucyhpZE1haWwsIGRhdGEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zZW5kbWFpbC9zYXZlYWR2YW5jZW9wdGlvbnMvJyArIGlkTWFpbDtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucHV0KHVybCwgZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0ZW1haWxuYW1lKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldChmdWxsVXJsQmFzZSArICdtYWlsL2VtYWlsbmFtZS8nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGFkZEVtYWlsTmFtZShkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ21haWwvYWRkZW1haWxuYW1lLyc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybCwgZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gYWRkRW1haWxTZW5kZXIoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdtYWlsL2FkZGVtYWlsc2VuZGVyLyc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybCwgZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICBmdW5jdGlvbiBhZGRSZXBseVRvKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnbWFpbC9hZGRyZXBseXRvLyc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybCwgZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gZmluZE1haWwoaWRNYWlsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zZW5kbWFpbC9maW5kbWFpbC8nICsgaWRNYWlsO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuLy8gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBmaW5kRW1haWxTZW5kZXIoaWRFbWFpbHNlbmRlcikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvc2VuZG1haWwvZmluZGVtYWlsc2VuZGVyLycgKyBpZEVtYWlsc2VuZGVyO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBmaW5kTWFpbEF0dGFjaG1lbnQoaWRFbWFpbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvc2VuZG1haWwvZmluZG1haWxhdHRhY2htZW50LycgKyBpZEVtYWlsO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBmaW5kRW1haWxOYW1lKGlkRW1haWxuYW1lKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zZW5kbWFpbC9maW5kZW1haWxuYW1lLycgKyBpZEVtYWlsbmFtZTtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICBmdW5jdGlvbiBmaW5kUmVwbHl0byhpZFJlcGx5dG8pIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnYXBpL3NlbmRtYWlsL2ZpbmRyZXBseXRvLycgKyBpZFJlcGx5dG87XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQodXJsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEFsbE1haWwocGFnZSwgZmlsdGVyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zZW5kbWFpbC9nZXRhbGxtYWlsLycgKyBwYWdlO1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhmaWx0ZXIpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCh1cmwsIGZpbHRlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRDb250ZW50TWFpbChpZE1haWwpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnYXBpL3NlbmRtYWlsL2dldGNvbnRlbnRtYWlsLycgKyBpZE1haWw7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQodXJsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0TWFpbENhdGVnb3J5KCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvc2VuZG1haWwvZ2V0bWFpbGNhdGVnb3J5JztcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHVybCk7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQodXJsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gYWRkQ29udGVudEVkaXRvcihpZE1haWwsIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnbWFpbC9jb250ZW50ZWRpdG9yLycgKyBpZE1haWw7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybCwgZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0TWFpbENhdGVnb3J5QnlJZE1haWwoaWRNYWlsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zZW5kbWFpbC9nZXRtYWlsY2F0ZWdvcnlpZG1haWwvJyArIGlkTWFpbDtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBmaW5kTWFpbENhdGVnb3J5KGlkTWFpbGNhdGVnb3J5KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zZW5kbWFpbC9maW5kbWFpbGNhdGVnb3J5LycgKyBpZE1haWxjYXRlZ29yeTtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBkZWxldGVNYWlsKGlkTWFpbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvc2VuZG1haWwvZGVsZXRlbWFpbC8nICsgaWRNYWlsO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZGVsZXRlKHVybClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gYWRkUGxhaW50ZXh0KGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnYXBpL3NlbmRtYWlsL3VwZGF0ZXBsYWludHRleHQnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucHV0KHVybCwgZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEFsbE1haWxTdHJ1Y3R1cmUocGFnZSwgbmFtZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvbWFpbHN0cnVjdHVyZS9nZXRhbGwvJyArIHBhZ2U7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybCwgbmFtZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIHNlbmREYXRhR29vZ2xlQW5hbGl0aWNzKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnYXBpL3NlbmRtYWlsL2FkZGdvb2dsZWFuYWxpdGljcyc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybCwgZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEFsbEdhbGxlcnkocGFnZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvZ2FsbGVyeS8nICsgcGFnZTtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBhZGRBZGp1bnQoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvc2VuZG1haWwvYWRkYWRqdW50JztcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QodXJsLCBkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0QWxsQXR0YWNobWVudChpZE1haWwpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnYXBpL3NlbmRtYWlsL2dldGFsbGF0dGFjaG1lbnQvJyArIGlkTWFpbDtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBzZW5kRGF0YUNvbWZpcm1hdGlvbkVtYWlsKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnYXBpL3NlbmRtYWlsL3NlbmRjb25maXJtYXRpb25tYWlsJztcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QodXJsLCBkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIHNlbmRTY2hlZHVsZURhdGVFbWFpbChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zZW5kbWFpbC9zZW5kc2NoZWR1bGVkYXRlZW1haWwnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCh1cmwsIGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIHNhdmVNYWlsQXNNYWlsVGVtcGxhdGUoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvbWFpbHRlbXBsYXRlL3NhdmVtYWlsdGVtcCc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybCwgZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIHNlbmRUZXN0TWFpbChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyBcImFwaS9zZW5kbWFpbC90ZXN0bWFpbFwiO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCh1cmwsIGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBwcmV2aWV3TWFpbFRlbXBsYXRlQ29udGVudChpZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSAnYXBpL21haWwvcHJldmlldy8nICsgaWQ7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRNYWlsQ29udGVudEpTT04oaWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gJ2FwaS9tYWlsL2dldG1haWxjb250ZW50anNvbi8nICsgaWQ7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gZGVsZXRlQXR0YWNoZWQoaWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnYXBpL3NlbmRtYWlsL2RlbGV0ZWF0dGFjaGVkLycgKyBpZDtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFNheHMoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zYXhzL2dldGFsbCc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQodXJsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRUaHVtYm5haWxNYWlsKGlkTWFpbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgXCJhcGkvc2VuZG1haWwvZ2V0dGh1bWJuYWlsL1wiICsgaWRNYWlsO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIHNhdmVDYXRlZ29yeShkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnYXBpL21haWxjYXRlZ29yeS9zYXZlbWFpbGNhdGVnb3J5aW5tYWlsJztcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybCwgZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGNoYW5nZVRlc3RNYWlsKGlkTWFpbCwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgXCJhcGkvc2VuZG1haWwvY2hhbmdldGVzdFwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QodXJsLCBkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gY2FuY2VsTWFpbChpZE1haWwpIHtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdhcGkvbWFpbC9jYW5jZWxtYWlsLycgKyBpZE1haWw7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZGVsZXRlKHVybClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGdldExpbmtzQnlNYWlsKGlkTWFpbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zZW5kbWFpbC9nZXRsaW5rc2J5bWFpbC8nICsgaWRNYWlsO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRNYWlsVGVtcGxhdGVDYXRlZ29yeSgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoZnVsbFVybEJhc2UgKyAnYXBpL21haWx0ZW1wbGF0ZS9nZXRtYWlsdGVtcGxhdGVjYXRlZ29yeScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBmdW5jdGlvbiBzZW5kVGVzdGVyTWFpbHMoZGF0YSwgaWRNYWlsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnYXBpL3NlbmRtYWlsL3NlbmR0ZXN0ZXIvJyArIGlkTWFpbDtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IGRlZmVyLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHVybCwgZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0TWQ1cHVibGlzaChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyAnYXBpL21haWwvZ2V0bWRncHVibGlzaC8nLCBkYXRhO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QodXJsLCBkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGRvd25sb2FkTWFpbFByZXZpZXcoaWRNYWlsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZnVsbFVybEJhc2UgKyBcImFwaS9zZW5kbWFpbC9kb3dubG9hZG1haWxwcmV2aWV3L1wiICsgaWRNYWlsO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyZWQucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uICBnZXRUYWJsZVJlc3VsdHMoaWQpIHtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJlc3RhIGxsZWdhbmRvIGFxdWkgc2VydmljZVwiKTsgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ21haWwvc3RydWN0dXJlbmFtZS8nK2lkO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QoZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICBmdW5jdGlvbiBkZWxldGVDdXN0b21pemVkcGRmKGlkKXtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdtYWlsL2RlbGV0ZWRhbGwvJytpZDtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHVybCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEFsbEF0dGFjaG1lbnRwZGYoaWRNYWlsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zZW5kbWFpbC9nZXRhbGxhdHRhY2htZW50cGRmLycgKyBpZE1haWw7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQodXJsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGdldENvbnRhY3RsaXN0OiBnZXRDb250YWN0bGlzdCxcclxuICAgICAgICAgICAgICAgIGdldFNlZ21lbnQ6IGdldFNlZ21lbnQsXHJcbiAgICAgICAgICAgICAgICBjb3VudENvbnRhY3Q6IGNvdW50Q29udGFjdCxcclxuICAgICAgICAgICAgICAgIGFkZEFkZHJlc3NlZXM6IGFkZEFkZHJlc3NlZXMsXHJcbiAgICAgICAgICAgICAgICBnZXRsaXN0dGltZXpvbmU6IGdldGxpc3R0aW1lem9uZSxcclxuICAgICAgICAgICAgICAgIGdldGVtYWlsbmFtZTogZ2V0ZW1haWxuYW1lLFxyXG4gICAgICAgICAgICAgICAgZ2V0ZW1haWxzZW5kOiBnZXRlbWFpbHNlbmQsXHJcbiAgICAgICAgICAgICAgICBhZGRCYXNpY0luZm9ybWF0aW9uOiBhZGRCYXNpY0luZm9ybWF0aW9uLFxyXG4gICAgICAgICAgICAgICAgZmluZE1haWw6IGZpbmRNYWlsLFxyXG4gICAgICAgICAgICAgICAgZ2V0QWxsTWFpbDogZ2V0QWxsTWFpbCxcclxuICAgICAgICAgICAgICAgIGFkZEVtYWlsTmFtZTogYWRkRW1haWxOYW1lLFxyXG4gICAgICAgICAgICAgICAgYWRkRW1haWxTZW5kZXI6IGFkZEVtYWlsU2VuZGVyLFxyXG4gICAgICAgICAgICAgICAgZWRpdEJhc2ljSW5mb3JtYXRpb246IGVkaXRCYXNpY0luZm9ybWF0aW9uLFxyXG4gICAgICAgICAgICAgICAgZ2V0Q29udGVudE1haWw6IGdldENvbnRlbnRNYWlsLFxyXG4gICAgICAgICAgICAgICAgZ2V0TWFpbENhdGVnb3J5OiBnZXRNYWlsQ2F0ZWdvcnksXHJcbiAgICAgICAgICAgICAgICBhZGRDb250ZW50RWRpdG9yOiBhZGRDb250ZW50RWRpdG9yLFxyXG4gICAgICAgICAgICAgICAgZ2V0TWFpbENhdGVnb3J5QnlJZE1haWw6IGdldE1haWxDYXRlZ29yeUJ5SWRNYWlsLFxyXG4gICAgICAgICAgICAgICAgZGVsZXRlTWFpbDogZGVsZXRlTWFpbCxcclxuICAgICAgICAgICAgICAgIGFkZFBsYWludGV4dDogYWRkUGxhaW50ZXh0LFxyXG4gICAgICAgICAgICAgICAgZ2V0QWxsTWFpbFN0cnVjdHVyZTogZ2V0QWxsTWFpbFN0cnVjdHVyZSxcclxuICAgICAgICAgICAgICAgIGdldEFsbEdhbGxlcnk6IGdldEFsbEdhbGxlcnksXHJcbiAgICAgICAgICAgICAgICBhZGRBZGp1bnQ6IGFkZEFkanVudCxcclxuICAgICAgICAgICAgICAgIGdldEFsbEF0dGFjaG1lbnQ6IGdldEFsbEF0dGFjaG1lbnQsXHJcbiAgICAgICAgICAgICAgICBzZW5kRGF0YUdvb2dsZUFuYWxpdGljczogc2VuZERhdGFHb29nbGVBbmFsaXRpY3MsXHJcbiAgICAgICAgICAgICAgICBmaW5kRW1haWxTZW5kZXI6IGZpbmRFbWFpbFNlbmRlcixcclxuICAgICAgICAgICAgICAgIGZpbmRFbWFpbE5hbWU6IGZpbmRFbWFpbE5hbWUsXHJcbiAgICAgICAgICAgICAgICBmaW5kTWFpbENhdGVnb3J5OiBmaW5kTWFpbENhdGVnb3J5LFxyXG4gICAgICAgICAgICAgICAgc2VuZERhdGFDb21maXJtYXRpb25FbWFpbDogc2VuZERhdGFDb21maXJtYXRpb25FbWFpbCxcclxuICAgICAgICAgICAgICAgIGZpbmRNYWlsQXR0YWNobWVudDogZmluZE1haWxBdHRhY2htZW50LFxyXG4gICAgICAgICAgICAgICAgc2VuZFNjaGVkdWxlRGF0ZUVtYWlsOiBzZW5kU2NoZWR1bGVEYXRlRW1haWwsXHJcbiAgICAgICAgICAgICAgICBzYXZlTWFpbEFzTWFpbFRlbXBsYXRlOiBzYXZlTWFpbEFzTWFpbFRlbXBsYXRlLFxyXG4gICAgICAgICAgICAgICAgc2VuZFRlc3RNYWlsOiBzZW5kVGVzdE1haWwsXHJcbiAgICAgICAgICAgICAgICBwcmV2aWV3TWFpbFRlbXBsYXRlQ29udGVudDogcHJldmlld01haWxUZW1wbGF0ZUNvbnRlbnQsXHJcbiAgICAgICAgICAgICAgICBnZXRNYWlsQ29udGVudEpTT046IGdldE1haWxDb250ZW50SlNPTixcclxuICAgICAgICAgICAgICAgIGRlbGV0ZUF0dGFjaGVkOiBkZWxldGVBdHRhY2hlZCxcclxuICAgICAgICAgICAgICAgIGdldFNheHM6IGdldFNheHMsXHJcbiAgICAgICAgICAgICAgICBzYXZlQWR2YW5jZU9wdGlvbnM6IHNhdmVBZHZhbmNlT3B0aW9ucyxcclxuICAgICAgICAgICAgICAgIGdldFRodW1ibmFpbE1haWw6IGdldFRodW1ibmFpbE1haWwsXHJcbiAgICAgICAgICAgICAgICBzYXZlQ2F0ZWdvcnk6IHNhdmVDYXRlZ29yeSxcclxuICAgICAgICAgICAgICAgIGNhbmNlbE1haWw6IGNhbmNlbE1haWwsXHJcbiAgICAgICAgICAgICAgICBjaGFuZ2VUZXN0TWFpbDogY2hhbmdlVGVzdE1haWwsXHJcbiAgICAgICAgICAgICAgICBnZXRNYWlsRmlsdGVyczogZ2V0TWFpbEZpbHRlcnMsXHJcbiAgICAgICAgICAgICAgICBnZXRMaW5rc0J5TWFpbDogZ2V0TGlua3NCeU1haWwsXHJcbiAgICAgICAgICAgICAgICBnZXRNYWlsVGVtcGxhdGVDYXRlZ29yeTogZ2V0TWFpbFRlbXBsYXRlQ2F0ZWdvcnksXHJcbiAgICAgICAgICAgICAgICBzZW5kVGVzdGVyTWFpbHM6IHNlbmRUZXN0ZXJNYWlscyxcclxuICAgICAgICAgICAgICAgIGdldE1kNXB1Ymxpc2ggOiBnZXRNZDVwdWJsaXNoLFxyXG4gICAgICAgICAgICAgICAgZG93bmxvYWRNYWlsUHJldmlldzogZG93bmxvYWRNYWlsUHJldmlldyxcclxuICAgICAgICAgICAgICAgIGdldFJlcGx5VG86IGdldFJlcGx5VG8sXHJcbiAgICAgICAgICAgICAgICBhZGRSZXBseVRvOiBhZGRSZXBseVRvLFxyXG4gICAgICAgICAgICAgICAgZmluZFJlcGx5dG86IGZpbmRSZXBseXRvLFxyXG4gICAgICAgICAgICAgICAgZ2V0VGFibGVSZXN1bHRzOiBnZXRUYWJsZVJlc3VsdHMsXHJcbiAgICAgICAgICAgICAgICBvbmx5OiBvbmx5LFxyXG4gICAgICAgICAgICAgICAgZGVsZXRlQ3VzdG9taXplZHBkZjogZGVsZXRlQ3VzdG9taXplZHBkZixcclxuICAgICAgICAgICAgICAgIGdldEFsbEF0dGFjaG1lbnRwZGY6IGdldEFsbEF0dGFjaG1lbnRwZGZcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XSlcclxuICAgICAgICAgIC5zZXJ2aWNlKFwiaW5jb21wbGV0ZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB2YXJpbmNvbXBsZXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0aW5jb21wbGV0ZSA9IGZ1bmN0aW9uIChpbmNvbXBsZSkge1xyXG4gICAgICAgICAgICAgIHZhcmluY29tcGxldGUgPSBpbmNvbXBsZTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5nZXRpbmNvbXBsZXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgIHJldHVybiB2YXJpbmNvbXBsZXRlO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5zZXJ2aWNlKFwid2l6YXJkXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGRlc2NyaWJlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBhZGRyZXNzZWVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBjb250ZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBhZHZhbmNlb3B0aW9ucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgc2hpcHBpbmdkYXRlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNldGRlc2NyaWJlID0gZnVuY3Rpb24gKGluY29tcGxlKSB7XHJcbiAgICAgICAgICAgICAgZGVzY3JpYmUgPSBpbmNvbXBsZTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5nZXRkZXNjcmliZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gZGVzY3JpYmU7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNldGFkZHJlc3NlZXMgPSBmdW5jdGlvbiAoaW5jb21wbGUpIHtcclxuICAgICAgICAgICAgICBhZGRyZXNzZWVzID0gaW5jb21wbGU7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0YWRkcmVzc2VlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gYWRkcmVzc2VlcztcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2V0Y29udGVudCA9IGZ1bmN0aW9uIChpbmNvbXBsZSkge1xyXG4gICAgICAgICAgICAgIGNvbnRlbnQgPSBpbmNvbXBsZTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5nZXRjb250ZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBjb250ZW50O1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zZXRhZHZhbmNlb3B0aW9ucyA9IGZ1bmN0aW9uIChpbmNvbXBsZSkge1xyXG4gICAgICAgICAgICAgIGFkdmFuY2VvcHRpb25zID0gaW5jb21wbGU7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0YWR2YW5jZW9wdGlvbnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGFkdmFuY2VvcHRpb25zO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zZXRzaGlwcGluZ2RhdGUgPSBmdW5jdGlvbiAoaW5jb21wbGUpIHtcclxuICAgICAgICAgICAgICBzaGlwcGluZ2RhdGUgPSBpbmNvbXBsZTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5nZXRzaGlwcGluZ2RhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHNoaXBwaW5nZGF0ZTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmZhY3RvcnkoJ25vdGlmaWNhdGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICBzbGlkZU9uVG9wKG1lc3NhZ2UsIDQwMDAsICdnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZS1jaXJjbGUnLCAnZGFuZ2VyJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3MobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgIHNsaWRlT25Ub3AobWVzc2FnZSwgNDAwMCwgJ2dseXBoaWNvbiBnbHlwaGljb24tb2stY2lyY2xlJywgJ3N1Y2Nlc3MnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gd2FybmluZyhtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgc2xpZGVPblRvcChtZXNzYWdlLCA0MDAwLCAnZ2x5cGhpY29uIGdseXBoaWNvbi1leGNsYW1hdGlvbi1zaWduJywgJ3dhcm5pbmcnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gbm90aWNlKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICBzbGlkZU9uVG9wKG1lc3NhZ2UsIDQwMDAsICdnbHlwaGljb24gZ2x5cGhpY29uLWV4Y2xhbWF0aW9uLXNpZ24nLCAnbm90aWNlJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHByaW1hcnkobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgIHNsaWRlT25Ub3AobWVzc2FnZSwgNDAwMCwgJ2dseXBoaWNvbiBnbHlwaGljb24tZXhjbGFtYXRpb24tc2lnbicsICdwcmltYXJ5Jyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLFxyXG4gICAgICAgICAgICAgIHN1Y2Nlc3M6IHN1Y2Nlc3MsXHJcbiAgICAgICAgICAgICAgd2FybmluZzogd2FybmluZyxcclxuICAgICAgICAgICAgICBub3RpY2U6IG5vdGljZSxcclxuICAgICAgICAgICAgICBwcmltYXJ5OiBwcmltYXJ5XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmZhY3RvcnkoJyRGQicsIFsnJHJvb3RTY29wZScsIGZ1bmN0aW9uICgkcm9vdFNjb3BlKSB7XHJcbiAgICAgICAgICAgICAgdmFyIGZiTG9hZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgLy8gT3VyIG93biBjdXN0b21pc2F0aW9uc1xyXG4gICAgICAgICAgICAgIHZhciBfZmIgPSB7XHJcbiAgICAgICAgICAgICAgICBsb2FkZWQ6IGZiTG9hZGVkLFxyXG4gICAgICAgICAgICAgICAgX2luaXQ6IGZ1bmN0aW9uIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5GQikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEZJWE1FOiBVZ2x5IGhhY2sgdG8gbWFpbnRhaW4gYm90aCB3aW5kb3cuRkJcclxuICAgICAgICAgICAgICAgICAgICAvLyBhbmQgb3VyIEFuZ3VsYXJKUy13cmFwcGVkICRGQiB3aXRoIG91ciBjdXN0b21pc2F0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHdpbmRvdy5GQiwgX2ZiKTtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChfZmIsIHdpbmRvdy5GQik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBmbGFnXHJcbiAgICAgICAgICAgICAgICAgICAgX2ZiLmxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSW5pdGlhbGlzZSBGQiBTREtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuRkIuaW5pdChwYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghJHJvb3RTY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgcmV0dXJuIF9mYjtcclxuICAgICAgICAgICAgfV0pO1xyXG5cclxufSkoKTtcclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9qcy9hbmd1bGFyL21haWwvc2VydmljZXMuanNcbi8vIG1vZHVsZSBpZCA9IDRcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///4\n");

/***/ })
/******/ ]);