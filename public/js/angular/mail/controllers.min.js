'use strict';(function(){angular.module('mail.controllers',[]).filter('propsFilter',function(){return function(items,props){var out=[];if(angular.isArray(items)){var keys=Object.keys(props);items.forEach(function(item){var itemMatches=!1;for(var i=0;i<keys.length;i++){var prop=keys[i];var text=props[prop].toLowerCase();if(item[prop].toString().toLowerCase().indexOf(text)!==-1){itemMatches=!0;break}}
if(itemMatches){out.push(item)}})}else{out=items}
return out}}).filter('getById',function(){return function(input,id){var i=0,len=input.length;for(;i<len;i++){if(input[i].gmt==id){return input[i]}}
return null}}).controller('main',['$scope','incomplete','$rootScope','wizard','restService',function($scope,incomplete,$rootScope,wizard,restService){$rootScope.incomplete=incomplete.getincomplete();wizard.setdescribe(!0);wizard.setaddressees(!1);wizard.setcontent(!1);wizard.setadvanceoptions(!1);wizard.setshippingdate(!1);$rootScope.addressees=wizard.getaddressees();$rootScope.describe=wizard.getdescribe();$rootScope.content=wizard.getcontent();$rootScope.advanceoptions=wizard.getadvanceoptions();$rootScope.shippingdate=wizard.getshippingdate()}]).controller('basicinformationController',['$scope','$rootScope','restService','$window','notificationService','$stateParams','wizard',function($scope,$rootScope,restService,$window,notificationService,$stateParams,wizard){wizard.setdescribe(!0);wizard.setaddressees(!1);wizard.setcontent(!1);wizard.setadvanceoptions(!1);wizard.setshippingdate(!1);$rootScope.addressees=wizard.getaddressees();$rootScope.describe=wizard.getdescribe();$rootScope.content=wizard.getcontent();$rootScope.advanceoptions=wizard.getadvanceoptions();$rootScope.shippingdate=wizard.getshippingdate();$scope.data={};$scope.data.category=[];function getemailname(){restService.getemailname().then(function(res){$scope.emailname=res})}
function getemailsend(){restService.getemailsend().then(function(res){$scope.emailsend=res})}
function getMailCategory(){restService.getMailCategory().then(function(res){$scope.availibleCategory=res})}
function getReplyTo(){restService.getReplyTo().then(function(res){$scope.replyToArray=res})}
getemailname();getemailsend();getReplyTo();getMailCategory();$scope.showInputName=!1;$scope.showInputCategory=!1;$scope.showSelectName=!0;$scope.showCategoryName=!0;$scope.showIconsName=!0;$scope.showIconsCategory=!0;$scope.showIconsSaveName=!1;$scope.showIconsSaveCategory=!1;$scope.changeStatusNameCategory=function(){if(!$scope.showInputCategory){$scope.showInputCategory=!0;$scope.showCategoryName=!1;$scope.showIconsCategory=!1;$scope.showIconsSaveCategory=!0}else{$scope.showInputCategory=!1;$scope.showCategoryName=!0;$scope.showIconsCategory=!0;$scope.showIconsSaveCategory=!1}};$scope.changeStatusInputName=function(){if(!$scope.showInputName){$scope.showInputName=!0;$scope.showSelectName=!1;$scope.showIconsName=!1;$scope.showIconsSaveName=!0}else{$scope.showInputName=!1;$scope.showSelectName=!0;$scope.showIconsName=!0;$scope.showIconsSaveName=!1}}
$scope.showInputEmail=!1;$scope.showSelectEmail=!0;$scope.showIconsEmail=!0;$scope.showIconsSaveEmail=!1;$scope.changeStatusInputEmail=function(){if(!$scope.showInputEmail){$scope.showInputEmail=!0;$scope.showSelectEmail=!1;$scope.showIconsEmail=!1;$scope.showIconsSaveEmail=!0}else{$scope.showInputEmail=!1;$scope.showSelectEmail=!0;$scope.showIconsEmail=!0;$scope.showIconsSaveEmail=!1}}
$scope.showInputReplyto=!1;$scope.showSelectReplyto=!0;$scope.showIconsReplyto=!0;$scope.showIconsSaveReplyto=!1;$scope.changeStatusInputReplyto=function(){if(!$scope.showInputReplyto){$scope.showInputReplyto=!0;$scope.showSelectReplyto=!1;$scope.showIconsReplyto=!1;$scope.showIconsSaveReplyto=!0}else{$scope.showInputReplyto=!1;$scope.showSelectReplyto=!0;$scope.showIconsReplyto=!0;$scope.showIconsSaveReplyto=!1}}
$scope.basicInformationRegister=function(){if(typeof($rootScope.idMailGet)!="undefined"){if(typeof($scope.data.senderNameSelect)=='undefined'){notificationService.error("El Nombre del remitente es obigatorio")}else if(typeof($scope.data.senderMailSelect)=='undefined'){notificationService.error("El Correo del remitente es obigatorio")}else{restService.editBasicInformation($rootScope.idMailGet,$scope.data).then(function(res){notificationService.success(res.msg);$rootScope.idMailGet=res.idMail;$window.location.href=fullUrlBase+templateBase+'/create#/addressees/'+res.idMail})}}else{if(typeof($scope.data.senderNameSelect)=='undefined'){notificationService.error("El Nombre del remitente es obigatorio")}else if(typeof($scope.data.senderMailSelect)=='undefined'){notificationService.error("El Correo del remitente es obigatorio")}else{restService.addBasicInformation($scope.data).then(function(res){notificationService.success(res.msg);$rootScope.idMailGet=res.idMail;$window.location.href=fullUrlBase+templateBase+'/create#/addressees/'+res.idMail})}}};$scope.basicInformationSave=function(){if(typeof($scope.data.senderNameSelect)=='undefined'){notificationService.error("El Nombre del remitente es obigatorio")}else if(typeof($scope.data.senderMailSelect)=='undefined'){notificationService.error("El Correo del remitente es obigatorio")}else{restService.editBasicInformation($rootScope.idMailGet,$scope.data).then(function(res){notificationService.success(res.msg);$rootScope.idMailGet=res.idMail;$window.location.href=fullUrlBase+templateBase})}};$scope.saveCategory=function(){var data={name:$scope.categoryName};$scope.changeStatusNameCategory();restService.saveCategory(data).then(function(res){notificationService.primary(res.msg);$scope.categoryName="";getMailCategory();$scope.data.category.push(res.category.idMailCategory)})};$scope.saveName=function(){var data={name:$scope.senderName};restService.addEmailName(data).then(function(res){notificationService.success(res.msg);$scope.senderName="";getemailname();$scope.changeStatusInputName();$scope.data.senderNameSelect=res.idNameSender})}
$scope.saveEmail=function(){var data={email:$scope.senderMail};restService.addEmailSender(data).then(function(res){if(res==""||res==null){notificationService.warning('No se pudo guardar el remitente, posiblemente el correo ese demasiado largo, intentelo nuevamente o comuniquese con soporte')}else{notificationService.success(res.msg);$scope.senderMail="";getemailsend();$scope.changeStatusInputEmail();$scope.data.senderMailSelect=res.idEmailsender}})}
$scope.saveReplyto=function(){var data={email:$scope.replyTo};restService.addReplyTo(data).then(function(res){notificationService.success(res.msg);$scope.replyTo="";getReplyTo();$scope.changeStatusInputReplyto();$scope.data.replyToSelect=res.idReplyTo})}
if($stateParams.id){if(!IsNumeric($stateParams.id)){notificationService.warning("El correo no se ha encontrado");location.href='#/basicinformation/'}else{$rootScope.idMailGet=$stateParams.id}}
function IsNumeric(val){return Number(parseFloat(val))==val}
if($rootScope.idMailGet&&IsNumeric($rootScope.idMailGet)){restService.findMail($rootScope.idMailGet).then(function(res){$scope.data.name=res.name;$scope.data.senderNameSelect=res.idNameSender;$scope.data.senderMailSelect=res.idEmailsender;$scope.data.replyToSelect=res.idReplyTo;$scope.data.replyto=res.replyto;$scope.data.subject=res.subject;$scope.data.test=(res.test==1)});restService.getMailCategoryByIdMail($rootScope.idMailGet).then(function(res){var idMailCategory=[];res.forEach(function(item,index){idMailCategory.push(item.idMailCategory)});$scope.data.category=idMailCategory})}}]).controller('shippingdateController',['$scope','$rootScope','$interval','$filter','restService','$stateParams','$q','notificationService','moment','wizard','$FB','$timeout',function($scope,$rootScope,$interval,$filter,restService,$stateParams,$q,notificationService,moment,wizard,$FB,$timeout){if(!IsNumeric($stateParams.id)){notificationService.warning("El correo no se ha encontrado");location.href='#/basicinformation/';return!0}
function IsNumeric(val){return Number(parseFloat(val))==val}
wizard.setdescribe(!1);wizard.setaddressees(!1);wizard.setcontent(!1);wizard.setadvanceoptions(!1);wizard.setshippingdate(!0);$rootScope.addressees=wizard.getaddressees();$rootScope.describe=wizard.getdescribe();$rootScope.content=wizard.getcontent();$rootScope.advanceoptions=wizard.getadvanceoptions();$rootScope.shippingdate=wizard.getshippingdate();$scope.show=!1;$scope.data={};$scope.zonahoraria={};$rootScope.idMailGet=$stateParams.id;$scope.idMail=$rootScope.idMailGet;$scope.imagenDate=new Date();$scope.imagenTime=$scope.imagenDate.getTime();$scope.tester={mailTester:!1,emailsSendTester:null,messageSendTester:null,sendTesterMail:function(){if(this.mailTester){if(this.emailsSendTester==null||this.emailsSendTester==""){notificationService.error("El campo de correos de envio de tester no puede estar vacio.");return!1}
data={mailsSend:this.emailsSendTester.split(","),messageSend:this.messageSendTester,idTester:$scope.idMail};restService.sendTesterMails(data,$scope.idMail).then(function(data){console.log(data)})}}};$('#datetimepicker').datetimepicker({format:'yyyy-MM-dd hh:mm',language:'es'}).on('changeDate',function(ev){$scope.tick();$scope.$apply()});$scope.showTextarea=function(){if($scope.show==!1){$scope.show=!0}else{$scope.show=!1}}
$scope.loginFB=function(idPage){$FB.getLoginStatus(function(response){if(response.status==='connected'){$FB.api('/'+idPage+"?fields=access_token,name",function(response){$scope.setFacebook(response)})}else{$FB.login(function(){$FB.api('/'+idPage+"?fields=access_token,name",function(response){$scope.setFacebook(response)})},{scope:'publish_actions,publish_pages,manage_pages'})}})}
$scope.setFacebook=function(data){$FB.api('/'+data.id+'/picture',function(response){$scope.$apply(function(){$scope.data.facebook.name=data.name;$scope.data.facebook.picture=response.data.url;$scope.data.facebook.access_token=data.access_token})})}
$scope.publishSocialFacebook=function(data){var post={};post.url="https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcQ1dmzDhsPc5yHJ5S6j90DUcoUEayldxlaiFDnhAyzR5YFcozADUxk1dBw";post.access_token=$scope.data.facebook.access_token;post.caption=($scope.data.facebook.description!=null)?$scope.data.facebook.description:"";if(data.socialSend!="now"){post.scheduled_publish_time=data.socialSend;post.published=!1}
post.link="https://aio.sigmamovil.com/webversion/show/"+"1-"+$scope.data.idMail+"-public-"+$scope.data.codigo+"/";$FB.api("/"+$scope.data.facebook.idPage+"/feed","POST",post,function(response){if(response&&!response.error){var photoId=response.id;var postId=response.post_id;if(typeof postId=="undefined"){postId=$scope.data.facebook.idPage+"_"+photoId}
restService.sendDataComfirmationEmail(data).then(function(data){notificationService.primary(data.message);openModalConfirm()}).catch(function(data){$FB.api("/"+photoId,"DELETE",{access_token:$scope.data.facebook.access_token},function(response){if(response&&!response.error){}});$FB.api("/"+postId,"DELETE",{access_token:$scope.data.facebook.access_token},function(response){if(response&&!response.error){}})})}else{notificationService.error("ocurrío un error haciendo el posteo, por favor validar la sessión de facebook.")}})}
if($stateParams.id){$rootScope.idMailGet=$stateParams.id;$scope.idMail=$rootScope.idMailGet}
restService.getSaxs().then(function(res){for(var i=0;i<res.length;i++){if(res[i].service=="email marketing"){$scope.ammoutEmail={ammount:res[i].amount,accountingMode:res[i].accountingMode}}}});restService.findMail($rootScope.idMailGet).then(function(res){$scope.data=res;$scope.data.test=(res.test=="1");if(res.scheduleDate!=null&&res.scheduleDate!=""){$("#valueDatepicker").val(res.scheduleDate);$scope.gmtDataBase=res.gmt;$scope.date=res.scheduleDate;$scope.oldHour=!0;restService.getlisttimezone().then(function(res){$scope.timezone=res;$scope.zonahoraria.zone=$filter('getById')($scope.timezone,res.gmt)})}else{restService.getlisttimezone().then(function(res){$scope.timezone=res;$scope.zonahoraria.zone=$filter('getById')($scope.timezone,"-0500")});$scope.oldHour=!1}
if(res.target!=null&&res.target!=""){var json=jQuery.parseJSON(res.target);if(json.type=="contactlist"){$scope.data.titleList='Lista(s) de contacto(s): ';$scope.data.contacts=json.contactlists}else if(json.type=="segment"){$scope.data.titleList='Segmento(s): ';$scope.data.contacts=json.segment}}
restService.getContentMail($rootScope.idMailGet).then(function(resStatics){if(resStatics.statisticsEmails!=""){$scope.data.statisticsEmails={statisticsEmails:resStatics.statisticsEmails,quantity:resStatics.quantity,typeTime:resStatics.typeTime}}else{$scope.data.statisticsEmails=!1}
if(resStatics.notificationEmails!=""){$scope.data.notificationEmails=resStatics.notificationEmails}else{$scope.data.notificationEmails=!1}
if(resStatics.facebook){$scope.data.facebook=resStatics.facebook;if($FB.loaded){$scope.loginFB($scope.data.facebook.idPage)}else{$timeout(function(){$scope.loginFB($scope.data.facebook.idPage)},2000)}}else{$scope.data.facebook=!1}})
restService.findEmailSender(res.idEmailsender).then(function(resEmailSender){$scope.data.emailSender=resEmailSender.email});restService.findEmailName(res.idNameSender).then(function(resEmailname){$scope.data.nameSender=resEmailname.name});if(res.idReplyTo!=null&&angular.isDefined(res.idReplyTo)){restService.findReplyto(res.idReplyTo).then(function(resReplyto){$scope.data.replyto=resReplyto.email})}else{$scope.data.replyto=null}
restService.findMailCategory($rootScope.idMailGet).then(function(res){$scope.data.category=res});restService.findMailAttachment($rootScope.idMailGet).then(function(res){$scope.data.attachment=res;$scope.data.sizeAttachment=0;if($scope.data.attachment.length>0){for(var i in $scope.data.attachment){$scope.data.sizeAttachment=$scope.data.sizeAttachment+parseInt($scope.data.attachment[i].size)}}})});var dateUnix=moment().utc().valueOf();var gmt;$scope.changeTestMail=function(test){var data={};if(test){data.test=1}else{data.test=0}
restService.changeTestMail($rootScope.idMailGet,data).then(function(res){notificationService.primary("Se actualizo correctamente el correo.")})}
$scope.tick=function(){var selecteDate=$("#valueDatepicker").val();if(!selecteDate.length==0){$scope.dateSelectedUnix=moment(selecteDate).utc().valueOf();dateUnix=$scope.dateSelectedUnix}
if(typeof($scope.zonahoraria.zone)=="undefined"){gmt="-0500"}else{gmt=$scope.zonahoraria.zone.gmt}
if(!$scope.oldHour){$scope.date=moment(dateUnix).utcOffset(gmt).format('YYYY-MM-DD HH:mm');$scope.dateCompare=moment(dateUnix).utcOffset(gmt).add(10,'minutes').format('YYYY-MM-DD HH:mm')}}
$scope.program=function(){var gmt;var selecteDate=$("#valueDatepicker").val();if(selecteDate.length==0){notificationService.error("No se puede programar el envio, falta la fecha de envio");return!1}
var timenow=moment().utc('-0500').format('YYYY-MM-DD HH:mm');if($scope.dateCompare<=timenow){notificationService.error("No se puede programar el envio, la fecha de envio ya expiro");return!1}
var enviar={dateSelected:selecteDate,gmt:$scope.zonahoraria.zone.gmt,idMail:$scope.idMail};restService.sendScheduleDateEmail(enviar).then(function(data){notificationService.primary(data.message);$scope.oldHour=!0;$scope.data.gmt=$scope.gmtDataBase=data.mail.gmt;$scope.data.scheduleDate=$scope.date=data.mail.scheduleDate})}
$scope.reprogram=function(){$scope.oldHour=!1;$("#valueDatepicker").val(moment(new Date()).format('YYYY-MM-DD HH:mm'));$scope.zonahoraria.zone=$filter('getById')($scope.timezone,"-0500");$scope.date=moment(new Date()).format('YYYY-MM-DD HH:mm')}
$scope.sendNow=function(){var gmt='-0500';var enviar={dateSelected:moment().utcOffset(gmt).format('YYYY-MM-DD HH:mm'),gmt:$scope.zonahoraria.zone.gmt,idMail:$scope.idMail};restService.sendScheduleDateEmail(enviar).then(function(data){notificationService.primary(data.message);$scope.oldHour=!0;$scope.data.gmt=$scope.gmtDataBase=data.mail.gmt;$scope.data.scheduleDate=$scope.date=data.mail.scheduleDate})};$scope.closeModalConfirm=function(){location.href=fullUrlBase+templateBase};$scope.sendConfirmation=function(){$scope.dateConfirmation=moment(new Date()).format('YYYY-MM-DD HH:mm');$scope.getMd5($scope.data)};$scope.sendDataConfirmationEmail=function(data){restService.sendDataComfirmationEmail(data).then(function(data){notificationService.primary(data.message);openModalConfirm()})}
$scope.validateData=function(){var data=$scope.data;var objSendDataConfirmation={};var defer=$q.defer();var message="No se puede enviar el mensaje porque falta el campo ";if(data.name==0||!angular.isDefined(data.name)){defer.reject(!1);notificationService.error(message+"nombre correo")}
if(data.emailSender==0||!angular.isDefined(data.emailSender)){defer.reject(!1);notificationService.error(message+"remitente")}
if(data.category==0||!angular.isDefined(data.category)){defer.reject(!1);notificationService.error(message+"categoria de correos")}
if(data.subject==0||!angular.isDefined(data.subject)){defer.reject(!1);notificationService.error(message+"asunto de correo")}
if(data.target==null||!angular.isDefined(data.target)){defer.reject(!1);notificationService.error(message+"destinatarios")}
if(data.scheduleDate==null||!angular.isDefined(data.scheduleDate)){defer.reject(!1);notificationService.error(message+"fecha y hora de envio")}
if(data.sizeAttachment>2000000){defer.reject(!1);notificationService.error("El tamaño de todos los adjuntos es mayor a lo permitido")}
if(angular.isDefined($scope.ammoutEmail)){if($scope.ammoutEmail.accountingMode=="sending"){if(parseInt($scope.ammoutEmail.ammount)<parseInt(data.quantitytarget)){defer.reject(!1);notificationService.error("No tiene saldo suficiente para realizar el envío, le invitamos a recargar el servicio.")}}}else{defer.reject(!1);notificationService.error("No tiene los servicios para realizar la camapaña, por favor comunicarse con soporte")}
var scheduleDate=moment(data.scheduleDate).utc(data.gmt).add(10,'minutes').format('YYYY-MM-DD HH:mm');var nowhour=moment().utc('-0500').format('YYYY-MM-DD HH:mm');var dateProgram=moment(scheduleDate);var hournow=moment();var programeSocial='now';if(scheduleDate<=nowhour){defer.reject(!1);notificationService.error("la fecha de programación ya expiro, por favor validar.")}else{var postDate=moment(data.scheduleDate).utc(data.gmt);var nowMoment=moment().utc('-0500');if(postDate.diff(nowMoment,'minutes')<=20){programeSocial="now"}else{programeSocial=moment(dateProgram).unix()}}
objSendDataConfirmation={dateConfirmation:$scope.dateConfirmation,idMail:$scope.idMail,socialSend:programeSocial};defer.resolve(objSendDataConfirmation);return defer.promise}
$scope.test={};$scope.loaderTestMail=!1;$scope.sendTestMail=function(){$scope.test.idMail=$stateParams.id;$scope.loaderTestMail=!0;restService.sendTestMail($scope.test).then(function(data){notificationService.success(data.message);$scope.test.target='';$scope.test.message='';$scope.loaderTestMail=!1}).catch(function(data){$scope.loaderTestMail=!1})};$scope.sendTesterMail=function(){$scope.test.idMail=$stateParams.id;$scope.loaderTestMail=!0;restService.sendTestMail($scope.test).then(function(data){notificationService.success(data.message);$scope.test.target='';$scope.test.message='';$scope.loaderTestMail=!1}).catch(function(data){$scope.loaderTestMail=!1})};restService.getThumbnailMail($stateParams.id).then(function(data){console.log(data.thumb);$scope.urlThumbnail=data.thumb});$scope.downloadMailPreview=function(){restService.downloadMailPreview($stateParams.id).then(function(data){if(!data.thumb){notificationService.error("Ocurrio un error generando el archivo, por favor comunicarse con el administrador.")}else{var url=fullUrlBase+data.thumb;location.href=url}})};$scope.getMd5=function(data){restService.getMd5publish(data).then(function(data){$scope.data.codigo=angular.copy(data.data);$scope.validateData().then(function(success){if($scope.data.facebook){$scope.publishSocialFacebook(success)}else{$scope.sendDataConfirmationEmail(success)}})}).catch(function(data){})}}]).controller('addAddresseesController',['$scope','restService','$window','incomplete','$rootScope','$stateParams','notificationService','wizard',function($scope,restService,$window,incomplete,$rootScope,$stateParams,notificationService,wizard){$rootScope.idMailGet=$stateParams.id;$scope.enabled=!1;if(!IsNumeric($stateParams.id)){notificationService.warning("El correo no se ha encontrado");location.href='#/basicinformation/'}
$scope.data={singleMail:!0};function IsNumeric(val){return Number(parseFloat(val))==val}
wizard.setdescribe(!1);wizard.setaddressees(!0);wizard.setcontent(!1);wizard.setadvanceoptions(!1);wizard.setshippingdate(!1);$rootScope.addressees=wizard.getaddressees();$rootScope.describe=wizard.getdescribe();$rootScope.content=wizard.getcontent();$rootScope.advanceoptions=wizard.getadvanceoptions();$rootScope.shippingdate=wizard.getshippingdate();$scope.idMail=$rootScope.idMailGet;$scope.disabledContactlist=!1;$scope.disabledSegment=!1;$scope.addressees=[];$scope.addressees={selectdContactlis:[]};$scope.addressees={selectdSegment:[]};$scope.addressees.showSegment=!0;$scope.addressees.showstep1=!0;$scope.addressees.showContactlist=!0;$scope.addressees.count=0;$scope.statusandtype="";restService.findMail($scope.idMail).then(function(data){$scope.addressees.count=data.quantitytarget;console.log(data);if(data.singleMail==1){$scope.data={singleMail:!0}}else if(data.singleMail==0&&data.target==null){$scope.data={singleMail:!0}}else if(data.singleMail==0){$scope.data={singleMail:!1}}
if(data.target){$scope.addressees.showstep1=!1;var json=jQuery.parseJSON(data.target);if(json.type=="contactlist"){$scope.statusandtype=json.type;$scope.addressees.showContactlist=!1;$scope.addressees.selectdContactlis=json.contactlists;$scope.getAllContactlist()}else if(json.type=="segment"){$scope.statusandtype=json.type;$scope.addressees.showSegment=!1;$scope.addressees.selectdSegment=json.segment;$scope.getAllSegment()}
if(json.filters){$scope.filters=json.filters;$scope.addressees.condition=json.condition}}});$scope.clearSelect=function(){$scope.filters=[];$scope.addressees.count=0;$scope.disabledContactlist=!1;$scope.disabledSegment=!1;$scope.addressees.selectdContactlis="";$scope.addressees.selectdSegment=""};$scope.getContactlist=function(){$scope.filters=[];$scope.addressees={selectdSegment:[]};$scope.segments=[];$scope.contactlists=[];$scope.addressees.showstep1=!1;$scope.addressees.count=0;$scope.addressees.showSegment=!0;$scope.addressees.showContactlist=!1;$scope.prueba=undefined;$scope.getAllContactlist();$scope.getAllSegment()};$scope.getAllContactlist=function(){restService.getContactlist().then(function(data){$scope.contactlists=data;$scope.only()})};$scope.getSegment=function(){$scope.filters=[];$scope.addressees={selectdContactlis:[]};$scope.segments=[];$scope.contactlists=[];$scope.addressees.showstep1=!1;$scope.addressees.count=0;$scope.prueba=undefined;$scope.prueba2=undefined;$scope.addressees.selectdContactlis=[];$scope.addressees.selectdSegment=[];$scope.addressees.showSegment=!1;$scope.addressees.showContactlist=!0;$scope.getAllSegment();$scope.getAllContactlist()};$scope.getAllSegment=function(){restService.getSegment().then(function(data){$scope.segments=data})};$scope.selectAction=function(){$scope.countContacts("contactlist")};$scope.selectActionSegment=function(){$scope.countContacts("segment")};$scope.countContacts=function(type){$scope.addressees.count=0;var data={type:type,segment:$scope.addressees.selectdSegment,contactlist:$scope.addressees.selectdContactlis,filters:$scope.filters,condition:$scope.addressees.condition,idMail:$scope.idMail};restService.countContact(data).then(function(data){$scope.addressees.count=data;$scope.only()})};$scope.addAddressees=function(){var data={selectdContactlis:$scope.addressees.selectdContactlis,selectdSegment:$scope.addressees.selectdSegment,showSegment:$scope.addressees.showSegment,showContactlist:$scope.addressees.showContactlist,idMail:$scope.idMail,quantitytarget:$scope.addressees.count,filters:$scope.filters,condition:$scope.addressees.condition,singleMail:$scope.data.singleMail};if($scope.addressees.selectdContactlis&&$scope.addressees.selectdContactlis.length>0){incomplete.setincomplete(!1);$rootScope.incomplete=incomplete.getincomplete();$scope.add(data)}else if($scope.addressees.selectdSegment&&$scope.addressees.selectdSegment.length>0){incomplete.setincomplete(!1);$rootScope.incomplete=incomplete.getincomplete();$scope.add(data)}else{incomplete.setincomplete(!0);$rootScope.incomplete=incomplete.getincomplete();$scope.add(data)}};$scope.allSegment=function(){$scope.disabledSegment=!0;$scope.addressees.selectdSegment=$scope.segments;$scope.selectActionSegment()};$scope.allContactlist=function(){$scope.disabledContactlist=!0;$scope.addressees.selectdContactlis=$scope.contactlists;$scope.selectAction()};$scope.filters=[];$scope.tipeFilters=[{id:1,name:"Enviar a contactos que hayan recibido un correo"},{id:2,name:"Enviar a contactos que hayan abierto un correo"},{id:3,name:"Enviar a contactos que hayan hecho clic un enlace"}];$scope.selectMailFilter=function(key){if(key.typeFilters==3){restService.getLinksByMail(key.mailSelected).then(function(data){key.links=data})}else{if(!$scope.addressees.showContactlist){$scope.countContacts("contactlist")}else{$scope.countContacts("segment")}}};function IsNumeric(val){return Number(parseFloat(val))==val}
$scope.selectinverted=function(key){if(key.typeFilters==3){if(IsNumeric(key.mailSelected)&&IsNumeric(key.mailSelected)&&IsNumeric(key.linkSelected)){if(!$scope.addressees.showContactlist){$scope.countContacts("contactlist")}else{$scope.countContacts("segment")}}}else{if(IsNumeric(key.mailSelected)&&key.typeFilters){if(!$scope.addressees.showContactlist){$scope.countContacts("contactlist")}else{$scope.countContacts("segment")}}}};$scope.selectLinkFilter=function(){if(!$scope.addressees.showContactlist){$scope.countContacts("contactlist")}else{$scope.countContacts("segment")}};$scope.selectTypeFilter=function(key){key.mailSelected=[];key.linkSelected=[];key.mail=[];key.links=[];key.inverted="";restService.getMailFilters(key.typeFilters).then(function(data){key.mail=data});switch(key.typeFilters){case 1:break;case 2:break;case 3:break}};$scope.addFilter=function(){$scope.addressees.condition="all";$scope.filters.push({})};$scope.removeFilters=function(index){$scope.filters.splice(index,1);if(!$scope.addressees.showContactlist){$scope.countContacts("contactlist")}else{$scope.countContacts("segment")}};$scope.add=function(data){restService.addAddressees(data).then(function(){notificationService.success("Se ha guardado la selección de destinatarios correctamente");location.href='#/content/'+$scope.idMail})};$scope.only=function(){console.log($scope.addressees.showContactlist);if($scope.addressees.showContactlist==!1){var data={selectdContactlis:$scope.addressees.selectdContactlis,singleMail:$scope.data.singleMail};if(typeof data.selectdContactlis!=='undefined'){restService.only(data).then(function(data){$scope.addressees.count=data})}}};$scope.only()}]).controller('index',['$scope','incomplete','$rootScope','restService','notificationService','$interval',function($scope,incomplete,$rootScope,restService,notificationService,$interval){$scope.viewlist=!0;$scope.viewnolist=!0;$scope.prueba=[{name:'Eliminar'}];$scope.initial=0;$scope.page=1;$scope.mail=[{}];$scope.mailToTemplate=[];$scope.selected=[];$scope.filter="";$scope.showTest=!1;$scope.confirmDelete=function(idMail){$scope.idMail=idMail;openModal()};$scope.confirmCancel=function(idMail){$scope.idMail=idMail;openModalCancel()};$scope.previewmailtempcont=function(id){restService.previewMailTemplateContent(id).then(function(data){var e=data.template;$('#content-preview').empty();$('<iframe frameborder="0" width="100%" height="100%"/>').appendTo('#content-preview').contents().find('body').append(e);$('#myModal').modal('show')})};$scope.pauseMailAn=function(idMail){pauseMail(idMail)};$scope.cancelMailAn=function(idMail){cancelMail(idMail)};$scope.resumeMailAn=function(idMail){resumeMail(idMail)};$scope.cancelMail=function(){restService.cancelMail($scope.idMail).then(function(data){notificationService.warning(data.message);closeModalCancel();$scope.getAll()})};$scope.deleteMail=function(){restService.deleteMail($scope.idMail).then(function(data){notificationService.warning(data.message);closeModal();$scope.getAll()})};$scope.filter={category:[]};$scope.$watch('showTest',function(){if($scope.showTest){$scope.filter.showTest=0}else{$scope.filter.showTest=1}
$scope.getAll()},!0);$scope.forward=function(){$scope.initial+=1;$scope.page+=1;$scope.getAll()};$scope.fastforward=function(){$scope.initial=($scope.mail.total_pages-1);$scope.page=$scope.mail.total_pages;$scope.getAll()};$scope.backward=function(){$scope.initial-=1;$scope.page-=1;$scope.getAll()};$scope.fastbackward=function(){$scope.initial=0;$scope.page=1;$scope.getAll()};$scope.search=function(){$scope.getAll()};$scope.searchcategory=function(){if($scope.filter.category.length>=1){$scope.getAll()}else{$scope.getAll()}};$scope.$watch('[filter.dateinitial,filter.dateend]',function(){$scope.getAll()});$scope.getAll=function(){if(angular.isDefined($scope.mail[0])){$scope.mail[0].items=[]}
restService.getAllMail($scope.initial,$scope.filter).then(function(data){$scope.mail=data})};var statusVerify=function(){restService.getAllMail($scope.initial,$scope.filter).then(function(data){data[0].items.forEach(function(item,index){if($scope.mail[0].items[index].status!=item.status){$scope.mail[0].items[index].status=item.status}})})};$interval(statusVerify,1000);restService.getMailCategory($scope.initial,$scope.filter).then(function(data){$scope.mailCategory=data});$scope.toggle=function(item,list){var idx=list.indexOf(item);if(idx>-1){list.splice(idx,1)}else{list.push(item)}};$scope.exists=function(item,list){return list.indexOf(item)>-1};$scope.isChecked=function(){return $scope.mail[0].items&&$scope.selected.length===$scope.mail[0].items.length};$scope.isIndeterminate=function(){$scope.initial=0;$scope.page=1;return($scope.selected.length!==$scope.mail[0].items.length)};$scope.toggleAll=function(){if($scope.selected.length===$scope.mail[0].items.length){$scope.selected=[]}else if($scope.selected.length===0||$scope.selected.length>0){$scope.selected=$scope.mail[0].items.slice(0)}};$scope.getAll();$scope.targetString=function(target){var string="";return string}
$scope.empty=!1;$scope.length=!1;$scope.categ=!1;$scope.restart=function(idMail){for(var i=0;i<$scope.mail[0].items.length;i++){if($scope.mail[0].items[i].idMail==idMail){$scope.mailToTemplate=$scope.mail[0].items[i];break}}
$scope.empty=!1;$scope.length=!1;$scope.categ=!1;$scope.namemailtempcat=''};restService.getMailTemplateCategory().then(function(data){$scope.mailtempcats=data});$scope.saveMailAsMailTemplate=function(){restService.getMailContentJSON($scope.mailToTemplate.idMail).then(function(data){$scope.editor=data.content;if(angular.isUndefined($scope.namemailtempcat)||$scope.namemailtempcat===''){$scope.empty=!0;$scope.length=!1;return!1}
if($scope.namemailtempcat.length<2||$scope.namemailtempcat.length>80){$scope.empty=!1;$scope.length=!0;return!1}
if(angular.isUndefined($scope.mailtempcat)){$scope.categ=!0;return!1}
var data={nameMailTemplate:$scope.namemailtempcat,mailTemplateCateg:$scope.mailtempcat,editor:$scope.editor};console.log(data);restService.saveMailAsMailTemplate(data,null).then(function(data){$("#saveMailAsMailTemplate").modal("hide");$scope.namemailtempcat='';$scope.mailtempcat='';$scope.empty=!1;$scope.length=!1;$scope.cat=!1;notificationService.success(data.message)})})}}]).controller('contentController',['$scope','restService','$stateParams','$rootScope','notificationService','$filter','wizard',function($scope,restService,$stateParams,$rootScope,notificationService,$filter,wizard){wizard.setdescribe(!1);wizard.setaddressees(!1);wizard.setcontent(!0);wizard.setadvanceoptions(!1);wizard.setshippingdate(!1);$rootScope.addressees=wizard.getaddressees();$rootScope.describe=wizard.getdescribe();$rootScope.content=wizard.getcontent();$rootScope.advanceoptions=wizard.getadvanceoptions();$rootScope.shippingdate=wizard.getshippingdate();$rootScope.idMailGet=$stateParams.id;$scope.idMail=$rootScope.idMailGet;$scope.imagenDate=new Date();$scope.imagenTime=$scope.imagenDate.getTime();if(!IsNumeric($stateParams.id)){notificationService.warning("El correo no se ha encontrado");location.href='#/basicinformation/'}
function IsNumeric(val){return Number(parseFloat(val))==val}
$scope.getContent={};$scope.setPlane={};$scope.boolEditors=!0;$scope.PlaneError={};htmlPreview($scope.idMail);restService.getContentMail($scope.idMail).then(function(data){if(!data.content){$scope.boolEditors=!0}else{restService.getThumbnailMail($stateParams.id).then(function(data){$scope.urlThumbnail=data.thumb});$scope.boolEditors=!1;$scope.getContent=data.content;$scope.setPlane.content=data.content.plaintext}});$scope.addplaintext=function(){var data={idMail:$scope.idMail,plaintext:$scope.setPlane.content};restService.addPlaintext(data).then(function(){notificationService.primary("Se ha modificado el texto plano del correo");$scope.closeModal()})};$scope.openModal=function(){$('.dialog').addClass('dialog--open')}
$scope.closeModal=function(){$('.dialog').removeClass('dialog--open')}}]).controller('contentEditorController',['$scope','restService','notificationService',function($scope,restService,notificationService){$scope.registerContent=function(idMail){var data={editor:document.getElementById('iframeEditor').contentWindow.catchEditorData()};restService.addContentEditor(idMail,data).then(function(res){location.href=fullUrlBase+templateBase+'/create#/content/'+res.idMail})};$scope.saveContent=function(idMail){var data={editor:document.getElementById('iframeEditor').contentWindow.catchEditorData()};restService.addContentEditor(idMail,data).then(function(res){document.getElementById('iframeEditor').contentWindow.RecreateEditor();notificationService.success(res.msg)})};$scope.empty=!1;$scope.length=!1;$scope.categ=!1;$scope.saveMailAsMailTemplate=function(){if(angular.isUndefined($scope.namemailtempcat)||$scope.namemailtempcat===''){$scope.empty=!0;$scope.length=!1;return!1}
if($scope.namemailtempcat.length<2||$scope.namemailtempcat.length>80){$scope.empty=!1;$scope.length=!0;return!1}
if(angular.isUndefined($scope.mailtempcat)){$scope.categ=!0;return!1}
var data={nameMailTemplate:$scope.namemailtempcat,mailTemplateCateg:$scope.mailtempcat,editor:document.getElementById('iframeEditor').contentWindow.catchEditorData()};document.getElementById('iframeEditor').contentWindow.RecreateEditor();restService.saveMailAsMailTemplate(data,null).then(function(data){$("#saveMailAsMailTemplate").modal("hide");$scope.namemailtempcat='';$scope.mailtempcat='';$scope.empty=!1;$scope.length=!1;$scope.cat=!1;notificationService.success(data.message)})};$scope.restart=function(){$scope.empty=!1;$scope.length=!1;$scope.categ=!1;$scope.namemailtempcat=''}}]).controller('contentUrlController',['$scope','restService','notificationService',function($scope,restService,notificationService){$scope.trimContent=function(){$('#url').val($('#url').val().trim())}
$scope.registerContentUrl=function(){sendData("no load")}}]).controller('advanceoptionsController',['$scope','restService','notificationService','$rootScope','$stateParams','$mdDialog','FileUploader','wizard','$FB','$q','constantMail','$timeout',function($scope,restService,notificationService,$rootScope,$stateParams,$mdDialog,FileUploader,wizard,$FB,$q,constantMail,$timeout){$scope.dataadv={};$scope.sizeFiles=0;var num=1;var numbers=[];while(num<=30){numbers[num]=num;num++}
$scope.numbers=numbers;$scope.typesTimes={hour:"horas",day:"días",week:"semanas"};$scope.dataadv.notifications=!1;$scope.dataadv.notificationEmails="";$scope.dataadv.statistics=!1;$scope.dataadv.statisticsEmails="";wizard.setdescribe(!1);wizard.setaddressees(!1);wizard.setcontent(!1);wizard.setadvanceoptions(!0);wizard.setshippingdate(!1);$rootScope.addressees=wizard.getaddressees();$rootScope.describe=wizard.getdescribe();$rootScope.content=wizard.getcontent();$rootScope.advanceoptions=wizard.getadvanceoptions();$rootScope.shippingdate=wizard.getshippingdate();$rootScope.idMailGet=$stateParams.id;if(!IsNumeric($stateParams.id)){notificationService.warning("El correo no se ha encontrado");location.href='#/basicinformation/'}
function IsNumeric(val){return Number(parseFloat(val))==val}
$scope.idMail=$rootScope.idMailGet;$scope.status='  ';$scope.customFullscreen=!1;$scope.deleteAttached=function(id,index){restService.deleteAttached(id).then(function(){$scope.attach()})};function DialogController($scope,$mdDialog){$scope.hide=function(){$mdDialog.hide()};$scope.cancel=function(){$mdDialog.cancel()};$scope.answer=function(answer){$scope.selectFile();$mdDialog.hide(answer)}}
var uploadUrl=fullUrlBase+"gallery/uploadfileadjunt/"+$scope.idMail;var uploader=$scope.uploader=new FileUploader({url:uploadUrl});uploader.onWhenAddingFileFailed=function(item,filter,options){};uploader.onAfterAddingFile=function(fileItem){$scope.uploader.queue[$scope.uploader.queue.length-1].upload()};uploader.onAfterAddingAll=function(addedFileItems){};uploader.onBeforeUploadItem=function(item){};uploader.onProgressItem=function(fileItem,progress){};uploader.onProgressAll=function(progress){};uploader.onSuccessItem=function(fileItem,response,status,headers){};uploader.onErrorItem=function(fileItem,response,status,headers){};uploader.onCancelItem=function(fileItem,response,status,headers){};uploader.onCompleteItem=function(fileItem,response,status,headers){};uploader.onCompleteAll=function(){$scope.attach()};$scope.showTabDialog=function(ev){document.body.scrollTop=0;$mdDialog.show({scope:$scope.$new(),controller:DialogController,templateUrl:'tabDialog.tmpl.html',parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status='You cancelled the dialog.'})};$scope.answer=function(answer){$mdDialog.hide(answer)};$scope.fileadjunt=[];$scope.fileSelecteds=[];$scope.divfile=!0;$scope.count=0;$scope.initial=0;$scope.page=1;$scope.hidefile=!1;$scope.search=function(){$scope.getAll()};$scope.forward=function(){$scope.initial+=1;$scope.page+=1;$scope.getAll()};$scope.fastforward=function(){$scope.initial=($scope.gallery.total_pages-1);$scope.page=$scope.gallery.total_pages;$scope.getAll()};$scope.backward=function(){$scope.initial-=1;$scope.page-=1;$scope.getAll()};$scope.fastbackward=function(){$scope.initial=0;$scope.page=1;$scope.getAll()};$scope.getAll=function(){restService.getAllGallery($scope.initial).then(function(data){$scope.gallery=data;$scope.attach()})};$scope.attach=function(){restService.getAllAttachment($scope.idMail).then(function(data){$scope.fileadjunt=data;$scope.sizeFiles=0;$scope.fileSelecteds=angular.copy($scope.fileadjunt);if($scope.fileadjunt.length>0){$scope.hidefile=!0;$scope.selectFile();$scope.setSizeFile()}})};$scope.setSizeFile=function(){for(var i in $scope.fileadjunt){$scope.sizeFiles=$scope.sizeFiles+parseInt($scope.fileadjunt[i].size)}}
$scope.selectFile=function(){for(var i=0;i<$scope.gallery[0].items.length;i++){$scope.gallery[0].items[i].class={}
for(var j in $scope.fileadjunt){if($scope.fileadjunt[j].idAsset==$scope.gallery[0].items[i].idAsset){$scope.gallery[0].items[i].class.border="1px solid red";$scope.gallery[0].items[i].class.opacity=0.5}}}};$scope.selectedAsset=function(data,$index){var x=$scope.gallery[0].items[$index];if(angular.isDefined(x.class)&&!angular.equals(x.class,{})){for(var i in $scope.fileSelecteds){if($scope.fileSelecteds[i].idAsset==data.idAsset){$scope.fileSelecteds.splice(i,1)}}
$scope.gallery[0].items[$index].class={}}else{$scope.fileSelecteds.push(data);$scope.gallery[0].items[$index].class={};$scope.gallery[0].items[$index].class.border="1px solid red";$scope.gallery[0].items[$index].class.opacity=0.5}};$scope.addFile=function(){if($scope.fileSelecteds.length>0){$scope.hidefile=!0;var data={file:$scope.fileSelecteds,idMail:$scope.idMail};restService.addAdjunt(data).then(function(){$scope.attach()})}
$scope.answer('not useful')};$scope.addFileLoad=function(){};$scope.getAll();$scope.googleAnalyticsLink=[];$scope.showLinksGoogleAnalytics=!1;$scope.googleAnalytics={links:[],campaignName:"",idMail:$stateParams.id};$scope.disabledSendDataGoogleAnalytics=!1;$scope.sendDataGoogleAnalytics=function(){if($scope.googleAnalytics.campaignName.length<2||$scope.googleAnalytics.links.length==0){notificationService.error("Los campos nombre de campaña y seguimiento de Google Analytics no pueden estar vacios.")}else{restService.sendDataGoogleAnalitics($scope.googleAnalytics).then(function(data){if(data.action=="create"){notificationService.success(data.message)}else{notificationService.primary(data.message)}})}};$scope.clearDataGoogleAnalytics=function(){$scope.googleAnalytics.campaignName="";$scope.googleAnalytics.links=[]};$scope.discardChangesGoogleAnalytics=function(){$scope.showLinksGoogleAnalytics=!1;$scope.googleAnalytics.campaignName="";$scope.googleAnalytics.links=[]};$scope.changeNotifications=function(){$("#notificationArea").removeClass("error-focus");if(!$scope.notifications){$scope.dataadv.notificationEmails="";$("#advert-error").removeClass('color-danger')}}
$scope.changeStatistics=function(){$("#statisticsArea").removeClass("error-focus");if(!$scope.statistics){$scope.dataadv.statisticsEmails="";$scope.dataadv.quantity=null;$scope.dataadv.typeTime=null;$("#advert-error-statistics").removeClass('color-danger')}}
$scope.validateEmail=function(){$("#notificationArea").removeClass("error-focus");var notEmails=$scope.dataadv.notificationEmails.split(',');var cont=0;var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;for(i=0;i<notEmails.length;i++){if(!re.test(notEmails[i])){cont++}}
if(cont>0){$("#notificationArea").addClass('error-focus')}
if(notEmails.length==1&&notEmails[0]==''){$("#notificationArea").removeClass("error-focus");$("#advert-error").removeClass('color-danger')}
if(notEmails.length>8){$("#notificationArea").addClass('error-focus');$("#advert-error").addClass('color-danger')}else{$("#advert-error").removeClass('color-danger')}}
$scope.validateEmailStatistics=function(){$("#statisticsArea").removeClass("error-focus");var notEmails=$scope.dataadv.statisticsEmails.split(',');var cont=0;var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;for(i=0;i<notEmails.length;i++){if(!re.test(notEmails[i])){cont++}}
if(cont>0){$("#statisticsArea").addClass('error-focus')}
if(notEmails.length==1&&notEmails[0]==''){$("#statisticsArea").removeClass("error-focus");$("#advert-error-statistics").removeClass('color-danger')}
if(notEmails.length>8){$("#statisticsArea").addClass('error-focus');$("#advert-error-statistics").addClass('color-danger')}else{$("#advert-error-statistics").removeClass('color-danger')}}
function ModalPageFacebookCtrl($scope,$mdDialog,pages){$scope.pages=pages
$scope.hide=function(){$mdDialog.hide()};$scope.closeDialog=function(){$mdDialog.cancel()};$scope.selectedPage=function(page){$mdDialog.hide(page)}}
$scope.appFacebook={fanPageSelected:!1,changeSwitch:function(){if($scope.appFacebook.facebook){if(!this.fanPageSelected){$scope.appFacebook.login(!1)}}else{}},login:function(objPage){console.log($FB);$FB.getLoginStatus(function(response){console.log(response);if(response.status==='connected'){$FB.api('/'+$FB.getUserID()+'/accounts',function(response){if(!objPage){$scope.appFacebook.showModalSelectedPage(response)}else{$scope.appFacebook.setFacebook(response,objPage)}})}else{$FB.login(function(){$FB.api('/'+$FB.getUserID()+'/accounts',function(response){if(!objPage){$scope.appFacebook.showModalSelectedPage(response)}else{$scope.appFacebook.setFacebook(response,objPage)}})},{scope:'publish_actions,publish_pages,manage_pages'})}})},getPicturesPage:function(id){var defer=$q.defer();var promise=defer.promise;FB.api('/'+id+'/picture',function(response){defer.resolve(response)});return promise},getFanPageArr:function(data){var defer=$q.defer();var promises=[];var response=data;angular.forEach(response,function(value){promises.push($scope.appFacebook.getPicturesPage(value.id))});function setResolve(data){for(var i=0;i<data.length;i++){response[i].picture=data[i].data.url}
defer.resolve(response)}
$q.all(promises).then(function(data){setResolve(data)});return defer.promise},showModalSelectedPage:function(data){var pages=data.data
$scope.appFacebook.getFanPageArr(pages).then(function(data){document.body.scrollTop=0;$mdDialog.show({scope:$scope.$new(),controller:ModalPageFacebookCtrl,template:constantMail.templateModalPageFacebook,parent:angular.element(document.body),clickOutsideToClose:!0,locals:{pages:data},}).then(function(response){$scope.appFacebook.fanPageSelected=response},function(){if(!$scope.appFacebook.fanPageSelected){$scope.appFacebook.facebook=!1}})})},setFacebook:function(response,objPage){$scope.appFacebook.getPicturesPage(objPage.idPage).then(function(data){for(var i=0;i<response.data.length;i++){let value=response.data[i];console.log(parseInt(value.id)==parseInt(objPage.idPage));if(parseInt(value.id)==parseInt(objPage.idPage)){$scope.appFacebook.facebook=!0;$scope.appFacebook.fanPageSelected=value;$scope.appFacebook.fanPageSelected.picture=data.data.url;$scope.appFacebook.descriptionPublish=objPage.description;console.log($scope.appFacebook);break}}})}};restService.getContentMail($scope.idMail).then(function(data){$scope.showLinksGoogleAnalytics=(data.googleAnalytics==1?!0:!1);$scope.googleAnalyticsLinks=data.content.links;if(typeof data.googleAnalyticsData!=='undefined'){$scope.googleAnalytics=data.googleAnalyticsData}
if(data.notificationEmails){$scope.dataadv.notifications=!0;$scope.dataadv.notificationEmails=data.notificationEmails}
if(data.statisticsEmails){$scope.dataadv.statistics=!0;$scope.dataadv.statisticsEmails=data.statisticsEmails;$scope.dataadv.quantity=data.quantity;$scope.dataadv.typeTime=data.typeTime}
if(data.facebook){var data={idPage:data.facebook.idPage,description:data.facebook.description};if($FB.loaded){$scope.appFacebook.login(data)}else{$timeout(function(){$scope.appFacebook.login(data)},100)}}
$scope.saveAdvanceOptions=function(){if($scope.appFacebook.facebook&&$scope.appFacebook.fanPageSelected){$scope.dataadv.facebook=angular.copy($scope.appFacebook)}else{$scope.dataadv.facebook=!1}
$scope.dataadv.googleAnalytics=$scope.showLinksGoogleAnalytics;restService.saveAdvanceOptions($scope.idMail,$scope.dataadv).then(function(data){notificationService.primary("La información del mail ha sido actualizada correctamente.");window.location.href=fullUrlBase+templateBase+'/create#/shippingdate/'+$scope.idMail})}})}]).controller('mailStructureEditorController',['$scope','restService','notificationService','$rootScope','$stateParams',function($scope,restService,notificationService,$rootScope,$stateParams){$scope.initial=0;$scope.page=1;$scope.filter="";$scope.search=function(){$scope.getAll()};$scope.forward=function(){$scope.initial+=1;$scope.page+=1;$scope.getAll()};$scope.fastforward=function(){$scope.initial=($scope.mailstructure.total_pages-1);$scope.page=$scope.mailstructure.total_pages;$scope.getAll()};$scope.backward=function(){$scope.initial-=1;$scope.page-=1;$scope.getAll()};$scope.fastbackward=function(){$scope.initial=0;$scope.page=1;$scope.getAll()};$scope.getAll=function(){restService.getAllMailStructure($scope.initial,$scope.filter).then(function(data){$scope.mailstructure=data})};$scope.getAll()}])})()