/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

eval("__webpack_require__(1);\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9qcy9hbmd1bGFyL3Ntcy9tYWluLmpzPzVhMWQiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsbUJBQU8sQ0FBQyxDQUFpQiIsImZpbGUiOiIwLmpzIiwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnLi9jb250cm9sbGVyLmpzJyk7XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vanMvYW5ndWxhci9zbXMvbWFpbi5qc1xuLy8gbW9kdWxlIGlkID0gMFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0\n");

/***/ }),
/* 1 */
/***/ (function(module, exports) {

eval("angular.module('aio', ['platanus.keepValues', 'ui.select', 'ngSanitize', 'ngMaterial', 'ngAnimate', 'moment-picker', 'angularMoment'])\r\n        .filter('propsFilter', function () {\r\n          return function (items, props) {\r\n            var out = [];\r\n            if (angular.isArray(items)) {\r\n              var keys = Object.keys(props);\r\n              items.forEach(function (item) {\r\n                var itemMatches = false;\r\n                for (var i = 0; i < keys.length; i++) {\r\n                  var prop = keys[i];\r\n                  var text = props[prop].toLowerCase();\r\n                  if (item[prop].toString().toLowerCase().indexOf(text) !== -1) {\r\n                    itemMatches = true;\r\n                    break;\r\n                  }\r\n                }\r\n\r\n                if (itemMatches) {\r\n                  out.push(item);\r\n                }\r\n              });\r\n            } else {\r\n              // Let the output be the input untouched\r\n              out = items;\r\n            }\r\n\r\n            return out;\r\n          };\r\n        })\r\n        .filter('split', function () {\r\n          return function (input, splitChar) {\r\n            // do some bounds checking here to ensure it has that index\r\n            return input.split(splitChar);\r\n          }\r\n        })\r\n        .directive('statusSms', function ($compile) {\r\n          return{\r\n            scope: {statusSms: '@'},\r\n            restrict: 'A',\r\n            link: function (scope, element, attr) {\r\n              var template = \"Estado: <span class='{{classStatus}}'>{{tralateSms}}<span>\";\r\n              scope.chaneStatus = function () {\r\n                switch (scope.statusSms) {\r\n                  case 'draft':\r\n                    scope.classStatus = 'color-draft';\r\n                    scope.tralateSms = \"Borrador\";\r\n                    break;\r\n                  case 'scheduled':\r\n                    scope.classStatus = 'color-scheduled';\r\n                    scope.tralateSms = \"Programado\";\r\n                    break;\r\n                  case 'pending':\r\n                    scope.classStatus = 'color-pending';\r\n                    scope.tralateSms = \"Pendiente\";\r\n                    break;\r\n                  case 'sending':\r\n                    scope.classStatus = 'color-sending';\r\n                    scope.tralateSms = \"En proceso de envío\";\r\n                    break;\r\n                  case 'sent':\r\n                    scope.classStatus = 'color-sent';\r\n                    scope.tralateSms = \"Enviado\";\r\n                    break;\r\n                  case 'paused':\r\n                    scope.classStatus = 'color-paused';\r\n                    scope.tralateSms = \"Pausado\";\r\n                    break;\r\n                  case 'canceled':\r\n                    scope.classStatus = 'color-canceled';\r\n                    scope.tralateSms = \"Cancelado\";\r\n                    break;\r\n                  case 'undelivered':\r\n                    scope.classStatus = 'color-canceled';\r\n                    scope.tralateSms = \"No enviado\";\r\n                    break;\r\n                  default:\r\n                    break;\r\n                }\r\n              }\r\n              scope.$watch('statusSms', function (v) {\r\n                scope.chaneStatus();\r\n                element.html(template);\r\n                $compile(element.contents())(scope);\r\n              });\r\n              scope.chaneStatus();\r\n              element.html(template);\r\n              $compile(element.contents())(scope);\r\n            }\r\n          }\r\n        })\r\n        .directive('typeSms', function ($compile) {\r\n          return{\r\n            restrict: 'A',\r\n            link: function (scope, element, attr) {\r\n              var template = \"Tipo: {{statusType}}\";\r\n              switch (attr.typeSms) {\r\n                case 'contact':\r\n                  scope.statusType = \"Contacto\";\r\n                  break;\r\n                case 'csv':\r\n                  scope.statusType = \"Csv\";\r\n                  break;\r\n                case 'lote':\r\n                  scope.statusType = \"Envío rapido\";\r\n                  break;\r\n                case 'automatic':\r\n                  scope.statusType = \"Contacto\";\r\n                  break;    \r\n                default:\r\n                  scope.statusType = \"Envío rapido\";\r\n                  break;\r\n              }\r\n\r\n              element.html(template);\r\n              $compile(element.contents())(scope);\r\n            }\r\n          }\r\n        })\r\n        .factory('socket', function ($rootScope) {\r\n          return {\r\n            on: function (eventName, callback) {\r\n              socket.on(eventName, function () {\r\n                var args = arguments;\r\n                $rootScope.$apply(function () {\r\n                  callback.apply(socket, args);\r\n                });\r\n              });\r\n            },\r\n            emit: function (eventName, data, callback) {\r\n              socket.emit(eventName, data, function () {\r\n                var args = arguments;\r\n                $rootScope.$apply(function () {\r\n                  if (callback) {\r\n                    callback.apply(socket, args);\r\n                  }\r\n                });\r\n              })\r\n            }\r\n          }\r\n        })\r\n        .factory('main', ['$http', '$window', '$q', 'notificationService', function ($http, $window, $q, notificationService) {\r\n            return {\r\n              getServiceVerified: function () {\r\n                var route = fullUrlBase + '/api/sms/verifysmstwowayservice';\r\n                var defer = $q.defer();\r\n                $http.get(route)\r\n                        .success(function (data) {\r\n                          defer.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          defer.resolve(data);\r\n                        });\r\n                return defer.promise;\r\n              },\r\n              createLote: function (data, success, error) {\r\n                $http.post('createlote', data).success(success).error(error);\r\n              },\r\n              editLote: function (data, success, error) {\r\n                var route = $window.myBaseURL + \"sms/edit/\";\r\n                $http.post(route + data.idSms, data).success(success).error(error);\r\n              },\r\n              getlisttimezone: function (success, error) {\r\n                var route = $window.myBaseURL + \"mail/timezone/\";\r\n                $http.post(route).success(success).error(error);\r\n              },\r\n              getcontactlist: function (success, error) {\r\n                var route = $window.myBaseURL + \"api/sendmail/getcontactlist\";\r\n                return $http.get(route);\r\n              },\r\n              getsegments: function () {\r\n                var route = $window.myBaseURL + \"api/sendmail/getsegment\";\r\n                return $http.get(route);\r\n              },\r\n              createContact: function (data) {\r\n                return $http.post('createcontact', data);\r\n              },\r\n              validatesmscontact: function (idSms) {\r\n                var route = $window.myBaseURL + \"sms/validatecontact/\" + idSms;\r\n                return $http.post(route, idSms);\r\n\r\n              },\r\n              countContact: function (data) {\r\n                var route = $window.myBaseURL + \"api/sms/countcontact\";\r\n                return $http.post(route, data);\r\n              },\r\n              editContact: function (data) {\r\n                var route = $window.myBaseURL + \"sms/editcontact/\" + data.idSms;\r\n//                console.log(\"error,\",data);\r\n//                return $http.post(route, data);\r\n                var defer = $q.defer();\r\n                $http.post(route, data)\r\n                        .success(function (data) {\r\n                          defer.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          defer.reject(data);\r\n\r\n                        });\r\n                return defer.promise;\r\n              },\r\n              listfullsmstemplate: function () {\r\n                var route = $window.myBaseURL + \"api/smstemplate/listfull\";\r\n                var defer = $q.defer();\r\n                $http.get(route)\r\n                        .success(function (data) {\r\n                          defer.resolve(data);\r\n                        });\r\n                return defer.promise;\r\n              },\r\n              getDetailSms: function (idSms, page) {\r\n                var route = fullUrlBase + 'api/statics/getdetailsms/' + idSms + \"/\" + page;\r\n                var defer = $q.defer();\r\n                $http.get(route)\r\n                        .success(function (data) {\r\n                          defer.resolve(data);\r\n                        });\r\n                return defer.promise;\r\n              },\r\n              getCategory: function () {\r\n                var route = fullUrlBase + '/api/smscategory/getall';\r\n                var defer = $q.defer();\r\n                $http.get(route)\r\n                        .success(function (data) {\r\n                          defer.resolve(data);\r\n                        });\r\n                return defer.promise;\r\n              },\r\n              getSms: function (page, data) {\r\n                var route = fullUrlBase + '/api/sms/getall/' + page;\r\n                var defer = $q.defer();\r\n                $http.post(route, data)\r\n                        .success(function (data) {\r\n                          defer.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          defer.reject(data);\r\n                          notificationService.warning(data.message);\r\n                        });\r\n                return defer.promise;\r\n              },\r\n              getOneSms: function (idSms) {\r\n                var route = fullUrlBase + '/api/sms/getone/' + idSms;\r\n                var defer = $q.defer();\r\n                $http.get(route)\r\n                        .success(function (data) {\r\n                          defer.resolve(data);\r\n                        })\r\n                        .error(function (data) {\r\n                          defer.resolve(data);\r\n                        });\r\n                return defer.promise;\r\n              },\r\n              downloadFailedSms: function (data, idSms) {\r\n                var route = fullUrlBase + 'api/sms/downloadreportsmsfailed/' + idSms;\r\n                var defer = $q.defer();\r\n                $http.post(route, data)\r\n                        .success(function (data) {\r\n                          defer.resolve(data);\r\n                        }).error(function (data) {\r\n                  defer.resolve(data);\r\n                });\r\n                return defer.promise;\r\n              },\r\n              deletevarioussmslotes: function (idSms) {\r\n                var route = fullUrlBase + 'api/sms/deletevariouslotes/' + idSms;\r\n                var defer = $q.defer();\r\n                $http.post(route)\r\n                        .success(function (data) {\r\n                          //console.log(data); \r\n                          defer.resolve(data);\r\n                          notificationService.warning(data.message);\r\n                        }).error(function (data) {\r\n                  defer.resolve(data);\r\n                });\r\n                return defer.promise;\r\n              },\r\n              validateBalance: function(){\r\n                  var route = fullUrlBase + 'api/sms/validatebalance';\r\n                  var defer = $q.defer();\r\n                  $http.post(route)\r\n                          .success(function(data){\r\n                              defer.resolve(data);\r\n                              //notificationService.warning(data.message);\r\n                          }).error(function(data){\r\n                              defer.resolve(data);\r\n                          });\r\n                          return defer.promise;\r\n              },\r\n              sendMailNotificationSmsBalance: function(data){\r\n                  var route = fullUrlBase + 'api/sms/sendmailnotsmsbalance';\r\n                  var defer = $q.defer();\r\n                  $http.post(route,data)\r\n                          .success(function(data){\r\n                              defer.resolve(data);\r\n                              //notificationService.warning(data.message);\r\n                          }).error(function(data){\r\n                              defer.resolve(data);\r\n                          });\r\n                          return defer.promise;\r\n              },\r\n              getBalanceSubAccount: function(){\r\n                  var route = fullUrlBase + 'api/sms/getbalancesubaccount';\r\n                  var defer = $q.defer();\r\n                  $http.post(route)\r\n                          .success(function(data){\r\n                              defer.resolve(data);\r\n                              //notificationService.warning(data.message);\r\n                          }).error(function(data){\r\n                              defer.resolve(data);\r\n                          });\r\n                          return defer.promise;\r\n            },\r\n              downloadFailedSmsContact: function (data, idSms) {\r\n                var route = fullUrlBase + 'api/sms/downloadfailedsmscontact/' + idSms;\r\n                console.log(route);\r\n                var defer = $q.defer();\r\n                $http.post(route, data)\r\n                        .success(function (data) {\r\n                          defer.resolve(data);\r\n                        }).error(function (data) {\r\n                  defer.resolve(data);\r\n                });\r\n                return defer.promise;\r\n              }\r\n            }\r\n          }])\r\n        .controller('ctrlSms', ['$rootScope', '$scope', '$http', 'main', '$window', '$timeout', 'socket', 'notificationService', function ($rootScope, $scope, $http, main, $window, $timeout, socket, notificationService) {\r\n            $scope.showButtonTwoway = false;\r\n            $scope.gmt = \"-0500\";\r\n            $scope.initial = 0;\r\n            $scope.page = 1;\r\n            $scope.filter = {};\r\n            $scope.complete = false;\r\n            $scope.misc = {};\r\n            $scope.misc.ProccessCsv = {};\r\n            $scope.typeCsv;\r\n            $scope.targetcsv;\r\n            $scope.morecaracter = false;\r\n            main.getlisttimezone(function (res)\r\n            {\r\n              $scope.timezones = res;\r\n              $scope.invalidCharacters = false;\r\n              $scope.existTags = false;\r\n            }, function (res) {\r\n              slideOnTop(\"Ha ocurrido un error intentelo de nuevo mas tarde\", 3000, \"glyphicon glyphicon-remove-sign\", \"danger\");\r\n            });\r\n            $scope.addDisabled = function (id) {\r\n              $(\"#\" + id).attr('disabled', 'disabled');\r\n            }\r\n            $scope.removeDisabled = function (id) {\r\n              $(\"#\" + id).removeAttr('disabled');\r\n            }\r\n            $scope.showDestinatary = false;\r\n            $scope.not = false;\r\n            $scope.datenow = true;\r\n            $scope.sendpush = false;\r\n            $scope.sendnotification = function () {\r\n              if ($scope.not) {\r\n                $scope.not = false;\r\n                $(\"#email-addresses\").hide(\"slow\");\r\n              } else {\r\n                $scope.not = true;\r\n                $(\"#email-addresses\").show(\"slow\");\r\n              }\r\n            }\r\n            \r\n            $scope.validateChecks = function (param){\r\n                if($scope.morecaracter == true && $scope.sendpush == true){\r\n\r\n                    slideOnTop(\"Lo sentimos no se puede realizar envíos de mensajes flash con la modalidad de más de 160 caracteres.\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                    \r\n                    if(param == 1 && $scope.sendpush == true){\r\n                       $scope.morecaracter = false;                        \r\n                    }else if(param == 2 && $scope.morecaracter == true){\r\n                       $scope.sendpush = false;                        \r\n                    }\r\n                }\r\n            }\r\n            //Opciones avanzadas\r\n            $scope.advancedoptions = false;\r\n            $scope.evaluateAdvancedoptions = function () {\r\n              if ($scope.advancedoptions) {\r\n                $scope.advancedoptions = false;\r\n              } else {\r\n                $scope.advancedoptions = true;\r\n              }\r\n            }\r\n\r\n            $scope.divide = false;\r\n            $scope.divideSending = function () {\r\n              if ($scope.divide) {\r\n                $scope.divide = false;\r\n                $(\"#divide-container\").hide(\"slow\");\r\n              } else {\r\n                $scope.divide = true;\r\n                $(\"#divide-container\").show(\"slow\");\r\n              }\r\n            }\r\n\r\n            $scope.timeFormats = [\r\n              {value: 'minute', name: \"Minuto(s)\"},\r\n              {value: 'hour', name: \"Hora(s)\"},\r\n              {value: 'day', name: \"Día(s)\"},\r\n              {value: 'week', name: \"Semana(s)\"},\r\n              {value: 'month', name: \"Mes(es)\"}\r\n            ];\r\n            //fin de opciones avanzadas\r\n\r\n//      $scope.expresion = function (msg){\r\n//        var regex =  /[ñÑáéíóúÁÉÍÓÚ¿¡´]/;\r\n//        console.log(regex.test(msg));\r\n//      }\r\n\r\n            $scope.validate = function () {\r\n              $scope.error = 0;\r\n              $scope.success = 0;\r\n\r\n              var existTags = 0;\r\n              var flag = true;\r\n              $scope.wrongRow = false;\r\n              $scope.arrError = [{}];\r\n              var breaks = (typeof $scope.receiver != 'undefined' && typeSms != 'csv') ? $scope.receiver.split('\\n') : [];\r\n//              if (!$scope.receiver && typeSms != 'csv') {\r\n//                flag = false;\r\n//                slideOnTop(\"El campo destinatario es obligatorio\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n//              }\r\n              $scope.total = breaks.length;\r\n              console.log(\"total: \",$scope.total);\r\n              console.log(\"totalAvailable: \",$scope.misc.totalAvailable);\r\n              if(($scope.total>$scope.misc.totalAvailable) && (idSubaccount != \"420\" || idSubaccount != 420)){\r\n                  //flag = false;\r\n                  $scope.apismsemailbalance = {};\r\n                  $scope.apismsemailbalance.total = $scope.total;\r\n                  $scope.apismsemailbalance.totalAvailable = $scope.misc.totalAvailable;\r\n                  $scope.sendMailNotificationSmsBalance();\r\n                  openModalAdvice();\r\n                  return false;\r\n              }\r\n              \r\n              //if (!$('#toggle-two').prop('checked')) {\r\n              if (!$scope.datenow) {\r\n                var startdate = document.getElementById(\"datesend\").value;\r\n                if (startdate) {\r\n                  var startdate = startdate.split(\" \");\r\n                  var time = startdate[1].split(\":\");\r\n                  if (time[0] < startHour || time[0] > endHour) {\r\n                    flag = false;\r\n                    slideOnTop(\"La hora de envio debe de ser entre las\" + startHour + \" :00  y las \" + endHour + \":00 \", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                  }\r\n                } else {\r\n                  flag = false;\r\n                  slideOnTop(\"Debes seleccionar una fecha y hora \", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                }\r\n              }\r\n              if ($scope.not == true) {\r\n                if ($scope.email == \"\") {\r\n                  slideOnTop(\"Por favor ingrese el email de notificación\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                }\r\n              }\r\n              if ($scope.email) {\r\n\r\n\r\n                var email = $scope.email.split(\",\");\r\n                emailRegex = /^[-\\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\\.){1,125}[A-Z]{2,63}$/i;\r\n                var flagemail = false;\r\n                for (var a = 0; a < email.length; a++) {\r\n                  console.log(email[a]);\r\n                  if (emailRegex.test(email[a])) {\r\n                    //pasa\r\n                  } else {\r\n                    flag = false;\r\n                    flagemail = true;\r\n                    if (flagemail) {\r\n                      slideOnTop(\"Hay algún correo de notificación erroneo por favor verifique\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                      flagemail = false;\r\n                    }\r\n                  }\r\n                }\r\n\r\n                if (email.length > 8) {\r\n                  flag = false;\r\n                  slideOnTop(\"Solo se puede ingresar un máximo de 8 correos electrónicos\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                }\r\n              }\r\n              if (!$scope.idSmsCategory) {\r\n                flag = false;\r\n                slideOnTop(\"Debes seleccionar una categoria\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n              }\r\n              if (!$scope.receiver && typeSms != 'csv') {\r\n                flag = false;\r\n                slideOnTop(\"Debes ingresar al menos un destinatario\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n              }\r\n              if (breaks.length > 50 && typeSms != 'csv') {\r\n                flag = false;\r\n                slideOnTop(\"Solo se puede ingresar 50 destinatarios\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n              }\r\n              var flagValidate = false;\r\n              if (typeSms != 'csv') {\r\n                for (var i = 0; i < breaks.length; i++) {\r\n                  if (!breaks[i].includes(\";\")) {\r\n                    flagValidate = true;\r\n                  }\r\n                  var sms = breaks[i].split(\";\");\r\n                  if (sms.length < 3) {\r\n                    flagValidate = true;\r\n                  }\r\n                }\r\n              }\r\n\r\n              if (flagValidate) {\r\n                flag = false;\r\n                slideOnTop(\"Hay algún destinatario con el formato erróneo\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                $scope.wrongRow = true;\r\n              } else {\r\n                $scope.wrongRow = false;\r\n              }\r\n\r\n              var re = /[ñÑáéíóúÁÉÍÓÚ¿¡´]/;\r\n              var tags = /%%+[a-z0-9_]+%%/;\r\n              $scope.success = breaks.length;\r\n              for (var i = 0; i < breaks.length; i++) {\r\n\r\n\r\n                var sms = breaks[i].split(\";\");\r\n                var str = sms[0].indexOf(\"+\");\r\n                if (sms.length >= 4) {\r\n                  $scope.arrError.push(breaks[i]);\r\n                  $scope.success--;\r\n                }\r\n                if (!isFinite(sms[1])) {\r\n                  $scope.arrError.push(breaks[i]);\r\n                  $scope.success--;\r\n                }\r\n                if (sms.length < 3) {\r\n                  $scope.arrError.push(breaks[i]);\r\n                  $scope.success--;\r\n                }\r\n                if (sms.length == 3) {\r\n                  if (sms[1].toString().trim().length !== 10) {\r\n                    $scope.arrError.push(breaks[i]);\r\n                    $scope.success--;\r\n                  }\r\n                  if (sms[2].toString().length > 160) {\r\n                    $scope.arrError.push(breaks[i]);\r\n                    $scope.success--;\r\n                  }\r\n                  if (tags.test(sms[2].toString())) {\r\n                    existTags++;\r\n                    $scope.arrError.push(breaks[i]);\r\n                    $scope.success--;\r\n                  }\r\n                }\r\n              }\r\n              //Se hace este proceso para la carga del csv y traiga el target que envia\r\n              if ($scope.typeCsv = 'csv') {\r\n                $scope.success = $scope.targetcsv;\r\n              }\r\n\r\n              if (existTags > 0) {\r\n                $scope.existTags = true;\r\n              } else {\r\n                $scope.existTags = false;\r\n              }\r\n              if (flag) {\r\n                openModal();\r\n              }\r\n            };\r\n            $scope.validateInLine = function () {\r\n              $scope.error = 0;\r\n              $scope.success = 0;\r\n              $scope.wrongRow = false;\r\n              var existTags = 0;\r\n              var breaks = $scope.receiver.split('\\n');\r\n              var re = /[ñÑáéíóúÁÉÍÓÚ¿¡´]/;\r\n              var tags = /%%+[a-z0-9_]+%%/;\r\n              $scope.success = breaks.length;\r\n              var flagValidate = false;\r\n              for (var i = 0; i < breaks.length; i++) {\r\n                if (!breaks[i].includes(\";\")) {\r\n                  flagValidate = true;\r\n                }\r\n                var sms = breaks[i].split(\";\");\r\n                if (sms.length < 3) {\r\n                  flagValidate = true;\r\n                }\r\n              }\r\n              if (flagValidate) {\r\n                $scope.wrongRow = true;\r\n              } else {\r\n                $scope.wrongRow = false;\r\n                var email = $scope.email.split(\",\");\r\n                emailRegex = /^[-\\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\\.){1,125}[A-Z]{2,63}$/i;\r\n                var flagemail = false;\r\n                for (var a = 0; a < email.length; a++) {\r\n\r\n                  console.log(email[a]);\r\n                  if (emailRegex.test(email[a])) {\r\n                    //pasa\r\n                  } else {\r\n                    flag = false;\r\n                    flagemail = true;\r\n                    if (flagemail) {\r\n                      slideOnTop(\"Hay algún correo de notificación erroneo por favor verifique\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                      flagemail = false;\r\n                    }\r\n                  }\r\n                }\r\n\r\n                if (email.length > 8) {\r\n                  flag = false;\r\n                  slideOnTop(\"Solo se puede ingresar un máximo de 8 correos electrónicos\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                }\r\n              }\r\n              if (!$scope.idSmsCategory) {\r\n                flag = false;\r\n                slideOnTop(\"Debes seleccionar una categoria\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n              }\r\n              if (!$scope.receiver) {\r\n                flag = false;\r\n                slideOnTop(\"Debes ingresar al menos un destinatario\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n              }\r\n              if (breaks.length > 50) {\r\n                flag = false;\r\n                slideOnTop(\"Solo se puede ingresar 50 destinatarios\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n              }\r\n              var flagValidate = false;\r\n              for (var i = 0; i < breaks.length; i++) {\r\n                if (!breaks[i].includes(\";\")) {\r\n                  flagValidate = true;\r\n                }\r\n                var sms = breaks[i].split(\";\");\r\n                if (sms.length < 3) {\r\n                  flagValidate = true;\r\n                }\r\n              }\r\n              if (flagValidate) {\r\n                flag = false;\r\n                slideOnTop(\"Hay algún destinatario con el formato erróneo\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                $scope.wrongRow = true;\r\n              } else {\r\n                $scope.wrongRow = false;\r\n              }\r\n\r\n              var re = /[ñÑáéíóúÁÉÍÓÚ¿¡´]/;\r\n              var tags = /%%+[a-z0-9_]+%%/;\r\n              $scope.success = breaks.length;\r\n              for (var i = 0; i < breaks.length; i++) {\r\n\r\n\r\n                var sms = breaks[i].split(\";\");\r\n                var str = sms[0].indexOf(\"+\");\r\n                if (sms.length >= 4) {\r\n                  $scope.arrError.push(breaks[i]);\r\n                  $scope.error++;\r\n                  $scope.success--;\r\n                }\r\n                if (!isFinite(sms[1])) {\r\n                  $scope.arrError.push(breaks[i]);\r\n                  $scope.error++;\r\n                  $scope.success--;\r\n                }\r\n                if (sms.length < 3) {\r\n                  $scope.arrError.push(breaks[i]);\r\n                  $scope.error++;\r\n                  $scope.success--;\r\n                }\r\n                if (sms.length == 3) {\r\n                  if (sms[1].toString().trim().length !== 10) {\r\n                    $scope.arrError.push(breaks[i]);\r\n                    $scope.error++;\r\n                    $scope.success--;\r\n                  }\r\n                  if (sms[2].toString().length > 160) {\r\n                    $scope.arrError.push(breaks[i]);\r\n                    $scope.error++;\r\n                    $scope.success--;\r\n                  }\r\n                  if (re.test(sms[2].toString())) {\r\n                    $scope.arrError.push(breaks[i]);\r\n                    $scope.error++;\r\n                    $scope.success--;\r\n                  }\r\n                  if (tags.test(sms[2].toString())) {\r\n                    existTags++;\r\n                    $scope.arrError.push(breaks[i]);\r\n                    $scope.error++;\r\n                    $scope.success--;\r\n                  }\r\n                }\r\n              }\r\n              if (existTags > 0) {\r\n                $scope.existTags = true;\r\n              } else {\r\n                $scope.existTags = false;\r\n              }\r\n              if (flag) {\r\n                openModal();\r\n              }\r\n            };\r\n            $scope.validateInLine = function () {\r\n              $scope.error = 0;\r\n              $scope.success = 0;\r\n              $scope.wrongRow = false;\r\n              var existTags = 0;\r\n              var breaks = $scope.receiver.split('\\n');\r\n              var re = /[ñÑáéíóúÁÉÍÓÚ¿¡´]/;\r\n              var tags = /%%+[a-z0-9_]+%%/;\r\n              $scope.success = breaks.length;\r\n              var flagValidate = false;\r\n              for (var i = 0; i < breaks.length; i++) {\r\n                if (!breaks[i].includes(\";\")) {\r\n                  flagValidate = true;\r\n                }\r\n                var sms = breaks[i].split(\";\");\r\n                if (sms.length < 3) {\r\n                  flagValidate = true;\r\n                }\r\n              }\r\n              if (flagValidate) {\r\n                $scope.wrongRow = true;\r\n              } else {\r\n                $scope.wrongRow = false;\r\n              }\r\n              for (var i = 0; i < breaks.length; i++) {\r\n                var sms = breaks[i].split(\";\");\r\n                var str = sms[0].indexOf(\"+\");\r\n                if (sms.length == 3) {\r\n                  if (tags.test(sms[2].toString())) {\r\n                    existTags++;\r\n                    $scope.error++;\r\n                    $scope.success--;\r\n                  }\r\n                }\r\n              }\r\n\r\n              if (existTags > 0) {\r\n                $scope.existTags = true;\r\n              } else {\r\n                $scope.existTags = false;\r\n              }\r\n            };\r\n            $scope.createlote = function () {\r\n              var data = {};\r\n              data = {\r\n                name: $scope.name,\r\n                notification: $scope.not,\r\n                email: $scope.email,\r\n                receiver: $scope.receiver,\r\n                idSmsCategory: $scope.idSmsCategory,\r\n                datesend: document.getElementById(\"datesend\").value,\r\n//                datenow: $('#toggle-two').prop('checked'),\r\n                timezone: $scope.timezone,\r\n                AproximateSendings: $scope.success,\r\n                advancedoptions: $scope.advancedoptions,\r\n                morecaracter : $scope.morecaracter,\r\n                divide: $scope.divide,\r\n                continueError:  $scope.continueError,\r\n                sendingTime: $scope.sendingTime,\r\n                timeFormat: $scope.timeFormat,\r\n                quantity: $scope.quantity,\r\n                idSms: $scope.idSms,\r\n                datenow: $scope.datenow,\r\n                gmt: $scope.gmt,\r\n                originalDate: document.getElementById(\"datesend\").value,\r\n                sendpush: $scope.sendpush\r\n                \r\n              };\r\n              main.createLote(data, function (res) {\r\n                closeModal();\r\n                var route = $window.myBaseURL + \"sms/\";\r\n                $window.location.href = route;\r\n              }, function (res) {                \r\n                slideOnTop(res.message, 3000, \"glyphicon glyphicon-remove-sign\", \"danger\");\r\n                $rootScope.error = 'fail';\r\n              });\r\n            }\r\n\r\n            $scope.editlote = function () {\r\n              var data = {\r\n                name: $scope.name,\r\n                notification: $scope.not,\r\n                email: $scope.email,\r\n                receiver: $scope.receiver,\r\n                idSmsCategory: $scope.idSmsCategory,\r\n                datesend: document.getElementById(\"datesend\").value,\r\n//                datenow: $('#toggle-two').prop('checked'),\r\n                timezone: $scope.timezone,\r\n                AproximateSendings: $scope.success,\r\n                advancedoptions: $scope.advancedoptions,\r\n                morecaracter : $scope.morecaracter,\r\n                divide: $scope.divide,\r\n                continueError:  $scope.continueError,\r\n                sendingTime: document.getElementById(\"sendingTime\").value,\r\n                timeFormat: $scope.timeFormat,\r\n                quantity: $scope.quantity,\r\n                idSms: $scope.idSms,\r\n                datenow: $scope.datenow,\r\n                gmt: $scope.gmt,\r\n                originalDate: document.getElementById(\"datesend\").value,\r\n                sendpush: $scope.sendpush\r\n              };\r\n              main.editLote(data, function (res) {\r\n                closeModal();\r\n                var route = $window.myBaseURL + \"sms/\";\r\n                $window.location.href = route;\r\n              }, function (res) {\r\n                if (data.datenow == false) {\r\n                  $scope.datenow = false;\r\n                } else {\r\n                  $scope.datenow = true;\r\n                } \r\n                slideOnTop(res, 3000, \"glyphicon glyphicon-remove-sign\", \"danger\");\r\n                $rootScope.error = 'fail';\r\n              });\r\n            }\r\n\r\n            $scope.sendnow = function () {\r\n              if ($scope.datenow) {\r\n                $scope.datenow = false;\r\n              } else {\r\n                $scope.datenow = true;\r\n              }\r\n            }\r\n            \r\n            $scope.opeModalMoreCa = function () {\r\n                if( $('#morecaracter').prop('checked') && $('#sendpush').prop('checked') == false) {\r\n                   $('#alertMoreCaracter').removeClass('modal'); \r\n                   $('#alertMoreCaracter').addClass('dialog dialog--open'); \r\n                }\r\n            }\r\n\r\n            $scope.getCategory = function () {\r\n              main.getCategory().then(function (data) {\r\n                $scope.smsCategory = data;\r\n              });\r\n            }\r\n\r\n            $scope.validateprocess = function () {\r\n              var flag = false;\r\n              var name = document.getElementById(\"name\").value;\r\n              var idSmsCategory = document.getElementById(\"idSmsCategory\").value;\r\n              var timezone = document.getElementById(\"timezone\").value;\r\n              var datesend = document.getElementById(\"datesend\").value;\r\n              var email = document.getElementById(\"email\").value;\r\n              var quantity = document.getElementById(\"quantity\").value;\r\n              var sendingTime = document.getElementById(\"sendingTime\").value;\r\n              var timeFormat = document.getElementById(\"timeFormat\").value;\r\n              if (name == \"\") {\r\n                slideOnTop(\"El nombre de envío esta incompleto, por favor ingrese un nombre\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                flag = true;\r\n              } else if (idSmsCategory == \"\") {\r\n                slideOnTop(\"Por favor ingrese una categoria\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                flag = true;\r\n              } else if ($scope.datenow == false) {\r\n                if (timezone == \"\") {\r\n                  slideOnTop(\"Por favor ingrese zona horaria\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                  flag = true;\r\n                } else if (datesend == \"\") {\r\n                  slideOnTop(\"Por favor ingrese fecha y hora de envio\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                  flag = true;\r\n                }\r\n              } else if ($scope.advancedoptions == true) {\r\n\r\n                if ($scope.not == true) {\r\n                  if (email == \"\") {\r\n                    slideOnTop(\"Por favor ingrese el email de notificación\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                    flag = true;\r\n                  } else {\r\n                    let emailArray = $scope.email.split(/[\\s\\n, ;]+/);\r\n                    let emailRegex = /^[-\\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\\.){1,125}[A-Z]{2,63}$/i;\r\n                    for (var a = 0; a < emailArray.length; a++) {\r\n                      if (!emailRegex.test(emailArray[a])) {\r\n                        slideOnTop(\"El coreo ( \" + emailArray[a] + \" ) ingresado no es valido\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                        flag = true;\r\n                      }\r\n                    }\r\n                    if (emailArray.length > 8) {\r\n                      slideOnTop(\"Solo se puede ingresar un máximo de 8 correos electrónicos\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                      flag = true;\r\n                    }\r\n                  }\r\n                } /*else if ($scope.divide == true) {\r\n                  if (quantity == \"\") {\r\n                    slideOnTop(\"Por favor ingrese la cantidad de envio por intervalos\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                    flag = true;\r\n                  } else if (sendingTime == \"\") {\r\n                    slideOnTop(\"Por favor ingrese tiempo de envio\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                    flag = true;\r\n                  } else if (timeFormat == \"\") {\r\n                    slideOnTop(\"Por favor ingrese el formato de envio\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                    flag = true;\r\n                  }\r\n                }*/\r\n              }\r\n              if (flag == false) {\r\n                var form = angular.element(document.getElementById('form').elements);\r\n                var formData = new FormData();\r\n                var config = {};\r\n                config.headers = {};\r\n                config.transformRequest = angular.identity;\r\n                config.headers['Content-Type'] = undefined;\r\n                for (var i = 0; i < form.length; i++) {\r\n                  if (form[i].getAttribute(\"name\") != null) {\r\n                    if (form[i].getAttribute(\"name\") == \"csv\") {\r\n                      formData.append(form[i].getAttribute(\"name\"), form[i].files[0]);\r\n                      //formData.append(\"idSmsCreated\", $scope.misc.idSms); \r\n                    } else {\r\n                      console.log(form[i].getAttribute(\"name\"), form[i].type, form[i].checked);\r\n                      if (form[i].type == \"checkbox\") {\r\n                        if (form[i].checked) {\r\n                          formData.append(form[i].getAttribute(\"name\"), form[i].value);\r\n                        }\r\n                      } else {\r\n                        formData.append(form[i].getAttribute(\"name\"), form[i].value);\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n                $('#ProcessCsv').addClass('dialog--open');\r\n                $scope.misc.ProccessCsv.porc = 20;\r\n                $http.post(fullUrlBase + 'api/sms/createcsv', formData, config)\r\n                        .success(function (data) {})\r\n                        .error(function (data) {\r\n                          notificationService.error(data.message);\r\n                          //$('#ProcessCsv').removeClass('dialog--open');\r\n                        });\r\n              } else {\r\n                document.getElementById(\"savecsv\").style.display = 'block';\r\n              }\r\n\r\n            }\r\n\r\n            $scope.verifyservicetwoway = function () {\r\n              main.getServiceVerified().then(function (data) {\r\n                $scope.smsverified = data;\r\n                if ($scope.smsverified == 1) {\r\n                  $scope.showButtonTwoway = true;\r\n                } else {\r\n                  $scope.showButtonTwoway = false;\r\n                }\r\n              });\r\n            };\r\n            $scope.forward = function () {\r\n              $scope.initial += 1;\r\n              $scope.page += 1;\r\n              $scope.getAll();\r\n            };\r\n            $scope.fastforward = function () {\r\n              $scope.initial = ($scope.sms.total_pages - 1);\r\n              $scope.page = $scope.sms.total_pages;\r\n              $scope.getAll();\r\n            };\r\n            $scope.backward = function () {\r\n              $scope.initial -= 1;\r\n              $scope.page -= 1;\r\n              $scope.getAll();\r\n            };\r\n            $scope.fastbackward = function () {\r\n              $scope.initial = 0;\r\n              $scope.page = 1;\r\n              $scope.getAll();\r\n            };\r\n            $scope.search = function () {\r\n              $scope.misc.progressbar = false;\r\n              $scope.initial = 0;\r\n              $scope.page = 1;\r\n              $scope.getAll();\r\n            };\r\n            $scope.searchcategory = function () {\r\n              $scope.misc.progressbar = false;\r\n              if ($scope.filter.category.length >= 1) {\r\n                $scope.initial = 0;\r\n                $scope.page = 1;\r\n                $scope.getAll();\r\n              } else {\r\n                $scope.getAll();\r\n              }\r\n            };\r\n            $scope.$watch('[filter.dateinitial,filter.dateend]', function () {\r\n              if ((angular.isDefined($scope.filter.dateinitial) && $scope.filter.dateinitial != \"\") && (angular.isDefined($scope.filter.dateend) && $scope.filter.dateend != \"\")) {\r\n                $scope.misc.progressbar = false;\r\n                $scope.initial = 0;\r\n                $scope.page = 1;\r\n                $scope.getAll();\r\n              }\r\n            });\r\n            $scope.statusFunc = function () {\r\n//                  console.log('Afuera');\r\n//                  console.log($scope.filter.mailStatus);\r\n              if ($scope.filter.smsStatus.length > 0) {\r\n//                  console.log('Adentro');\r\n//                  console.log($scope.filter.mailStatus);\r\n                $scope.initial = 0;\r\n                $scope.page = 1;\r\n                $scope.getAll();\r\n              }\r\n            };\r\n            $scope.getAll = function () {              \r\n                main.getSms($scope.initial, $scope.filter).then(function (data)\r\n                {\r\n                  $scope.sms = data;\r\n                  $scope.complete = true;\r\n                  $scope.misc.progressbar = true;\r\n                }).catch(function (error) {\r\n                  notificationService.error(error.message);\r\n                  $scope.misc.progressbar = true;\r\n                })              \r\n            };\r\n            $scope.getOne = function (idSms) {\r\n              \r\n              main.getOneSms(idSms).then(function (data)\r\n              {\r\n                $scope.sms = data;\r\n                $scope.typeCsv = $scope.sms.type;\r\n                $scope.targetcsv = $scope.sms.target;\r\n                $scope.idSms = $scope.sms.idSms;\r\n                $scope.name = $scope.sms.name;\r\n                $scope.not = false;\r\n                if ($scope.sms.notification == 1) {\r\n                  $scope.not = true;\r\n                }\r\n                if($scope.sms.morecaracter === true){\r\n                   $scope.morecaracter = true;\r\n                   $(\"#morecaracter\").prop('checked', true);\r\n                }else{\r\n                   $scope.morecaracter = false; \r\n                   $(\"#morecaracter\").prop('checked', false);\r\n                }\r\n                $scope.email = $scope.sms.email;\r\n                $scope.receiver = $scope.sms.receiver;\r\n                $scope.idSmsCategory = $scope.sms.idSmsCategory;\r\n                $scope.originalDate = $scope.sms.originalDate;\r\n                $scope.datenow = false;\r\n                $('#toggle-two').bootstrapToggle('off');\r\n                if ($scope.sms.dateNow == 1) {\r\n                  $scope.datenow = true;\r\n                  $('#toggle-two').bootstrapToggle('on');\r\n                }\r\n                if ($scope.sms.advancedoptions == 1) {\r\n                  $scope.advancedoptions = true;\r\n                  $('#toggle-three').bootstrapToggle('on');\r\n                }\r\n                if ($scope.sms.notification == 1) {\r\n                  $scope.not = true;\r\n                  $('#toggle-one').bootstrapToggle('on');\r\n                }\r\n                if ($scope.sms.divide == 1) {\r\n                  $scope.divide = true;\r\n                  $('#toggle-four').bootstrapToggle('on');\r\n                }\r\n                if($scope.sms.sendpush == 1){\r\n                  $scope.sendpush = true;\r\n                  $('#toggle-one').bootstrapToggle('on');\r\n                }\r\n                $scope.timezone;\r\n                $scope.AproximateSendings;\r\n                $scope.timeFormat = $scope.sms.timeFormat;\r\n                $scope.quantity = parseInt($scope.sms.quantity);\r\n//                $scope.gmt = $scope.sms.gmt;\r\n                $scope.gmt = $scope.sms.gmt;\r\n              });\r\n            };\r\n            $scope.validateBalance = function () {\r\n              main.validateBalance().then(function (data) {\r\n                $scope.misc.tempSumSmsPendingTarget = 0;\r\n                if(data.smsFindPending.length>0){\r\n                    angular.forEach(data.smsFindPending, function (value, key) {\r\n                        $scope.misc.tempSumSmsPendingTarget = $scope.misc.tempSumSmsPendingTarget + parseInt(value.target);\r\n                    });\r\n                }\r\n                else{\r\n                    $scope.misc.smsAvailable = 0;\r\n                }\r\n                if(data.balanceConsumedFind.length>0){\r\n                    $scope.misc.balanceAvailable = data.balanceConsumedFind[0]['amount'];\r\n                    $scope.misc.balanceTotalGet = data.balanceConsumedFind[0]['totalAmount'];\r\n                }\r\n                else{\r\n                    $scope.misc.balanceAvailable = 0;\r\n                }\r\n                \r\n                $scope.misc.totalAvailable = parseInt($scope.misc.balanceAvailable) - parseInt($scope.misc.tempSumSmsPendingTarget);\r\n                \r\n                console.log('smsFindPending:',data.smsFindPending);\r\n                console.log('balanceConsumedFind:',data.balanceConsumedFind);\r\n                console.log('tempSumSmsPendingTarget',$scope.misc.tempSumSmsPendingTarget);\r\n                console.log('scope.misc.balanceConsumed',$scope.misc.balanceAvailable);\r\n                console.log('scope.misc.totalAvailable',$scope.misc.totalAvailable);\r\n              });\r\n            };\r\n            \r\n            $scope.sendMailNotificationSmsBalance = function () {\r\n                   main.sendMailNotificationSmsBalance($scope.apismsemailbalance).then(function (data) { \r\n                    });\r\n                }; \r\n            $scope.sendMailNotificationSmsBalanceCsv = function () {\r\n                   main.sendMailNotificationSmsBalance($scope.apismsemailbalancecvs).then(function (data) { \r\n                    });\r\n                }; \r\n            \r\n            if (loadGetAll == ''){\r\n              $scope.getAll();\r\n            }\r\n            \r\n            //$scope.verifyservicetwoway();\r\n            $scope.validateBalance();\r\n            $scope.changeStatusCsv = function (status) {\r\n              $http.post(fullUrlBase + 'api/sms/changestatus/' + $scope.misc.idSms, {status: status}).then(function () {\r\n                var route = $window.myBaseURL + \"sms/\";\r\n                $window.location.href = route;\r\n              }).catch(function () {});\r\n            }\r\n            \r\n            //METODO PARA VALIDAR LA CANTIDAD DE MENSAJES EN EL CSV Y EL SALDO DISPONIBLE\r\n            $scope.balanceCSV = false;\r\n            $scope.validateBalanceCSV = function(totalAvailable, countSent){\r\n                if(totalAvailable < countSent){\r\n                    $scope.balanceCSV = true;\r\n                }\r\n            };\r\n            \r\n            socket.on('loading-csv-sms', function (data) {\r\n              console.info(\"Node Data\", data);\r\n              if (data.idSubaccount == idSubaccountLogin) {\r\n                if (data.status == \"preload\") {\r\n                  $scope.misc.ProccessCsv.preload = {};\r\n                  $scope.misc.ProccessCsv.porc += 20;\r\n                }\r\n                if (data.status == \"validations\") {\r\n                  $scope.misc.ProccessCsv.porc += 20;\r\n                  $scope.misc.ProccessCsv.preload.data = data.data;\r\n                  $scope.misc.ProccessCsv.validations = {};\r\n                }\r\n                if (data.status == \"load\") {\r\n                  $scope.misc.ProccessCsv.porc += 20;\r\n                  $scope.misc.ProccessCsv.validations.data = data.data;\r\n                  $scope.misc.ProccessCsv.load = {};\r\n                }\r\n                if (data.status == \"finish\") {\r\n                 \r\n                  console.log('totalAvailable:',$scope.misc.totalAvailable);\r\n                  $scope.misc.ProccessCsv.porc += 20;\r\n                  $scope.misc.ProccessCsv.load.data = data.data;\r\n                  $scope.misc.ProccessCsv.finish = {};\r\n                  $scope.misc.idSms = data.id;\r\n                  $scope.misc.ProccessCsv.finish.message = data.message;\r\n                  $scope.triggerEmailNotificationBalance();\r\n                  if(idSubaccountLogin != 420 || idSubaccountLogin != \"420\"){\r\n                    $scope.validateBalanceCSV($scope.misc.totalAvailable, $scope.misc.ProccessCsv.load.data.countSent);\r\n                  }\r\n\r\n                }\r\n              }\r\n            });\r\n            \r\n\r\n            \r\n            $scope.cancelSmsAndDeleteLotes = function () {\r\n              main.deletevarioussmslotes($scope.misc.idSms).then(function (data) { /*nothing to do...*/\r\n              });\r\n            };\r\n            $scope.misc.progressbar = false;\r\n            $scope.downloadFailedSms = function () {\r\n              $scope.titleReport = \"Detalle números Invalidos\";\r\n              $scope.misc.progressbar = true;\r\n              main.downloadFailedSms($scope.misc.ProccessCsv, $scope.misc.idSms).then(function () {\r\n                var url = fullUrlBase + 'statistic/downloadexcel/' + $scope.titleReport;\r\n                location.href = url;\r\n                $scope.misc.progressbar = false;\r\n              });\r\n            };\r\n            socket.on('refresh-view-sms', function (data) {\r\n              for (i in $scope.sms.items) {\r\n                if ($scope.sms.items[i].idSms == data.idSms) {\r\n                  $scope.sms.items.target = 1000;\r\n                  $scope.sms.items[i].status = data.status;\r\n                }\r\n              }\r\n            });\r\n            socket.on('refresh-view-sms-send', function (data) {\r\n              for (i in $scope.sms.items) {\r\n                if ($scope.sms.items[i].idSms == data.idSms) {\r\n                  $scope.sms.items[i].sent = data.sent;\r\n                  $scope.sms.items[i].total = data.total;\r\n                }\r\n              }\r\n            });\r\n            /*$scope.getBalanceSubAccount = function(){\r\n                main.getBalanceSubAccount().then(function (data) {\r\n                    console.log('Data getBalanceSubAccount:', data);\r\n                });\r\n            }\r\n            $scope.getBalanceSubAccount();*/\r\n                \r\n            $scope.triggerEmailNotificationBalance = function (){\r\n                if($scope.misc.totalAvailable<$scope.misc.ProccessCsv.load.data.countSent){\r\n                   $scope.apismsemailbalancecvs = {};\r\n                   $scope.apismsemailbalancecvs.total = $scope.misc.ProccessCsv.load.data.countSent;\r\n                   $scope.apismsemailbalancecvs.totalAvailable = $scope.misc.totalAvailable;\r\n                   $scope.sendMailNotificationSmsBalanceCsv();\r\n                }\r\n                \r\n            };\r\n            \r\n            \r\n                \r\n          }])\r\n        .controller('smsContact', ['$rootScope', '$scope', '$http', 'main', '$window', '$timeout', 'notificationService', function ($rootScope, $scope, $http, main, $window, $timeout, notificationService) {\r\n            $scope.listAddressee = [{id: 1, name: \"Listas de contactos\"}, {id: 2, name: \"Segmentos\"}];\r\n            $scope.arrAddressee = [];\r\n            $scope.listSelected = {};\r\n            $scope.data = {};\r\n            $scope.datenow = false;\r\n            $scope.viewTemplate = false;\r\n            $scope.notification = false;\r\n            $scope.notificationEmail = false;\r\n            $scope.allList = false;\r\n            $scope.gmt = \"-0500\";\r\n            $scope.countContactsApproximate = {};\r\n            $scope.countContactsApproximate.counts = 0;\r\n            $scope.advancedoptions = false;\r\n            $scope.divide = false;\r\n            $scope.continueError = false;\r\n            $scope.initProcessValidate = false;\r\n            $scope.editandcreate = false;\r\n            $scope.progresslinear = false;\r\n            $scope.switchrepeated = true;\r\n            $scope.morecaracter = false;\r\n            $scope.sendpush = false;\r\n            $scope.misc = {};\r\n            \r\n            $scope.validateBalanceSmsContact = function () {\r\n              main.validateBalance().then(function (data) {\r\n                $scope.misc.tempSumSmsPendingTarget = 0;\r\n                if(data.smsFindPending.length>0){\r\n                    angular.forEach(data.smsFindPending, function (value, key) {\r\n                        $scope.misc.tempSumSmsPendingTarget = $scope.misc.tempSumSmsPendingTarget + parseInt(value.target);\r\n                    });\r\n                }\r\n                else{\r\n                    $scope.misc.smsAvailable = 0;\r\n                }\r\n                if(data.balanceConsumedFind.length>0){\r\n                    $scope.misc.balanceAvailable = data.balanceConsumedFind[0]['amount'];\r\n                    $scope.misc.balanceTotalGet = data.balanceConsumedFind[0]['totalAmount'];\r\n                }\r\n                else{\r\n                    $scope.misc.balanceAvailable = 0;\r\n                }\r\n                \r\n                $scope.misc.totalAvailable = parseInt($scope.misc.balanceAvailable) - parseInt($scope.misc.tempSumSmsPendingTarget);\r\n                \r\n                console.log('smsFindPending:',data.smsFindPending);\r\n                console.log('balanceConsumedFind:',data.balanceConsumedFind);\r\n                console.log('tempSumSmsPendingTarget',$scope.misc.tempSumSmsPendingTarget);\r\n                console.log('scope.misc.balanceConsumed',$scope.misc.balanceAvailable);\r\n                console.log('scope.misc.totalAvailable',$scope.misc.totalAvailable);\r\n              });\r\n            };\r\n            \r\n            $scope.validateChecks = function (param){\r\n                if($scope.morecaracter == true && $scope.sendpush == true){\r\n\r\n                    slideOnTop(\"Lo sentimos no se puede realizar envíos de mensajes flash con la modalidad de más de 160 caracteres.\", 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n                    \r\n                    if(param == 1 && $scope.sendpush == true){\r\n                       $scope.morecaracter = false;                        \r\n                    }else if(param == 2 && $scope.morecaracter == true){\r\n                       $scope.sendpush = false;                        \r\n                    }\r\n                }\r\n            }\r\n            \r\n            $scope.validateId = function () {\r\n              if (!angular.isUndefined(idSms)) {\r\n                $scope.name = nameSms;\r\n                $scope.showAddressee = true;\r\n                if (receiverSms.type == \"contactlist\") {\r\n                  $scope.data.listSelected = $scope.listAddressee[0];\r\n                  $scope.getDetinatary($scope.data.listSelected);\r\n                  $scope.data.arrAddressee = receiverSms.contactlists;\r\n                } else {\r\n                  $scope.data.listSelected = $scope.listAddressee[1];\r\n                  $scope.getDetinatary($scope.data.listSelected);\r\n                  $scope.data.arrAddressee = receiverSms.segment;\r\n                }\r\n                $scope.data.message = messageSms;\r\n                $scope.countContacts();\r\n                if (emailSms != \"\") {\r\n                  $scope.not = false;\r\n                  $scope.notificationEmail = true;\r\n                  $scope.email = emailSms;\r\n                }\r\n              }\r\n            }\r\n            main.getlisttimezone(function (res) {\r\n              $scope.timezones = res;\r\n              $scope.timezone = \"-0500\";\r\n            }, function (res) {\r\n              slideOnTop(\"Ha ocurrido un error intentelo de nuevo mas tarde\", 3000, \"glyphicon glyphicon-remove-sign\", \"danger\");\r\n            });\r\n\r\n            $scope.timeFormats = [\r\n              {value: 'minute', name: \"Minuto(s)\"},\r\n              {value: 'hour', name: \"Hora(s)\"},\r\n              {value: 'day', name: \"Día(s)\"},\r\n              {value: 'week', name: \"Semana(s)\"},\r\n              {value: 'month', name: \"Mes(es)\"}\r\n            ];\r\n            //fin de opciones avanzadas\r\n\r\n            $scope.addDisabled = function (id) {\r\n              $(\"#\" + id).attr('disabled', 'disabled');\r\n            }\r\n            $scope.removeDisabled = function (id) {\r\n              $(\"#\" + id).removeAttr('disabled');\r\n            }\r\n\r\n            $scope.opeModalMoreCa = function () {\r\n                if( $('#morecaracter').prop('checked') && $('#sendpush').prop('checked') == false) {\r\n                   $('#alertMoreCaracter').removeClass('modal'); \r\n                   $('#alertMoreCaracter').addClass('dialog dialog--open'); \r\n                }\r\n            }\r\n\r\n            $scope.timeFormats = [\r\n              {value: 'minute', name: \"Minuto(s)\"},\r\n              {value: 'hour', name: \"Hora(s)\"},\r\n              {value: 'day', name: \"Día(s)\"},\r\n              {value: 'week', name: \"Semana(s)\"},\r\n              {value: 'month', name: \"Mes(es)\"}\r\n            ];\r\n            //fin de opciones avanzadas\r\n\r\n            $scope.addDisabled = function (id) {\r\n              $(\"#\" + id).attr('disabled', 'disabled');\r\n            }\r\n            $scope.removeDisabled = function (id) {\r\n              $(\"#\" + id).removeAttr('disabled');\r\n            }\r\n            \r\n            //METODO PARA VALIDAR LA CANTIDAD DE MENSAJES EN EL CSV Y EL SALDO DISPONIBLE\r\n            $scope.balanceCSV = false;\r\n            $scope.validateBalanceCSV = function(totalAvailable, countSent){\r\n                if(totalAvailable < countSent){\r\n                    $scope.balanceCSV = true;\r\n                    console.log(\"balanceCSV: \",$scope.balanceCSV);\r\n                }\r\n            };\r\n\r\n            $scope.validate = function () {\r\n              $scope.error = 0;\r\n              $scope.success = 0;\r\n              var flag = true;\r\n              $scope.arrError = [{}];\r\n              try {\r\n\r\n                if (!$scope.datenow) {\r\n                  var startdate = document.getElementById(\"datesend\").value;\r\n                  if (startdate) {\r\n                    var startdate = startdate.split(\" \");\r\n                    var time = startdate[1].split(\":\");\r\n                    if (time[0] < startHour || time[0] > endHour) {\r\n                      throw(\"La hora de envio debe de ser entre las\" + startHour + \" :00  y las \" + endHour + \":00 \");\r\n                    }\r\n                  } else {\r\n                    throw(\"Debes seleccionar una fecha y hora \");\r\n                  }\r\n                }\r\n                if ($scope.not == true) {\r\n                  if ($scope.email == \"\") {\r\n                    throw(\"Por favor ingrese el email de notificación\");\r\n                  }\r\n                }\r\n                if ($scope.email) {\r\n                  var email = $scope.email.split(\",\");\r\n                  if (email.length == 0) {\r\n                    throw(\"No se encontro ningun correo electronico.\");\r\n                  }\r\n                  if (email.length > 8) {\r\n                    throw(\"Solo se puede ingresar un máximo de 8 correos electrónicos\");\r\n                  }\r\n                  for (var i = 0; i < email.length; i++) {\r\n                    var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n                    email[i] = email[i].trim();\r\n                    if (!email[i].match(re)) {\r\n                      throw(\"El correo \" + email[i] + \" no es valido.\");\r\n                    }\r\n                  }\r\n                }\r\n                var message = $('#message').val(); \r\n                $scope.data.message = message;\r\n                message = null;\r\n                if (!$scope.idSmsCategory) {\r\n                  throw(\"Debes seleccionar una categoria\");\r\n                }\r\n                if (angular.isUndefined($scope.data.listSelected)) {\r\n                  throw(\"Debe seleccionar una lista de destinatarios\");\r\n                }\r\n                if (angular.isUndefined($scope.data.arrAddressee) || $scope.data.arrAddressee == 0) {\r\n                  throw (\"Debe seleccionar al menos un segmento o lista de contacto.\");\r\n                }\r\n\r\n                if (angular.isUndefined($scope.data.message) || $scope.data.message.length < 2) {\r\n                  console.log($scope.data);  \r\n                  throw (\"El mensaje es obligatorio y debe ser mayor a dos caracteres.\");\r\n                }\r\n//                if ($scope.newMessage.length > 160) {\r\n//                  throw (\"El mensaje no puede ser mayor a 160 caracteres.\");\r\n//                }\r\n                console.log(\"totalAvailable: \",$scope.misc.totalAvailable);\r\n                console.log(\"countContactsApproximate: \",$scope.countContactsApproximate.counts);\r\n                if(idSubaccount != 420 || idSubaccount != \"420\"){\r\n                    $scope.validateBalanceCSV($scope.misc.totalAvailable, $scope.countContactsApproximate.counts);\r\n                }\r\n                openModal();\r\n\r\n              } catch ($err) {\r\n                slideOnTop($err, 3000, \"glyphicon glyphicon-info-sign\", \"danger\");\r\n              }\r\n            };\r\n\r\n            $scope.validatecreate = function () {\r\n              main.validatesmscontact($scope.IdSms)\r\n                      .then(function (data) {\r\n                        closeModal();\r\n                        var route = $window.myBaseURL + \"sms/\";\r\n                        $window.location.href = route;\r\n                      })\r\n                      .catch(function (data) {\r\n                        slideOnTop(data.message, 3000, \"glyphicon glyphicon-remove-sign\", \"danger\");\r\n                        $rootScope.error = 'fail';\r\n                      });\r\n\r\n            }\r\n\r\n            $scope.canceledandedit = function () {\r\n              idSms = $scope.IdSms\r\n              closeModal();\r\n              $scope.initProcessValidate = false;\r\n              $scope.editandcreate = true;\r\n\r\n            }\r\n\r\n            $scope.downloadFailedSms = function () {\r\n              $scope.titleReport = \"Detalle números Invalidos\";\r\n              $scope.data;\r\n              main.downloadFailedSmsContact($scope.data, $scope.IdSms).then(function () {\r\n                var url = fullUrlBase + 'statistic/downloadexcel/' + $scope.titleReport;\r\n                location.href = url;\r\n              });\r\n            };\r\n\r\n            $scope.sendnow = function () {\r\n              if ($scope.datenow) {\r\n                $scope.datenow = false;\r\n              } else {\r\n                $scope.datenow = true;\r\n              }\r\n            }\r\n\r\n            $scope.createcontact = function () {\r\n              $scope.disabled = true;\r\n              $scope.progresslinear = true;\r\n\r\n              if ($scope.editandcreate == true) {\r\n                $scope.editContact();\r\n              } else {\r\n\r\n                var data = {};\r\n                var target = {};\r\n                if ($scope.data.listSelected.id == 1) {\r\n                  target = {type: 'contactlist', contactlists: $scope.data.arrAddressee};\r\n                } else {\r\n                  target = {type: 'segment', segment: $scope.data.arrAddressee};\r\n                }\r\n\r\n                data = {\r\n                  name: $scope.name,\r\n//                notification: $('#toggle-one').prop('checked'),\r\n                  notification: $scope.not,\r\n                  email: $scope.email,\r\n                  target: $scope.countContactsApproximate.counts,\r\n                  receiver: target,\r\n                  message: $scope.data.message,\r\n                  idSmsCategory: $scope.idSmsCategory,\r\n                  datesend: document.getElementById(\"datesend\").value,\r\n//                datenow: $('#toggle-two').prop('checked'),\r\n                  timezone: $scope.timezone,\r\n                  AproximateSendings: $scope.success,\r\n                  advancedoptions: $scope.advancedoptions,\r\n                  divide: $scope.divide,\r\n                  continueError: $scope.continueError,\r\n                  sendingTime: $scope.sendingTime,\r\n                  timeFormat: $scope.timeFormat,\r\n                  quantity: $scope.quantity,\r\n                  idSms: $scope.idSms,\r\n                  datenow: $scope.datenow,\r\n                  gmt: $scope.gmt,\r\n                  morecaracter : $scope.morecaracter,\r\n                  originalDate: document.getElementById(\"datesend\").value,\r\n                  switchrepeated: $scope.switchrepeated,\r\n                  sendpush: $scope.sendpush\r\n                };\r\n\r\n                if ($scope.viewTemplate == true && $scope.idSmsTemplate == undefined) {\r\n                  notificationService.error(\"Si desea usar una plantilla predefinida de SMS, debe seleccionarla de la lista de plantillas\");\r\n                  return false;\r\n                }\r\n\r\n                main.createContact(data)\r\n                        .then(function (data) {\r\n                          console.log(data);\r\n                          $scope.disabled = false;\r\n                          $scope.validcount = data.data.Envios;\r\n                          $scope.invalicount = data.data.Invalidos;\r\n                          $scope.IdSms = data.data.IdSms;\r\n                          $scope.initProcessValidate = true;\r\n                          $scope.progresslinear = false;\r\n\r\n                          //closePreview();\r\n                          //var route = $window.myBaseURL + \"sms/\";\r\n                          //$window.location.href = route;\r\n                        })\r\n                        .catch(function (data) {\r\n                          $scope.progresslinear = false;\r\n                          slideOnTop(data.data.message, 3000, \"glyphicon glyphicon-remove-sign\", \"danger\");\r\n                          $rootScope.error = 'fail';\r\n                        });\r\n              }\r\n            }\r\n\r\n            $scope.sendnotification = function () {\r\n              if ($scope.not) {\r\n                $scope.not = false;\r\n                //$(\"#email-addresses\").hide(\"slow\");\r\n              } else {\r\n                $scope.not = true;\r\n                // $(\"#email-addresses\").show(\"slow\");\r\n              }\r\n            }\r\n\r\n            $scope.editContact = function () {\r\n\r\n              $scope.progresslinear = true;\r\n\r\n              var data = {};\r\n              var target = {};\r\n              if ($scope.data.listSelected.id == 1) {\r\n                target = {type: 'contactlist', contactlists: $scope.data.arrAddressee};\r\n              } else {\r\n                target = {type: 'segment', segment: $scope.data.arrAddressee};\r\n              }\r\n\r\n              if (!$scope.not) {\r\n                $scope.email = \"\";\r\n              }\r\n\r\n              data = {\r\n                name: $scope.name,\r\n                notification: $('#toggle-one').prop('checked'),\r\n                email: $scope.email,\r\n                target: $scope.countContactsApproximate.counts,\r\n                receiver: target,\r\n                message: $scope.data.message,\r\n                idSmsCategory: $scope.idSmsCategory,\r\n                datesend: document.getElementById(\"datesend\").value,\r\n                datenow: $scope.datenow,\r\n                timezone: $scope.timezone,\r\n                idSms: idSms,\r\n                morecaracter : $scope.morecaracter,\r\n                sendpush : $scope.sendpush,\r\n                switchrepeated: $scope.switchrepeated\r\n              };\r\n              $scope.taggedMessage = $scope.data.message;\r\n              console.log(data);\r\n              main.editContact(data)\r\n                      .then(function (data) {\r\n\r\n                        $scope.validcount = data.Envios;\r\n                        $scope.invalicount = data.Invalidos;\r\n                        $scope.IdSms = data.IdSms;\r\n                        $scope.initProcessValidate = true;\r\n                        $scope.progresslinear = false;\r\n                      })\r\n                      .catch(function (data) {\r\n                        $scope.progresslinear = false;\r\n                        console.log(data);\r\n                        slideOnTop(data, 3000, \"glyphicon glyphicon-remove-sign\", \"danger\");\r\n                        $rootScope.error = 'fail';\r\n                      });\r\n            }\r\n            $scope.errorMessage = false;\r\n            $scope.validateInLine = function () {\r\n              $scope.invalidCharacters = false;\r\n              $scope.existTags = false;\r\n              $scope.taggedMessage = $scope.data.message;\r\n              $scope.newMessage = $scope.data.message;\r\n              var re = /[ñÑáéíóúÁÉÍÓÚ¿¡´]/;\r\n              var tags = /%%+[a-zA-Z0-9_]+%%/;\r\n              var count = 0;\r\n              if (tags.test($scope.data.message)) {\r\n                $scope.existTags = true;\r\n                $scope.taggedMessage = \"\";\r\n                $scope.newMessage = \"\";\r\n                var words = $scope.data.message.split(\" \");\r\n                for (var cont = 0; cont < words.length; cont++) {\r\n                  var word = words[cont];\r\n                  var word2 = words[cont];\r\n                  if (word.substr(0, 2) == \"%%\" && (word.substr(-2) == \"%%\" || word.substr(-3) == \"%%,\" || word.substr(-3) == \"%%.\" || word.substr(-3) == \"%%;\")) {\r\n                    word = word.substr(2);\r\n                    //word2 = \"\";\r\n                    word = \"<b><i>\" + word;\r\n                    if (word.substr(-2) == \"%%\") {\r\n                      word = word.substr(0, word.length - 2);\r\n                    } else if (word.substr(-3) == \"%%,\" || word.substr(-3) == \"%%.\" || word.substr(-3) == \"%%;\") {\r\n                      word = word.substr(0, word.length - 3);\r\n                    }\r\n                    word = word + \"</i></b>\";\r\n                    count = count + word.length;\r\n                  }\r\n                  $scope.taggedMessage += word + \" \";\r\n                  $scope.newMessage += word2;\r\n                }\r\n              }\r\n            };\r\n            /*$scope.$watch(\"data.message\", function () {\r\n             var message = $scope.data.message;\r\n             var tags = /%%+[a-z0-9_]+%%/;\r\n             console.log(message);\r\n             }, true);*/\r\n            $scope.changeMessage = function () {\r\n              var message = $scope.data.message;\r\n              var tags = /%%+[a-z0-9_]+%%/;\r\n              /*if(tags.search(message)){\r\n               console.log(\"hola\");\r\n               }*/\r\n            };\r\n\r\n            $scope.countContacts = function () {\r\n                console.log('scope.data',$scope.data);\r\n              var type = '';\r\n              $scope.countError = false;\r\n              if ($scope.data.listSelected.id == 1) {\r\n                type = 'contactlist';\r\n              } else {\r\n                type = 'segment';\r\n              }\r\n              if (angular.isUndefined($scope.data.arrAddressee) || $scope.data.arrAddressee == 0) {\r\n                $scope.countContactsApproximate.counts = 0\r\n                return;\r\n              }\r\n              var data = {\r\n                type: type,\r\n                segment: $scope.data.arrAddressee,\r\n                contactlist: $scope.data.arrAddressee,\r\n                switchrepeated: $scope.switchrepeated\r\n              };\r\n              main.countContact(data).then(function (data) {\r\n                $scope.countContactsApproximate = data.data;\r\n                console.log('countContacts:',$scope.countContactsApproximate);\r\n                if($scope.countContactsApproximate.counts > 40000 && !$scope.divide){\r\n                  slideOnTop(\"Sobrepasa el maximo permitido de 40.000 Contactos\", 3000, \"glyphicon glyphicon-remove-sign\", \"warning\");\r\n                  return;\r\n                }\r\n                $scope.triggerEmailNotificationBalanceSmsContact($scope.countContactsApproximate.counts);\r\n              }).catch(\r\n                function (data) {\r\n                  $scope.countError = true;\r\n                  slideOnTop(/*data.data.message*/\"Sobrepasa el maximo permitido de 40.000 Contactos\", 3000, \"glyphicon glyphicon-remove-sign\", \"warning\");\r\n                }\r\n              );\r\n            };\r\n            $scope.getDetinatary = function (list) {\r\n//        $scope.countContactsApproximate.counts=1;\r\n              $scope.showAddressee = false;\r\n              $scope.data.arrAddressee = [];\r\n              if (list.id == 1) {\r\n                main.getcontactlist()\r\n                        .success(function (data) {\r\n                          $scope.showAddressee = true;\r\n                          $scope.listAllAddressee = data;\r\n                        })\r\n                        .catch(function (data) {\r\n                          slideOnTop(data.message, 3000, \"glyphicon glyphicon-remove-sign\", \"danger\");\r\n                        });\r\n              } else {\r\n                main.getsegments()\r\n                        .success(function (data) {\r\n                          $scope.showAddressee = true;\r\n                          $scope.listAllAddressee = data;\r\n                        })\r\n                        .catch(function (data) {\r\n                          slideOnTop(data.message, 3000, \"glyphicon glyphicon-remove-sign\", \"danger\");\r\n                        });\r\n              }\r\n            }\r\n\r\n\r\n            $scope.openPreview = function () {\r\n              $(\"#preview\").addClass('dialog--open');\r\n            }\r\n            $scope.closePreview = function () {\r\n              $(\"#preview\").removeClass('dialog--open');\r\n            }\r\n\r\n            $scope.addTag = function (tag) {\r\n              if (typeof $scope.data.message == \"undefined\") {\r\n                $scope.data.message = \"\";\r\n                $scope.data.message += tag;\r\n              } else {\r\n                var text = $scope.data.message + \" \" + tag;\r\n                if (text.length > 160 && $scope.morecaracter === false) {\r\n                  slideOnTop(\"No puede agregar esta etiqueta, ya que excede el límite de caracteres\", 3000, \"glyphicon glyphicon-remove-sign\", \"danger\");\r\n                  return false;\r\n                }else if(text.length > 300 && $scope.morecaracter === true){\r\n                  slideOnTop(\"No puede agregar esta etiqueta, ya que excede el límite de caracteres\", 3000, \"glyphicon glyphicon-remove-sign\", \"danger\");\r\n                  return false;                    \r\n                }\r\n                $scope.data.message += \" \" + tag;\r\n              }\r\n\r\n              $scope.validateInLine();\r\n            }\r\n\r\n            main.listfullsmstemplate().then(function (data) {\r\n              $scope.listfullsmstemplate = data;\r\n            });\r\n            $scope.smstemplate = function (data) {\r\n              $scope.viewTemplate = !data;\r\n            };\r\n            $scope.useTemplate = function () {\r\n              angular.forEach($scope.listfullsmstemplate, function (value, key) {\r\n                if (value.idSmsTemplate == $scope.idSmsTemplate) {\r\n                  $scope.addTag(value.content);\r\n                }\r\n              });\r\n            };\r\n            $scope.getOne = function () {\r\n\r\n              main.getOneSms(idSms).then(function (data)\r\n              {\r\n                $scope.sms = data;\r\n                $scope.idSms = $scope.sms.idSms;\r\n                $scope.name = $scope.sms.name;\r\n                $scope.not = false;\r\n                if ($scope.sms.notification == 1) {\r\n                  $scope.not = true;\r\n                }\r\n                if($scope.sms.morecaracter === true){\r\n                   $scope.morecaracter = true;\r\n                   $(\"#morecaracter\").prop('checked', true);\r\n                }else{\r\n                   $scope.morecaracter = false; \r\n                   $(\"#morecaracter\").prop('checked', false);\r\n                }\r\n                $scope.email = $scope.sms.email;\r\n                $scope.receiver = $scope.sms.receiver;\r\n                $scope.idSmsCategory = $scope.sms.idSmsCategory;\r\n                $scope.originalDate = $scope.sms.originalDate;\r\n                $scope.datenow = true;\r\n                $('#toggle-two').bootstrapToggle('off');\r\n\r\n \r\n\r\n                if ($scope.sms.dateNow == 1) {\r\n                  $scope.datenow = true;\r\n                  $('#toggle-two').bootstrapToggle('off');\r\n                }\r\n                if ($scope.sms.advancedoptions == 1) {\r\n                  $scope.advancedoptions = true;\r\n                  $('#toggle-three').bootstrapToggle('on');\r\n                }\r\n                if ($scope.sms.notification == 1) {\r\n                  $scope.not = true;\r\n                  $('#toggle-one').bootstrapToggle('on');\r\n                }\r\n                if ($scope.sms.divide == 1) {\r\n                  $scope.divide = true;\r\n                  $('#toggle-four').bootstrapToggle('on');\r\n                }\r\n                if($scope.sms.sendpush == 1){\r\n                  $scope.sendpush = true;\r\n                  $('#toggle-one').bootstrapToggle('on');\r\n                }\r\n                $scope.timezone;\r\n                $scope.AproximateSendings;\r\n                $scope.timeFormat = $scope.sms.timeFormat;\r\n                $scope.quantity = parseInt($scope.sms.quantity);\r\n//                $scope.gmt = $scope.sms.gmt;\r\n                $scope.gmt = $scope.sms.gmt;\r\n              });\r\n            };\r\n            $scope.getOne();\r\n            $scope.validateBalanceSmsContact();\r\n            \r\n            $scope.triggerEmailNotificationBalanceSmsContact = function (totalContacts){\r\n              if($scope.misc.totalAvailable<totalContacts){\r\n                    $scope.apismsContactEmailbalance = {};\r\n                    $scope.apismsContactEmailbalance.total = totalContacts;\r\n                    $scope.apismsContactEmailbalance.totalAvailable = $scope.misc.totalAvailable;\r\n                    $scope.sendMailNotificationSmsContactBalance();\r\n                   }\r\n              };\r\n//              \r\n              $scope.sendMailNotificationSmsContactBalance = function () {\r\n                   main.sendMailNotificationSmsBalance($scope.apismsContactEmailbalance).then(function (data) { \r\n                    });\r\n                }; \r\n            \r\n            $scope.selectAllList = function () {\r\n              console.log($scope.allList);\r\n              if ($scope.allList) {\r\n                $scope.data.arrAddressee = [];\r\n                for (let i = 0; i < $scope.listAllAddressee.length; i++) {\r\n                  $scope.data.arrAddressee.push($scope.listAllAddressee[i]);\r\n                }\r\n              } else {\r\n                $scope.data.arrAddressee = [];\r\n              }\r\n              $scope.countContacts();\r\n            }\r\n\r\n\r\n            \r\n            $scope.switchrepeatedclic = function (switchrepeated) {\r\n              $scope.switchrepeated = switchrepeated;\r\n              console.log($scope.switchrepeated);\r\n\r\n              if ($scope.switchrepeated !== true) {\r\n                $scope.switchrepeated = false;\r\n              }\r\n              if ($scope.switchrepeated == true) {\r\n                document.getElementById('repe1').style.display = \"block\";\r\n                document.getElementById('repe2').style.display = \"none\";\r\n                $scope.countContacts();\r\n              }\r\n              if ($scope.switchrepeated == false) {\r\n                document.getElementById('repe1').style.display = \"none\";\r\n                document.getElementById('repe2').style.display = \"block\";\r\n                $scope.countContacts();\r\n              }\r\n            }\r\n\r\n          }])\r\n        .controller('showContact', ['$rootScope', '$scope', '$http', 'main', '$window', '$timeout', 'notificationService', function ($rootScope, $scope, $http, main, $window, $timeout, notificationService) {\r\n            $scope.initial = 0;\r\n            $scope.page = 1;\r\n            $scope.getAll = function () {\r\n              main.getDetailSms(idSms, $scope.initial).then(function (res) {\r\n                $scope.listsms = res;\r\n              });\r\n            };\r\n            $scope.forward = function () {\r\n              $scope.initial += 1;\r\n              $scope.page += 1;\r\n              $scope.getAll();\r\n            };\r\n            $scope.fastforward = function () {\r\n              $scope.initial = ($scope.listsms.detail[1].total_pages - 1);\r\n              $scope.page = $scope.listsms.detail[1].total_pages;\r\n              $scope.getAll();\r\n            };\r\n            $scope.backward = function () {\r\n              $scope.initial -= 1;\r\n              $scope.page -= 1;\r\n              $scope.getAll();\r\n            };\r\n            $scope.fastbackward = function () {\r\n              $scope.initial = 0;\r\n              $scope.page = 1;\r\n              $scope.getAll();\r\n            };\r\n            $scope.getAll();\r\n            $scope.traslateStatus = function (status) {\r\n              var string = \"\";\r\n              switch (status) {\r\n                case \"sent\":\r\n                  string = \"Enviado\";\r\n                  break;\r\n                case \"undelivered\":\r\n                  string = \"No enviado\";\r\n                  break;\r\n              }\r\n              return string;\r\n            };\r\n          }])\r\n        .factory('notificationService', function () {\r\n          function error(message) {\r\n            slideOnTop(message, 4000, 'glyphicon glyphicon-remove-circle', 'danger');\r\n          }\r\n\r\n          function success(message) {\r\n            slideOnTop(message, 4000, 'glyphicon glyphicon-ok-circle', 'success');\r\n          }\r\n\r\n          function warning(message) {\r\n            slideOnTop(message, 4000, 'glyphicon glyphicon-exclamation-sign', 'warning');\r\n          }\r\n\r\n          function notice(message) {\r\n            slideOnTop(message, 4000, 'glyphicon glyphicon-exclamation-sign', 'notice');\r\n          }\r\n\r\n          function primary(message) {\r\n            slideOnTop(message, 4000, 'glyphicon glyphicon-exclamation-sign', 'primary');\r\n          }\r\n\r\n          return {\r\n            error: error,\r\n            success: success,\r\n            warning: warning,\r\n            notice: notice,\r\n            primary: primary\r\n          };\r\n        });\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9qcy9hbmd1bGFyL3Ntcy9jb250cm9sbGVyLmpzP2E3OGQiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixpQkFBaUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxvQkFBb0IsZUFBZTtBQUNuQztBQUNBO0FBQ0EscURBQXFELGFBQWEsSUFBSSxZQUFZO0FBQ2xGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLFlBQVk7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixlQUFlO0FBQ2YsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGVB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VztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnYWlvJywgWydwbGF0YW51cy5rZWVwVmFsdWVzJywgJ3VpLnNlbGVjdCcsICduZ1Nhbml0aXplJywgJ25nTWF0ZXJpYWwnLCAnbmdBbmltYXRlJywgJ21vbWVudC1waWNrZXInLCAnYW5ndWxhck1vbWVudCddKVxyXG4gICAgICAgIC5maWx0ZXIoJ3Byb3BzRmlsdGVyJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtcywgcHJvcHMpIHtcclxuICAgICAgICAgICAgdmFyIG91dCA9IFtdO1xyXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGl0ZW1zKSkge1xyXG4gICAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMocHJvcHMpO1xyXG4gICAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtTWF0Y2hlcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBwcm9wID0ga2V5c1tpXTtcclxuICAgICAgICAgICAgICAgICAgdmFyIHRleHQgPSBwcm9wc1twcm9wXS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICAgICAgICBpZiAoaXRlbVtwcm9wXS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0ZXh0KSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtTWF0Y2hlcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbU1hdGNoZXMpIHtcclxuICAgICAgICAgICAgICAgICAgb3V0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8gTGV0IHRoZSBvdXRwdXQgYmUgdGhlIGlucHV0IHVudG91Y2hlZFxyXG4gICAgICAgICAgICAgIG91dCA9IGl0ZW1zO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gb3V0O1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5maWx0ZXIoJ3NwbGl0JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCwgc3BsaXRDaGFyKSB7XHJcbiAgICAgICAgICAgIC8vIGRvIHNvbWUgYm91bmRzIGNoZWNraW5nIGhlcmUgdG8gZW5zdXJlIGl0IGhhcyB0aGF0IGluZGV4XHJcbiAgICAgICAgICAgIHJldHVybiBpbnB1dC5zcGxpdChzcGxpdENoYXIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnc3RhdHVzU21zJywgZnVuY3Rpb24gKCRjb21waWxlKSB7XHJcbiAgICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHNjb3BlOiB7c3RhdHVzU21zOiAnQCd9LFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIpIHtcclxuICAgICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSBcIkVzdGFkbzogPHNwYW4gY2xhc3M9J3t7Y2xhc3NTdGF0dXN9fSc+e3t0cmFsYXRlU21zfX08c3Bhbj5cIjtcclxuICAgICAgICAgICAgICBzY29wZS5jaGFuZVN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoc2NvcGUuc3RhdHVzU21zKSB7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ2RyYWZ0JzpcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5jbGFzc1N0YXR1cyA9ICdjb2xvci1kcmFmdCc7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudHJhbGF0ZVNtcyA9IFwiQm9ycmFkb3JcIjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgY2FzZSAnc2NoZWR1bGVkJzpcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5jbGFzc1N0YXR1cyA9ICdjb2xvci1zY2hlZHVsZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnRyYWxhdGVTbXMgPSBcIlByb2dyYW1hZG9cIjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgY2FzZSAncGVuZGluZyc6XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2xhc3NTdGF0dXMgPSAnY29sb3ItcGVuZGluZyc7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudHJhbGF0ZVNtcyA9IFwiUGVuZGllbnRlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ3NlbmRpbmcnOlxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNsYXNzU3RhdHVzID0gJ2NvbG9yLXNlbmRpbmcnO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnRyYWxhdGVTbXMgPSBcIkVuIHByb2Nlc28gZGUgZW52w61vXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ3NlbnQnOlxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNsYXNzU3RhdHVzID0gJ2NvbG9yLXNlbnQnO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnRyYWxhdGVTbXMgPSBcIkVudmlhZG9cIjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgY2FzZSAncGF1c2VkJzpcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5jbGFzc1N0YXR1cyA9ICdjb2xvci1wYXVzZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnRyYWxhdGVTbXMgPSBcIlBhdXNhZG9cIjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgY2FzZSAnY2FuY2VsZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNsYXNzU3RhdHVzID0gJ2NvbG9yLWNhbmNlbGVkJztcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS50cmFsYXRlU21zID0gXCJDYW5jZWxhZG9cIjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgY2FzZSAndW5kZWxpdmVyZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNsYXNzU3RhdHVzID0gJ2NvbG9yLWNhbmNlbGVkJztcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS50cmFsYXRlU21zID0gXCJObyBlbnZpYWRvXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnc3RhdHVzU21zJywgZnVuY3Rpb24gKHYpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmNoYW5lU3RhdHVzKCk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwodGVtcGxhdGUpO1xyXG4gICAgICAgICAgICAgICAgJGNvbXBpbGUoZWxlbWVudC5jb250ZW50cygpKShzY29wZSk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgc2NvcGUuY2hhbmVTdGF0dXMoKTtcclxuICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwodGVtcGxhdGUpO1xyXG4gICAgICAgICAgICAgICRjb21waWxlKGVsZW1lbnQuY29udGVudHMoKSkoc2NvcGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZGlyZWN0aXZlKCd0eXBlU21zJywgZnVuY3Rpb24gKCRjb21waWxlKSB7XHJcbiAgICAgICAgICByZXR1cm57XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cikge1xyXG4gICAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9IFwiVGlwbzoge3tzdGF0dXNUeXBlfX1cIjtcclxuICAgICAgICAgICAgICBzd2l0Y2ggKGF0dHIudHlwZVNtcykge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnY29udGFjdCc6XHJcbiAgICAgICAgICAgICAgICAgIHNjb3BlLnN0YXR1c1R5cGUgPSBcIkNvbnRhY3RvXCI7XHJcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnY3N2JzpcclxuICAgICAgICAgICAgICAgICAgc2NvcGUuc3RhdHVzVHlwZSA9IFwiQ3N2XCI7XHJcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnbG90ZSc6XHJcbiAgICAgICAgICAgICAgICAgIHNjb3BlLnN0YXR1c1R5cGUgPSBcIkVudsOtbyByYXBpZG9cIjtcclxuICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdhdXRvbWF0aWMnOlxyXG4gICAgICAgICAgICAgICAgICBzY29wZS5zdGF0dXNUeXBlID0gXCJDb250YWN0b1wiO1xyXG4gICAgICAgICAgICAgICAgICBicmVhazsgICAgXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICBzY29wZS5zdGF0dXNUeXBlID0gXCJFbnbDrW8gcmFwaWRvXCI7XHJcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZWxlbWVudC5odG1sKHRlbXBsYXRlKTtcclxuICAgICAgICAgICAgICAkY29tcGlsZShlbGVtZW50LmNvbnRlbnRzKCkpKHNjb3BlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmZhY3RvcnkoJ3NvY2tldCcsIGZ1bmN0aW9uICgkcm9vdFNjb3BlKSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBvbjogZnVuY3Rpb24gKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICBzb2NrZXQub24oZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlbWl0OiBmdW5jdGlvbiAoZXZlbnROYW1lLCBkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgIHNvY2tldC5lbWl0KGV2ZW50TmFtZSwgZGF0YSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5mYWN0b3J5KCdtYWluJywgWyckaHR0cCcsICckd2luZG93JywgJyRxJywgJ25vdGlmaWNhdGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICR3aW5kb3csICRxLCBub3RpZmljYXRpb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgZ2V0U2VydmljZVZlcmlmaWVkOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm91dGUgPSBmdWxsVXJsQmFzZSArICcvYXBpL3Ntcy92ZXJpZnlzbXN0d293YXlzZXJ2aWNlJztcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQocm91dGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIGNyZWF0ZUxvdGU6IGZ1bmN0aW9uIChkYXRhLCBzdWNjZXNzLCBlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnY3JlYXRlbG90ZScsIGRhdGEpLnN1Y2Nlc3Moc3VjY2VzcykuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgZWRpdExvdGU6IGZ1bmN0aW9uIChkYXRhLCBzdWNjZXNzLCBlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvdXRlID0gJHdpbmRvdy5teUJhc2VVUkwgKyBcInNtcy9lZGl0L1wiO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdChyb3V0ZSArIGRhdGEuaWRTbXMsIGRhdGEpLnN1Y2Nlc3Moc3VjY2VzcykuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgZ2V0bGlzdHRpbWV6b25lOiBmdW5jdGlvbiAoc3VjY2VzcywgZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHZhciByb3V0ZSA9ICR3aW5kb3cubXlCYXNlVVJMICsgXCJtYWlsL3RpbWV6b25lL1wiO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdChyb3V0ZSkuc3VjY2VzcyhzdWNjZXNzKS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBnZXRjb250YWN0bGlzdDogZnVuY3Rpb24gKHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm91dGUgPSAkd2luZG93Lm15QmFzZVVSTCArIFwiYXBpL3NlbmRtYWlsL2dldGNvbnRhY3RsaXN0XCI7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHJvdXRlKTtcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIGdldHNlZ21lbnRzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm91dGUgPSAkd2luZG93Lm15QmFzZVVSTCArIFwiYXBpL3NlbmRtYWlsL2dldHNlZ21lbnRcIjtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQocm91dGUpO1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgY3JlYXRlQ29udGFjdDogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCdjcmVhdGVjb250YWN0JywgZGF0YSk7XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICB2YWxpZGF0ZXNtc2NvbnRhY3Q6IGZ1bmN0aW9uIChpZFNtcykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvdXRlID0gJHdpbmRvdy5teUJhc2VVUkwgKyBcInNtcy92YWxpZGF0ZWNvbnRhY3QvXCIgKyBpZFNtcztcclxuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHJvdXRlLCBpZFNtcyk7XHJcblxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgY291bnRDb250YWN0OiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvdXRlID0gJHdpbmRvdy5teUJhc2VVUkwgKyBcImFwaS9zbXMvY291bnRjb250YWN0XCI7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdChyb3V0ZSwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBlZGl0Q29udGFjdDogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciByb3V0ZSA9ICR3aW5kb3cubXlCYXNlVVJMICsgXCJzbXMvZWRpdGNvbnRhY3QvXCIgKyBkYXRhLmlkU21zO1xyXG4vLyAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yLFwiLGRhdGEpO1xyXG4vLyAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdChyb3V0ZSwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdChyb3V0ZSwgZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QoZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgbGlzdGZ1bGxzbXN0ZW1wbGF0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvdXRlID0gJHdpbmRvdy5teUJhc2VVUkwgKyBcImFwaS9zbXN0ZW1wbGF0ZS9saXN0ZnVsbFwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldChyb3V0ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgZ2V0RGV0YWlsU21zOiBmdW5jdGlvbiAoaWRTbXMsIHBhZ2UpIHtcclxuICAgICAgICAgICAgICAgIHZhciByb3V0ZSA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zdGF0aWNzL2dldGRldGFpbHNtcy8nICsgaWRTbXMgKyBcIi9cIiArIHBhZ2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHJvdXRlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBnZXRDYXRlZ29yeTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvdXRlID0gZnVsbFVybEJhc2UgKyAnL2FwaS9zbXNjYXRlZ29yeS9nZXRhbGwnO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldChyb3V0ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgZ2V0U21zOiBmdW5jdGlvbiAocGFnZSwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvdXRlID0gZnVsbFVybEJhc2UgKyAnL2FwaS9zbXMvZ2V0YWxsLycgKyBwYWdlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3Qocm91dGUsIGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2Uud2FybmluZyhkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgZ2V0T25lU21zOiBmdW5jdGlvbiAoaWRTbXMpIHtcclxuICAgICAgICAgICAgICAgIHZhciByb3V0ZSA9IGZ1bGxVcmxCYXNlICsgJy9hcGkvc21zL2dldG9uZS8nICsgaWRTbXM7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHJvdXRlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBkb3dubG9hZEZhaWxlZFNtczogZnVuY3Rpb24gKGRhdGEsIGlkU21zKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm91dGUgPSBmdWxsVXJsQmFzZSArICdhcGkvc21zL2Rvd25sb2FkcmVwb3J0c21zZmFpbGVkLycgKyBpZFNtcztcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHJvdXRlLCBkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgZGVsZXRldmFyaW91c3Ntc2xvdGVzOiBmdW5jdGlvbiAoaWRTbXMpIHtcclxuICAgICAgICAgICAgICAgIHZhciByb3V0ZSA9IGZ1bGxVcmxCYXNlICsgJ2FwaS9zbXMvZGVsZXRldmFyaW91c2xvdGVzLycgKyBpZFNtcztcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHJvdXRlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coZGF0YSk7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS53YXJuaW5nKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgdmFsaWRhdGVCYWxhbmNlOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICB2YXIgcm91dGUgPSBmdWxsVXJsQmFzZSArICdhcGkvc21zL3ZhbGlkYXRlYmFsYW5jZSc7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICRodHRwLnBvc3Qocm91dGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbm90aWZpY2F0aW9uU2VydmljZS53YXJuaW5nKGRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBzZW5kTWFpbE5vdGlmaWNhdGlvblNtc0JhbGFuY2U6IGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICAgICAgICB2YXIgcm91dGUgPSBmdWxsVXJsQmFzZSArICdhcGkvc21zL3NlbmRtYWlsbm90c21zYmFsYW5jZSc7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICRodHRwLnBvc3Qocm91dGUsZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9ub3RpZmljYXRpb25TZXJ2aWNlLndhcm5pbmcoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIGdldEJhbGFuY2VTdWJBY2NvdW50OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICB2YXIgcm91dGUgPSBmdWxsVXJsQmFzZSArICdhcGkvc21zL2dldGJhbGFuY2VzdWJhY2NvdW50JztcclxuICAgICAgICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgICAgJGh0dHAucG9zdChyb3V0ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9ub3RpZmljYXRpb25TZXJ2aWNlLndhcm5pbmcoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBkb3dubG9hZEZhaWxlZFNtc0NvbnRhY3Q6IGZ1bmN0aW9uIChkYXRhLCBpZFNtcykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvdXRlID0gZnVsbFVybEJhc2UgKyAnYXBpL3Ntcy9kb3dubG9hZGZhaWxlZHNtc2NvbnRhY3QvJyArIGlkU21zO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocm91dGUpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3Qocm91dGUsIGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XSlcclxuICAgICAgICAuY29udHJvbGxlcignY3RybFNtcycsIFsnJHJvb3RTY29wZScsICckc2NvcGUnLCAnJGh0dHAnLCAnbWFpbicsICckd2luZG93JywgJyR0aW1lb3V0JywgJ3NvY2tldCcsICdub3RpZmljYXRpb25TZXJ2aWNlJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSwgJGh0dHAsIG1haW4sICR3aW5kb3csICR0aW1lb3V0LCBzb2NrZXQsIG5vdGlmaWNhdGlvblNlcnZpY2UpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dCdXR0b25Ud293YXkgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLmdtdCA9IFwiLTA1MDBcIjtcclxuICAgICAgICAgICAgJHNjb3BlLmluaXRpYWwgPSAwO1xyXG4gICAgICAgICAgICAkc2NvcGUucGFnZSA9IDE7XHJcbiAgICAgICAgICAgICRzY29wZS5maWx0ZXIgPSB7fTtcclxuICAgICAgICAgICAgJHNjb3BlLmNvbXBsZXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5taXNjID0ge307XHJcbiAgICAgICAgICAgICRzY29wZS5taXNjLlByb2NjZXNzQ3N2ID0ge307XHJcbiAgICAgICAgICAgICRzY29wZS50eXBlQ3N2O1xyXG4gICAgICAgICAgICAkc2NvcGUudGFyZ2V0Y3N2O1xyXG4gICAgICAgICAgICAkc2NvcGUubW9yZWNhcmFjdGVyID0gZmFsc2U7XHJcbiAgICAgICAgICAgIG1haW4uZ2V0bGlzdHRpbWV6b25lKGZ1bmN0aW9uIChyZXMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAkc2NvcGUudGltZXpvbmVzID0gcmVzO1xyXG4gICAgICAgICAgICAgICRzY29wZS5pbnZhbGlkQ2hhcmFjdGVycyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5leGlzdFRhZ3MgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgIHNsaWRlT25Ub3AoXCJIYSBvY3VycmlkbyB1biBlcnJvciBpbnRlbnRlbG8gZGUgbnVldm8gbWFzIHRhcmRlXCIsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1yZW1vdmUtc2lnblwiLCBcImRhbmdlclwiKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICRzY29wZS5hZGREaXNhYmxlZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgICAgICAgICQoXCIjXCIgKyBpZCkuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkc2NvcGUucmVtb3ZlRGlzYWJsZWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAgICAgICAkKFwiI1wiICsgaWQpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJHNjb3BlLnNob3dEZXN0aW5hdGFyeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUubm90ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRlbm93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgJHNjb3BlLnNlbmRwdXNoID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5zZW5kbm90aWZpY2F0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgIGlmICgkc2NvcGUubm90KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubm90ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkKFwiI2VtYWlsLWFkZHJlc3Nlc1wiKS5oaWRlKFwic2xvd1wiKTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5vdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkKFwiI2VtYWlsLWFkZHJlc3Nlc1wiKS5zaG93KFwic2xvd1wiKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS52YWxpZGF0ZUNoZWNrcyA9IGZ1bmN0aW9uIChwYXJhbSl7XHJcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUubW9yZWNhcmFjdGVyID09IHRydWUgJiYgJHNjb3BlLnNlbmRwdXNoID09IHRydWUpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiTG8gc2VudGltb3Mgbm8gc2UgcHVlZGUgcmVhbGl6YXIgZW52w61vcyBkZSBtZW5zYWplcyBmbGFzaCBjb24gbGEgbW9kYWxpZGFkIGRlIG3DoXMgZGUgMTYwIGNhcmFjdGVyZXMuXCIsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1pbmZvLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYocGFyYW0gPT0gMSAmJiAkc2NvcGUuc2VuZHB1c2ggPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1vcmVjYXJhY3RlciA9IGZhbHNlOyAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKHBhcmFtID09IDIgJiYgJHNjb3BlLm1vcmVjYXJhY3RlciA9PSB0cnVlKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2VuZHB1c2ggPSBmYWxzZTsgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9PcGNpb25lcyBhdmFuemFkYXNcclxuICAgICAgICAgICAgJHNjb3BlLmFkdmFuY2Vkb3B0aW9ucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUuZXZhbHVhdGVBZHZhbmNlZG9wdGlvbnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgaWYgKCRzY29wZS5hZHZhbmNlZG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hZHZhbmNlZG9wdGlvbnMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFkdmFuY2Vkb3B0aW9ucyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuZGl2aWRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5kaXZpZGVTZW5kaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgIGlmICgkc2NvcGUuZGl2aWRlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGl2aWRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkKFwiI2RpdmlkZS1jb250YWluZXJcIikuaGlkZShcInNsb3dcIik7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kaXZpZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJChcIiNkaXZpZGUtY29udGFpbmVyXCIpLnNob3coXCJzbG93XCIpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnRpbWVGb3JtYXRzID0gW1xyXG4gICAgICAgICAgICAgIHt2YWx1ZTogJ21pbnV0ZScsIG5hbWU6IFwiTWludXRvKHMpXCJ9LFxyXG4gICAgICAgICAgICAgIHt2YWx1ZTogJ2hvdXInLCBuYW1lOiBcIkhvcmEocylcIn0sXHJcbiAgICAgICAgICAgICAge3ZhbHVlOiAnZGF5JywgbmFtZTogXCJEw61hKHMpXCJ9LFxyXG4gICAgICAgICAgICAgIHt2YWx1ZTogJ3dlZWsnLCBuYW1lOiBcIlNlbWFuYShzKVwifSxcclxuICAgICAgICAgICAgICB7dmFsdWU6ICdtb250aCcsIG5hbWU6IFwiTWVzKGVzKVwifVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICAvL2ZpbiBkZSBvcGNpb25lcyBhdmFuemFkYXNcclxuXHJcbi8vICAgICAgJHNjb3BlLmV4cHJlc2lvbiA9IGZ1bmN0aW9uIChtc2cpe1xyXG4vLyAgICAgICAgdmFyIHJlZ2V4ID0gIC9bw7HDkcOhw6nDrcOzw7rDgcOJw43Dk8Oawr/CocK0XS87XHJcbi8vICAgICAgICBjb25zb2xlLmxvZyhyZWdleC50ZXN0KG1zZykpO1xyXG4vLyAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSAwO1xyXG4gICAgICAgICAgICAgICRzY29wZS5zdWNjZXNzID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgdmFyIGV4aXN0VGFncyA9IDA7XHJcbiAgICAgICAgICAgICAgdmFyIGZsYWcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICRzY29wZS53cm9uZ1JvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5hcnJFcnJvciA9IFt7fV07XHJcbiAgICAgICAgICAgICAgdmFyIGJyZWFrcyA9ICh0eXBlb2YgJHNjb3BlLnJlY2VpdmVyICE9ICd1bmRlZmluZWQnICYmIHR5cGVTbXMgIT0gJ2NzdicpID8gJHNjb3BlLnJlY2VpdmVyLnNwbGl0KCdcXG4nKSA6IFtdO1xyXG4vLyAgICAgICAgICAgICAgaWYgKCEkc2NvcGUucmVjZWl2ZXIgJiYgdHlwZVNtcyAhPSAnY3N2Jykge1xyXG4vLyAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbi8vICAgICAgICAgICAgICAgIHNsaWRlT25Ub3AoXCJFbCBjYW1wbyBkZXN0aW5hdGFyaW8gZXMgb2JsaWdhdG9yaW9cIiwgMzAwMCwgXCJnbHlwaGljb24gZ2x5cGhpY29uLWluZm8tc2lnblwiLCBcImRhbmdlclwiKTtcclxuLy8gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAkc2NvcGUudG90YWwgPSBicmVha3MubGVuZ3RoO1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidG90YWw6IFwiLCRzY29wZS50b3RhbCk7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ0b3RhbEF2YWlsYWJsZTogXCIsJHNjb3BlLm1pc2MudG90YWxBdmFpbGFibGUpO1xyXG4gICAgICAgICAgICAgIGlmKCgkc2NvcGUudG90YWw+JHNjb3BlLm1pc2MudG90YWxBdmFpbGFibGUpICYmIChpZFN1YmFjY291bnQgIT0gXCI0MjBcIiB8fCBpZFN1YmFjY291bnQgIT0gNDIwKSl7XHJcbiAgICAgICAgICAgICAgICAgIC8vZmxhZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuYXBpc21zZW1haWxiYWxhbmNlID0ge307XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5hcGlzbXNlbWFpbGJhbGFuY2UudG90YWwgPSAkc2NvcGUudG90YWw7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5hcGlzbXNlbWFpbGJhbGFuY2UudG90YWxBdmFpbGFibGUgPSAkc2NvcGUubWlzYy50b3RhbEF2YWlsYWJsZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbmRNYWlsTm90aWZpY2F0aW9uU21zQmFsYW5jZSgpO1xyXG4gICAgICAgICAgICAgICAgICBvcGVuTW9kYWxBZHZpY2UoKTtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAvL2lmICghJCgnI3RvZ2dsZS10d28nKS5wcm9wKCdjaGVja2VkJykpIHtcclxuICAgICAgICAgICAgICBpZiAoISRzY29wZS5kYXRlbm93KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RhcnRkYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkYXRlc2VuZFwiKS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGlmIChzdGFydGRhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0ZGF0ZSA9IHN0YXJ0ZGF0ZS5zcGxpdChcIiBcIik7XHJcbiAgICAgICAgICAgICAgICAgIHZhciB0aW1lID0gc3RhcnRkYXRlWzFdLnNwbGl0KFwiOlwiKTtcclxuICAgICAgICAgICAgICAgICAgaWYgKHRpbWVbMF0gPCBzdGFydEhvdXIgfHwgdGltZVswXSA+IGVuZEhvdXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVPblRvcChcIkxhIGhvcmEgZGUgZW52aW8gZGViZSBkZSBzZXIgZW50cmUgbGFzXCIgKyBzdGFydEhvdXIgKyBcIiA6MDAgIHkgbGFzIFwiICsgZW5kSG91ciArIFwiOjAwIFwiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24taW5mby1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgIHNsaWRlT25Ub3AoXCJEZWJlcyBzZWxlY2Npb25hciB1bmEgZmVjaGEgeSBob3JhIFwiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24taW5mby1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoJHNjb3BlLm5vdCA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmVtYWlsID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgc2xpZGVPblRvcChcIlBvciBmYXZvciBpbmdyZXNlIGVsIGVtYWlsIGRlIG5vdGlmaWNhY2nDs25cIiwgMzAwMCwgXCJnbHlwaGljb24gZ2x5cGhpY29uLWluZm8tc2lnblwiLCBcImRhbmdlclwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgaWYgKCRzY29wZS5lbWFpbCkge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZW1haWwgPSAkc2NvcGUuZW1haWwuc3BsaXQoXCIsXCIpO1xyXG4gICAgICAgICAgICAgICAgZW1haWxSZWdleCA9IC9eWy1cXHcuJStdezEsNjR9QCg/OltBLVowLTktXXsxLDYzfVxcLil7MSwxMjV9W0EtWl17Miw2M30kL2k7XHJcbiAgICAgICAgICAgICAgICB2YXIgZmxhZ2VtYWlsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IGVtYWlsLmxlbmd0aDsgYSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVtYWlsW2FdKTtcclxuICAgICAgICAgICAgICAgICAgaWYgKGVtYWlsUmVnZXgudGVzdChlbWFpbFthXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3Bhc2FcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZmxhZ2VtYWlsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmxhZ2VtYWlsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiSGF5IGFsZ8O6biBjb3JyZW8gZGUgbm90aWZpY2FjacOzbiBlcnJvbmVvIHBvciBmYXZvciB2ZXJpZmlxdWVcIiwgMzAwMCwgXCJnbHlwaGljb24gZ2x5cGhpY29uLWluZm8tc2lnblwiLCBcImRhbmdlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgIGZsYWdlbWFpbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlbWFpbC5sZW5ndGggPiA4KSB7XHJcbiAgICAgICAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgc2xpZGVPblRvcChcIlNvbG8gc2UgcHVlZGUgaW5ncmVzYXIgdW4gbcOheGltbyBkZSA4IGNvcnJlb3MgZWxlY3Ryw7NuaWNvc1wiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24taW5mby1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoISRzY29wZS5pZFNtc0NhdGVnb3J5KSB7XHJcbiAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiRGViZXMgc2VsZWNjaW9uYXIgdW5hIGNhdGVnb3JpYVwiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24taW5mby1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoISRzY29wZS5yZWNlaXZlciAmJiB0eXBlU21zICE9ICdjc3YnKSB7XHJcbiAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiRGViZXMgaW5ncmVzYXIgYWwgbWVub3MgdW4gZGVzdGluYXRhcmlvXCIsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1pbmZvLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGlmIChicmVha3MubGVuZ3RoID4gNTAgJiYgdHlwZVNtcyAhPSAnY3N2Jykge1xyXG4gICAgICAgICAgICAgICAgZmxhZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgc2xpZGVPblRvcChcIlNvbG8gc2UgcHVlZGUgaW5ncmVzYXIgNTAgZGVzdGluYXRhcmlvc1wiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24taW5mby1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB2YXIgZmxhZ1ZhbGlkYXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgaWYgKHR5cGVTbXMgIT0gJ2NzdicpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnJlYWtzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmICghYnJlYWtzW2ldLmluY2x1ZGVzKFwiO1wiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZsYWdWYWxpZGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgdmFyIHNtcyA9IGJyZWFrc1tpXS5zcGxpdChcIjtcIik7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChzbXMubGVuZ3RoIDwgMykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZsYWdWYWxpZGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGlmIChmbGFnVmFsaWRhdGUpIHtcclxuICAgICAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHNsaWRlT25Ub3AoXCJIYXkgYWxnw7puIGRlc3RpbmF0YXJpbyBjb24gZWwgZm9ybWF0byBlcnLDs25lb1wiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24taW5mby1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLndyb25nUm93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLndyb25nUm93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICB2YXIgcmUgPSAvW8Oxw5HDocOpw63Ds8O6w4HDicONw5PDmsK/wqHCtF0vO1xyXG4gICAgICAgICAgICAgIHZhciB0YWdzID0gLyUlK1thLXowLTlfXSslJS87XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnN1Y2Nlc3MgPSBicmVha3MubGVuZ3RoO1xyXG4gICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnJlYWtzLmxlbmd0aDsgaSsrKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBzbXMgPSBicmVha3NbaV0uc3BsaXQoXCI7XCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0ciA9IHNtc1swXS5pbmRleE9mKFwiK1wiKTtcclxuICAgICAgICAgICAgICAgIGlmIChzbXMubGVuZ3RoID49IDQpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmFyckVycm9yLnB1c2goYnJlYWtzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnN1Y2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghaXNGaW5pdGUoc21zWzFdKSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuYXJyRXJyb3IucHVzaChicmVha3NbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc3VjY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHNtcy5sZW5ndGggPCAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5hcnJFcnJvci5wdXNoKGJyZWFrc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zdWNjZXNzLS07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoc21zLmxlbmd0aCA9PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChzbXNbMV0udG9TdHJpbmcoKS50cmltKCkubGVuZ3RoICE9PSAxMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcnJFcnJvci5wdXNoKGJyZWFrc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN1Y2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBpZiAoc21zWzJdLnRvU3RyaW5nKCkubGVuZ3RoID4gMTYwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFyckVycm9yLnB1c2goYnJlYWtzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3VjY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIGlmICh0YWdzLnRlc3Qoc21zWzJdLnRvU3RyaW5nKCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXhpc3RUYWdzKys7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFyckVycm9yLnB1c2goYnJlYWtzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3VjY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIC8vU2UgaGFjZSBlc3RlIHByb2Nlc28gcGFyYSBsYSBjYXJnYSBkZWwgY3N2IHkgdHJhaWdhIGVsIHRhcmdldCBxdWUgZW52aWFcclxuICAgICAgICAgICAgICBpZiAoJHNjb3BlLnR5cGVDc3YgPSAnY3N2Jykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnN1Y2Nlc3MgPSAkc2NvcGUudGFyZ2V0Y3N2O1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgaWYgKGV4aXN0VGFncyA+IDApIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5leGlzdFRhZ3MgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXhpc3RUYWdzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgICAgICAgICBvcGVuTW9kYWwoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS52YWxpZGF0ZUluTGluZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSAwO1xyXG4gICAgICAgICAgICAgICRzY29wZS5zdWNjZXNzID0gMDtcclxuICAgICAgICAgICAgICAkc2NvcGUud3JvbmdSb3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICB2YXIgZXhpc3RUYWdzID0gMDtcclxuICAgICAgICAgICAgICB2YXIgYnJlYWtzID0gJHNjb3BlLnJlY2VpdmVyLnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgICB2YXIgcmUgPSAvW8Oxw5HDocOpw63Ds8O6w4HDicONw5PDmsK/wqHCtF0vO1xyXG4gICAgICAgICAgICAgIHZhciB0YWdzID0gLyUlK1thLXowLTlfXSslJS87XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnN1Y2Nlc3MgPSBicmVha3MubGVuZ3RoO1xyXG4gICAgICAgICAgICAgIHZhciBmbGFnVmFsaWRhdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJyZWFrcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFicmVha3NbaV0uaW5jbHVkZXMoXCI7XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgIGZsYWdWYWxpZGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgc21zID0gYnJlYWtzW2ldLnNwbGl0KFwiO1wiKTtcclxuICAgICAgICAgICAgICAgIGlmIChzbXMubGVuZ3RoIDwgMykge1xyXG4gICAgICAgICAgICAgICAgICBmbGFnVmFsaWRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoZmxhZ1ZhbGlkYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUud3JvbmdSb3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUud3JvbmdSb3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZhciBlbWFpbCA9ICRzY29wZS5lbWFpbC5zcGxpdChcIixcIik7XHJcbiAgICAgICAgICAgICAgICBlbWFpbFJlZ2V4ID0gL15bLVxcdy4lK117MSw2NH1AKD86W0EtWjAtOS1dezEsNjN9XFwuKXsxLDEyNX1bQS1aXXsyLDYzfSQvaTtcclxuICAgICAgICAgICAgICAgIHZhciBmbGFnZW1haWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgZW1haWwubGVuZ3RoOyBhKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVtYWlsW2FdKTtcclxuICAgICAgICAgICAgICAgICAgaWYgKGVtYWlsUmVnZXgudGVzdChlbWFpbFthXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3Bhc2FcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZmxhZ2VtYWlsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmxhZ2VtYWlsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiSGF5IGFsZ8O6biBjb3JyZW8gZGUgbm90aWZpY2FjacOzbiBlcnJvbmVvIHBvciBmYXZvciB2ZXJpZmlxdWVcIiwgMzAwMCwgXCJnbHlwaGljb24gZ2x5cGhpY29uLWluZm8tc2lnblwiLCBcImRhbmdlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgIGZsYWdlbWFpbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlbWFpbC5sZW5ndGggPiA4KSB7XHJcbiAgICAgICAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgc2xpZGVPblRvcChcIlNvbG8gc2UgcHVlZGUgaW5ncmVzYXIgdW4gbcOheGltbyBkZSA4IGNvcnJlb3MgZWxlY3Ryw7NuaWNvc1wiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24taW5mby1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoISRzY29wZS5pZFNtc0NhdGVnb3J5KSB7XHJcbiAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiRGViZXMgc2VsZWNjaW9uYXIgdW5hIGNhdGVnb3JpYVwiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24taW5mby1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoISRzY29wZS5yZWNlaXZlcikge1xyXG4gICAgICAgICAgICAgICAgZmxhZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgc2xpZGVPblRvcChcIkRlYmVzIGluZ3Jlc2FyIGFsIG1lbm9zIHVuIGRlc3RpbmF0YXJpb1wiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24taW5mby1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoYnJlYWtzLmxlbmd0aCA+IDUwKSB7XHJcbiAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiU29sbyBzZSBwdWVkZSBpbmdyZXNhciA1MCBkZXN0aW5hdGFyaW9zXCIsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1pbmZvLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHZhciBmbGFnVmFsaWRhdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJyZWFrcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFicmVha3NbaV0uaW5jbHVkZXMoXCI7XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgIGZsYWdWYWxpZGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgc21zID0gYnJlYWtzW2ldLnNwbGl0KFwiO1wiKTtcclxuICAgICAgICAgICAgICAgIGlmIChzbXMubGVuZ3RoIDwgMykge1xyXG4gICAgICAgICAgICAgICAgICBmbGFnVmFsaWRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoZmxhZ1ZhbGlkYXRlKSB7XHJcbiAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiSGF5IGFsZ8O6biBkZXN0aW5hdGFyaW8gY29uIGVsIGZvcm1hdG8gZXJyw7NuZW9cIiwgMzAwMCwgXCJnbHlwaGljb24gZ2x5cGhpY29uLWluZm8tc2lnblwiLCBcImRhbmdlclwiKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS53cm9uZ1JvdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS53cm9uZ1JvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgdmFyIHJlID0gL1vDscORw6HDqcOtw7PDusOBw4nDjcOTw5rCv8KhwrRdLztcclxuICAgICAgICAgICAgICB2YXIgdGFncyA9IC8lJStbYS16MC05X10rJSUvO1xyXG4gICAgICAgICAgICAgICRzY29wZS5zdWNjZXNzID0gYnJlYWtzLmxlbmd0aDtcclxuICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJyZWFrcy5sZW5ndGg7IGkrKykge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgc21zID0gYnJlYWtzW2ldLnNwbGl0KFwiO1wiKTtcclxuICAgICAgICAgICAgICAgIHZhciBzdHIgPSBzbXNbMF0uaW5kZXhPZihcIitcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoc21zLmxlbmd0aCA+PSA0KSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5hcnJFcnJvci5wdXNoKGJyZWFrc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcisrO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc3VjY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFpc0Zpbml0ZShzbXNbMV0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5hcnJFcnJvci5wdXNoKGJyZWFrc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcisrO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc3VjY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHNtcy5sZW5ndGggPCAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5hcnJFcnJvci5wdXNoKGJyZWFrc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcisrO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc3VjY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHNtcy5sZW5ndGggPT0gMykge1xyXG4gICAgICAgICAgICAgICAgICBpZiAoc21zWzFdLnRvU3RyaW5nKCkudHJpbSgpLmxlbmd0aCAhPT0gMTApIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXJyRXJyb3IucHVzaChicmVha3NbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcisrO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWNjZXNzLS07XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgaWYgKHNtc1syXS50b1N0cmluZygpLmxlbmd0aCA+IDE2MCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcnJFcnJvci5wdXNoKGJyZWFrc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yKys7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN1Y2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBpZiAocmUudGVzdChzbXNbMl0udG9TdHJpbmcoKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXJyRXJyb3IucHVzaChicmVha3NbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcisrO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWNjZXNzLS07XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgaWYgKHRhZ3MudGVzdChzbXNbMl0udG9TdHJpbmcoKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBleGlzdFRhZ3MrKztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXJyRXJyb3IucHVzaChicmVha3NbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcisrO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWNjZXNzLS07XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgaWYgKGV4aXN0VGFncyA+IDApIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5leGlzdFRhZ3MgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXhpc3RUYWdzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgICAgICAgICBvcGVuTW9kYWwoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS52YWxpZGF0ZUluTGluZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSAwO1xyXG4gICAgICAgICAgICAgICRzY29wZS5zdWNjZXNzID0gMDtcclxuICAgICAgICAgICAgICAkc2NvcGUud3JvbmdSb3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICB2YXIgZXhpc3RUYWdzID0gMDtcclxuICAgICAgICAgICAgICB2YXIgYnJlYWtzID0gJHNjb3BlLnJlY2VpdmVyLnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgICB2YXIgcmUgPSAvW8Oxw5HDocOpw63Ds8O6w4HDicONw5PDmsK/wqHCtF0vO1xyXG4gICAgICAgICAgICAgIHZhciB0YWdzID0gLyUlK1thLXowLTlfXSslJS87XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnN1Y2Nlc3MgPSBicmVha3MubGVuZ3RoO1xyXG4gICAgICAgICAgICAgIHZhciBmbGFnVmFsaWRhdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJyZWFrcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFicmVha3NbaV0uaW5jbHVkZXMoXCI7XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgIGZsYWdWYWxpZGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgc21zID0gYnJlYWtzW2ldLnNwbGl0KFwiO1wiKTtcclxuICAgICAgICAgICAgICAgIGlmIChzbXMubGVuZ3RoIDwgMykge1xyXG4gICAgICAgICAgICAgICAgICBmbGFnVmFsaWRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoZmxhZ1ZhbGlkYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUud3JvbmdSb3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUud3JvbmdSb3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBicmVha3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBzbXMgPSBicmVha3NbaV0uc3BsaXQoXCI7XCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0ciA9IHNtc1swXS5pbmRleE9mKFwiK1wiKTtcclxuICAgICAgICAgICAgICAgIGlmIChzbXMubGVuZ3RoID09IDMpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKHRhZ3MudGVzdChzbXNbMl0udG9TdHJpbmcoKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBleGlzdFRhZ3MrKztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IrKztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3VjY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBpZiAoZXhpc3RUYWdzID4gMCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmV4aXN0VGFncyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5leGlzdFRhZ3MgPSBmYWxzZTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS5jcmVhdGVsb3RlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgIHZhciBkYXRhID0ge307XHJcbiAgICAgICAgICAgICAgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIG5hbWU6ICRzY29wZS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uOiAkc2NvcGUubm90LFxyXG4gICAgICAgICAgICAgICAgZW1haWw6ICRzY29wZS5lbWFpbCxcclxuICAgICAgICAgICAgICAgIHJlY2VpdmVyOiAkc2NvcGUucmVjZWl2ZXIsXHJcbiAgICAgICAgICAgICAgICBpZFNtc0NhdGVnb3J5OiAkc2NvcGUuaWRTbXNDYXRlZ29yeSxcclxuICAgICAgICAgICAgICAgIGRhdGVzZW5kOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRhdGVzZW5kXCIpLnZhbHVlLFxyXG4vLyAgICAgICAgICAgICAgICBkYXRlbm93OiAkKCcjdG9nZ2xlLXR3bycpLnByb3AoJ2NoZWNrZWQnKSxcclxuICAgICAgICAgICAgICAgIHRpbWV6b25lOiAkc2NvcGUudGltZXpvbmUsXHJcbiAgICAgICAgICAgICAgICBBcHJveGltYXRlU2VuZGluZ3M6ICRzY29wZS5zdWNjZXNzLFxyXG4gICAgICAgICAgICAgICAgYWR2YW5jZWRvcHRpb25zOiAkc2NvcGUuYWR2YW5jZWRvcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgbW9yZWNhcmFjdGVyIDogJHNjb3BlLm1vcmVjYXJhY3RlcixcclxuICAgICAgICAgICAgICAgIGRpdmlkZTogJHNjb3BlLmRpdmlkZSxcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlRXJyb3I6ICAkc2NvcGUuY29udGludWVFcnJvcixcclxuICAgICAgICAgICAgICAgIHNlbmRpbmdUaW1lOiAkc2NvcGUuc2VuZGluZ1RpbWUsXHJcbiAgICAgICAgICAgICAgICB0aW1lRm9ybWF0OiAkc2NvcGUudGltZUZvcm1hdCxcclxuICAgICAgICAgICAgICAgIHF1YW50aXR5OiAkc2NvcGUucXVhbnRpdHksXHJcbiAgICAgICAgICAgICAgICBpZFNtczogJHNjb3BlLmlkU21zLFxyXG4gICAgICAgICAgICAgICAgZGF0ZW5vdzogJHNjb3BlLmRhdGVub3csXHJcbiAgICAgICAgICAgICAgICBnbXQ6ICRzY29wZS5nbXQsXHJcbiAgICAgICAgICAgICAgICBvcmlnaW5hbERhdGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGF0ZXNlbmRcIikudmFsdWUsXHJcbiAgICAgICAgICAgICAgICBzZW5kcHVzaDogJHNjb3BlLnNlbmRwdXNoXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgIG1haW4uY3JlYXRlTG90ZShkYXRhLCBmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICBjbG9zZU1vZGFsKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm91dGUgPSAkd2luZG93Lm15QmFzZVVSTCArIFwic21zL1wiO1xyXG4gICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcm91dGU7XHJcbiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlcykgeyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHNsaWRlT25Ub3AocmVzLm1lc3NhZ2UsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1yZW1vdmUtc2lnblwiLCBcImRhbmdlclwiKTtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuZXJyb3IgPSAnZmFpbCc7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5lZGl0bG90ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIG5hbWU6ICRzY29wZS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uOiAkc2NvcGUubm90LFxyXG4gICAgICAgICAgICAgICAgZW1haWw6ICRzY29wZS5lbWFpbCxcclxuICAgICAgICAgICAgICAgIHJlY2VpdmVyOiAkc2NvcGUucmVjZWl2ZXIsXHJcbiAgICAgICAgICAgICAgICBpZFNtc0NhdGVnb3J5OiAkc2NvcGUuaWRTbXNDYXRlZ29yeSxcclxuICAgICAgICAgICAgICAgIGRhdGVzZW5kOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRhdGVzZW5kXCIpLnZhbHVlLFxyXG4vLyAgICAgICAgICAgICAgICBkYXRlbm93OiAkKCcjdG9nZ2xlLXR3bycpLnByb3AoJ2NoZWNrZWQnKSxcclxuICAgICAgICAgICAgICAgIHRpbWV6b25lOiAkc2NvcGUudGltZXpvbmUsXHJcbiAgICAgICAgICAgICAgICBBcHJveGltYXRlU2VuZGluZ3M6ICRzY29wZS5zdWNjZXNzLFxyXG4gICAgICAgICAgICAgICAgYWR2YW5jZWRvcHRpb25zOiAkc2NvcGUuYWR2YW5jZWRvcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgbW9yZWNhcmFjdGVyIDogJHNjb3BlLm1vcmVjYXJhY3RlcixcclxuICAgICAgICAgICAgICAgIGRpdmlkZTogJHNjb3BlLmRpdmlkZSxcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlRXJyb3I6ICAkc2NvcGUuY29udGludWVFcnJvcixcclxuICAgICAgICAgICAgICAgIHNlbmRpbmdUaW1lOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNlbmRpbmdUaW1lXCIpLnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgdGltZUZvcm1hdDogJHNjb3BlLnRpbWVGb3JtYXQsXHJcbiAgICAgICAgICAgICAgICBxdWFudGl0eTogJHNjb3BlLnF1YW50aXR5LFxyXG4gICAgICAgICAgICAgICAgaWRTbXM6ICRzY29wZS5pZFNtcyxcclxuICAgICAgICAgICAgICAgIGRhdGVub3c6ICRzY29wZS5kYXRlbm93LFxyXG4gICAgICAgICAgICAgICAgZ210OiAkc2NvcGUuZ210LFxyXG4gICAgICAgICAgICAgICAgb3JpZ2luYWxEYXRlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRhdGVzZW5kXCIpLnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgc2VuZHB1c2g6ICRzY29wZS5zZW5kcHVzaFxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgbWFpbi5lZGl0TG90ZShkYXRhLCBmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICBjbG9zZU1vZGFsKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm91dGUgPSAkd2luZG93Lm15QmFzZVVSTCArIFwic21zL1wiO1xyXG4gICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcm91dGU7XHJcbiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0ZW5vdyA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0ZW5vdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGVub3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgICAgIHNsaWRlT25Ub3AocmVzLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmVycm9yID0gJ2ZhaWwnO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuc2VuZG5vdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICBpZiAoJHNjb3BlLmRhdGVub3cpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRlbm93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRlbm93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS5vcGVNb2RhbE1vcmVDYSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmKCAkKCcjbW9yZWNhcmFjdGVyJykucHJvcCgnY2hlY2tlZCcpICYmICQoJyNzZW5kcHVzaCcpLnByb3AoJ2NoZWNrZWQnKSA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgJCgnI2FsZXJ0TW9yZUNhcmFjdGVyJykucmVtb3ZlQ2xhc3MoJ21vZGFsJyk7IFxyXG4gICAgICAgICAgICAgICAgICAgJCgnI2FsZXJ0TW9yZUNhcmFjdGVyJykuYWRkQ2xhc3MoJ2RpYWxvZyBkaWFsb2ctLW9wZW4nKTsgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5nZXRDYXRlZ29yeSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICBtYWluLmdldENhdGVnb3J5KCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNtc0NhdGVnb3J5ID0gZGF0YTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnZhbGlkYXRlcHJvY2VzcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICB2YXIgZmxhZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgIHZhciBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJuYW1lXCIpLnZhbHVlO1xyXG4gICAgICAgICAgICAgIHZhciBpZFNtc0NhdGVnb3J5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpZFNtc0NhdGVnb3J5XCIpLnZhbHVlO1xyXG4gICAgICAgICAgICAgIHZhciB0aW1lem9uZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGltZXpvbmVcIikudmFsdWU7XHJcbiAgICAgICAgICAgICAgdmFyIGRhdGVzZW5kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkYXRlc2VuZFwiKS52YWx1ZTtcclxuICAgICAgICAgICAgICB2YXIgZW1haWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVtYWlsXCIpLnZhbHVlO1xyXG4gICAgICAgICAgICAgIHZhciBxdWFudGl0eSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicXVhbnRpdHlcIikudmFsdWU7XHJcbiAgICAgICAgICAgICAgdmFyIHNlbmRpbmdUaW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzZW5kaW5nVGltZVwiKS52YWx1ZTtcclxuICAgICAgICAgICAgICB2YXIgdGltZUZvcm1hdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGltZUZvcm1hdFwiKS52YWx1ZTtcclxuICAgICAgICAgICAgICBpZiAobmFtZSA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiRWwgbm9tYnJlIGRlIGVudsOtbyBlc3RhIGluY29tcGxldG8sIHBvciBmYXZvciBpbmdyZXNlIHVuIG5vbWJyZVwiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24taW5mby1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgZmxhZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChpZFNtc0NhdGVnb3J5ID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHNsaWRlT25Ub3AoXCJQb3IgZmF2b3IgaW5ncmVzZSB1bmEgY2F0ZWdvcmlhXCIsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1pbmZvLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRzY29wZS5kYXRlbm93ID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGltZXpvbmUgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiUG9yIGZhdm9yIGluZ3Jlc2Ugem9uYSBob3JhcmlhXCIsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1pbmZvLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgIGZsYWcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRlc2VuZCA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgIHNsaWRlT25Ub3AoXCJQb3IgZmF2b3IgaW5ncmVzZSBmZWNoYSB5IGhvcmEgZGUgZW52aW9cIiwgMzAwMCwgXCJnbHlwaGljb24gZ2x5cGhpY29uLWluZm8tc2lnblwiLCBcImRhbmdlclwiKTtcclxuICAgICAgICAgICAgICAgICAgZmxhZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSBlbHNlIGlmICgkc2NvcGUuYWR2YW5jZWRvcHRpb25zID09IHRydWUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm5vdCA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChlbWFpbCA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVPblRvcChcIlBvciBmYXZvciBpbmdyZXNlIGVsIGVtYWlsIGRlIG5vdGlmaWNhY2nDs25cIiwgMzAwMCwgXCJnbHlwaGljb24gZ2x5cGhpY29uLWluZm8tc2lnblwiLCBcImRhbmdlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZW1haWxBcnJheSA9ICRzY29wZS5lbWFpbC5zcGxpdCgvW1xcc1xcbiwgO10rLyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGVtYWlsUmVnZXggPSAvXlstXFx3LiUrXXsxLDY0fUAoPzpbQS1aMC05LV17MSw2M31cXC4pezEsMTI1fVtBLVpdezIsNjN9JC9pO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgZW1haWxBcnJheS5sZW5ndGg7IGErKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbWFpbFJlZ2V4LnRlc3QoZW1haWxBcnJheVthXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVPblRvcChcIkVsIGNvcmVvICggXCIgKyBlbWFpbEFycmF5W2FdICsgXCIgKSBpbmdyZXNhZG8gbm8gZXMgdmFsaWRvXCIsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1pbmZvLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsYWcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZW1haWxBcnJheS5sZW5ndGggPiA4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiU29sbyBzZSBwdWVkZSBpbmdyZXNhciB1biBtw6F4aW1vIGRlIDggY29ycmVvcyBlbGVjdHLDs25pY29zXCIsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1pbmZvLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gLyplbHNlIGlmICgkc2NvcGUuZGl2aWRlID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKHF1YW50aXR5ID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiUG9yIGZhdm9yIGluZ3Jlc2UgbGEgY2FudGlkYWQgZGUgZW52aW8gcG9yIGludGVydmFsb3NcIiwgMzAwMCwgXCJnbHlwaGljb24gZ2x5cGhpY29uLWluZm8tc2lnblwiLCBcImRhbmdlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZW5kaW5nVGltZSA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVPblRvcChcIlBvciBmYXZvciBpbmdyZXNlIHRpZW1wbyBkZSBlbnZpb1wiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24taW5mby1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZsYWcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRpbWVGb3JtYXQgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNsaWRlT25Ub3AoXCJQb3IgZmF2b3IgaW5ncmVzZSBlbCBmb3JtYXRvIGRlIGVudmlvXCIsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1pbmZvLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgZmxhZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoZmxhZyA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGZvcm0gPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zvcm0nKS5lbGVtZW50cyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICAgICAgICAgIHZhciBjb25maWcgPSB7fTtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0ge307XHJcbiAgICAgICAgICAgICAgICBjb25maWcudHJhbnNmb3JtUmVxdWVzdCA9IGFuZ3VsYXIuaWRlbnRpdHk7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZvcm0ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKGZvcm1baV0uZ2V0QXR0cmlidXRlKFwibmFtZVwiKSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm1baV0uZ2V0QXR0cmlidXRlKFwibmFtZVwiKSA9PSBcImNzdlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoZm9ybVtpXS5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpLCBmb3JtW2ldLmZpbGVzWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgIC8vZm9ybURhdGEuYXBwZW5kKFwiaWRTbXNDcmVhdGVkXCIsICRzY29wZS5taXNjLmlkU21zKTsgXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGZvcm1baV0uZ2V0QXR0cmlidXRlKFwibmFtZVwiKSwgZm9ybVtpXS50eXBlLCBmb3JtW2ldLmNoZWNrZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm1baV0udHlwZSA9PSBcImNoZWNrYm94XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm1baV0uY2hlY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChmb3JtW2ldLmdldEF0dHJpYnV0ZShcIm5hbWVcIiksIGZvcm1baV0udmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoZm9ybVtpXS5nZXRBdHRyaWJ1dGUoXCJuYW1lXCIpLCBmb3JtW2ldLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICQoJyNQcm9jZXNzQ3N2JykuYWRkQ2xhc3MoJ2RpYWxvZy0tb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1pc2MuUHJvY2Nlc3NDc3YucG9yYyA9IDIwO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdChmdWxsVXJsQmFzZSArICdhcGkvc21zL2NyZWF0ZWNzdicsIGZvcm1EYXRhLCBjb25maWcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7fSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vJCgnI1Byb2Nlc3NDc3YnKS5yZW1vdmVDbGFzcygnZGlhbG9nLS1vcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNhdmVjc3ZcIikuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnZlcmlmeXNlcnZpY2V0d293YXkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgbWFpbi5nZXRTZXJ2aWNlVmVyaWZpZWQoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc21zdmVyaWZpZWQgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zbXN2ZXJpZmllZCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93QnV0dG9uVHdvd2F5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93QnV0dG9uVHdvd2F5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS5mb3J3YXJkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICRzY29wZS5pbml0aWFsICs9IDE7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgKz0gMTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS5mYXN0Zm9yd2FyZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbCA9ICgkc2NvcGUuc21zLnRvdGFsX3BhZ2VzIC0gMSk7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgPSAkc2NvcGUuc21zLnRvdGFsX3BhZ2VzO1xyXG4gICAgICAgICAgICAgICRzY29wZS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgJHNjb3BlLmJhY2t3YXJkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICRzY29wZS5pbml0aWFsIC09IDE7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgLT0gMTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS5mYXN0YmFja3dhcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmluaXRpYWwgPSAwO1xyXG4gICAgICAgICAgICAgICRzY29wZS5wYWdlID0gMTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS5zZWFyY2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLm1pc2MucHJvZ3Jlc3NiYXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbCA9IDA7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgPSAxO1xyXG4gICAgICAgICAgICAgICRzY29wZS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgJHNjb3BlLnNlYXJjaGNhdGVnb3J5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICRzY29wZS5taXNjLnByb2dyZXNzYmFyID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgaWYgKCRzY29wZS5maWx0ZXIuY2F0ZWdvcnkubGVuZ3RoID49IDEpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsID0gMDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYWdlID0gMTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnW2ZpbHRlci5kYXRlaW5pdGlhbCxmaWx0ZXIuZGF0ZWVuZF0nLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgaWYgKChhbmd1bGFyLmlzRGVmaW5lZCgkc2NvcGUuZmlsdGVyLmRhdGVpbml0aWFsKSAmJiAkc2NvcGUuZmlsdGVyLmRhdGVpbml0aWFsICE9IFwiXCIpICYmIChhbmd1bGFyLmlzRGVmaW5lZCgkc2NvcGUuZmlsdGVyLmRhdGVlbmQpICYmICRzY29wZS5maWx0ZXIuZGF0ZWVuZCAhPSBcIlwiKSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1pc2MucHJvZ3Jlc3NiYXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsID0gMDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYWdlID0gMTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAkc2NvcGUuc3RhdHVzRnVuYyA9IGZ1bmN0aW9uICgpIHtcclxuLy8gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQWZ1ZXJhJyk7XHJcbi8vICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLmZpbHRlci5tYWlsU3RhdHVzKTtcclxuICAgICAgICAgICAgICBpZiAoJHNjb3BlLmZpbHRlci5zbXNTdGF0dXMubGVuZ3RoID4gMCkge1xyXG4vLyAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBZGVudHJvJyk7XHJcbi8vICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLmZpbHRlci5tYWlsU3RhdHVzKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsID0gMDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYWdlID0gMTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS5nZXRBbGwgPSBmdW5jdGlvbiAoKSB7ICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIG1haW4uZ2V0U21zKCRzY29wZS5pbml0aWFsLCAkc2NvcGUuZmlsdGVyKS50aGVuKGZ1bmN0aW9uIChkYXRhKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc21zID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvbXBsZXRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pc2MucHJvZ3Jlc3NiYXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuZXJyb3IoZXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLnByb2dyZXNzYmFyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0pICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgJHNjb3BlLmdldE9uZSA9IGZ1bmN0aW9uIChpZFNtcykge1xyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIG1haW4uZ2V0T25lU21zKGlkU21zKS50aGVuKGZ1bmN0aW9uIChkYXRhKVxyXG4gICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zbXMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnR5cGVDc3YgPSAkc2NvcGUuc21zLnR5cGU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudGFyZ2V0Y3N2ID0gJHNjb3BlLnNtcy50YXJnZXQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaWRTbXMgPSAkc2NvcGUuc21zLmlkU21zO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5hbWUgPSAkc2NvcGUuc21zLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubm90ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNtcy5ub3RpZmljYXRpb24gPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubm90ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKCRzY29wZS5zbXMubW9yZWNhcmFjdGVyID09PSB0cnVlKXtcclxuICAgICAgICAgICAgICAgICAgICRzY29wZS5tb3JlY2FyYWN0ZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgJChcIiNtb3JlY2FyYWN0ZXJcIikucHJvcCgnY2hlY2tlZCcsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAkc2NvcGUubW9yZWNhcmFjdGVyID0gZmFsc2U7IFxyXG4gICAgICAgICAgICAgICAgICAgJChcIiNtb3JlY2FyYWN0ZXJcIikucHJvcCgnY2hlY2tlZCcsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzY29wZS5lbWFpbCA9ICRzY29wZS5zbXMuZW1haWw7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVjZWl2ZXIgPSAkc2NvcGUuc21zLnJlY2VpdmVyO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlkU21zQ2F0ZWdvcnkgPSAkc2NvcGUuc21zLmlkU21zQ2F0ZWdvcnk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUub3JpZ2luYWxEYXRlID0gJHNjb3BlLnNtcy5vcmlnaW5hbERhdGU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0ZW5vdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgJCgnI3RvZ2dsZS10d28nKS5ib290c3RyYXBUb2dnbGUoJ29mZicpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zbXMuZGF0ZU5vdyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRlbm93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgJCgnI3RvZ2dsZS10d28nKS5ib290c3RyYXBUb2dnbGUoJ29uJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNtcy5hZHZhbmNlZG9wdGlvbnMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuYWR2YW5jZWRvcHRpb25zID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgJCgnI3RvZ2dsZS10aHJlZScpLmJvb3RzdHJhcFRvZ2dsZSgnb24nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc21zLm5vdGlmaWNhdGlvbiA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5ub3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAkKCcjdG9nZ2xlLW9uZScpLmJvb3RzdHJhcFRvZ2dsZSgnb24nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc21zLmRpdmlkZSA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kaXZpZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAkKCcjdG9nZ2xlLWZvdXInKS5ib290c3RyYXBUb2dnbGUoJ29uJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUuc21zLnNlbmRwdXNoID09IDEpe1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2VuZHB1c2ggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAkKCcjdG9nZ2xlLW9uZScpLmJvb3RzdHJhcFRvZ2dsZSgnb24nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzY29wZS50aW1lem9uZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5BcHJveGltYXRlU2VuZGluZ3M7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudGltZUZvcm1hdCA9ICRzY29wZS5zbXMudGltZUZvcm1hdDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5xdWFudGl0eSA9IHBhcnNlSW50KCRzY29wZS5zbXMucXVhbnRpdHkpO1xyXG4vLyAgICAgICAgICAgICAgICAkc2NvcGUuZ210ID0gJHNjb3BlLnNtcy5nbXQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ210ID0gJHNjb3BlLnNtcy5nbXQ7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS52YWxpZGF0ZUJhbGFuY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgbWFpbi52YWxpZGF0ZUJhbGFuY2UoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWlzYy50ZW1wU3VtU21zUGVuZGluZ1RhcmdldCA9IDA7XHJcbiAgICAgICAgICAgICAgICBpZihkYXRhLnNtc0ZpbmRQZW5kaW5nLmxlbmd0aD4wKXtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZGF0YS5zbXNGaW5kUGVuZGluZywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pc2MudGVtcFN1bVNtc1BlbmRpbmdUYXJnZXQgPSAkc2NvcGUubWlzYy50ZW1wU3VtU21zUGVuZGluZ1RhcmdldCArIHBhcnNlSW50KHZhbHVlLnRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLnNtc0F2YWlsYWJsZSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihkYXRhLmJhbGFuY2VDb25zdW1lZEZpbmQubGVuZ3RoPjApe1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLmJhbGFuY2VBdmFpbGFibGUgPSBkYXRhLmJhbGFuY2VDb25zdW1lZEZpbmRbMF1bJ2Ftb3VudCddO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLmJhbGFuY2VUb3RhbEdldCA9IGRhdGEuYmFsYW5jZUNvbnN1bWVkRmluZFswXVsndG90YWxBbW91bnQnXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pc2MuYmFsYW5jZUF2YWlsYWJsZSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICRzY29wZS5taXNjLnRvdGFsQXZhaWxhYmxlID0gcGFyc2VJbnQoJHNjb3BlLm1pc2MuYmFsYW5jZUF2YWlsYWJsZSkgLSBwYXJzZUludCgkc2NvcGUubWlzYy50ZW1wU3VtU21zUGVuZGluZ1RhcmdldCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzbXNGaW5kUGVuZGluZzonLGRhdGEuc21zRmluZFBlbmRpbmcpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2JhbGFuY2VDb25zdW1lZEZpbmQ6JyxkYXRhLmJhbGFuY2VDb25zdW1lZEZpbmQpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RlbXBTdW1TbXNQZW5kaW5nVGFyZ2V0Jywkc2NvcGUubWlzYy50ZW1wU3VtU21zUGVuZGluZ1RhcmdldCk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc2NvcGUubWlzYy5iYWxhbmNlQ29uc3VtZWQnLCRzY29wZS5taXNjLmJhbGFuY2VBdmFpbGFibGUpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Njb3BlLm1pc2MudG90YWxBdmFpbGFibGUnLCRzY29wZS5taXNjLnRvdGFsQXZhaWxhYmxlKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS5zZW5kTWFpbE5vdGlmaWNhdGlvblNtc0JhbGFuY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICBtYWluLnNlbmRNYWlsTm90aWZpY2F0aW9uU21zQmFsYW5jZSgkc2NvcGUuYXBpc21zZW1haWxiYWxhbmNlKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7IFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfTsgXHJcbiAgICAgICAgICAgICRzY29wZS5zZW5kTWFpbE5vdGlmaWNhdGlvblNtc0JhbGFuY2VDc3YgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICBtYWluLnNlbmRNYWlsTm90aWZpY2F0aW9uU21zQmFsYW5jZSgkc2NvcGUuYXBpc21zZW1haWxiYWxhbmNlY3ZzKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7IFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfTsgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAobG9hZEdldEFsbCA9PSAnJyl7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyRzY29wZS52ZXJpZnlzZXJ2aWNldHdvd2F5KCk7XHJcbiAgICAgICAgICAgICRzY29wZS52YWxpZGF0ZUJhbGFuY2UoKTtcclxuICAgICAgICAgICAgJHNjb3BlLmNoYW5nZVN0YXR1c0NzdiA9IGZ1bmN0aW9uIChzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAkaHR0cC5wb3N0KGZ1bGxVcmxCYXNlICsgJ2FwaS9zbXMvY2hhbmdlc3RhdHVzLycgKyAkc2NvcGUubWlzYy5pZFNtcywge3N0YXR1czogc3RhdHVzfSkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm91dGUgPSAkd2luZG93Lm15QmFzZVVSTCArIFwic21zL1wiO1xyXG4gICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcm91dGU7XHJcbiAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge30pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL01FVE9ETyBQQVJBIFZBTElEQVIgTEEgQ0FOVElEQUQgREUgTUVOU0FKRVMgRU4gRUwgQ1NWIFkgRUwgU0FMRE8gRElTUE9OSUJMRVxyXG4gICAgICAgICAgICAkc2NvcGUuYmFsYW5jZUNTViA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUudmFsaWRhdGVCYWxhbmNlQ1NWID0gZnVuY3Rpb24odG90YWxBdmFpbGFibGUsIGNvdW50U2VudCl7XHJcbiAgICAgICAgICAgICAgICBpZih0b3RhbEF2YWlsYWJsZSA8IGNvdW50U2VudCl7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJhbGFuY2VDU1YgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgc29ja2V0Lm9uKCdsb2FkaW5nLWNzdi1zbXMnLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIk5vZGUgRGF0YVwiLCBkYXRhKTtcclxuICAgICAgICAgICAgICBpZiAoZGF0YS5pZFN1YmFjY291bnQgPT0gaWRTdWJhY2NvdW50TG9naW4pIHtcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PSBcInByZWxvYWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubWlzYy5Qcm9jY2Vzc0Nzdi5wcmVsb2FkID0ge307XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLlByb2NjZXNzQ3N2LnBvcmMgKz0gMjA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgPT0gXCJ2YWxpZGF0aW9uc1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLlByb2NjZXNzQ3N2LnBvcmMgKz0gMjA7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLlByb2NjZXNzQ3N2LnByZWxvYWQuZGF0YSA9IGRhdGEuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pc2MuUHJvY2Nlc3NDc3YudmFsaWRhdGlvbnMgPSB7fTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PSBcImxvYWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubWlzYy5Qcm9jY2Vzc0Nzdi5wb3JjICs9IDIwO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubWlzYy5Qcm9jY2Vzc0Nzdi52YWxpZGF0aW9ucy5kYXRhID0gZGF0YS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubWlzYy5Qcm9jY2Vzc0Nzdi5sb2FkID0ge307XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgPT0gXCJmaW5pc2hcIikge1xyXG4gICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndG90YWxBdmFpbGFibGU6Jywkc2NvcGUubWlzYy50b3RhbEF2YWlsYWJsZSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLlByb2NjZXNzQ3N2LnBvcmMgKz0gMjA7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLlByb2NjZXNzQ3N2LmxvYWQuZGF0YSA9IGRhdGEuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pc2MuUHJvY2Nlc3NDc3YuZmluaXNoID0ge307XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLmlkU21zID0gZGF0YS5pZDtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pc2MuUHJvY2Nlc3NDc3YuZmluaXNoLm1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS50cmlnZ2VyRW1haWxOb3RpZmljYXRpb25CYWxhbmNlKCk7XHJcbiAgICAgICAgICAgICAgICAgIGlmKGlkU3ViYWNjb3VudExvZ2luICE9IDQyMCB8fCBpZFN1YmFjY291bnRMb2dpbiAhPSBcIjQyMFwiKXtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudmFsaWRhdGVCYWxhbmNlQ1NWKCRzY29wZS5taXNjLnRvdGFsQXZhaWxhYmxlLCAkc2NvcGUubWlzYy5Qcm9jY2Vzc0Nzdi5sb2FkLmRhdGEuY291bnRTZW50KTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAkc2NvcGUuY2FuY2VsU21zQW5kRGVsZXRlTG90ZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgbWFpbi5kZWxldGV2YXJpb3Vzc21zbG90ZXMoJHNjb3BlLm1pc2MuaWRTbXMpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsgLypub3RoaW5nIHRvIGRvLi4uKi9cclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgJHNjb3BlLm1pc2MucHJvZ3Jlc3NiYXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLmRvd25sb2FkRmFpbGVkU21zID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICRzY29wZS50aXRsZVJlcG9ydCA9IFwiRGV0YWxsZSBuw7ptZXJvcyBJbnZhbGlkb3NcIjtcclxuICAgICAgICAgICAgICAkc2NvcGUubWlzYy5wcm9ncmVzc2JhciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgbWFpbi5kb3dubG9hZEZhaWxlZFNtcygkc2NvcGUubWlzYy5Qcm9jY2Vzc0NzdiwgJHNjb3BlLm1pc2MuaWRTbXMpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGZ1bGxVcmxCYXNlICsgJ3N0YXRpc3RpYy9kb3dubG9hZGV4Y2VsLycgKyAkc2NvcGUudGl0bGVSZXBvcnQ7XHJcbiAgICAgICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gdXJsO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1pc2MucHJvZ3Jlc3NiYXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgc29ja2V0Lm9uKCdyZWZyZXNoLXZpZXctc21zJywgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICBmb3IgKGkgaW4gJHNjb3BlLnNtcy5pdGVtcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zbXMuaXRlbXNbaV0uaWRTbXMgPT0gZGF0YS5pZFNtcykge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc21zLml0ZW1zLnRhcmdldCA9IDEwMDA7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zbXMuaXRlbXNbaV0uc3RhdHVzID0gZGF0YS5zdGF0dXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc29ja2V0Lm9uKCdyZWZyZXNoLXZpZXctc21zLXNlbmQnLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgIGZvciAoaSBpbiAkc2NvcGUuc21zLml0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNtcy5pdGVtc1tpXS5pZFNtcyA9PSBkYXRhLmlkU21zKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zbXMuaXRlbXNbaV0uc2VudCA9IGRhdGEuc2VudDtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNtcy5pdGVtc1tpXS50b3RhbCA9IGRhdGEudG90YWw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLyokc2NvcGUuZ2V0QmFsYW5jZVN1YkFjY291bnQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgbWFpbi5nZXRCYWxhbmNlU3ViQWNjb3VudCgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRGF0YSBnZXRCYWxhbmNlU3ViQWNjb3VudDonLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRzY29wZS5nZXRCYWxhbmNlU3ViQWNjb3VudCgpOyovXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgJHNjb3BlLnRyaWdnZXJFbWFpbE5vdGlmaWNhdGlvbkJhbGFuY2UgPSBmdW5jdGlvbiAoKXtcclxuICAgICAgICAgICAgICAgIGlmKCRzY29wZS5taXNjLnRvdGFsQXZhaWxhYmxlPCRzY29wZS5taXNjLlByb2NjZXNzQ3N2LmxvYWQuZGF0YS5jb3VudFNlbnQpe1xyXG4gICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwaXNtc2VtYWlsYmFsYW5jZWN2cyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgJHNjb3BlLmFwaXNtc2VtYWlsYmFsYW5jZWN2cy50b3RhbCA9ICRzY29wZS5taXNjLlByb2NjZXNzQ3N2LmxvYWQuZGF0YS5jb3VudFNlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBpc21zZW1haWxiYWxhbmNlY3ZzLnRvdGFsQXZhaWxhYmxlID0gJHNjb3BlLm1pc2MudG90YWxBdmFpbGFibGU7XHJcbiAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2VuZE1haWxOb3RpZmljYXRpb25TbXNCYWxhbmNlQ3N2KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICB9XSlcclxuICAgICAgICAuY29udHJvbGxlcignc21zQ29udGFjdCcsIFsnJHJvb3RTY29wZScsICckc2NvcGUnLCAnJGh0dHAnLCAnbWFpbicsICckd2luZG93JywgJyR0aW1lb3V0JywgJ25vdGlmaWNhdGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHNjb3BlLCAkaHR0cCwgbWFpbiwgJHdpbmRvdywgJHRpbWVvdXQsIG5vdGlmaWNhdGlvblNlcnZpY2UpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmxpc3RBZGRyZXNzZWUgPSBbe2lkOiAxLCBuYW1lOiBcIkxpc3RhcyBkZSBjb250YWN0b3NcIn0sIHtpZDogMiwgbmFtZTogXCJTZWdtZW50b3NcIn1dO1xyXG4gICAgICAgICAgICAkc2NvcGUuYXJyQWRkcmVzc2VlID0gW107XHJcbiAgICAgICAgICAgICRzY29wZS5saXN0U2VsZWN0ZWQgPSB7fTtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGEgPSB7fTtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGVub3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLnZpZXdUZW1wbGF0ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUubm90aWZpY2F0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5ub3RpZmljYXRpb25FbWFpbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUuYWxsTGlzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUuZ210ID0gXCItMDUwMFwiO1xyXG4gICAgICAgICAgICAkc2NvcGUuY291bnRDb250YWN0c0FwcHJveGltYXRlID0ge307XHJcbiAgICAgICAgICAgICRzY29wZS5jb3VudENvbnRhY3RzQXBwcm94aW1hdGUuY291bnRzID0gMDtcclxuICAgICAgICAgICAgJHNjb3BlLmFkdmFuY2Vkb3B0aW9ucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGl2aWRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5jb250aW51ZUVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5pbml0UHJvY2Vzc1ZhbGlkYXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5lZGl0YW5kY3JlYXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2xpbmVhciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUuc3dpdGNocmVwZWF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAkc2NvcGUubW9yZWNhcmFjdGVyID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5zZW5kcHVzaCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUubWlzYyA9IHt9O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgJHNjb3BlLnZhbGlkYXRlQmFsYW5jZVNtc0NvbnRhY3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgbWFpbi52YWxpZGF0ZUJhbGFuY2UoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWlzYy50ZW1wU3VtU21zUGVuZGluZ1RhcmdldCA9IDA7XHJcbiAgICAgICAgICAgICAgICBpZihkYXRhLnNtc0ZpbmRQZW5kaW5nLmxlbmd0aD4wKXtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZGF0YS5zbXNGaW5kUGVuZGluZywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pc2MudGVtcFN1bVNtc1BlbmRpbmdUYXJnZXQgPSAkc2NvcGUubWlzYy50ZW1wU3VtU21zUGVuZGluZ1RhcmdldCArIHBhcnNlSW50KHZhbHVlLnRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLnNtc0F2YWlsYWJsZSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihkYXRhLmJhbGFuY2VDb25zdW1lZEZpbmQubGVuZ3RoPjApe1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLmJhbGFuY2VBdmFpbGFibGUgPSBkYXRhLmJhbGFuY2VDb25zdW1lZEZpbmRbMF1bJ2Ftb3VudCddO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5taXNjLmJhbGFuY2VUb3RhbEdldCA9IGRhdGEuYmFsYW5jZUNvbnN1bWVkRmluZFswXVsndG90YWxBbW91bnQnXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pc2MuYmFsYW5jZUF2YWlsYWJsZSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICRzY29wZS5taXNjLnRvdGFsQXZhaWxhYmxlID0gcGFyc2VJbnQoJHNjb3BlLm1pc2MuYmFsYW5jZUF2YWlsYWJsZSkgLSBwYXJzZUludCgkc2NvcGUubWlzYy50ZW1wU3VtU21zUGVuZGluZ1RhcmdldCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzbXNGaW5kUGVuZGluZzonLGRhdGEuc21zRmluZFBlbmRpbmcpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2JhbGFuY2VDb25zdW1lZEZpbmQ6JyxkYXRhLmJhbGFuY2VDb25zdW1lZEZpbmQpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RlbXBTdW1TbXNQZW5kaW5nVGFyZ2V0Jywkc2NvcGUubWlzYy50ZW1wU3VtU21zUGVuZGluZ1RhcmdldCk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc2NvcGUubWlzYy5iYWxhbmNlQ29uc3VtZWQnLCRzY29wZS5taXNjLmJhbGFuY2VBdmFpbGFibGUpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Njb3BlLm1pc2MudG90YWxBdmFpbGFibGUnLCRzY29wZS5taXNjLnRvdGFsQXZhaWxhYmxlKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS52YWxpZGF0ZUNoZWNrcyA9IGZ1bmN0aW9uIChwYXJhbSl7XHJcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUubW9yZWNhcmFjdGVyID09IHRydWUgJiYgJHNjb3BlLnNlbmRwdXNoID09IHRydWUpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiTG8gc2VudGltb3Mgbm8gc2UgcHVlZGUgcmVhbGl6YXIgZW52w61vcyBkZSBtZW5zYWplcyBmbGFzaCBjb24gbGEgbW9kYWxpZGFkIGRlIG3DoXMgZGUgMTYwIGNhcmFjdGVyZXMuXCIsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1pbmZvLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYocGFyYW0gPT0gMSAmJiAkc2NvcGUuc2VuZHB1c2ggPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1vcmVjYXJhY3RlciA9IGZhbHNlOyAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKHBhcmFtID09IDIgJiYgJHNjb3BlLm1vcmVjYXJhY3RlciA9PSB0cnVlKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2VuZHB1c2ggPSBmYWxzZTsgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS52YWxpZGF0ZUlkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgIGlmICghYW5ndWxhci5pc1VuZGVmaW5lZChpZFNtcykpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5uYW1lID0gbmFtZVNtcztcclxuICAgICAgICAgICAgICAgICRzY29wZS5zaG93QWRkcmVzc2VlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGlmIChyZWNlaXZlclNtcy50eXBlID09IFwiY29udGFjdGxpc3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5saXN0U2VsZWN0ZWQgPSAkc2NvcGUubGlzdEFkZHJlc3NlZVswXTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmdldERldGluYXRhcnkoJHNjb3BlLmRhdGEubGlzdFNlbGVjdGVkKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEuYXJyQWRkcmVzc2VlID0gcmVjZWl2ZXJTbXMuY29udGFjdGxpc3RzO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEubGlzdFNlbGVjdGVkID0gJHNjb3BlLmxpc3RBZGRyZXNzZWVbMV07XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5nZXREZXRpbmF0YXJ5KCRzY29wZS5kYXRhLmxpc3RTZWxlY3RlZCk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLmFyckFkZHJlc3NlZSA9IHJlY2VpdmVyU21zLnNlZ21lbnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5tZXNzYWdlID0gbWVzc2FnZVNtcztcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb3VudENvbnRhY3RzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW1haWxTbXMgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubm90ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5ub3RpZmljYXRpb25FbWFpbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5lbWFpbCA9IGVtYWlsU21zO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtYWluLmdldGxpc3R0aW1lem9uZShmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnRpbWV6b25lcyA9IHJlcztcclxuICAgICAgICAgICAgICAkc2NvcGUudGltZXpvbmUgPSBcIi0wNTAwXCI7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiSGEgb2N1cnJpZG8gdW4gZXJyb3IgaW50ZW50ZWxvIGRlIG51ZXZvIG1hcyB0YXJkZVwiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnRpbWVGb3JtYXRzID0gW1xyXG4gICAgICAgICAgICAgIHt2YWx1ZTogJ21pbnV0ZScsIG5hbWU6IFwiTWludXRvKHMpXCJ9LFxyXG4gICAgICAgICAgICAgIHt2YWx1ZTogJ2hvdXInLCBuYW1lOiBcIkhvcmEocylcIn0sXHJcbiAgICAgICAgICAgICAge3ZhbHVlOiAnZGF5JywgbmFtZTogXCJEw61hKHMpXCJ9LFxyXG4gICAgICAgICAgICAgIHt2YWx1ZTogJ3dlZWsnLCBuYW1lOiBcIlNlbWFuYShzKVwifSxcclxuICAgICAgICAgICAgICB7dmFsdWU6ICdtb250aCcsIG5hbWU6IFwiTWVzKGVzKVwifVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICAvL2ZpbiBkZSBvcGNpb25lcyBhdmFuemFkYXNcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hZGREaXNhYmxlZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgICAgICAgICQoXCIjXCIgKyBpZCkuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkc2NvcGUucmVtb3ZlRGlzYWJsZWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAgICAgICAkKFwiI1wiICsgaWQpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5vcGVNb2RhbE1vcmVDYSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmKCAkKCcjbW9yZWNhcmFjdGVyJykucHJvcCgnY2hlY2tlZCcpICYmICQoJyNzZW5kcHVzaCcpLnByb3AoJ2NoZWNrZWQnKSA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgJCgnI2FsZXJ0TW9yZUNhcmFjdGVyJykucmVtb3ZlQ2xhc3MoJ21vZGFsJyk7IFxyXG4gICAgICAgICAgICAgICAgICAgJCgnI2FsZXJ0TW9yZUNhcmFjdGVyJykuYWRkQ2xhc3MoJ2RpYWxvZyBkaWFsb2ctLW9wZW4nKTsgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS50aW1lRm9ybWF0cyA9IFtcclxuICAgICAgICAgICAgICB7dmFsdWU6ICdtaW51dGUnLCBuYW1lOiBcIk1pbnV0byhzKVwifSxcclxuICAgICAgICAgICAgICB7dmFsdWU6ICdob3VyJywgbmFtZTogXCJIb3JhKHMpXCJ9LFxyXG4gICAgICAgICAgICAgIHt2YWx1ZTogJ2RheScsIG5hbWU6IFwiRMOtYShzKVwifSxcclxuICAgICAgICAgICAgICB7dmFsdWU6ICd3ZWVrJywgbmFtZTogXCJTZW1hbmEocylcIn0sXHJcbiAgICAgICAgICAgICAge3ZhbHVlOiAnbW9udGgnLCBuYW1lOiBcIk1lcyhlcylcIn1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgLy9maW4gZGUgb3BjaW9uZXMgYXZhbnphZGFzXHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuYWRkRGlzYWJsZWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAgICAgICAkKFwiI1wiICsgaWQpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJHNjb3BlLnJlbW92ZURpc2FibGVkID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgICAgICAgJChcIiNcIiArIGlkKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL01FVE9ETyBQQVJBIFZBTElEQVIgTEEgQ0FOVElEQUQgREUgTUVOU0FKRVMgRU4gRUwgQ1NWIFkgRUwgU0FMRE8gRElTUE9OSUJMRVxyXG4gICAgICAgICAgICAkc2NvcGUuYmFsYW5jZUNTViA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUudmFsaWRhdGVCYWxhbmNlQ1NWID0gZnVuY3Rpb24odG90YWxBdmFpbGFibGUsIGNvdW50U2VudCl7XHJcbiAgICAgICAgICAgICAgICBpZih0b3RhbEF2YWlsYWJsZSA8IGNvdW50U2VudCl7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJhbGFuY2VDU1YgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiYmFsYW5jZUNTVjogXCIsJHNjb3BlLmJhbGFuY2VDU1YpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IDA7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnN1Y2Nlc3MgPSAwO1xyXG4gICAgICAgICAgICAgIHZhciBmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAkc2NvcGUuYXJyRXJyb3IgPSBbe31dO1xyXG4gICAgICAgICAgICAgIHRyeSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuZGF0ZW5vdykge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgc3RhcnRkYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkYXRlc2VuZFwiKS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0ZGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGFydGRhdGUgPSBzdGFydGRhdGUuc3BsaXQoXCIgXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0aW1lID0gc3RhcnRkYXRlWzFdLnNwbGl0KFwiOlwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGltZVswXSA8IHN0YXJ0SG91ciB8fCB0aW1lWzBdID4gZW5kSG91cikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgdGhyb3coXCJMYSBob3JhIGRlIGVudmlvIGRlYmUgZGUgc2VyIGVudHJlIGxhc1wiICsgc3RhcnRIb3VyICsgXCIgOjAwICB5IGxhcyBcIiArIGVuZEhvdXIgKyBcIjowMCBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93KFwiRGViZXMgc2VsZWNjaW9uYXIgdW5hIGZlY2hhIHkgaG9yYSBcIik7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUubm90ID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5lbWFpbCA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3coXCJQb3IgZmF2b3IgaW5ncmVzZSBlbCBlbWFpbCBkZSBub3RpZmljYWNpw7NuXCIpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmVtYWlsKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBlbWFpbCA9ICRzY29wZS5lbWFpbC5zcGxpdChcIixcIik7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChlbWFpbC5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93KFwiTm8gc2UgZW5jb250cm8gbmluZ3VuIGNvcnJlbyBlbGVjdHJvbmljby5cIik7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgaWYgKGVtYWlsLmxlbmd0aCA+IDgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyhcIlNvbG8gc2UgcHVlZGUgaW5ncmVzYXIgdW4gbcOheGltbyBkZSA4IGNvcnJlb3MgZWxlY3Ryw7NuaWNvc1wiKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVtYWlsLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlID0gL14oKFtePD4oKVxcW1xcXVxcXFwuLDs6XFxzQFwiXSsoXFwuW148PigpXFxbXFxdXFxcXC4sOzpcXHNAXCJdKykqKXwoXCIuK1wiKSlAKChcXFtbMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XSl8KChbYS16QS1aXFwtMC05XStcXC4pK1thLXpBLVpdezIsfSkpJC87XHJcbiAgICAgICAgICAgICAgICAgICAgZW1haWxbaV0gPSBlbWFpbFtpXS50cmltKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbWFpbFtpXS5tYXRjaChyZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHRocm93KFwiRWwgY29ycmVvIFwiICsgZW1haWxbaV0gKyBcIiBubyBlcyB2YWxpZG8uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAkKCcjbWVzc2FnZScpLnZhbCgpOyBcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLm1lc3NhZ2UgPSBtZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5pZFNtc0NhdGVnb3J5KSB7XHJcbiAgICAgICAgICAgICAgICAgIHRocm93KFwiRGViZXMgc2VsZWNjaW9uYXIgdW5hIGNhdGVnb3JpYVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKCRzY29wZS5kYXRhLmxpc3RTZWxlY3RlZCkpIHtcclxuICAgICAgICAgICAgICAgICAgdGhyb3coXCJEZWJlIHNlbGVjY2lvbmFyIHVuYSBsaXN0YSBkZSBkZXN0aW5hdGFyaW9zXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQoJHNjb3BlLmRhdGEuYXJyQWRkcmVzc2VlKSB8fCAkc2NvcGUuZGF0YS5hcnJBZGRyZXNzZWUgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICB0aHJvdyAoXCJEZWJlIHNlbGVjY2lvbmFyIGFsIG1lbm9zIHVuIHNlZ21lbnRvIG8gbGlzdGEgZGUgY29udGFjdG8uXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKCRzY29wZS5kYXRhLm1lc3NhZ2UpIHx8ICRzY29wZS5kYXRhLm1lc3NhZ2UubGVuZ3RoIDwgMikge1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuZGF0YSk7ICBcclxuICAgICAgICAgICAgICAgICAgdGhyb3cgKFwiRWwgbWVuc2FqZSBlcyBvYmxpZ2F0b3JpbyB5IGRlYmUgc2VyIG1heW9yIGEgZG9zIGNhcmFjdGVyZXMuXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4vLyAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm5ld01lc3NhZ2UubGVuZ3RoID4gMTYwKSB7XHJcbi8vICAgICAgICAgICAgICAgICAgdGhyb3cgKFwiRWwgbWVuc2FqZSBubyBwdWVkZSBzZXIgbWF5b3IgYSAxNjAgY2FyYWN0ZXJlcy5cIik7XHJcbi8vICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidG90YWxBdmFpbGFibGU6IFwiLCRzY29wZS5taXNjLnRvdGFsQXZhaWxhYmxlKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY291bnRDb250YWN0c0FwcHJveGltYXRlOiBcIiwkc2NvcGUuY291bnRDb250YWN0c0FwcHJveGltYXRlLmNvdW50cyk7XHJcbiAgICAgICAgICAgICAgICBpZihpZFN1YmFjY291bnQgIT0gNDIwIHx8IGlkU3ViYWNjb3VudCAhPSBcIjQyMFwiKXtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudmFsaWRhdGVCYWxhbmNlQ1NWKCRzY29wZS5taXNjLnRvdGFsQXZhaWxhYmxlLCAkc2NvcGUuY291bnRDb250YWN0c0FwcHJveGltYXRlLmNvdW50cyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBvcGVuTW9kYWwoKTtcclxuXHJcbiAgICAgICAgICAgICAgfSBjYXRjaCAoJGVycikge1xyXG4gICAgICAgICAgICAgICAgc2xpZGVPblRvcCgkZXJyLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24taW5mby1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS52YWxpZGF0ZWNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICBtYWluLnZhbGlkYXRlc21zY29udGFjdCgkc2NvcGUuSWRTbXMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZU1vZGFsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3V0ZSA9ICR3aW5kb3cubXlCYXNlVVJMICsgXCJzbXMvXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJvdXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKGRhdGEubWVzc2FnZSwgMzAwMCwgXCJnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZS1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmVycm9yID0gJ2ZhaWwnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuY2FuY2VsZWRhbmRlZGl0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgIGlkU21zID0gJHNjb3BlLklkU21zXHJcbiAgICAgICAgICAgICAgY2xvc2VNb2RhbCgpO1xyXG4gICAgICAgICAgICAgICRzY29wZS5pbml0UHJvY2Vzc1ZhbGlkYXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmVkaXRhbmRjcmVhdGUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmRvd25sb2FkRmFpbGVkU21zID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICRzY29wZS50aXRsZVJlcG9ydCA9IFwiRGV0YWxsZSBuw7ptZXJvcyBJbnZhbGlkb3NcIjtcclxuICAgICAgICAgICAgICAkc2NvcGUuZGF0YTtcclxuICAgICAgICAgICAgICBtYWluLmRvd25sb2FkRmFpbGVkU21zQ29udGFjdCgkc2NvcGUuZGF0YSwgJHNjb3BlLklkU21zKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBmdWxsVXJsQmFzZSArICdzdGF0aXN0aWMvZG93bmxvYWRleGNlbC8nICsgJHNjb3BlLnRpdGxlUmVwb3J0O1xyXG4gICAgICAgICAgICAgICAgbG9jYXRpb24uaHJlZiA9IHVybDtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zZW5kbm93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgIGlmICgkc2NvcGUuZGF0ZW5vdykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRhdGVub3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRhdGVub3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmNyZWF0ZWNvbnRhY3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NsaW5lYXIgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICBpZiAoJHNjb3BlLmVkaXRhbmRjcmVhdGUgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVkaXRDb250YWN0KCk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5kYXRhLmxpc3RTZWxlY3RlZC5pZCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgIHRhcmdldCA9IHt0eXBlOiAnY29udGFjdGxpc3QnLCBjb250YWN0bGlzdHM6ICRzY29wZS5kYXRhLmFyckFkZHJlc3NlZX07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICB0YXJnZXQgPSB7dHlwZTogJ3NlZ21lbnQnLCBzZWdtZW50OiAkc2NvcGUuZGF0YS5hcnJBZGRyZXNzZWV9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGRhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgIG5hbWU6ICRzY29wZS5uYW1lLFxyXG4vLyAgICAgICAgICAgICAgICBub3RpZmljYXRpb246ICQoJyN0b2dnbGUtb25lJykucHJvcCgnY2hlY2tlZCcpLFxyXG4gICAgICAgICAgICAgICAgICBub3RpZmljYXRpb246ICRzY29wZS5ub3QsXHJcbiAgICAgICAgICAgICAgICAgIGVtYWlsOiAkc2NvcGUuZW1haWwsXHJcbiAgICAgICAgICAgICAgICAgIHRhcmdldDogJHNjb3BlLmNvdW50Q29udGFjdHNBcHByb3hpbWF0ZS5jb3VudHMsXHJcbiAgICAgICAgICAgICAgICAgIHJlY2VpdmVyOiB0YXJnZXQsXHJcbiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICRzY29wZS5kYXRhLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICAgIGlkU21zQ2F0ZWdvcnk6ICRzY29wZS5pZFNtc0NhdGVnb3J5LFxyXG4gICAgICAgICAgICAgICAgICBkYXRlc2VuZDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkYXRlc2VuZFwiKS52YWx1ZSxcclxuLy8gICAgICAgICAgICAgICAgZGF0ZW5vdzogJCgnI3RvZ2dsZS10d28nKS5wcm9wKCdjaGVja2VkJyksXHJcbiAgICAgICAgICAgICAgICAgIHRpbWV6b25lOiAkc2NvcGUudGltZXpvbmUsXHJcbiAgICAgICAgICAgICAgICAgIEFwcm94aW1hdGVTZW5kaW5nczogJHNjb3BlLnN1Y2Nlc3MsXHJcbiAgICAgICAgICAgICAgICAgIGFkdmFuY2Vkb3B0aW9uczogJHNjb3BlLmFkdmFuY2Vkb3B0aW9ucyxcclxuICAgICAgICAgICAgICAgICAgZGl2aWRlOiAkc2NvcGUuZGl2aWRlLFxyXG4gICAgICAgICAgICAgICAgICBjb250aW51ZUVycm9yOiAkc2NvcGUuY29udGludWVFcnJvcixcclxuICAgICAgICAgICAgICAgICAgc2VuZGluZ1RpbWU6ICRzY29wZS5zZW5kaW5nVGltZSxcclxuICAgICAgICAgICAgICAgICAgdGltZUZvcm1hdDogJHNjb3BlLnRpbWVGb3JtYXQsXHJcbiAgICAgICAgICAgICAgICAgIHF1YW50aXR5OiAkc2NvcGUucXVhbnRpdHksXHJcbiAgICAgICAgICAgICAgICAgIGlkU21zOiAkc2NvcGUuaWRTbXMsXHJcbiAgICAgICAgICAgICAgICAgIGRhdGVub3c6ICRzY29wZS5kYXRlbm93LFxyXG4gICAgICAgICAgICAgICAgICBnbXQ6ICRzY29wZS5nbXQsXHJcbiAgICAgICAgICAgICAgICAgIG1vcmVjYXJhY3RlciA6ICRzY29wZS5tb3JlY2FyYWN0ZXIsXHJcbiAgICAgICAgICAgICAgICAgIG9yaWdpbmFsRGF0ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkYXRlc2VuZFwiKS52YWx1ZSxcclxuICAgICAgICAgICAgICAgICAgc3dpdGNocmVwZWF0ZWQ6ICRzY29wZS5zd2l0Y2hyZXBlYXRlZCxcclxuICAgICAgICAgICAgICAgICAgc2VuZHB1c2g6ICRzY29wZS5zZW5kcHVzaFxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnZpZXdUZW1wbGF0ZSA9PSB0cnVlICYmICRzY29wZS5pZFNtc1RlbXBsYXRlID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKFwiU2kgZGVzZWEgdXNhciB1bmEgcGxhbnRpbGxhIHByZWRlZmluaWRhIGRlIFNNUywgZGViZSBzZWxlY2Npb25hcmxhIGRlIGxhIGxpc3RhIGRlIHBsYW50aWxsYXNcIik7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBtYWluLmNyZWF0ZUNvbnRhY3QoZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudmFsaWRjb3VudCA9IGRhdGEuZGF0YS5FbnZpb3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmludmFsaWNvdW50ID0gZGF0YS5kYXRhLkludmFsaWRvcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuSWRTbXMgPSBkYXRhLmRhdGEuSWRTbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmluaXRQcm9jZXNzVmFsaWRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2xpbmVhciA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAvL2Nsb3NlUHJldmlldygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHJvdXRlID0gJHdpbmRvdy5teUJhc2VVUkwgKyBcInNtcy9cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAvLyR3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJvdXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NsaW5lYXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKGRhdGEuZGF0YS5tZXNzYWdlLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5lcnJvciA9ICdmYWlsJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuc2VuZG5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICBpZiAoJHNjb3BlLm5vdCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5vdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgLy8kKFwiI2VtYWlsLWFkZHJlc3Nlc1wiKS5oaWRlKFwic2xvd1wiKTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5vdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAvLyAkKFwiI2VtYWlsLWFkZHJlc3Nlc1wiKS5zaG93KFwic2xvd1wiKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5lZGl0Q29udGFjdCA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzbGluZWFyID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcclxuICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0ge307XHJcbiAgICAgICAgICAgICAgaWYgKCRzY29wZS5kYXRhLmxpc3RTZWxlY3RlZC5pZCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB7dHlwZTogJ2NvbnRhY3RsaXN0JywgY29udGFjdGxpc3RzOiAkc2NvcGUuZGF0YS5hcnJBZGRyZXNzZWV9O1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB7dHlwZTogJ3NlZ21lbnQnLCBzZWdtZW50OiAkc2NvcGUuZGF0YS5hcnJBZGRyZXNzZWV9O1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgaWYgKCEkc2NvcGUubm90KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZW1haWwgPSBcIlwiO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIG5hbWU6ICRzY29wZS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uOiAkKCcjdG9nZ2xlLW9uZScpLnByb3AoJ2NoZWNrZWQnKSxcclxuICAgICAgICAgICAgICAgIGVtYWlsOiAkc2NvcGUuZW1haWwsXHJcbiAgICAgICAgICAgICAgICB0YXJnZXQ6ICRzY29wZS5jb3VudENvbnRhY3RzQXBwcm94aW1hdGUuY291bnRzLFxyXG4gICAgICAgICAgICAgICAgcmVjZWl2ZXI6IHRhcmdldCxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICRzY29wZS5kYXRhLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICBpZFNtc0NhdGVnb3J5OiAkc2NvcGUuaWRTbXNDYXRlZ29yeSxcclxuICAgICAgICAgICAgICAgIGRhdGVzZW5kOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRhdGVzZW5kXCIpLnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgZGF0ZW5vdzogJHNjb3BlLmRhdGVub3csXHJcbiAgICAgICAgICAgICAgICB0aW1lem9uZTogJHNjb3BlLnRpbWV6b25lLFxyXG4gICAgICAgICAgICAgICAgaWRTbXM6IGlkU21zLFxyXG4gICAgICAgICAgICAgICAgbW9yZWNhcmFjdGVyIDogJHNjb3BlLm1vcmVjYXJhY3RlcixcclxuICAgICAgICAgICAgICAgIHNlbmRwdXNoIDogJHNjb3BlLnNlbmRwdXNoLFxyXG4gICAgICAgICAgICAgICAgc3dpdGNocmVwZWF0ZWQ6ICRzY29wZS5zd2l0Y2hyZXBlYXRlZFxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnRhZ2dlZE1lc3NhZ2UgPSAkc2NvcGUuZGF0YS5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICAgIG1haW4uZWRpdENvbnRhY3QoZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudmFsaWRjb3VudCA9IGRhdGEuRW52aW9zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaW52YWxpY291bnQgPSBkYXRhLkludmFsaWRvcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLklkU21zID0gZGF0YS5JZFNtcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmluaXRQcm9jZXNzVmFsaWRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NsaW5lYXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzbGluZWFyID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKGRhdGEsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1yZW1vdmUtc2lnblwiLCBcImRhbmdlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5lcnJvciA9ICdmYWlsJztcclxuICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLnZhbGlkYXRlSW5MaW5lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICRzY29wZS5pbnZhbGlkQ2hhcmFjdGVycyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICRzY29wZS5leGlzdFRhZ3MgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAkc2NvcGUudGFnZ2VkTWVzc2FnZSA9ICRzY29wZS5kYXRhLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLm5ld01lc3NhZ2UgPSAkc2NvcGUuZGF0YS5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgIHZhciByZSA9IC9bw7HDkcOhw6nDrcOzw7rDgcOJw43Dk8Oawr/CocK0XS87XHJcbiAgICAgICAgICAgICAgdmFyIHRhZ3MgPSAvJSUrW2EtekEtWjAtOV9dKyUlLztcclxuICAgICAgICAgICAgICB2YXIgY291bnQgPSAwO1xyXG4gICAgICAgICAgICAgIGlmICh0YWdzLnRlc3QoJHNjb3BlLmRhdGEubWVzc2FnZSkpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5leGlzdFRhZ3MgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRhZ2dlZE1lc3NhZ2UgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5ld01lc3NhZ2UgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIHdvcmRzID0gJHNjb3BlLmRhdGEubWVzc2FnZS5zcGxpdChcIiBcIik7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBjb250ID0gMDsgY29udCA8IHdvcmRzLmxlbmd0aDsgY29udCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciB3b3JkID0gd29yZHNbY29udF07XHJcbiAgICAgICAgICAgICAgICAgIHZhciB3b3JkMiA9IHdvcmRzW2NvbnRdO1xyXG4gICAgICAgICAgICAgICAgICBpZiAod29yZC5zdWJzdHIoMCwgMikgPT0gXCIlJVwiICYmICh3b3JkLnN1YnN0cigtMikgPT0gXCIlJVwiIHx8IHdvcmQuc3Vic3RyKC0zKSA9PSBcIiUlLFwiIHx8IHdvcmQuc3Vic3RyKC0zKSA9PSBcIiUlLlwiIHx8IHdvcmQuc3Vic3RyKC0zKSA9PSBcIiUlO1wiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHdvcmQgPSB3b3JkLnN1YnN0cigyKTtcclxuICAgICAgICAgICAgICAgICAgICAvL3dvcmQyID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICB3b3JkID0gXCI8Yj48aT5cIiArIHdvcmQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdvcmQuc3Vic3RyKC0yKSA9PSBcIiUlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHdvcmQgPSB3b3JkLnN1YnN0cigwLCB3b3JkLmxlbmd0aCAtIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAod29yZC5zdWJzdHIoLTMpID09IFwiJSUsXCIgfHwgd29yZC5zdWJzdHIoLTMpID09IFwiJSUuXCIgfHwgd29yZC5zdWJzdHIoLTMpID09IFwiJSU7XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHdvcmQgPSB3b3JkLnN1YnN0cigwLCB3b3JkLmxlbmd0aCAtIDMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB3b3JkID0gd29yZCArIFwiPC9pPjwvYj5cIjtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudCA9IGNvdW50ICsgd29yZC5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnRhZ2dlZE1lc3NhZ2UgKz0gd29yZCArIFwiIFwiO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubmV3TWVzc2FnZSArPSB3b3JkMjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8qJHNjb3BlLiR3YXRjaChcImRhdGEubWVzc2FnZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9ICRzY29wZS5kYXRhLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICB2YXIgdGFncyA9IC8lJStbYS16MC05X10rJSUvO1xyXG4gICAgICAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICB9LCB0cnVlKTsqL1xyXG4gICAgICAgICAgICAkc2NvcGUuY2hhbmdlTWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9ICRzY29wZS5kYXRhLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgdmFyIHRhZ3MgPSAvJSUrW2EtejAtOV9dKyUlLztcclxuICAgICAgICAgICAgICAvKmlmKHRhZ3Muc2VhcmNoKG1lc3NhZ2UpKXtcclxuICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJob2xhXCIpO1xyXG4gICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5jb3VudENvbnRhY3RzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Njb3BlLmRhdGEnLCRzY29wZS5kYXRhKTtcclxuICAgICAgICAgICAgICB2YXIgdHlwZSA9ICcnO1xyXG4gICAgICAgICAgICAgICRzY29wZS5jb3VudEVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgaWYgKCRzY29wZS5kYXRhLmxpc3RTZWxlY3RlZC5pZCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB0eXBlID0gJ2NvbnRhY3RsaXN0JztcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdHlwZSA9ICdzZWdtZW50JztcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQoJHNjb3BlLmRhdGEuYXJyQWRkcmVzc2VlKSB8fCAkc2NvcGUuZGF0YS5hcnJBZGRyZXNzZWUgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50Q29udGFjdHNBcHByb3hpbWF0ZS5jb3VudHMgPSAwXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHZhciBkYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgICAgICAgICAgIHNlZ21lbnQ6ICRzY29wZS5kYXRhLmFyckFkZHJlc3NlZSxcclxuICAgICAgICAgICAgICAgIGNvbnRhY3RsaXN0OiAkc2NvcGUuZGF0YS5hcnJBZGRyZXNzZWUsXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2hyZXBlYXRlZDogJHNjb3BlLnN3aXRjaHJlcGVhdGVkXHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICBtYWluLmNvdW50Q29udGFjdChkYXRhKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRDb250YWN0c0FwcHJveGltYXRlID0gZGF0YS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvdW50Q29udGFjdHM6Jywkc2NvcGUuY291bnRDb250YWN0c0FwcHJveGltYXRlKTtcclxuICAgICAgICAgICAgICAgIGlmKCRzY29wZS5jb3VudENvbnRhY3RzQXBwcm94aW1hdGUuY291bnRzID4gNDAwMDAgJiYgISRzY29wZS5kaXZpZGUpe1xyXG4gICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiU29icmVwYXNhIGVsIG1heGltbyBwZXJtaXRpZG8gZGUgNDAuMDAwIENvbnRhY3Rvc1wiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlLXNpZ25cIiwgXCJ3YXJuaW5nXCIpO1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudHJpZ2dlckVtYWlsTm90aWZpY2F0aW9uQmFsYW5jZVNtc0NvbnRhY3QoJHNjb3BlLmNvdW50Q29udGFjdHNBcHByb3hpbWF0ZS5jb3VudHMpO1xyXG4gICAgICAgICAgICAgIH0pLmNhdGNoKFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50RXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKC8qZGF0YS5kYXRhLm1lc3NhZ2UqL1wiU29icmVwYXNhIGVsIG1heGltbyBwZXJtaXRpZG8gZGUgNDAuMDAwIENvbnRhY3Rvc1wiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlLXNpZ25cIiwgXCJ3YXJuaW5nXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS5nZXREZXRpbmF0YXJ5ID0gZnVuY3Rpb24gKGxpc3QpIHtcclxuLy8gICAgICAgICRzY29wZS5jb3VudENvbnRhY3RzQXBwcm94aW1hdGUuY291bnRzPTE7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnNob3dBZGRyZXNzZWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5hcnJBZGRyZXNzZWUgPSBbXTtcclxuICAgICAgICAgICAgICBpZiAobGlzdC5pZCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBtYWluLmdldGNvbnRhY3RsaXN0KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0FkZHJlc3NlZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxpc3RBbGxBZGRyZXNzZWUgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKGRhdGEubWVzc2FnZSwgMzAwMCwgXCJnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZS1zaWduXCIsIFwiZGFuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbWFpbi5nZXRzZWdtZW50cygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dBZGRyZXNzZWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5saXN0QWxsQWRkcmVzc2VlID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVPblRvcChkYXRhLm1lc3NhZ2UsIDMwMDAsIFwiZ2x5cGhpY29uIGdseXBoaWNvbi1yZW1vdmUtc2lnblwiLCBcImRhbmdlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLm9wZW5QcmV2aWV3ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICQoXCIjcHJldmlld1wiKS5hZGRDbGFzcygnZGlhbG9nLS1vcGVuJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJHNjb3BlLmNsb3NlUHJldmlldyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAkKFwiI3ByZXZpZXdcIikucmVtb3ZlQ2xhc3MoJ2RpYWxvZy0tb3BlbicpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuYWRkVGFnID0gZnVuY3Rpb24gKHRhZykge1xyXG4gICAgICAgICAgICAgIGlmICh0eXBlb2YgJHNjb3BlLmRhdGEubWVzc2FnZSA9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5tZXNzYWdlID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLm1lc3NhZ2UgKz0gdGFnO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9ICRzY29wZS5kYXRhLm1lc3NhZ2UgKyBcIiBcIiArIHRhZztcclxuICAgICAgICAgICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDE2MCAmJiAkc2NvcGUubW9yZWNhcmFjdGVyID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiTm8gcHVlZGUgYWdyZWdhciBlc3RhIGV0aXF1ZXRhLCB5YSBxdWUgZXhjZWRlIGVsIGzDrW1pdGUgZGUgY2FyYWN0ZXJlc1wiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1lbHNlIGlmKHRleHQubGVuZ3RoID4gMzAwICYmICRzY29wZS5tb3JlY2FyYWN0ZXIgPT09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgICBzbGlkZU9uVG9wKFwiTm8gcHVlZGUgYWdyZWdhciBlc3RhIGV0aXF1ZXRhLCB5YSBxdWUgZXhjZWRlIGVsIGzDrW1pdGUgZGUgY2FyYWN0ZXJlc1wiLCAzMDAwLCBcImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlLXNpZ25cIiwgXCJkYW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEubWVzc2FnZSArPSBcIiBcIiArIHRhZztcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICRzY29wZS52YWxpZGF0ZUluTGluZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBtYWluLmxpc3RmdWxsc21zdGVtcGxhdGUoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmxpc3RmdWxsc21zdGVtcGxhdGUgPSBkYXRhO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgJHNjb3BlLnNtc3RlbXBsYXRlID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAkc2NvcGUudmlld1RlbXBsYXRlID0gIWRhdGE7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS51c2VUZW1wbGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goJHNjb3BlLmxpc3RmdWxsc21zdGVtcGxhdGUsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuaWRTbXNUZW1wbGF0ZSA9PSAkc2NvcGUuaWRTbXNUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuYWRkVGFnKHZhbHVlLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAkc2NvcGUuZ2V0T25lID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgICBtYWluLmdldE9uZVNtcyhpZFNtcykudGhlbihmdW5jdGlvbiAoZGF0YSlcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc21zID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pZFNtcyA9ICRzY29wZS5zbXMuaWRTbXM7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubmFtZSA9ICRzY29wZS5zbXMubmFtZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5ub3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc21zLm5vdGlmaWNhdGlvbiA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5ub3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLnNtcy5tb3JlY2FyYWN0ZXIgPT09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgICAgJHNjb3BlLm1vcmVjYXJhY3RlciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAkKFwiI21vcmVjYXJhY3RlclwiKS5wcm9wKCdjaGVja2VkJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICRzY29wZS5tb3JlY2FyYWN0ZXIgPSBmYWxzZTsgXHJcbiAgICAgICAgICAgICAgICAgICAkKFwiI21vcmVjYXJhY3RlclwiKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVtYWlsID0gJHNjb3BlLnNtcy5lbWFpbDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZWNlaXZlciA9ICRzY29wZS5zbXMucmVjZWl2ZXI7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaWRTbXNDYXRlZ29yeSA9ICRzY29wZS5zbXMuaWRTbXNDYXRlZ29yeTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5vcmlnaW5hbERhdGUgPSAkc2NvcGUuc21zLm9yaWdpbmFsRGF0ZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRlbm93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICQoJyN0b2dnbGUtdHdvJykuYm9vdHN0cmFwVG9nZ2xlKCdvZmYnKTtcclxuXHJcbiBcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNtcy5kYXRlTm93ID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGVub3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAkKCcjdG9nZ2xlLXR3bycpLmJvb3RzdHJhcFRvZ2dsZSgnb2ZmJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNtcy5hZHZhbmNlZG9wdGlvbnMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuYWR2YW5jZWRvcHRpb25zID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgJCgnI3RvZ2dsZS10aHJlZScpLmJvb3RzdHJhcFRvZ2dsZSgnb24nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc21zLm5vdGlmaWNhdGlvbiA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5ub3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAkKCcjdG9nZ2xlLW9uZScpLmJvb3RzdHJhcFRvZ2dsZSgnb24nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc21zLmRpdmlkZSA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5kaXZpZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAkKCcjdG9nZ2xlLWZvdXInKS5ib290c3RyYXBUb2dnbGUoJ29uJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUuc21zLnNlbmRwdXNoID09IDEpe1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2VuZHB1c2ggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAkKCcjdG9nZ2xlLW9uZScpLmJvb3RzdHJhcFRvZ2dsZSgnb24nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzY29wZS50aW1lem9uZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5BcHJveGltYXRlU2VuZGluZ3M7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudGltZUZvcm1hdCA9ICRzY29wZS5zbXMudGltZUZvcm1hdDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5xdWFudGl0eSA9IHBhcnNlSW50KCRzY29wZS5zbXMucXVhbnRpdHkpO1xyXG4vLyAgICAgICAgICAgICAgICAkc2NvcGUuZ210ID0gJHNjb3BlLnNtcy5nbXQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ210ID0gJHNjb3BlLnNtcy5nbXQ7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS5nZXRPbmUoKTtcclxuICAgICAgICAgICAgJHNjb3BlLnZhbGlkYXRlQmFsYW5jZVNtc0NvbnRhY3QoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS50cmlnZ2VyRW1haWxOb3RpZmljYXRpb25CYWxhbmNlU21zQ29udGFjdCA9IGZ1bmN0aW9uICh0b3RhbENvbnRhY3RzKXtcclxuICAgICAgICAgICAgICBpZigkc2NvcGUubWlzYy50b3RhbEF2YWlsYWJsZTx0b3RhbENvbnRhY3RzKXtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBpc21zQ29udGFjdEVtYWlsYmFsYW5jZSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcGlzbXNDb250YWN0RW1haWxiYWxhbmNlLnRvdGFsID0gdG90YWxDb250YWN0cztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXBpc21zQ29udGFjdEVtYWlsYmFsYW5jZS50b3RhbEF2YWlsYWJsZSA9ICRzY29wZS5taXNjLnRvdGFsQXZhaWxhYmxlO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zZW5kTWFpbE5vdGlmaWNhdGlvblNtc0NvbnRhY3RCYWxhbmNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfTtcclxuLy8gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICRzY29wZS5zZW5kTWFpbE5vdGlmaWNhdGlvblNtc0NvbnRhY3RCYWxhbmNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgbWFpbi5zZW5kTWFpbE5vdGlmaWNhdGlvblNtc0JhbGFuY2UoJHNjb3BlLmFwaXNtc0NvbnRhY3RFbWFpbGJhbGFuY2UpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsgXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9OyBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RBbGxMaXN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5hbGxMaXN0KTtcclxuICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFsbExpc3QpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLmFyckFkZHJlc3NlZSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAkc2NvcGUubGlzdEFsbEFkZHJlc3NlZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5hcnJBZGRyZXNzZWUucHVzaCgkc2NvcGUubGlzdEFsbEFkZHJlc3NlZVtpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLmFyckFkZHJlc3NlZSA9IFtdO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAkc2NvcGUuY291bnRDb250YWN0cygpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS5zd2l0Y2hyZXBlYXRlZGNsaWMgPSBmdW5jdGlvbiAoc3dpdGNocmVwZWF0ZWQpIHtcclxuICAgICAgICAgICAgICAkc2NvcGUuc3dpdGNocmVwZWF0ZWQgPSBzd2l0Y2hyZXBlYXRlZDtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuc3dpdGNocmVwZWF0ZWQpO1xyXG5cclxuICAgICAgICAgICAgICBpZiAoJHNjb3BlLnN3aXRjaHJlcGVhdGVkICE9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3dpdGNocmVwZWF0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgaWYgKCRzY29wZS5zd2l0Y2hyZXBlYXRlZCA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVwZTEnKS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlcGUyJykuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50Q29udGFjdHMoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgaWYgKCRzY29wZS5zd2l0Y2hyZXBlYXRlZCA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlcGUxJykuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlcGUyJykuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb3VudENvbnRhY3RzKCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgfV0pXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3Nob3dDb250YWN0JywgWyckcm9vdFNjb3BlJywgJyRzY29wZScsICckaHR0cCcsICdtYWluJywgJyR3aW5kb3cnLCAnJHRpbWVvdXQnLCAnbm90aWZpY2F0aW9uU2VydmljZScsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRodHRwLCBtYWluLCAkd2luZG93LCAkdGltZW91dCwgbm90aWZpY2F0aW9uU2VydmljZSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuaW5pdGlhbCA9IDA7XHJcbiAgICAgICAgICAgICRzY29wZS5wYWdlID0gMTtcclxuICAgICAgICAgICAgJHNjb3BlLmdldEFsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICBtYWluLmdldERldGFpbFNtcyhpZFNtcywgJHNjb3BlLmluaXRpYWwpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmxpc3RzbXMgPSByZXM7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS5mb3J3YXJkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICRzY29wZS5pbml0aWFsICs9IDE7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLnBhZ2UgKz0gMTtcclxuICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS5mYXN0Zm9yd2FyZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbCA9ICgkc2NvcGUubGlzdHNtcy5kZXRhaWxbMV0udG90YWxfcGFnZXMgLSAxKTtcclxuICAgICAgICAgICAgICAkc2NvcGUucGFnZSA9ICRzY29wZS5saXN0c21zLmRldGFpbFsxXS50b3RhbF9wYWdlcztcclxuICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICRzY29wZS5iYWNrd2FyZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbCAtPSAxO1xyXG4gICAgICAgICAgICAgICRzY29wZS5wYWdlIC09IDE7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAkc2NvcGUuZmFzdGJhY2t3YXJkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICRzY29wZS5pbml0aWFsID0gMDtcclxuICAgICAgICAgICAgICAkc2NvcGUucGFnZSA9IDE7XHJcbiAgICAgICAgICAgICAgJHNjb3BlLmdldEFsbCgpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAkc2NvcGUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgICRzY29wZS50cmFzbGF0ZVN0YXR1cyA9IGZ1bmN0aW9uIChzdGF0dXMpIHtcclxuICAgICAgICAgICAgICB2YXIgc3RyaW5nID0gXCJcIjtcclxuICAgICAgICAgICAgICBzd2l0Y2ggKHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcInNlbnRcIjpcclxuICAgICAgICAgICAgICAgICAgc3RyaW5nID0gXCJFbnZpYWRvXCI7XHJcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcInVuZGVsaXZlcmVkXCI6XHJcbiAgICAgICAgICAgICAgICAgIHN0cmluZyA9IFwiTm8gZW52aWFkb1wiO1xyXG4gICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZztcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgIH1dKVxyXG4gICAgICAgIC5mYWN0b3J5KCdub3RpZmljYXRpb25TZXJ2aWNlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgZnVuY3Rpb24gZXJyb3IobWVzc2FnZSkge1xyXG4gICAgICAgICAgICBzbGlkZU9uVG9wKG1lc3NhZ2UsIDQwMDAsICdnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZS1jaXJjbGUnLCAnZGFuZ2VyJyk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgZnVuY3Rpb24gc3VjY2VzcyhtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHNsaWRlT25Ub3AobWVzc2FnZSwgNDAwMCwgJ2dseXBoaWNvbiBnbHlwaGljb24tb2stY2lyY2xlJywgJ3N1Y2Nlc3MnKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBmdW5jdGlvbiB3YXJuaW5nKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgc2xpZGVPblRvcChtZXNzYWdlLCA0MDAwLCAnZ2x5cGhpY29uIGdseXBoaWNvbi1leGNsYW1hdGlvbi1zaWduJywgJ3dhcm5pbmcnKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBmdW5jdGlvbiBub3RpY2UobWVzc2FnZSkge1xyXG4gICAgICAgICAgICBzbGlkZU9uVG9wKG1lc3NhZ2UsIDQwMDAsICdnbHlwaGljb24gZ2x5cGhpY29uLWV4Y2xhbWF0aW9uLXNpZ24nLCAnbm90aWNlJyk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgZnVuY3Rpb24gcHJpbWFyeShtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHNsaWRlT25Ub3AobWVzc2FnZSwgNDAwMCwgJ2dseXBoaWNvbiBnbHlwaGljb24tZXhjbGFtYXRpb24tc2lnbicsICdwcmltYXJ5Jyk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBzdWNjZXNzLFxyXG4gICAgICAgICAgICB3YXJuaW5nOiB3YXJuaW5nLFxyXG4gICAgICAgICAgICBub3RpY2U6IG5vdGljZSxcclxuICAgICAgICAgICAgcHJpbWFyeTogcHJpbWFyeVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9qcy9hbmd1bGFyL3Ntcy9jb250cm9sbGVyLmpzXG4vLyBtb2R1bGUgaWQgPSAxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1\n");

/***/ })
/******/ ]);