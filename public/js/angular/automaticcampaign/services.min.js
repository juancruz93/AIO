(function(){angular.module('automaticcampaign.services',[]).service('restServices',['$http','$q','notificationService','moment',function(a,b,c,d){this.createAutomaticCampaign=function(e){var f=b.defer(),g=fullUrlBase+'api/automacamp/save';return a.post(g,e).success(function(h){f.resolve(h)}).error(function(h){f.reject(h),c.error(h.message)}),f.promise},this.cancelAutomaticCampaign=function(e){var f=b.defer(),g=fullUrlBase+'api/automacamp/cancelautomaticcampaign';return a.post(g,e).success(function(h){f.resolve(h)}).error(function(h){f.reject(h),c.error(h.message)}),f.promise},this.getservices=function(){var e=b.defer(),f=fullUrlBase+'api/saxs/getall';return a.get(f).success(function(g){0==g.length&&(c.error('No tienes servicios disponibles, para adquirir uno por favor contacta a soporte.'),e.reject(g)),e.resolve(g)}).error(function(g){e.reject(g),c.error(g.message)}),e.promise},this.getallcategory=function(){var e=b.defer(),f=fullUrlBase+'api/automacampcateg/allcategory';return a.get(f).success(function(g){0==g.length&&(c.error('No se encontraron categorias para la campa\xF1a.'),e.reject(g)),e.resolve(g)}).error(function(g){e.reject(g),c.error(g.message)}),e.promise},this.getGmt=function(){var e=b.defer(),f=fullUrlBase+'mail/timezone/';return a.get(f).success(function(g){e.resolve(g)}).error(function(g){e.reject(g),c.error(g.message)}),e.promise},this.editAutomaticCampaign=function(e){var f=b.defer(),g=fullUrlBase+'api/automacamp/getautomaticcampaign/'+e;return a.get(g).success(function(h){f.resolve(h)}).error(function(h){f.reject(h),c.error(h.message)}),f.promise},this.updateAutomaticCampaignAll=function(e,f){var g=b.defer(),h=fullUrlBase+'api/automacamp/updatecampaignall/'+f;return a.put(h,e).success(function(j){g.resolve(j)}).error(function(j){g.reject(j),c.error(j.message)}),g.promise},this.updateAutomaticCampaign=function(e,f){var g=b.defer(),h=fullUrlBase+'api/automacamp/updatecampaign/'+f;return a.put(h,e).success(function(j){g.resolve(j)}).error(function(j){g.reject(j),c.error(j.message)}),g.promise},this.updateAutomaticCampaignConfiguration=function(e,f){var g=b.defer(),h=fullUrlBase+'api/automacamp/updatecampaignconfiguration/'+f;return a.put(h,e).success(function(j){g.resolve(j)}).error(function(j){g.reject(j),c.error(j.message)}),g.promise},this.createAutomaticCampaignDraft=function(e){var f=b.defer(),g=fullUrlBase+'api/automacamp/savedraft';return a.post(g,e).success(function(h){f.resolve(h)}).error(function(h){f.reject(h),c.error(h.message)}),f.promise},this.updateStatusCampaign=function(e){var f=b.defer(),g=fullUrlBase+'api/automacamp/updatestatus/'+e;return a.put(g,{status:'draft'}).success(function(j){f.resolve(j)}).error(function(j){f.reject(j),c.error(j.message)}),f.promise},this.listcampaign=function(e,f){var g=b.defer(),h=fullUrlBase+'api/automacamp/list/'+e;return a.post(h,f).success(function(j){g.resolve(j)}).error(function(j){g.reject(j)}),g.promise},this.validateJsonAutomaticCampaign=function(e,f){var g=b.defer();0>=e.connections&&(c.error('No se encontro ninguna conexion en la campa\xF1a.'),g.reject()),3>e.nodes.length&&(c.error('El numero de nodos debe ser mayor a 3.'),g.reject()),61<e.nodes.length&&(c.error('El numero de nodos debe ser mayor a 60.'),g.reject()),e.nodes.length-1!=e.connections.length&&(c.error('las conexiones no coinciden con los nodos, por favor revisar.'),g.reject());for(var h=0;h<e.nodes.length;h++)jQuery.isEmptyObject(e.nodes[h].sendData)&&(c.error('Ningun nodo debe estar vacio, por favor revisar.'),g.reject());for(var h=0;h<e.connections.length;h++)'negation'==e.connections[h].class&&jQuery.isEmptyObject(e.connections[h].sendData)&&(c.error('Hay relaciones que no pueden estar vacias, por favor revisar.'),g.reject());return this.validateService(e,f).catch(function(){c.error('Ningun nodo debe estar vacio, por favor revisar.'),g.reject()}),g.resolve(!0),g.promise},this.validateFormCampaign=function(e){var f=b.defer(),g=d(e.startDate).utc('-0500').add(30,'minutes').format('YYYY-MM-DD HH:mm'),h=d().utc('-0500').format('YYYY-MM-DD HH:mm');return(''==e.startDate||null==e.startDate)&&(c.error('El campo de fecha inicial es obligatorio.'),f.reject()),(''==e.gmt||null==e.gmt)&&(c.error('El campo de gmt es obligatorio.'),f.reject()),g<h&&(c.error('La fecha inicial no debe ser menor a la fecha actual'),f.reject()),(''==e.campaignCategory||'undefined'==typeof e.campaignCategory||null==e.campaignCategory)&&(c.error('El campo de categoria de campa\xF1a es obligatorio.'),f.reject()),(''==e.descriptionCampaign||'undefined'==typeof e.descriptionCampaign||null==e.descriptionCampaign)&&(e.descriptionCampaign=''),(''==e.nameCampaign||'undefined'==typeof e.nameCampaign||null==typeof e.nameCampaign)&&(c.error('El campo de nombre de campa\xF1a es obligatorio.'),f.reject()),f.resolve(e),f.promise},this.validateService=function(e,f){var g=b.defer();if(0==f.length&&(c.error('La campa\xF1a tiene servicios que no estan habilitados, por favor contactar a soporte.'),g.reject()),2>f.length){for(var h=0;h<e.nodes.length;h++)'service'==e.nodes[h].theme&&f[0].service!=e.nodes[h].method&&(c.error('La campa\xF1a tiene servicios que no estan habilitados, por favor contactar a soporte.'),g.reject());g.resolve()}else g.resolve();return g.promise},this.countContact=function(e){var f=b.defer(),g=fullUrlBase+'api/sendmail/countcontact';return a.post(g,e).success(function(h){f.resolve(h)}).error(function(h){f.reject(h),c.error(h.message)}),f.promise},this.getScheme=function(e){var f=b.defer(),g=fullUrlBase+'api/automacamp/getscheme/'+e;return a.get(g).success(function(h){f.resolve(h)}).error(function(h){f.reject(h),c.error(h.message)}),f.promise}}]).factory('notificationService',function(){return{error:function(f){slideOnTop(f,4e3,'glyphicon glyphicon-remove-circle','danger')},success:function(f){slideOnTop(f,4e3,'glyphicon glyphicon-ok-circle','success')},warning:function(f){slideOnTop(f,4e3,'glyphicon glyphicon-exclamation-sign','warning')},notice:function(f){slideOnTop(f,4e3,'glyphicon glyphicon-exclamation-sign','notice')},primary:function(f){slideOnTop(f,4e3,'glyphicon glyphicon-exclamation-sign','primary')}}}).factory('setData',function(){var a={},b={};return a.getData=function(){return b},a.setData=function(c){b=c},a})})();